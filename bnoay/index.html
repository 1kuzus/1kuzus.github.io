<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><script async src="https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-45BYSZ6WPY")</script><title>铃木的网络日记</title><script defer="defer" src="/static/js/main.44188c52.js"></script><link href="/static/css/main.537669bb.css" rel="stylesheet"></head><body><noscript><div><h1>复盘：复现NeRF-RPN代码</h1><h2>说明</h2><p>复现仓库：<a href="https://github.com/lyclyc52/NeRF_RPN" target="_blank" rel="noreferrer">https://github.com/lyclyc52/NeRF_RPN</a></p><p>这项研究在NeRF中引入RPN，用于3D物体检测和相关任务。作者提供了改写的Instant-NGP以供可视化3D提议框。我自己在尝试复现的时候绕了一些弯子，因此借这篇博客复盘一下当时的过程。仓库提供的脚本多为适用于linux系统的.sh文件，而我自己的设备是windows系统，因此示例中会给出适用于windows系统的相应指令。</p><h2>环境相关</h2><h3>克隆仓库</h3><div>[CODEBLOCK]</div><div><h4>遇到问题</h4><h4>git clone 失败，报错 fatal: early EOF</h4><p>报错：</p><div>[CODEBLOCK]</div><p>解决：增大缓冲区(1048576000是1G)</p><div>[CODEBLOCK]</div></div><h3>下载数据集</h3><p>作者提供了数据集的<a href="https://hkustconnect-my.sharepoint.com/:f:/g/personal/bhuai_connect_ust_hk/Ekjf3YC0W9BMsc-jHWXI4xEBy5s_OJBLEbebNVIprd4zMg?e=FgbN9S" target="_blank" rel="noreferrer">OneDrive链接</a>，这里以3D-FRONT数据集作为例子，需要从作者提供的链接中下载front3d_nerf_data.zip和front3d_rpn_data.zip。</p><p>假设数据集解压的路径为E:\front3d_nerf_data和E:\front3d_rpn_data。</p><h3>可视化数据集</h3><p>在完成上面步骤后，就可以先利用Instant-NGP的UI可视化数据集中标注的groundtruth了，这里以场景3dfront_0004_00为例：</p><div>[CODEBLOCK]</div><p>执行上述命令后，勾选UIDebug visualization下的Visualize object bounding boxes就可以看到如下结果：</p><div>[IMAGE]</div><h3>下载预训练的权重</h3><p>本博客给出的示例需要在上面的OneDrive链接中下载nerf_rpn_model_release\front3d_anchor_resnet50.pt。</p><p>假设预训练权重保存的路径为NeRFrpn[backslash]nerf_rpn\weights\front3d_anchor_resnet50.pt。</p><h2>生成proposals</h2><p>接下来，利用预训练的权重，写一个test脚本生成提议框。</p><div>[CODEBLOCK]</div><p>由于我的设备显存小，所以把batch_size改为了1。原始的参数是2。</p><p>运行后会在NeRFrpn[backslash]nerf_rpn[backslash]results[backslash]front3d_test中得到eval.json文件和储存了17个测试场景的提议框的proposals目录。</p><div><h4>遇到问题</h4><h4>CUDA device 不匹配</h4><p>报错：<br/>RuntimeError: Attempting to deserialize object on CUDA device 4 buttorch.cuda.device_count() is 1. Please use torch.load with map_location to map your storages to anexisting device.</p><p>解决：在run_rpn.py找到下面这行代码：</p><div>[CODEBLOCK]</div><p>运行后会在NeRFrpn[backslash]nerf_rpn[backslash]results[backslash]proposals_to_ngp中得到17个测试场景的3dfront_xxxx_xx.json文件。</p><p>接下来，把文件3dfront_0004_00.json复制到路径E:[backslash]front3d_nerf_data[backslash]3dfront_0004_00[backslash]train下，然后启动Instant-NGP的UI并指定这个新的json文件：</p><div>[CODEBLOCK]</div><p>可以看到如下结果：</p><div>[IMAGE]</div><h2>文件结构参考</h2><p>这里展示了前面我们生成、或需要用到的各个文件的路径示意。注意这并不是仓库中的全部内容，而是只展示了前面提及的文件。</p><div>[CODEBLOCK]</div></div></noscript><div id="root"></div></body></html>