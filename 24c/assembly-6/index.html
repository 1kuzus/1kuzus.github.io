<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/7d7aa1060b5664fb.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/f421cb1dbc9a88bf.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-791decc97e4b377f.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-e278622fa62dc0bf.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-faab496ef6116e58.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-ed6799cd4e1df27b.js" async="" crossorigin=""></script><script src="/_next/static/chunks/457b8330-69f8bab043e7caf2.js" async=""></script><script src="/_next/static/chunks/d3ac728e-0c798b3b8aa3bf53.js" async=""></script><script src="/_next/static/chunks/250-0ef8476c0fa8ee24.js" async=""></script><script src="/_next/static/chunks/612-c60a65f28e774a61.js" async=""></script><script src="/_next/static/chunks/548-617600d488b129da.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-bddbb5dbd3f48f88.js" async=""></script><script src="/_next/static/chunks/app/page-43cb1a3cad7f6aa8.js" async=""></script><script src="/_next/static/chunks/app/layout-8463ba7e9dd08fd1.js" async=""></script><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY"></script><title>【汇编语言】中断及外部设备操作 - 铃木的网络日记</title><link rel="canonical" href="https://1kuzus.github.io/24c/assembly-6/"/><link rel="icon" href="/favicon.ico" type="image/x-icon"/><script>
window.dataLayer = window.dataLayer || [];
function gtag() {
    dataLayer.push(arguments);
}
gtag('js', new Date());
gtag('config', 'G-45BYSZ6WPY');
</script><script>const a=z=>h.getItem(z),b=(y,z)=>h.setItem(y,z),c=(y,z)=>document.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e&&a(d)!==f&&b(d,f);a(d)===e?c(g,e):c(g,f);</script><script>
if (!Array.prototype.findLast) {
    Array.prototype.findLast = function (callback) {
        for (let i = this.length - 1; i >= 0; i--) {
            if (callback(this[i])) return this[i];
        }
        return undefined;
    };
}
if (!Array.prototype.findLastIndex) {
    Array.prototype.findLastIndex = function (callback) {
        for (let i = this.length - 1; i >= 0; i--) {
            if (callback(this[i])) return i;
        }
        return -1;
    };
}
</script><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body><div id="header"><div id="header-left-wrapper"><a href="/"><div id="header-logo-bg"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 1560 1560"><path fill="#00A8C4" d="M644 97h273l272 683H916z"></path><path fill="#30303C" d="M98 97h273l409 1024L1189 97h273L916 1462H644z"></path><path fill="#00F8FF" d="M98 1462 643 97h273L371 1462z"></path></svg></div></a></div><div id="header-right-wrapper"><button id="header-show-sidebar-button" class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024"><rect fill="#FCFCFC" x="100" y="148" width="824" height="128" rx="64"></rect><rect fill="#FCFCFC" x="100" y="448" width="824" height="128" rx="64"></rect><rect fill="#FCFCFC" x="100" y="748" width="824" height="128" rx="64"></rect></svg></button><button class="header-button-bg"><div id="header-dark-theme-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024"><path fill="#FCFCFC" d="M525 939h-4a440 440 0 0 1-314-135 446 446 0 0 1-11-597A432 432 0 0 1 367 90a43 43 0 0 1 45 9 43 43 0 0 1 10 43 358 358 0 0 0 83 376 361 361 0 0 0 377 83 43 43 0 0 1 54 55 433 433 0 0 1-100 155 439 439 0 0 1-311 128z"></path></svg></div><div id="header-light-theme-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024"><path fill="#FCFCFC" d="M512 61c13 0 25 8 30 20l28 68c11 29-5 62-36 73a66 66 0 0 1-22 3c-34 0-61-25-61-56 0-7 1-14 3-20l28-68c5-12 17-20 30-20zm0 902c-13 0-25-8-30-20l-28-68a53 53 0 0 1-3-20c0-31 27-56 61-56a66 66 0 0 1 22 3c31 11 47 44 36 73l-28 68c-5 12-17 20-30 20zm451-451c0 13-8 25-20 30l-68 28c-29 11-62-5-73-36a66 66 0 0 1-3-22c0-34 25-61 56-61 7 0 14 1 20 3l68 28c12 5 20 17 20 30zm-902 0c0-13 8-25 20-30l68-28a53 53 0 0 1 20-3c31 0 56 27 56 61a66 66 0 0 1-3 22 57 57 0 0 1-73 36l-68-28c-12-5-20-17-20-30zm132-319c10-9 24-12 35-7l68 28c29 13 41 47 26 77a66 66 0 0 1-13 18c-24 24-61 26-83 4a53 53 0 0 1-12-17l-28-68c-5-11-2-25 7-35zm638 638c-10 9-24 12-35 7l-68-28a53 53 0 0 1-17-12c-22-22-20-59 4-83a66 66 0 0 1 18-13c30-15 64-3 77 26l28 68c5 11 2 25-7 35zm0-638c9 10 12 24 7 35l-28 68a56 56 0 0 1-77 26 66 66 0 0 1-18-13c-24-24-26-61-4-83 5-5 11-9 17-12l68-28c11-5 25-2 35 7zM193 831c-9-10-12-24-7-35l28-68a53 53 0 0 1 12-17c22-22 59-20 83 4a66 66 0 0 1 13 18c15 30 3 64-26 77l-68 28c-11 5-25 2-35-7zm319-94a225 225 0 1 1 0-450 225 225 0 0 1 0 450z"></path></svg></div></button><a href="https://github.com/1kuzus/1kuzus.github.io" target="_blank" rel="noreferrer"><div class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 1024 1024"><path fill="#FCFCFC" d="M411 831c4-5 7-10 7-12v-70c-106 22-128-44-128-44-17-45-43-56-43-56-34-24 4-24 4-24 37 3 58 39 58 39 34 58 89 41 111 32 3-24 13-41 24-51-86-10-174-43-174-188 0-41 15-75 39-102-4-10-17-48 3-101 0 0 33-10 104 40 31-9 64-12 96-12s65 5 96 12c73-50 104-40 104-40 20 53 8 91 3 101 24 27 39 60 39 102 0 145-88 178-174 188 14 12 26 34 26 70v104c0 4 2 7 7 12 5 7 3 19-4 24-3 2-7 3-10 3H425c-10 0-17-6-17-17 0-5 2-8 3-10z"></path></svg></div></a></div></div><div id="contents"><h4 id="contents-header">本页目录</h4></div><div id="post-layout"><div id="main" class="center-wrapper"><h1 class="x-title">【汇编语言】中断及外部设备操作</h1><div class="views-count"><span class="views-count-views">0<!-- --> Views.</span></div><!--$--><!--$--><h2 class="x-h1">描述内存单元的标号</h2><p class="x-p">汇编语言中同样可以用标号表示内存单元，称为数据标号，使用起来的感觉很像C语言的数组。下面的程序计算<code class="x-inline-highlight">arr</code>中元素的和，并存放在数据标号<code class="x-inline-highlight">x</code>对应的字空间中：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg,<span class="token register variable">ds</span>:datasg

datasg <span class="token keyword">segment</span>
    arr    <span class="token keyword">db</span> <span class="token number">1,</span><span class="token number">2,</span><span class="token number">3,</span><span class="token number">4,</span><span class="token number">5,</span><span class="token number">6,</span><span class="token number">7,</span><span class="token number">8
</span>    x      <span class="token keyword">dw</span> <span class="token number">0
</span>datasg <span class="token keyword">ends</span>

codesg <span class="token keyword">segment</span>
    start:
           <span class="token function">mov</span>  <span class="token register variable">ax</span>,datasg
           <span class="token function">mov</span>  <span class="token register variable">ds</span>,<span class="token register variable">ax</span>

           <span class="token function">mov</span>  <span class="token register variable">si</span>,<span class="token number">0
</span>           <span class="token function">mov</span>  <span class="token register variable">cx</span>,<span class="token number">8
</span>    s:     <span class="token function">mov</span>  <span class="token register variable">ah</span>,<span class="token number">0
</span>           <span class="token function">mov</span>  <span class="token register variable">al</span>,arr<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>    <span class="token comment">;使用数据标号</span>
           <span class="token function">add</span>  x,<span class="token register variable">ax</span>          <span class="token comment">;使用数据标号</span>
           <span class="token function">inc</span>  <span class="token register variable">si</span>
           <span class="token function">loop</span> s

           <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>           <span class="token function">int</span>  <span class="token number">21h
</span>codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><p class="x-p">和前面学习的地址标号相比，地址标号仅仅表示一个地址，而数据标号表示地址的同时还暗含了数据的类型，操作时不再需要用<code class="x-inline-highlight">byte ptr</code>等显式地指定数据的类型。</p><h2 class="x-h1">操作显存</h2><p class="x-p">屏幕上的内容其实就是显存中的数据。显存是一块内存区域，在8086 CPU中，显存占用地址<code class="x-inline-highlight">a0000h</code>~<code class="x-inline-highlight">bffffh</code>共<code class="x-inline-highlight">128KB</code>的地址空间，而显示字符时常用到其中的一小块区域：<code class="x-inline-highlight">b8000h</code>~<code class="x-inline-highlight">bffffh</code>共<code class="x-inline-highlight">32KB</code>的地址空间，它是<code class="x-inline-highlight">25</code>行、<code class="x-inline-highlight">80</code>列彩色字符模式第<code class="x-inline-highlight">0</code>页的显示缓冲区。</p><p class="x-p">这<code class="x-inline-highlight">32KB</code>的地址空间被划分为<code class="x-inline-highlight">8</code>个页，每个页<code class="x-inline-highlight">4KB</code>；<code class="x-inline-highlight">25</code>行、<code class="x-inline-highlight">80</code>列一共<code class="x-inline-highlight">2000</code>个字符，每个字符用<code class="x-inline-highlight">2</code>个字节描述，刚好是一页的大小。这两个字节分别是：要显示符号的ASCII码、显示属性。</p><p class="x-p">显示属性一个字节共<code class="x-inline-highlight">8</code>位，从高到低依次是：</p><div class="x-table-wrapper"><table class="x-table"><tbody><tr><th><p>位</p></th><td><p><code class="x-inline-highlight">7</code></p></td><td><p><code class="x-inline-highlight">6</code></p></td><td><p><code class="x-inline-highlight">5</code></p></td><td><p><code class="x-inline-highlight">4</code></p></td><td><p><code class="x-inline-highlight">3</code></p></td><td><p><code class="x-inline-highlight">2</code></p></td><td><p><code class="x-inline-highlight">1</code></p></td><td><p><code class="x-inline-highlight">0</code></p></td></tr><tr><th><p>含义</p></th><td><p>闪烁</p></td><td><p>背景<code class="x-inline-highlight">R</code></p></td><td><p>背景<code class="x-inline-highlight">G</code></p></td><td><p>背景<code class="x-inline-highlight">B</code></p></td><td><p>高亮</p></td><td><p>前景<code class="x-inline-highlight">R</code></p></td><td><p>前景<code class="x-inline-highlight">G</code></p></td><td><p>前景<code class="x-inline-highlight">B</code></p></td></tr></tbody></table></div><p class="x-p">直接修改内存对应地址的值，屏幕上就会立即有变化：</p><img alt="img" loading="lazy" width="1021" height="79" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:100%;height:auto" src="/_next/static/media/fig1.a5cb63cb.jpg"/><h2 class="x-h1">中断、中断处理程序</h2><p class="x-p">在8086 CPU中，中断可以打断当前程序的执行，当CPU收到中断请求时，会执行中断处理程序，处理完后再返回到原程序继续执行。中断处理程序的入口地址存放在<span class="x-inline-strong">中断向量表</span>中，根据中断类型码查表得到对应处理程序的入口地址。</p><p class="x-p">8086 CPU的中断向量表是一个<code class="x-inline-highlight">1KB</code>的表，包含了<code class="x-inline-highlight">256</code>个中断类型码对应的中断处理程序的入口地址，每个入口地址占<code class="x-inline-highlight">4</code>个字节，前两字节存放<code class="x-inline-highlight">IP</code>的值，后两字节存放<code class="x-inline-highlight">CS</code>的值。中断向量表的起始地址是<code class="x-inline-highlight">00000h</code>，终止地址是<code class="x-inline-highlight">003ffh</code>。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>00000h: 0号中断处理程序的入口地址IP
00002h: 0号中断处理程序的入口地址CS
00004h: 1号中断处理程序的入口地址IP
00006h: 1号中断处理程序的入口地址CS
00008h: 2号中断处理程序的入口地址IP
0000ah: 2号中断处理程序的入口地址CS
...
003fch: 255号中断处理程序的入口地址IP
003feh: 255号中断处理程序的入口地址CS
</code></pre></div><p class="x-p">中断可以分为：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>内部中断：由CPU内部产生，如除法错误（<code class="x-inline-highlight">0</code>号）、溢出（<code class="x-inline-highlight">4</code>号）、<code class="x-inline-highlight">int n</code>指令触发（<code class="x-inline-highlight">n</code>号）等。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>外部中断：由外部设备产生，如键盘输入等。</p></div></div><img alt="img" loading="lazy" width="1200" height="450" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:800px;height:auto" src="/_next/static/media/fig9.ed6e4214.jpg"/><p class="x-p">其中外部中断又分为可屏蔽中断和不可屏蔽中断：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>可屏蔽中断：CPU可以不响应的外中断，一般是由外部硬件通过INTR<code class="x-inline-highlight">(Interrupt Request)</code>信号线发送给CPU；CPU是否响应取决于<code class="x-inline-highlight">IF</code>标志位，如果<code class="x-inline-highlight">IF=0</code>，CPU不响应可屏蔽中断。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>不可屏蔽中断：CPU必须响应的外中断，通过NMI<code class="x-inline-highlight">(Non-Maskable Interrupt)</code>信号线发送。8086 CPU不可屏蔽中断的中断类型码固定为<code class="x-inline-highlight">2</code>。</p></div></div><p class="x-p">几乎所有外部设备引发的中断都是可屏蔽中断，如键盘输入、打印机请求等；而不可屏蔽中断是在系统有必须处理的紧急情况发生时用来通知CPU的中断信息。</p><h3 class="x-h2">8086 CPU中断过程</h3><p class="x-p">中断过程由CPU的硬件自动完成，用中断类型码找到中断向量，并用它设置CS和IP。具体地说8086 CPU的中断过程为：</p><div class="x-oli"><div class="x-oli-number">1.</div><div class="x-oli-content-wrapper"><p>从中断信息中取得中断类型码</p></div></div><div class="x-oli"><div class="x-oli-number">2.</div><div class="x-oli-content-wrapper"><p>标志寄存器入栈（中断过程会改变标志，需要先进行保护）</p></div></div><div class="x-oli"><div class="x-oli-number">3.</div><div class="x-oli-content-wrapper"><p>设置<code class="x-inline-highlight">IF=0</code>，<code class="x-inline-highlight">TF=0</code></p></div></div><div class="x-oli"><div class="x-oli-number">4.</div><div class="x-oli-content-wrapper"><p><code class="x-inline-highlight">CS</code>入栈，<code class="x-inline-highlight">IP</code>入栈</p></div></div><div class="x-oli"><div class="x-oli-number">5.</div><div class="x-oli-content-wrapper"><p>从中断向量表读取中断处理程序的入口地址，设置<code class="x-inline-highlight">CS</code>和<code class="x-inline-highlight">IP</code></p></div></div><div class="x-oli"><div class="x-oli-number">6.</div><div class="x-oli-content-wrapper"><p>开始执行中断处理程序</p></div></div><h3 class="x-h2">单步中断</h3><p class="x-p">标志寄存器中有两个标志位与中断有关：<code class="x-inline-highlight">TF(Trap Flag)</code>和<code class="x-inline-highlight">IF(Interrupt Flag)</code>。<code class="x-inline-highlight">TF</code>用于单步执行，<code class="x-inline-highlight">IF</code>用于可屏蔽中断的开关。</p><p class="x-p"><code class="x-inline-highlight">TF</code>陷阱标志用于调试，当<code class="x-inline-highlight">TF=1</code>时，CPU在执行完一条指令后，会产生一个<code class="x-inline-highlight">1</code>号中断，由系统控制计算机。</p><p class="x-p"><code class="x-inline-highlight">IF</code>中断标志用于控制CPU是否响应可屏蔽中断。当<code class="x-inline-highlight">IF=1</code>时，CPU响应可屏蔽中断；当<code class="x-inline-highlight">IF=0</code>时，CPU不响应可屏蔽中断。这个标志位可以用<code class="x-inline-highlight">sti</code>指令和<code class="x-inline-highlight">cli</code>指令来设置：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token function">sti</span>  <span class="token comment">;设置IF=1，CPU响应可屏蔽中断</span>
<span class="token function">cli</span>  <span class="token comment">;设置IF=0，CPU不响应可屏蔽中断</span>
</code></pre></div><div class="x-highlightblock highlight-background-red"><h4 class="x-h3">讨论</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">8086 CPU中断过程第<code class="x-inline-highlight">3</code>步中，为什么要设置<code class="x-inline-highlight">TF=0</code>？</p><p class="x-p">中断处理程序也是一条条的指令。如果在执行中断处理程序前<code class="x-inline-highlight">TF=1</code>，则执行完程序的第一条指令后，又会产生单步中断，然后转去执行单步中断的中断处理程序。此时由于<code class="x-inline-highlight">TF=1</code>，则执行完第一条指令后，又会产生单步中断……</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">8086 CPU中断过程第<code class="x-inline-highlight">3</code>步中，为什么要设置<code class="x-inline-highlight">IF=0</code>？</p><p class="x-p">进入中断处理程序后，禁止其他的可屏蔽中断，避免中断嵌套。</p></div></div></div><h3 class="x-h2">int指令与iret指令</h3><p class="x-p">在执行<code class="x-inline-highlight">int n</code>时，逻辑上相当于自动依次执行了：<code class="x-inline-highlight">pushf</code>、<code class="x-inline-highlight">push cs</code>、<code class="x-inline-highlight">push ip</code>；它和<code class="x-inline-highlight">call</code>指令保存<code class="x-inline-highlight">CS</code>和<code class="x-inline-highlight">IP</code>的行为很像，但还保存并修改了标志寄存器的值。</p><p class="x-p">对应地，从一个中断处理程序返回到原程序时，需要使用<code class="x-inline-highlight">iret</code>指令，逻辑上相当于自动依次执行了：<code class="x-inline-highlight">pop ip</code>、<code class="x-inline-highlight">pop cs</code>、<code class="x-inline-highlight">popf</code>。</p><h3 class="x-h2">int指令示例</h3><p class="x-p">在这里我们编写设计一个<code class="x-inline-highlight">int 7ch</code>中断，功能是将以<code class="x-inline-highlight">0</code>结尾的纯字母字符串转为大写，参数是<code class="x-inline-highlight">DS:SI</code>指向字符串首地址。</p><p class="x-p">先看不使用中断，只用最一般的子程序调用的实现：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg,<span class="token register variable">ds</span>:datasg,<span class="token register variable">ss</span>:stcksg

datasg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token string">'misunderstanding'</span>,<span class="token number">0
</span>datasg <span class="token keyword">ends</span>

stcksg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token number">16 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
stcksg <span class="token keyword">ends</span>

codesg <span class="token keyword">segment</span>
    start:
           <span class="token function">mov</span>  <span class="token register variable">ax</span>,datasg
           <span class="token function">mov</span>  <span class="token register variable">ds</span>,<span class="token register variable">ax</span>
           <span class="token function">mov</span>  <span class="token register variable">si</span>,<span class="token number">0 </span>                      <span class="token comment">;设置DS:SI为字符串首地址</span>
           <span class="token function">call</span> i7ch

           <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>           <span class="token function">int</span>  <span class="token number">21h
</span>
    i7ch:
           <span class="token function">push</span> <span class="token register variable">cx</span>
           <span class="token function">push</span> <span class="token register variable">si</span>
           <span class="token function">mov</span>  <span class="token register variable">ch</span>,<span class="token number">0
</span>    w:     <span class="token function">mov</span>  <span class="token register variable">cx</span>,<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>
           <span class="token function">jcxz</span> return
           <span class="token function">and</span>  <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token number">11011111b
</span>           <span class="token function">inc</span>  <span class="token register variable">si</span>
           <span class="token function">jmp</span>  w
    return:<span class="token function">pop</span>  <span class="token register variable">si</span>
           <span class="token function">pop</span>  <span class="token register variable">cx</span>
           <span class="token function">ret</span>
codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><img alt="img" loading="lazy" width="1022" height="181" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:100%;height:auto" src="/_next/static/media/fig11.daae968e.jpg"/><p class="x-p">现在希望编写一个<code class="x-inline-highlight">i7ch</code>中断处理程序，由<code class="x-inline-highlight">int 7ch</code>触发中断；此时需要一个确定、但又不影响系统的内存位置存放程序；一个技巧是使用中断向量表的内存区域，因为别的程序不会用到，而系统要处理的中断事件也远没有<code class="x-inline-highlight">256</code>个，因此可以利用中断向量表后段地址空间，这里选取从<code class="x-inline-highlight">00200h</code>开始的地址空间作为存放<code class="x-inline-highlight">i7ch</code>程序的目的地址。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 312px, var(--bg-transparent-golden) 312px 504px, transparent 504px, transparent 600px, var(--bg-transparent-golden) 600px 624px, transparent 624px, transparent 720px, var(--bg-transparent-golden) 720px 1152px, transparent 1152px, transparent 1440px, var(--bg-transparent-golden) 1440px 1464px, transparent 1464px)"><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg,<span class="token register variable">ds</span>:datasg,<span class="token register variable">ss</span>:stcksg

datasg <span class="token keyword">segment</span>
              <span class="token keyword">db</span> <span class="token string">'misunderstanding'</span>,<span class="token number">0
</span>datasg <span class="token keyword">ends</span>

stcksg <span class="token keyword">segment</span>
              <span class="token keyword">db</span> <span class="token number">16 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
stcksg <span class="token keyword">ends</span>

codesg <span class="token keyword">segment</span>
       start:
       <span class="token comment">;安装中断处理程序</span>
                <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">0
</span>                <span class="token function">mov</span>  <span class="token register variable">es</span>,<span class="token register variable">ax</span>
                <span class="token function">mov</span>  <span class="token register variable">di</span>,<span class="token number">200h </span>                               <span class="token comment">;设置安装位置，安装到ES:DI处</span>
                <span class="token function">call</span> install
       <span class="token comment">;设置中断向量表</span>
                <span class="token function">mov</span>  <span class="token keyword">word</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">7ch*</span><span class="token number">4]</span>,<span class="token number">200h </span>              <span class="token comment">;设置7ch号中断的IP=200h</span>
                <span class="token function">mov</span>  <span class="token keyword">word</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">7ch*</span><span class="token number">4+</span><span class="token number">2]</span>,<span class="token number">0 </span>               <span class="token comment">;设置7ch号中断的CS=0</span>
       <span class="token comment">;调用中断实现功能</span>
                <span class="token function">mov</span>  <span class="token register variable">ax</span>,datasg
                <span class="token function">mov</span>  <span class="token register variable">ds</span>,<span class="token register variable">ax</span>
                <span class="token function">mov</span>  <span class="token register variable">si</span>,<span class="token number">0 </span>                                  <span class="token comment">;设置DS:SI为字符串首地址</span>
                <span class="token function">int</span>  <span class="token number">7ch
</span>
                <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>                <span class="token function">int</span>  <span class="token number">21h
</span>
       <span class="token comment">;中断安装程序</span>
       <span class="token comment">;使用movsb指令安装，该指令从DS:SI复制到ES:DI，ES:DI在前面已经设置好</span>
       install:
                <span class="token function">push</span> <span class="token register variable">ax</span>
                <span class="token function">push</span> <span class="token register variable">cx</span>
                <span class="token function">push</span> <span class="token register variable">si</span>
                <span class="token function">push</span> <span class="token register variable">ds</span>
                <span class="token function">cld</span>                                         <span class="token comment">;设置方向标志</span>
                <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token register variable">cs</span>
                <span class="token function">mov</span>  <span class="token register variable">ds</span>,<span class="token register variable">ax</span>                                  <span class="token comment">;设置DS为代码段起始地址</span>
                <span class="token function">mov</span>  <span class="token register variable">si</span>,<span class="token keyword">offset</span> i7ch                         <span class="token comment">;设置SI为offset i7ch（从子程序开始处复制）</span>
                <span class="token function">mov</span>  <span class="token register variable">cx</span>,<span class="token keyword">offset</span> end_i7ch <span class="token operator">-</span> <span class="token keyword">offset</span> i7ch       <span class="token comment">;使用地址标号相减得到指令长度，也是循环次数</span>
                <span class="token function">rep</span>  <span class="token function">movsb</span>
                <span class="token function">pop</span>  <span class="token register variable">ds</span>
                <span class="token function">pop</span>  <span class="token register variable">si</span>
                <span class="token function">pop</span>  <span class="token register variable">cx</span>
                <span class="token function">pop</span>  <span class="token register variable">ax</span>
                <span class="token function">ret</span>

       i7ch:
                <span class="token function">push</span> <span class="token register variable">cx</span>
                <span class="token function">push</span> <span class="token register variable">si</span>
                <span class="token function">mov</span>  <span class="token register variable">ch</span>,<span class="token number">0
</span>       w:       <span class="token function">mov</span>  <span class="token register variable">cx</span>,<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>
                <span class="token function">jcxz</span> return
                <span class="token function">and</span>  <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token number">11011111b
</span>                <span class="token function">inc</span>  <span class="token register variable">si</span>
                <span class="token function">jmp</span>  w
       return:  <span class="token function">pop</span>  <span class="token register variable">si</span>
                <span class="token function">pop</span>  <span class="token register variable">cx</span>
                iret
       end_i7ch:
                <span class="token function">nop</span>
codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><p class="x-p">所谓的“安装程序”就是将<code class="x-inline-highlight">i7ch</code>中断处理程序的代码复制到内存中（通过<code class="x-inline-highlight">movsb</code>指令复制机器码），然后还需要修改中断向量表，将<code class="x-inline-highlight">7ch</code>号中断的入口地址设置为复制到的内存地址。这样触发<code class="x-inline-highlight">7ch</code>中断时就能够找到自定义的中断处理程序了。</p><p class="x-p">执行的效果是相同的：数据段中的字符串会被改写为大写，但要注意此时中断处理程序已经写入了内存，在其他程序中可以直接调用<code class="x-inline-highlight">int 7ch</code>实现同样的功能！例如编写一个<code class="x-inline-highlight">test</code>程序：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg,<span class="token register variable">ds</span>:datasg

datasg <span class="token keyword">segment</span>
              <span class="token keyword">db</span> <span class="token string">'internationalism'</span>,<span class="token number">0
</span>datasg <span class="token keyword">ends</span>

codesg <span class="token keyword">segment</span>
       start:
              <span class="token function">mov</span> <span class="token register variable">ax</span>,datasg
              <span class="token function">mov</span> <span class="token register variable">ds</span>,<span class="token register variable">ax</span>
              <span class="token function">mov</span> <span class="token register variable">si</span>,<span class="token number">0
</span>              <span class="token function">int</span> <span class="token number">7ch
</span>
              <span class="token function">mov</span> <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>              <span class="token function">int</span> <span class="token number">21h
</span>codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><p class="x-p">假设前面的程序编译后得到<code class="x-inline-highlight">i7ch.EXE</code>，现在做一个实验，依次执行：</p><img alt="img" loading="lazy" width="1022" height="261" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:100%;height:auto" src="/_next/static/media/fig12.87c752d4.jpg"/><p class="x-p">可以看到<code class="x-inline-highlight">test</code>程序中并没有<code class="x-inline-highlight">7ch</code>中断相关的逻辑，但先执行过<code class="x-inline-highlight">i7ch.EXE</code>之后，是可以调用相关逻辑完成转换大写功能的，说明成功在内存中存入程序、并改写入口地址了。</p><h2 class="x-h1">BIOS中断和DOS中断</h2><h3 class="x-h2">BIOS中断调用示例</h3><p class="x-p">BIOS中断是由BIOS提供的一些服务程序，可以通过<code class="x-inline-highlight">int</code>指令调用。前面提到可以直接操作显存来控制屏幕显示的内容，而定位到具体的地址需要细节的计算；而BIOS的<code class="x-inline-highlight">10h</code>号中断提供了一系列关于字符显示的功能，包括设置光标位置、在指定位置显示字符等。BIOS中断相当于封装了底层的细节，提供了更方便的调用方式。</p><p class="x-p">找到这些中断的中断号和功能描述，需要<span class="x-inline-strong">查手册</span>！例如：</p><img alt="img" loading="lazy" width="1162" height="187" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:800px;height:auto" src="/_next/static/media/fig3.e4071585.jpg"/><img alt="img" loading="lazy" width="1162" height="560" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:800px;height:auto" src="/_next/static/media/fig4.07ea42ed.jpg"/><img alt="img" loading="lazy" width="1162" height="564" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:800px;height:auto" src="/_next/static/media/fig5.faa7082d.jpg"/><p class="x-p">这个手册指明显示服务的中断号是<code class="x-inline-highlight">10h</code>，我们如果想使用设置光标位置功能，需要设置四个输入参数：功能号<code class="x-inline-highlight">AH</code>，页号<code class="x-inline-highlight">BH</code>，行号<code class="x-inline-highlight">DH</code>，列号<code class="x-inline-highlight">DL</code>；显示字符功能同理。因此就可以编写出如下程序：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg
codesg <span class="token keyword">segment</span>
    start:
           <span class="token function">mov</span> <span class="token register variable">ah</span>,<span class="token number">2 </span>           <span class="token comment">;设置光标位置功能号</span>
           <span class="token function">mov</span> <span class="token register variable">bh</span>,<span class="token number">0 </span>           <span class="token comment">;页号为0</span>
           <span class="token function">mov</span> <span class="token register variable">dh</span>,<span class="token number">5 </span>           <span class="token comment">;第5行</span>
           <span class="token function">mov</span> <span class="token register variable">dl</span>,<span class="token number">12 </span>          <span class="token comment">;第12列</span>
           <span class="token function">int</span> <span class="token number">10h </span>            <span class="token comment">;调用BIOS中断</span>

           <span class="token function">mov</span> <span class="token register variable">ah</span>,<span class="token number">9 </span>           <span class="token comment">;显示字符功能号</span>
           <span class="token function">mov</span> <span class="token register variable">al</span>,<span class="token string">'a'</span>          <span class="token comment">;要显示的字符为'a'</span>
           <span class="token function">mov</span> <span class="token register variable">bl</span>,<span class="token number">01001010b </span>   <span class="token comment">;颜色属性</span>
           <span class="token function">mov</span> <span class="token register variable">bh</span>,<span class="token number">0 </span>           <span class="token comment">;页号为0</span>
           <span class="token function">mov</span> <span class="token register variable">cx</span>,<span class="token number">3 </span>           <span class="token comment">;重复3次，即显示3个'a'</span>
           <span class="token function">int</span> <span class="token number">10h </span>            <span class="token comment">;调用BIOS中断</span>

           <span class="token function">mov</span> <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>           <span class="token function">int</span> <span class="token number">21h
</span>codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><img alt="img" loading="lazy" width="1021" height="164" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:100%;height:auto" src="/_next/static/media/fig6.c44b3d53.jpg"/><h3 class="x-h2">DOS中断</h3><p class="x-p">DOS中断是由操作系统提供的、更为高层的中断，同样提供了丰富的功能，使用时查手册即可。下图列出了一些DOS中断，并以<code class="x-inline-highlight">21h</code>为例做展开。</p><img alt="img" loading="lazy" width="1361" height="413" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:100%;height:auto" src="/_next/static/media/fig7.20032de4.jpg"/><h3 class="x-h2">二者的联系</h3><p class="x-p">BIOS和DOS在所提供的中断处理程序中包含了许多子程序，这些子程序实现了编程时常用到的功能。<br/>这些功能大多是调用外设的功能，而外设的硬件细节太多，常调用ROM中的BIOS中断来完成操作；<br/>对于DOS中断来说，和硬件设备相关的DOS中断处理程序中，一般都是在操作系统级调用BIOS的中断处理程序来实现的，提供更加高层的一些功能。<br/>当然如果这些都不能满足需求，用户也可以在程序里直接和外设进行联系（端口操作）。</p><img alt="img" loading="lazy" width="707" height="176" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:600px;height:auto" src="/_next/static/media/fig8.a8a422ad.jpg"/><h2 class="x-h1">端口的读写</h2><p class="x-p">CPU可以直接读写三个地方的数据：CPU内部的寄存器、内存单元、端口；而端口对应网卡、显卡等等外部芯片。这些外部芯片工作时，都有一些寄存器由CPU读写；而从CPU的角度，就把这些寄存器当作端口并统一编址。</p><p class="x-p">端口的编址是<code class="x-inline-highlight">16</code>位的，范围是<code class="x-inline-highlight">0</code>~<code class="x-inline-highlight">65535</code>，这部分地址是独立于内存地址的。硬件设备与特定端口之间的映射是由硬件设计者决定的；为了确保不同厂商的设备能够正常工作，会有标准化组织制定统一的行业标准。</p><p class="x-p">读写端口要使用<code class="x-inline-highlight">in</code>指令和<code class="x-inline-highlight">out</code>指令：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token function">in</span>  <span class="token register variable">al</span>,<span class="token number">20h </span> <span class="token comment">;从20h号端口读取一个字节到AL</span>
<span class="token function">out</span> <span class="token number">21h,</span><span class="token register variable">al</span>  <span class="token comment">;将AL的内容写入21h号端口</span>
</code></pre></div><p class="x-p">对于<code class="x-inline-highlight">0</code>~<code class="x-inline-highlight">255</code>号端口，端口号可以直接用立即数给出；对于<code class="x-inline-highlight">256</code>~<code class="x-inline-highlight">65535</code>号端口，端口号放在<code class="x-inline-highlight">DX</code>中：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token function">mov</span>  <span class="token register variable">dx</span>,<span class="token number">3f8h
</span><span class="token function">in</span>   <span class="token register variable">al</span>,<span class="token register variable">dx</span>  <span class="token comment">;从3f8h号端口读取一个字节到AL</span>
<span class="token function">out</span>  <span class="token register variable">dx</span>,<span class="token register variable">al</span>  <span class="token comment">;将AL的内容写入3f8h号端口</span>
</code></pre></div><div class="x-highlightblock highlight-background-golden"><p class="x-p">在<code class="x-inline-highlight">in</code>指令和<code class="x-inline-highlight">out</code>指令中，只能使用<code class="x-inline-highlight">AL</code>（访问<code class="x-inline-highlight">8</code>位端口）或<code class="x-inline-highlight">AX</code>（访问<code class="x-inline-highlight">16</code>位端口）来存放读取或要写入的数据。</p></div><h3 class="x-h2">扬声器发声示例</h3><p class="x-p">下面的程序可以让扬声器响一下：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg
codesg <span class="token keyword">segment</span>
    start:
           <span class="token function">mov</span>  <span class="token register variable">al</span>,<span class="token number">0ffh
</span>           <span class="token function">out</span>  <span class="token number">42h,</span><span class="token register variable">al</span>       <span class="token comment">;设置声音频率，第一次写入低8位</span>
           <span class="token function">mov</span>  <span class="token register variable">al</span>,<span class="token number">08h
</span>           <span class="token function">out</span>  <span class="token number">42h,</span><span class="token register variable">al</span>       <span class="token comment">;设置声音频率，第二次写入高8位</span>

           <span class="token function">in</span>   <span class="token register variable">al</span>,<span class="token number">61h </span>      <span class="token comment">;读取端口原值</span>
           <span class="token function">mov</span>  <span class="token register variable">ah</span>,<span class="token register variable">al</span>        <span class="token comment">;保存原值到AH</span>

           <span class="token function">or</span>   <span class="token register variable">al</span>,<span class="token number">3 </span>        <span class="token comment">;设置最低两位为1：打开扬声器和定时器</span>
           <span class="token function">out</span>  <span class="token number">61h,</span><span class="token register variable">al</span>       <span class="token comment">;接通扬声器和定时器</span>

           <span class="token function">mov</span>  <span class="token register variable">cx</span>,<span class="token number">0ffffh
</span>    delay: <span class="token function">nop</span>
           <span class="token function">loop</span> delay        <span class="token comment">;延迟一段时间</span>

           <span class="token function">mov</span>  <span class="token register variable">al</span>,<span class="token register variable">ah</span>
           <span class="token function">out</span>  <span class="token number">61h,</span><span class="token register variable">al</span>       <span class="token comment">;恢复端口原值</span>

           <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>           <span class="token function">int</span>  <span class="token number">21h
</span>codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><h2 class="x-h1">键盘相关操作</h2><h3 class="x-h2">键盘输入的处理过程</h3><div class="x-oli"><div class="x-oli-number">1.</div><div class="x-oli-content-wrapper"><p class="x-p">键盘输入</p><p class="x-p">键盘上每一个键相当于一个开关，键盘中有一个芯片对每一个键的开关状态进行扫描：按下/松开一个键时，芯片都会产生一个扫描码，扫描码被送入主板上相关接口芯片的寄存器中，该寄存器的端口地址为<code class="x-inline-highlight">60h</code>。扫描码与ASCII码不同，下图是通码：</p><img alt="img" loading="lazy" width="1130" height="600" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:800px;height:auto" src="/_next/static/media/fig10.14a8cbfd.jpg"/><p class="x-p">按下一个键产生通码，松开一个键产生断码；通码的最高位为<code class="x-inline-highlight">0</code>，断码的最高位为<code class="x-inline-highlight">1</code>；通码和断码的低<code class="x-inline-highlight">7</code>位是相同的。</p></div></div><div class="x-oli"><div class="x-oli-number">2.</div><div class="x-oli-content-wrapper"><p class="x-p">引发<code class="x-inline-highlight">int 9</code>中断</p><p class="x-p">键盘的输入到达<code class="x-inline-highlight">60h</code>端口时，相关的芯片就会向CPU发出中断类型码为<code class="x-inline-highlight">9</code>的可屏蔽中断信息。CPU检测到该中断信息后，如果<code class="x-inline-highlight">IF=1</code>，则响应中断，转去执行<code class="x-inline-highlight">int 9</code>中断处理程序。</p></div></div><div class="x-oli"><div class="x-oli-number">3.</div><div class="x-oli-content-wrapper"><p class="x-p">执行<code class="x-inline-highlight">int 9</code>中断处理程序</p><div class="x-highlightblock highlight-background-golden"><h4 class="x-h3">BIOS键盘缓冲区</h4><p class="x-p">BIOS键盘缓冲区是系统启动后，BIOS用于存放<code class="x-inline-highlight">int 9</code>中断处理程序所接收的键盘输入的内存区。BIOS键盘缓冲区可以存储最多<code class="x-inline-highlight">15</code>个键盘输入，每个键盘输入用一个字存放，高位字节存放扫描码，低位字节存放ASCII码。</p><p class="x-p">如果输入了控制键和切换键，内存中有一个特殊的字节：键盘状态字节，地址是<code class="x-inline-highlight">00417h</code>，用于存放控制键和切换键的状态信息。字节内容为：</p><div class="x-table-wrapper"><table class="x-table"><tbody><tr><th><p>位</p></th><td><p><code class="x-inline-highlight">7</code></p></td><td><p><code class="x-inline-highlight">6</code></p></td><td><p><code class="x-inline-highlight">5</code></p></td><td><p><code class="x-inline-highlight">4</code></p></td><td><p><code class="x-inline-highlight">3</code></p></td><td><p><code class="x-inline-highlight">2</code></p></td><td><p><code class="x-inline-highlight">1</code></p></td><td><p><code class="x-inline-highlight">0</code></p></td></tr><tr><th><p>含义</p></th><td><p><code class="x-inline-highlight">Insert</code></p></td><td><p><code class="x-inline-highlight">Caps Lock</code></p></td><td><p><code class="x-inline-highlight">Num Lock</code></p></td><td><p><code class="x-inline-highlight">Scroll Lock</code></p></td><td><p><code class="x-inline-highlight">Alt</code></p></td><td><p><code class="x-inline-highlight">Ctrl</code></p></td><td><p>左<code class="x-inline-highlight">Shift</code></p></td><td><p>右<code class="x-inline-highlight">Shift</code></p></td></tr></tbody></table></div></div><p class="x-p">程序读出<code class="x-inline-highlight">60h</code>端口中的扫描码，如果是字符键的扫描码，将该扫描码和它所对应的ASCII码送入内存中的BIOS键盘缓冲区；如果是控制键和切换键的扫描码，则更新键盘状态字节。</p></div></div><h3 class="x-h2">更多中断操作</h3><img alt="img" loading="lazy" width="1065" height="484" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:800px;height:auto" src="/_next/static/media/fig13.27546d70.jpg"/><p class="x-p">硬件中断、BIOS中断、DOS中断是由底层至上层针对键盘操作提供的不同功能。</p><p class="x-p">以BIOS<code class="x-inline-highlight">int 16h</code>中断为例，第<code class="x-inline-highlight">0</code>号功能的过程是：</p><div class="x-oli"><div class="x-oli-number">1.</div><div class="x-oli-content-wrapper"><p>检查键盘缓冲区是否有数据</p></div></div><div class="x-oli"><div class="x-oli-number">2.</div><div class="x-oli-content-wrapper"><p>如果没有，重复第<code class="x-inline-highlight">1</code>步</p></div></div><div class="x-oli"><div class="x-oli-number">3.</div><div class="x-oli-content-wrapper"><p>读取缓冲区第一个字单元的键盘输入</p></div></div><div class="x-oli"><div class="x-oli-number">4.</div><div class="x-oli-content-wrapper"><p>将读取的扫描码送入<code class="x-inline-highlight">AH</code>，ASCII码送入<code class="x-inline-highlight">AL</code></p></div></div><div class="x-oli"><div class="x-oli-number">5.</div><div class="x-oli-content-wrapper"><p>将已读取的键盘输入从缓冲区中删除</p></div></div><p class="x-p"><code class="x-inline-highlight">int 16h</code>中断和<code class="x-inline-highlight">int 9</code>中断是一对相互配合的程序，<code class="x-inline-highlight">int 9</code>中断处理程序向键盘缓冲区中写入，<code class="x-inline-highlight">int 16h</code>中断处理程序从缓冲区中读出。它们写入和读出的时机不同，<code class="x-inline-highlight">int 9</code>中断处理程序在有键按下的时候向键盘缓冲区中写入数据；而<code class="x-inline-highlight">int 16h</code>中断处理程序是在应用程序对其进行调用的时候，将数据从键盘缓冲区中读出。</p><h2 class="x-h1">练习</h2><h3 class="x-h2">编写除法错误的中断处理程序</h3><div class="x-highlightblock highlight-background-blue"><p class="x-p">编程自定义除法错误中断，除以<code class="x-inline-highlight">0</code>时在屏幕上提示<code class="x-inline-highlight">Cannot divide by zero!</code>然后返回操作系统。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token comment">;以下代码会触发除法错误中断</span>
<span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">1
</span><span class="token function">mov</span>  <span class="token register variable">bl</span>,<span class="token number">0
</span><span class="token function">div</span>  <span class="token register variable">bl</span>
</code></pre></div><p class="x-p">注：除法错误不仅仅是除以<code class="x-inline-highlight">0</code>，还包括除数溢出等情况。</p></div><p class="x-p">选取从<code class="x-inline-highlight">00200h</code>开始的地址空间作为存放<code class="x-inline-highlight">div0</code>程序的目的地址。同时，我们希望中断处理程序能够永久驻留内存，因此为了保证正常工作，提示字符串的值也需要随程序一起复制到内存中，我们把这部分数据保存到<code class="x-inline-highlight">00200h</code>之前的<code class="x-inline-highlight">32</code>个字节（从<code class="x-inline-highlight">001e0</code>开始）。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg,<span class="token register variable">ds</span>:datasg,<span class="token register variable">ss</span>:stcksg

datasg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token string">'Cannot divide by zero!'</span>,<span class="token number">32 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
datasg <span class="token keyword">ends</span>

stcksg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token number">16 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
stcksg <span class="token keyword">ends</span>

codesg <span class="token keyword">segment</span>
    start:
    <span class="token comment">;安装中断处理程序</span>
             <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">0
</span>             <span class="token function">mov</span>  <span class="token register variable">es</span>,<span class="token register variable">ax</span>
             <span class="token function">mov</span>  <span class="token register variable">di</span>,<span class="token number">200h-</span><span class="token number">32 </span>                         <span class="token comment">;设置安装位置，安装到ES:DI处，留出了32字节的数据空间用于存储提示字符串</span>
             <span class="token function">call</span> install
    <span class="token comment">;设置中断向量表</span>
             <span class="token function">mov</span>  <span class="token keyword">word</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">0]</span>,<span class="token number">200h </span>               <span class="token comment">;设置0号中断的IP=200h，真正的程序从200h开始</span>
             <span class="token function">mov</span>  <span class="token keyword">word</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">2]</span>,<span class="token number">0 </span>                  <span class="token comment">;设置0号中断的CS=0</span>

             <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>             <span class="token function">int</span>  <span class="token number">21h
</span>
    <span class="token comment">;中断安装程序</span>
    <span class="token comment">;使用movsb指令安装，该指令从DS:SI复制到ES:DI，ES:DI在前面已经设置好</span>
    install:
             <span class="token function">push</span> <span class="token register variable">ax</span>
             <span class="token function">push</span> <span class="token register variable">cx</span>
             <span class="token function">push</span> <span class="token register variable">si</span>
             <span class="token function">push</span> <span class="token register variable">ds</span>
             <span class="token function">cld</span>                                      <span class="token comment">;设置方向标志</span>
    <span class="token comment">;前32字节安装字符串常量</span>
             <span class="token function">mov</span>  <span class="token register variable">ax</span>,datasg
             <span class="token function">mov</span>  <span class="token register variable">ds</span>,<span class="token register variable">ax</span>                               <span class="token comment">;设置DS为数据段起始地址</span>
             <span class="token function">mov</span>  <span class="token register variable">si</span>,<span class="token number">0 </span>                               <span class="token comment">;设置SI为0</span>
             <span class="token function">mov</span>  <span class="token register variable">cx</span>,<span class="token number">32 </span>                              <span class="token comment">;一共复制32个字节（字符串+填充的0），循环32次</span>
             <span class="token function">rep</span>  <span class="token function">movsb</span>
    <span class="token comment">;后面安装程序</span>
             <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token register variable">cs</span>
             <span class="token function">mov</span>  <span class="token register variable">ds</span>,<span class="token register variable">ax</span>                               <span class="token comment">;设置DS为代码段起始地址</span>
             <span class="token function">mov</span>  <span class="token register variable">si</span>,<span class="token keyword">offset</span> div0                      <span class="token comment">;设置SI为offset div0（从子程序开始处复制）</span>
             <span class="token function">mov</span>  <span class="token register variable">cx</span>,<span class="token keyword">offset</span> end_div0 <span class="token operator">-</span> <span class="token keyword">offset</span> div0    <span class="token comment">;使用地址标号相减得到指令长度，也是循环次数</span>
             <span class="token function">rep</span>  <span class="token function">movsb</span>
             <span class="token function">pop</span>  <span class="token register variable">ds</span>
             <span class="token function">pop</span>  <span class="token register variable">si</span>
             <span class="token function">pop</span>  <span class="token register variable">cx</span>
             <span class="token function">pop</span>  <span class="token register variable">ax</span>
             <span class="token function">ret</span>

    <span class="token comment">;中断处理程序</span>
    div0:
             <span class="token function">push</span> <span class="token register variable">ax</span>
             <span class="token function">push</span> <span class="token register variable">cx</span>
             <span class="token function">push</span> <span class="token register variable">si</span>
             <span class="token function">push</span> <span class="token register variable">di</span>
             <span class="token function">push</span> <span class="token register variable">ds</span>
             <span class="token function">push</span> <span class="token register variable">es</span>
             <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">0
</span>             <span class="token function">mov</span>  <span class="token register variable">ds</span>,<span class="token register variable">ax</span>
             <span class="token function">mov</span>  <span class="token register variable">si</span>,<span class="token number">200h-</span><span class="token number">32 </span>                         <span class="token comment">;初始化DS:SI=00200h-32，这是安装好的字符串数据的起始地址</span>
             <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">0b800h
</span>             <span class="token function">mov</span>  <span class="token register variable">es</span>,<span class="token register variable">ax</span>
             <span class="token function">mov</span>  <span class="token register variable">di</span>,<span class="token number">80*</span><span class="token number">2*</span><span class="token number">12 </span>                         <span class="token comment">;初始化ES:DI=b8000h+80*2*12，这目标显存的起始地址（第12行开头）</span>
             <span class="token function">mov</span>  <span class="token register variable">ch</span>,<span class="token number">0
</span>    w:       <span class="token function">mov</span>  <span class="token register variable">cl</span>,<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>                             <span class="token comment">;字符串循环写入显存</span>
             <span class="token function">jcxz</span> return                              <span class="token comment">;遇到0就停止</span>
             <span class="token function">mov</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token register variable">di</span><span class="token operator">]</span>,<span class="token register variable">cl</span>
             <span class="token function">mov</span>  <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token register variable">di</span><span class="token operator">+</span><span class="token number">1]</span>,<span class="token number">40h </span>             <span class="token comment">;红底黑字</span>
             <span class="token function">inc</span>  <span class="token register variable">si</span>
             <span class="token function">add</span>  <span class="token register variable">di</span>,<span class="token number">2
</span>             <span class="token function">jmp</span>  w
    return:  <span class="token function">pop</span>  <span class="token register variable">es</span>
             <span class="token function">pop</span>  <span class="token register variable">ds</span>
             <span class="token function">pop</span>  <span class="token register variable">di</span>
             <span class="token function">pop</span>  <span class="token register variable">si</span>
             <span class="token function">pop</span>  <span class="token register variable">cx</span>
             <span class="token function">pop</span>  <span class="token register variable">ax</span>
             <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>             <span class="token function">int</span>  <span class="token number">21h </span>                                <span class="token comment">;直接返回操作系统</span>
    end_div0:
             <span class="token function">nop</span>
codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><p class="x-p">编译上面的程序，命名为<code class="x-inline-highlight">div0.EXE</code>；接下来编译一个触发除法错误中断的程序，命名为<code class="x-inline-highlight">bad.EXE</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg
codesg <span class="token keyword">segment</span>
    start: <span class="token function">mov</span> <span class="token register variable">ax</span>,<span class="token number">1
</span>           <span class="token function">mov</span> <span class="token register variable">bl</span>,<span class="token number">0
</span>           <span class="token function">div</span> <span class="token register variable">bl</span>

           <span class="token function">mov</span> <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>           <span class="token function">int</span> <span class="token number">21h
</span>codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><p class="x-p">依次执行，在<code class="x-inline-highlight">div0.EXE</code>执行完成返回后，执行<code class="x-inline-highlight">bad.EXE</code>能够触发自定义的中断处理程序并在屏幕上输出提示内容。</p><img alt="img" loading="lazy" width="1022" height="340" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:100%;height:auto" src="/_next/static/media/fig2.69db75f2.jpg"/><h3 class="x-h2">自定义键盘输入处理</h3><div class="x-highlightblock highlight-background-blue"><p class="x-p">下面的程序可以在屏幕的中心以红底黑字依次显示字符<code class="x-inline-highlight">A</code>~<code class="x-inline-highlight">Z</code>，然后结束程序。子程序<code class="x-inline-highlight">delay</code>的作用是控制相邻两个字符显示的时间间隔。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg,<span class="token register variable">ds</span>:datasg,<span class="token register variable">ss</span>:stcksg

datasg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token number">32 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
datasg <span class="token keyword">ends</span>

stcksg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token number">16 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
stcksg <span class="token keyword">ends</span>

codesg <span class="token keyword">segment</span>
    start:
    <span class="token comment">;一段循环在屏幕中间显示A~Z的程序</span>
           <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">0b800h
</span>           <span class="token function">mov</span>  <span class="token register variable">es</span>,<span class="token register variable">ax</span>
           <span class="token function">mov</span>  <span class="token register variable">al</span>,<span class="token string">'A'</span>
           <span class="token function">mov</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">80*</span><span class="token number">2*</span><span class="token number">12+</span><span class="token number">40*</span><span class="token number">2+</span><span class="token number">1]</span>,<span class="token number">40h </span>  <span class="token comment">;第12行、第40列，红底黑字</span>
    s:     <span class="token function">mov</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">80*</span><span class="token number">2*</span><span class="token number">12+</span><span class="token number">40*</span><span class="token number">2]</span>,<span class="token register variable">al</span>                <span class="token comment">;显示字符</span>
           <span class="token function">call</span> delay
           <span class="token function">inc</span>  <span class="token register variable">al</span>
           <span class="token function">cmp</span>  <span class="token register variable">al</span>,<span class="token string">'Z'</span>
           jng  s

           <span class="token function">mov</span>  <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>           <span class="token function">int</span>  <span class="token number">21h
</span>
    <span class="token comment">;执行双重空循环，延时</span>
    delay:
           <span class="token function">push</span> <span class="token register variable">cx</span>
           <span class="token function">mov</span>  <span class="token register variable">cx</span>,<span class="token number">10h
</span>    s1:    <span class="token function">push</span> <span class="token register variable">cx</span>
           <span class="token function">mov</span>  <span class="token register variable">cx</span>,<span class="token number">0ffffh
</span>    s2:    <span class="token function">loop</span> s2
           <span class="token function">pop</span>  <span class="token register variable">cx</span>
           <span class="token function">loop</span> s1
           <span class="token function">pop</span>  <span class="token register variable">cx</span>
           <span class="token function">ret</span>
codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><p class="x-p">现在希望加入一个功能，在程序执行的任何时刻，按下<code class="x-inline-highlight">Alt</code>键可以切换字符的显示背景。（在红/绿色之间切换即可，只需要每次对显示属性字节异或<code class="x-inline-highlight">01100000b</code>）</p></div><p class="x-p">与上一题不同的是，首先本题不需要安装中断处理程序，只需要程序运行时能够定制化键盘中断的功能；另外由于键盘输入的中断处理程序涉及到所有键的输入，因此不能像上题一样完全重写一个处理程序，而是大致的思路应该为在原有<code class="x-inline-highlight">9</code>号中断处理程序的基础上，“插入”一个条件判断，如果是<code class="x-inline-highlight">Alt</code>键则执行想要的功能。</p><p class="x-p">综上，本题采用的思路为，先把原来的中断向量保存到内存中，然后修改原来的中断向量指向自定义的中断处理程序<code class="x-inline-highlight">i9</code>；在返回前还要恢复原来的中断向量。而在子程序<code class="x-inline-highlight">i9</code>中，还要想办法调用原来的中断处理程序，正常响应键盘输入。一个大致的框架为：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 312px, var(--bg-transparent-golden) 312px 600px, transparent 600px, transparent 696px, var(--bg-transparent-golden) 696px 864px, transparent 864px, transparent 960px, var(--bg-transparent-golden) 960px 1008px, transparent 1008px)"><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg,<span class="token register variable">ds</span>:datasg,<span class="token register variable">ss</span>:stcksg

datasg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token number">32 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
datasg <span class="token keyword">ends</span>

stcksg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token number">16 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
stcksg <span class="token keyword">ends</span>

codesg <span class="token keyword">segment</span>
    start:
    <span class="token comment">;保存原来的中断向量到DS:0处</span>
           <span class="token function">mov</span>   <span class="token register variable">ax</span>,datasg
           <span class="token function">mov</span>   <span class="token register variable">ds</span>,<span class="token register variable">ax</span>
           <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0
</span>           <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
           <span class="token function">push</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>
           <span class="token function">pop</span>   <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">0]</span>
           <span class="token function">push</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>
           <span class="token function">pop</span>   <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">2]</span>
    <span class="token comment">;更改原来的中断向量</span>
           <span class="token function">mov</span>   <span class="token keyword">word</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>,<span class="token keyword">offset</span> i9               <span class="token comment">;设置9号中断的IP为offset i9</span>
           <span class="token function">mov</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>,<span class="token register variable">cs</span>                             <span class="token comment">;设置9号中断的CS为代码段起始地址</span>

    <span class="token comment">;一段循环在屏幕中间显示A~Z的程序</span>
           <span class="token comment">;...</span>

    <span class="token comment">;恢复原来的中断向量</span>
           <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0
</span>           <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
           <span class="token function">push</span>  <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">0]</span>
           <span class="token function">pop</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>
           <span class="token function">push</span>  <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">2]</span>
           <span class="token function">pop</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>

           <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>           <span class="token function">int</span>   <span class="token number">21h
</span>
    i9:
           <span class="token comment">;...</span>
codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><p class="x-p">前面提到8086 CPU的中断过程为：</p><div class="x-highlightblock highlight-background-gray"><div class="x-oli"><div class="x-oli-number">1.</div><div class="x-oli-content-wrapper"><p>从中断信息中取得中断类型码</p></div></div><div class="x-oli"><div class="x-oli-number">2.</div><div class="x-oli-content-wrapper"><p>标志寄存器入栈（中断过程会改变标志，需要先进行保护）</p></div></div><div class="x-oli"><div class="x-oli-number">3.</div><div class="x-oli-content-wrapper"><p>设置<code class="x-inline-highlight">IF=0</code>，<code class="x-inline-highlight">TF=0</code></p></div></div><div class="x-oli"><div class="x-oli-number">4.</div><div class="x-oli-content-wrapper"><p><code class="x-inline-highlight">CS</code>入栈，<code class="x-inline-highlight">IP</code>入栈</p></div></div><div class="x-oli"><div class="x-oli-number">5.</div><div class="x-oli-content-wrapper"><p>从中断向量表读取中断处理程序的入口地址，设置<code class="x-inline-highlight">CS</code>和<code class="x-inline-highlight">IP</code></p></div></div><div class="x-oli"><div class="x-oli-number">6.</div><div class="x-oli-content-wrapper"><p>开始执行中断处理程序</p></div></div></div><p class="x-p">我们现在要在<code class="x-inline-highlight">i9</code>子程序中调用原来的<code class="x-inline-highlight">int 9</code>中断处理程序。请注意，程序之所以跳转到<code class="x-inline-highlight">i9</code>，是因为程序已经修改了中断向量表，然后由键盘输入产生<code class="x-inline-highlight">int 9</code>中断，中断过程的第<code class="x-inline-highlight">1</code>~<code class="x-inline-highlight">5</code>步已经执行完成，在第<code class="x-inline-highlight">5</code>步进入到<code class="x-inline-highlight">i9</code>子程序中；</p><p class="x-p">而我们还想在<code class="x-inline-highlight">i9</code>子程序中手动调用被保存在<code class="x-inline-highlight">dword ptr ds:[0]</code>中的原来的<code class="x-inline-highlight">int 9</code>中断处理程序，此时没有人为我们自动执行中断过程了，需要手动模拟！因此这部分过程为：</p><div class="x-oli"><div class="x-oli-number">1.</div><div class="x-oli-content-wrapper"><p class="x-p">模拟标志寄存器入栈</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token function">pushf</span></code></pre></div></div></div><div class="x-oli"><div class="x-oli-number">2.</div><div class="x-oli-content-wrapper"><p class="x-p">模拟设置<code class="x-inline-highlight">IF=0</code>，<code class="x-inline-highlight">TF=0</code></p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token function">pushf</span>
<span class="token function">pop</span>   <span class="token register variable">bx</span>                <span class="token comment">;标志寄存器的值临时赋值给BX</span>
<span class="token function">and</span>   <span class="token register variable">bh</span>,<span class="token number">11111100b </span>     <span class="token comment">;IF=0，TF=0</span>
<span class="token function">push</span>  <span class="token register variable">bx</span>
<span class="token function">popf</span>                    <span class="token comment">;将更新后的值赋值给标志寄存器</span>
</code></pre></div></div></div><div class="x-oli"><div class="x-oli-number">3.</div><div class="x-oli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">CS</code>入栈、<code class="x-inline-highlight">IP</code>入栈、跳转到入口地址由<code class="x-inline-highlight">call</code>指令完成：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token function">call</span>  <span class="token keyword">dword</span> <span class="token keyword">ptr</span> <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">0]</span></code></pre></div></div></div><p class="x-p">在原中断处理程序调用完成后，就是自定义的部分：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token comment">;自定义的键盘输入处理</span>
<span class="token function">in</span>    <span class="token register variable">al</span>,<span class="token number">60h </span>                                   <span class="token comment">;读取键盘输入送入AL</span>
<span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">38h </span>                                   <span class="token comment">;判断是否为Alt键</span>
jne   return                                    <span class="token comment">;不是则返回</span>
<span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0b800h
</span><span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
<span class="token function">xor</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">80*</span><span class="token number">2*</span><span class="token number">12+</span><span class="token number">40*</span><span class="token number">2+</span><span class="token number">1]</span>,<span class="token number">01100000b </span>   <span class="token comment">;在红色和绿色背景之间切换</span>
</code></pre></div><p class="x-p">注意因为这是中断调用，要使用<code class="x-inline-highlight">iret</code>指令返回。<code class="x-inline-highlight">i9</code>子程序的完整代码为：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>i9:
       <span class="token function">push</span>  <span class="token register variable">ax</span>
       <span class="token function">push</span>  <span class="token register variable">bx</span>
       <span class="token function">push</span>  <span class="token register variable">es</span>
<span class="token comment">;------------------------------------------------------</span>
<span class="token comment">;模拟标志寄存器入栈</span>
       <span class="token function">pushf</span>
<span class="token comment">;模拟设置IF=0，TF=0</span>
       <span class="token function">pushf</span>
       <span class="token function">pop</span>   <span class="token register variable">bx</span>
       <span class="token function">and</span>   <span class="token register variable">bh</span>,<span class="token number">11111100b
</span>       <span class="token function">push</span>  <span class="token register variable">bx</span>
       <span class="token function">popf</span>
<span class="token comment">;call指令即可实现CS、IP入栈并跳转到入口地址</span>
       <span class="token function">call</span>  <span class="token keyword">dword</span> <span class="token keyword">ptr</span> <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">0]</span>
<span class="token comment">;------------------------------------------------------</span>
<span class="token comment">;自定义的键盘输入处理</span>
       <span class="token function">in</span>    <span class="token register variable">al</span>,<span class="token number">60h </span>                                   <span class="token comment">;读取键盘输入送入AL</span>
       <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">38h </span>                                   <span class="token comment">;判断是否为Alt键</span>
       jne   return                                    <span class="token comment">;不是则返回</span>
       <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0b800h
</span>       <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
       <span class="token function">xor</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">80*</span><span class="token number">2*</span><span class="token number">12+</span><span class="token number">40*</span><span class="token number">2+</span><span class="token number">1]</span>,<span class="token number">01100000b </span>   <span class="token comment">;在红色和绿色背景之间切换</span>
return:
       <span class="token function">pop</span>   <span class="token register variable">es</span>
       <span class="token function">pop</span>   <span class="token register variable">bx</span>
       <span class="token function">pop</span>   <span class="token register variable">ax</span>
       iret
</code></pre></div><div class="x-divider"></div><p class="x-p">题目的完整代码为：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg,<span class="token register variable">ds</span>:datasg,<span class="token register variable">ss</span>:stcksg

datasg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token number">32 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
datasg <span class="token keyword">ends</span>

stcksg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token number">16 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
stcksg <span class="token keyword">ends</span>

codesg <span class="token keyword">segment</span>
    start:
    <span class="token comment">;保存原来的中断向量到DS:0处</span>
           <span class="token function">mov</span>   <span class="token register variable">ax</span>,datasg
           <span class="token function">mov</span>   <span class="token register variable">ds</span>,<span class="token register variable">ax</span>
           <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0
</span>           <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
           <span class="token function">push</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>
           <span class="token function">pop</span>   <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">0]</span>
           <span class="token function">push</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>
           <span class="token function">pop</span>   <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">2]</span>
    <span class="token comment">;更改原来的中断向量</span>
           <span class="token function">mov</span>   <span class="token keyword">word</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>,<span class="token keyword">offset</span> i9               <span class="token comment">;设置9号中断的IP为offset i9</span>
           <span class="token function">mov</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>,<span class="token register variable">cs</span>                             <span class="token comment">;设置9号中断的CS为代码段起始地址</span>
    <span class="token comment">;一段循环在屏幕中间显示A~Z的程序</span>
           <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0b800h
</span>           <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
           <span class="token function">mov</span>   <span class="token register variable">al</span>,<span class="token string">'A'</span>
           <span class="token function">mov</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">80*</span><span class="token number">2*</span><span class="token number">12+</span><span class="token number">40*</span><span class="token number">2+</span><span class="token number">1]</span>,<span class="token number">40h </span>         <span class="token comment">;第12行、第40列，红底黑字</span>
    s:     <span class="token function">mov</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">80*</span><span class="token number">2*</span><span class="token number">12+</span><span class="token number">40*</span><span class="token number">2]</span>,<span class="token register variable">al</span>                      <span class="token comment">;显示字符</span>
           <span class="token function">call</span>  delay
           <span class="token function">inc</span>   <span class="token register variable">al</span>
           <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token string">'Z'</span>
           jng   s
    <span class="token comment">;恢复原来的中断向量</span>
           <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0
</span>           <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
           <span class="token function">push</span>  <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">0]</span>
           <span class="token function">pop</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>
           <span class="token function">push</span>  <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">2]</span>
           <span class="token function">pop</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>

           <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>           <span class="token function">int</span>   <span class="token number">21h
</span>
    <span class="token comment">;执行双重空循环，延时</span>
    delay:
           <span class="token function">push</span>  <span class="token register variable">cx</span>
           <span class="token function">mov</span>   <span class="token register variable">cx</span>,<span class="token number">10h
</span>    s1:    <span class="token function">push</span>  <span class="token register variable">cx</span>
           <span class="token function">mov</span>   <span class="token register variable">cx</span>,<span class="token number">0ffffh
</span>    s2:    <span class="token function">loop</span>  s2
           <span class="token function">pop</span>   <span class="token register variable">cx</span>
           <span class="token function">loop</span>  s1
           <span class="token function">pop</span>   <span class="token register variable">cx</span>
           <span class="token function">ret</span>

    i9:
           <span class="token function">push</span>  <span class="token register variable">ax</span>
           <span class="token function">push</span>  <span class="token register variable">bx</span>
           <span class="token function">push</span>  <span class="token register variable">es</span>
    <span class="token comment">;------------------------------------------------------</span>
    <span class="token comment">;模拟标志寄存器入栈</span>
           <span class="token function">pushf</span>
    <span class="token comment">;模拟设置IF=0，TF=0</span>
           <span class="token function">pushf</span>
           <span class="token function">pop</span>   <span class="token register variable">bx</span>
           <span class="token function">and</span>   <span class="token register variable">bh</span>,<span class="token number">11111100b
</span>           <span class="token function">push</span>  <span class="token register variable">bx</span>
           <span class="token function">popf</span>
    <span class="token comment">;call指令即可实现CS、IP入栈并跳转到入口地址</span>
           <span class="token function">call</span>  <span class="token keyword">dword</span> <span class="token keyword">ptr</span> <span class="token register variable">ds</span>:<span class="token operator">[</span><span class="token number">0]</span>
    <span class="token comment">;------------------------------------------------------</span>
    <span class="token comment">;自定义的键盘输入处理</span>
           <span class="token function">in</span>    <span class="token register variable">al</span>,<span class="token number">60h </span>                                   <span class="token comment">;读取键盘输入送入AL</span>
           <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">38h </span>                                   <span class="token comment">;判断是否为Alt键</span>
           jne   return                                    <span class="token comment">;不是则返回</span>
           <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0b800h
</span>           <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
           <span class="token function">xor</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">80*</span><span class="token number">2*</span><span class="token number">12+</span><span class="token number">40*</span><span class="token number">2+</span><span class="token number">1]</span>,<span class="token number">01100000b </span>   <span class="token comment">;在红色和绿色背景之间切换</span>

    return:
           <span class="token function">pop</span>   <span class="token register variable">es</span>
           <span class="token function">pop</span>   <span class="token register variable">bx</span>
           <span class="token function">pop</span>   <span class="token register variable">ax</span>
           iret
codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><p class="x-p">执行效果（按下<code class="x-inline-highlight">Alt</code>键切换背景颜色）：</p><img alt="img" loading="lazy" width="118" height="118" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:200px;height:auto" src="/_next/static/media/fig14.22fe7f01.gif"/><!--/$--><!--/$--></div><div id="sidebar"><div id="sidebar-width-wrapper"><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">网络杂识<!-- --> (<!-- -->5<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23d/database-3nf/"><span class="post-title">数据库设计三大范式</span></a></li><li><a class="link" href="/23d/github-linguist-vendored/"><span class="post-title">不统计Github仓库某个目录下的语言</span></a></li><li><a class="link" href="/24a/deepl-shortcut-setting/"><span class="post-title">解决：DeepL该快捷键已被使用</span></a></li><li><a class="link" href="/24a/git-merge-allow-unrelated-histories/"><span class="post-title">记录：使用--allow-unrelated-histories</span></a></li><li><a class="link" href="/24b/injective-surjective-bijective/"><span class="post-title">单射、满射、双射</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">安全学习<!-- --> (<!-- -->7<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/wp-portswigger/"><span class="post-title">PortSwigger Writeup</span></a></li><li><a class="link" href="/23d/hust-cas-login/"><span class="post-title">Python登录华科统一身份认证接口</span></a></li><li><a class="link" href="/24b/learn-cwes/"><span class="post-title">Learn CWEs &amp; Real-word Examples</span></a></li><li><a class="link" href="/24b/cross-site-scripting/"><span class="post-title">Learn XSS</span></a></li><li><a class="link" href="/24b/cross-site-request-forgery/"><span class="post-title">Learn CSRF</span></a></li><li><a class="link" href="/24d/wp-bluehensctf-2024/"><span class="post-title">BlueHens CTF 2024 Writeup</span></a></li><li><a class="link" href="/24d/wp-1337uplive-2024/"><span class="post-title">1337UP LIVE CTF 2024 Writeup</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">安全研究<!-- --> (<!-- -->9<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/papers-sec/"><span class="post-title">论文速记：安全</span></a></li><li><a class="link" href="/24b/papers-sec-240514-taintmini/"><span class="post-title">论文精读：TAINTMINI: Detecting Flow of Sensitive Data in Mini-Programs with Static Taint Analysis (ICSE 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240728-2fa-consistency/"><span class="post-title">论文精读：A Systematic Study of the Consistency of Two-Factor Authentication User Journeys on Top-Ranked Websites (NDSS 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240810-conquer/"><span class="post-title">论文精读：Do Not Give A Dog Bread Every Time He Wags His Tail: Stealing Passwords through Content Queries (CONQUER) Attack (NDSS 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240817-2fa-failures/"><span class="post-title">论文精读：Security and Privacy Failures in Popular 2FA Apps (Security 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240824-zxcvbn/"><span class="post-title">论文精读：zxcvbn: Low-Budget Password Strength Estimation (Security 2016)</span></a></li><li><a class="link" href="/24c/papers-sec-240902-pafa-authentication/"><span class="post-title">论文精读：Maginot Line: Assessing a New Cross-app Threat to PII-as-Factor Authentication in Chinese Mobile Apps (NDSS 2024)</span></a></li><li><a class="link" href="/24c/papers-sec-240922-pre-hijacked-accounts/"><span class="post-title">论文概要：Pre-hijacked accounts: An Empirical Study of Security Failures in User Account Creation on the Web (Security 2022)</span></a></li><li><a class="link" href="/24d/papers-sec-241207-aimie/"><span class="post-title">论文精读：Understanding and Detecting Abused Image Hosting Modules as Malicious Services (CCS 2023)</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">算法<!-- --> (<!-- -->26<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/sorting-algorithm/"><span class="post-title">排序算法总结与代码实现</span></a></li><li><a class="link" href="/24b/mst-and-sp/"><span class="post-title">最小生成树与最短路算法</span></a></li><li><a class="link" href="/24a/csp-2016-04/"><span class="post-title">CSP 201604 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2018-03/"><span class="post-title">CSP 201803 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-06/"><span class="post-title">CSP 202006 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-09/"><span class="post-title">CSP 202009 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-12/"><span class="post-title">CSP 202012 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2022-06/"><span class="post-title">CSP 202206 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2023-05/"><span class="post-title">CSP 202305 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2023-09/"><span class="post-title">CSP 202309 T1-T4题解</span></a></li><li><a class="link" href="/24b/leetcode-4/"><span class="post-title">LeetCode 4.寻找两个正序数组的中位数</span></a></li><li><a class="link" href="/24b/leetcode-30/"><span class="post-title">LeetCode 30.串联所有单词的子串</span></a></li><li><a class="link" href="/24b/leetcode-37/"><span class="post-title">LeetCode 37.解数独</span></a></li><li><a class="link" href="/24c/leetcode-42/"><span class="post-title">LeetCode 42.接雨水</span></a></li><li><a class="link" href="/24c/leetcode-51/"><span class="post-title">LeetCode 51.N皇后</span></a></li><li><a class="link" href="/24c/leetcode-52/"><span class="post-title">LeetCode 52.N皇后 II</span></a></li><li><a class="link" href="/24b/leetcode-60/"><span class="post-title">LeetCode 60.排列序列</span></a></li><li><a class="link" href="/24b/leetcode-65/"><span class="post-title">LeetCode 65.有效数字</span></a></li><li><a class="link" href="/24c/leetcode-68/"><span class="post-title">LeetCode 68.文本左右对齐</span></a></li><li><a class="link" href="/24b/leetcode-84/"><span class="post-title">LeetCode 84.柱状图中最大的矩形</span></a></li><li><a class="link" href="/24c/leetcode-85/"><span class="post-title">LeetCode 85.最大矩形</span></a></li><li><a class="link" href="/24c/leetcode-149/"><span class="post-title">LeetCode 149.直线上最多的点数</span></a></li><li><a class="link" href="/24d/leetcode-282/"><span class="post-title">LeetCode 282.给表达式添加运算符</span></a></li><li><a class="link" href="/24b/leetcode-312/"><span class="post-title">LeetCode 312.戳气球</span></a></li><li><a class="link" href="/24b/leetcode-1373/"><span class="post-title">LeetCode 1373.二叉搜索子树的最大键值和</span></a></li><li><a class="link" href="/24b/leetcode-1739/"><span class="post-title">LeetCode 1739.放置盒子</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">深度学习<!-- --> (<!-- -->8<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/papers-dl/"><span class="post-title">论文速记：深度学习</span></a></li><li><a class="link" href="/23d/r2plus1d/"><span class="post-title">行为识别R(2+1)D网络</span></a></li><li><a class="link" href="/23d/object-detection-map/"><span class="post-title">目标检测评价指标mAP</span></a></li><li><a class="link" href="/23d/learn-rnn-lstm/"><span class="post-title">学习RNN和LSTM</span></a></li><li><a class="link" href="/24a/reproduce-nerf-rpn/"><span class="post-title">记录：复现NeRF-RPN代码</span></a></li><li><a class="link" href="/24b/yolov5-obb-nms-rotated/"><span class="post-title">解决：nms_rotated报错&quot;THC/THC.h&quot;: No such file or directory</span></a></li><li><a class="link" href="/24c/winograd/"><span class="post-title">Winograd算法</span></a></li><li><a class="link" href="/24c/model-optimization/"><span class="post-title">模型优化概述：量化、压缩、轻量化</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">编程语言<!-- --> (<!-- -->5<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23c/js-array/"><span class="post-title">JavaScript数组常用方法</span></a></li><li><a class="link" href="/24a/cpp-stl/"><span class="post-title">C++中STL的基本使用</span></a></li><li><a class="link" href="/24a/torch-numpy-topk/"><span class="post-title">在pytorch和numpy中取top-k值和索引</span></a></li><li><a class="link" href="/24a/object-oriented-programming-python/"><span class="post-title">Python面向对象编程</span></a></li><li><a class="link" href="/24c/asm8086-snake/"><span class="post-title">8086汇编贪吃蛇</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">前端<!-- --> (<!-- -->2<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23d/css-auto-height-transition/"><span class="post-title">CSS实现auto高度的过渡动画</span></a></li><li><a class="link" href="/24d/android-send-explicit-intent-to-dynamically-registered-receiver/"><span class="post-title">不能向动态注册的广播接收器发送显式Intent</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">课程笔记<!-- --> (<!-- -->20<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/rank-inequality/"><span class="post-title">【线性代数】对秩不等式的理解</span></a></li><li><a class="link" href="/23c/pattern-recognition-1/"><span class="post-title">【模式识别】统计决策方法</span></a></li><li><a class="link" href="/23c/pattern-recognition-2/"><span class="post-title">【模式识别】参数估计</span></a></li><li><a class="link" href="/23c/pattern-recognition-3/"><span class="post-title">【模式识别】非参数估计</span></a></li><li><a class="link" href="/23d/pattern-recognition-4/"><span class="post-title">【模式识别】线性学习器与线性分类器</span></a></li><li><a class="link" href="/23d/protocols/"><span class="post-title">【计算机网络】协议总结</span></a></li><li><a class="link" href="/24a/machine-learning-exercises/"><span class="post-title">【机器学习】习题</span></a></li><li><a class="link" href="/24a/games101-01-transformation/"><span class="post-title">【GAMES101】Transformation</span></a></li><li><a class="link" href="/24a/games101-02-rasterization/"><span class="post-title">【GAMES101】Rasterization</span></a></li><li><a class="link" href="/24a/games101-03-shading/"><span class="post-title">【GAMES101】Shading</span></a></li><li><a class="link" href="/24a/games101-04-geometry/"><span class="post-title">【GAMES101】Geometry</span></a></li><li><a class="link" href="/24a/games101-05-ray-tracing/"><span class="post-title">【GAMES101】Ray Tracing</span></a></li><li><a class="link" href="/24c/assembly-1/"><span class="post-title">【汇编语言】访问寄存器和内存</span></a></li><li><a class="link" href="/24c/assembly-2/"><span class="post-title">【汇编语言】汇编语言编程</span></a></li><li><a class="link" href="/24c/assembly-3/"><span class="post-title">【汇编语言】内存寻址方式</span></a></li><li><a class="link" href="/24c/assembly-4/"><span class="post-title">【汇编语言】流程转移与子程序</span></a></li><li><a class="link" href="/24c/assembly-5/"><span class="post-title">【汇编语言】标志寄存器</span></a></li><li><a class="link active" href="/24c/assembly-6/"><span class="post-title">【汇编语言】中断及外部设备操作</span></a></li><li><a class="link" href="/24d/crypto-1/"><span class="post-title">【密码学】流密码</span></a></li><li><a class="link" href="/24d/crypto-2/"><span class="post-title">【密码学】块密码</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">杂记<!-- --> (<!-- -->4<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/by-questions/"><span class="post-title">专业课复习</span></a></li><li><a class="link" href="/24d/about-interactive-multimedia/"><span class="post-title">关于交互式多媒体</span></a></li><li><a class="link" href="/longtime/hundred-thousand/"><span class="post-title">十万</span></a></li><li><a class="link" href="/longtime/linux-commands/"><span class="post-title">三开</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">交互式多媒体<!-- --> (<!-- -->3<!-- -->)</div><div class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path fill="#50505c" d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z"></path></svg></div></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24d/about-interactive-multimedia/"><span class="post-title">关于交互式多媒体</span></a></li><li><a class="link" href="/23c/pattern-recognition-1/"><span class="post-title">【模式识别】统计决策方法</span></a></li><li><a class="link" href="/23d/css-auto-height-transition/"><span class="post-title">CSS实现auto高度的过渡动画</span></a></li></ul></div></div></div></div><div id="sidebar-mask"></div></div><script src="/_next/static/chunks/webpack-791decc97e4b377f.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/7d7aa1060b5664fb.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/f421cb1dbc9a88bf.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[47690,[],\"\"]\n6:I[55329,[\"481\",\"static/chunks/457b8330-69f8bab043e7caf2.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-c60a65f28e774a61.js\",\"548\",\"static/chunks/548-617600d488b129da.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-bddbb5dbd3f48f88.js\"],\"\"]\n7:I[93334,[\"481\",\"static/chunks/457b8330-69f8bab043e7caf2.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-c60a65f28e774a61.js\",\"931\",\"static/chunks/app/page-43cb1a3cad7f6aa8.js\"],\"\"]\n8:\"$Sreact.suspense\"\na:I[30389,[\"481\",\"static/chunks/457b8330-69f8bab043e7caf2.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-c60a65f28e774a61.js\",\"548\",\"static/chunks/548-617600d488b129da.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-bddbb5dbd3f48f88.js\"],\"\"]\nb:I[5613,[],\"\"]\nd:I[31778,[],\"\"]\ne:I[25694,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"185\",\"static/chunks/app/layout-8463ba7e9dd08fd1.js\"],\"GlobalProvider\"]\nf:I[30397,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"185\",\"static/chunks/app/layout-8463ba7e9dd08fd1.js\"],\"\"]\n11:I[48955,[],\"\"]\nc:[\"slug\",\"24c/assembly-6\",\"c\"]\n12:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7d7aa1060b5664fb.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"gxWF1u4Cr0FTqvy2DnWxJ\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/24c/assembly-6/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"24c/assembly-6\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"24c\\\",\\\"assembly-6\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"24c/assembly-6\",\"c\"],{\"children\":[\"__PAGE__\",{},[\"$L5\",[[\"$\",\"$L6\",null,{}],[\"$\",\"div\",null,{\"id\":\"post-layout\",\"children\":[false,[\"$\",\"div\",null,{\"id\":\"main\",\"className\":\"center-wrapper\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"x-title\",\"children\":\"【汇编语言】中断及外部设备操作\"}],[\"$\",\"$L7\",null,{\"path\":\"/24c/assembly-6/\"}],[\"$\",\"$8\",null,{\"fallback\":[\"$\",\"p\",null,{\"children\":\"Loading...\"}],\"children\":[\"$\",\"$8\",null,{\"fallback\":[\"$\",\"p\",null,{\"children\":\"Loading component...\"}],\"children\":\"$L9\"}]}]]}],[\"$\",\"$La\",null,{}]]}]],null]]},[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$c\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Ld\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f421cb1dbc9a88bf.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[null,[\"$\",\"html\",null,{\"lang\":\"zh-CN\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\"}],[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"}],[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY\"}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\nwindow.dataLayer = window.dataLayer || [];\\nfunction gtag() {\\n    dataLayer.push(arguments);\\n}\\ngtag('js', new Date());\\ngtag('config', 'G-45BYSZ6WPY');\\n\"}}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"const a=z=\u003eh.getItem(z),b=(y,z)=\u003eh.setItem(y,z),c=(y,z)=\u003edocument.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e\u0026\u0026a(d)!==f\u0026\u0026b(d,f);a(d)===e?c(g,e):c(g,f);\"}}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\nif (!Array.prototype.findLast) {\\n    Array.prototype.findLast = function (callback) {\\n        for (let i = this.length - 1; i \u003e= 0; i--) {\\n            if (callback(this[i])) return this[i];\\n        }\\n        return undefined;\\n    };\\n}\\nif (!Array.prototype.findLastIndex) {\\n    Array.prototype.findLastIndex = function (callback) {\\n        for (let i = this.length - 1; i \u003e= 0; i--) {\\n            if (callback(this[i])) return i;\\n        }\\n        return -1;\\n    };\\n}\\n\"}}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$Le\",null,{\"children\":[[\"$\",\"$Lf\",null,{}],[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Ld\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"id\":\"notfound\",\"children\":[[\"$\",\"img\",null,{\"alt\":\"img\",\"src\":\"/images/cry.gif\"}],[\"$\",\"code\",null,{\"id\":\"notfound-404\",\"children\":\"404\"}],[\"$\",\"code\",null,{\"id\":\"notfound-text\",\"children\":\"Page Not Found\"}]]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/98e601cf5ba3633d.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"styles\":null}]]}]}]]}],null]],\"initialHead\":[false,\"$L10\"],\"globalErrorComponent\":\"$11\",\"missingSlots\":\"$W12\"}]]\n"])</script><script>self.__next_f.push([1,"13:I[62029,[\"481\",\"static/chunks/457b8330-69f8bab043e7caf2.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-c60a65f28e774a61.js\",\"548\",\"static/chunks/548-617600d488b129da.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-bddbb5dbd3f48f88.js\"],\"\"]\n15:I[74365,[\"481\",\"static/chunks/457b8330-69f8bab043e7caf2.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-c60a65f28e774a61.js\",\"548\",\"static/chunks/548-617600d488b129da.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-bddbb5dbd3f48f88.js\"],\"\"]\n14:T914,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg,\u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:datasg\n\ndatasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    arr    \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e1,\u003c/span\u003e\u003cspan class=\"token number\"\u003e2,\u003c/span\u003e\u003cspan class=\"token number\"\u003e3,\u003c/span\u003e\u003cspan class=\"token number\"\u003e4,\u003c/span\u003e\u003cspan class=\"token number\"\u003e5,\u003c/span\u003e\u003cspan class=\"token number\"\u003e6,\u003c/span\u003e\u003cspan class=\"token number\"\u003e7,\u003c/span\u003e\u003cspan class=\"token number\"\u003e8\n\u003c/span\u003e    x      \u003cspan class=\"token keyword\"\u003edw\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\n\u003c/span\u003edatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,datasg\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e8\n\u003c/span\u003e    s:     \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eah\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,arr\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e    \u003cspan class=\"token comment\"\u003e;使用数据标号\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e  x,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e          \u003cspan class=\"token comment\"\u003e;使用数据标号\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003einc\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e s\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003eint\u003c/span\u003e  \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003ecodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"16:Tb8d,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg,\u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:datasg,\u003cspan class=\"token register variable\"\u003ess\u003c/span\u003e:stcksg\n\ndatasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token string\"\u003e'misunderstanding'\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003edatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\nstcksg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e16 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\nstcksg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,datasg\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e                      \u003cspan class=\"token comment\"\u003e;设置DS:SI为字符串首地址\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e i7ch\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003eint\u003c/span\u003e  \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003e\n    i7ch:\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ech\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e    w:     \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ejcxz\u003c/span\u003e return\n           \u003cspan class=\"token function\"\u003eand\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e11011111b\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003einc\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e  w\n    return:\u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\ncodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"17:T811,"])</script><script>self.__next_f.push([1,"assume cs:codesg,ds:datasg,ss:stcksg\n\ndatasg segment\n              db 'misunderstanding',0\ndatasg ends\n\nstcksg segment\n              db 16 dup(0)\nstcksg ends\n\ncodesg segment\n       start:\n       ;安装中断处理程序\n                mov  ax,0\n                mov  es,ax\n                mov  di,200h                                ;设置安装位置，安装到ES:DI处\n                call install\n       ;设置中断向量表\n                mov  word ptr es:[7ch*4],200h               ;设置7ch号中断的IP=200h\n                mov  word ptr es:[7ch*4+2],0                ;设置7ch号中断的CS=0\n       ;调用中断实现功能\n                mov  ax,datasg\n                mov  ds,ax\n                mov  si,0                                   ;设置DS:SI为字符串首地址\n                int  7ch\n\n                mov  ax,4c00h\n                int  21h\n\n       ;中断安装程序\n       ;使用movsb指令安装，该指令从DS:SI复制到ES:DI，ES:DI在前面已经设置好\n       install:\n                push ax\n                push cx\n                push si\n                push ds\n                cld                                         ;设置方向标志\n                mov  ax,cs\n                mov  ds,ax                                  ;设置DS为代码段起始地址\n                mov  si,offset i7ch                         ;设置SI为offset i7ch（从子程序开始处复制）\n                mov  cx,offset end_i7ch - offset i7ch       ;使用地址标号相减得到指令长度，也是循环次数\n                rep  movsb\n                pop  ds\n                pop  si\n                pop  cx\n                pop  ax\n                ret\n\n       i7ch:\n                push cx\n                push si\n                mov  ch,0\n       w:       mov  cx,[si]\n                jcxz return\n                and  byte ptr [si],11011111b\n                inc  si\n                jmp  w\n       return:  pop  si\n                pop  cx\n                iret\n       end_i7ch:\n                nop\ncodesg ends\nend start\n"])</script><script>self.__next_f.push([1,"18:T1c13,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg,\u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:datasg,\u003cspan class=\"token register variable\"\u003ess\u003c/span\u003e:stcksg\n\ndatasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n              \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token string\"\u003e'misunderstanding'\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003edatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\nstcksg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n              \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e16 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\nstcksg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n       start:\n       \u003cspan class=\"token comment\"\u003e;安装中断处理程序\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e200h \u003c/span\u003e                               \u003cspan class=\"token comment\"\u003e;设置安装位置，安装到ES:DI处\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e install\n       \u003cspan class=\"token comment\"\u003e;设置中断向量表\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e7ch*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e200h \u003c/span\u003e              \u003cspan class=\"token comment\"\u003e;设置7ch号中断的IP=200h\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e7ch*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e               \u003cspan class=\"token comment\"\u003e;设置7ch号中断的CS=0\u003c/span\u003e\n       \u003cspan class=\"token comment\"\u003e;调用中断实现功能\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,datasg\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e                                  \u003cspan class=\"token comment\"\u003e;设置DS:SI为字符串首地址\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eint\u003c/span\u003e  \u003cspan class=\"token number\"\u003e7ch\n\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e                \u003cspan class=\"token function\"\u003eint\u003c/span\u003e  \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003e\n       \u003cspan class=\"token comment\"\u003e;中断安装程序\u003c/span\u003e\n       \u003cspan class=\"token comment\"\u003e;使用movsb指令安装，该指令从DS:SI复制到ES:DI，ES:DI在前面已经设置好\u003c/span\u003e\n       install:\n                \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003ecld\u003c/span\u003e                                         \u003cspan class=\"token comment\"\u003e;设置方向标志\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e                                  \u003cspan class=\"token comment\"\u003e;设置DS为代码段起始地址\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e i7ch                         \u003cspan class=\"token comment\"\u003e;设置SI为offset i7ch（从子程序开始处复制）\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e end_i7ch \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e i7ch       \u003cspan class=\"token comment\"\u003e;使用地址标号相减得到指令长度，也是循环次数\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003erep\u003c/span\u003e  \u003cspan class=\"token function\"\u003emovsb\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n\n       i7ch:\n                \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ech\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e       w:       \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003ejcxz\u003c/span\u003e return\n                \u003cspan class=\"token function\"\u003eand\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e11011111b\n\u003c/span\u003e                \u003cspan class=\"token function\"\u003einc\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e  w\n       return:  \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n                iret\n       end_i7ch:\n                \u003cspan class=\"token function\"\u003enop\u003c/span\u003e\ncodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"19:T4f8,\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg,\u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:datasg\n\ndatasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n              \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token string\"\u003e'internationalism'\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003edatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n       start:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,datasg\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eint\u003c/span\u003e \u003cspan class=\"token number\"\u003e7ch\n\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eint\u003c/span\u003e \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003ecodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n1a:Ta17,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eah\u003c/span\u003e,\u003cspan class=\"token number\"\u003e2 \u003c/span\u003e           \u003cspan class=\"token comment\"\u003e;设置光标位置功能号\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e           \u003cspan class=\"token comment\"\u003e;页号为0\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003edh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e5 \u003c/span\u003e           \u003cspan class=\"token comment\"\u003e;第5行\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003edl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e12 \u003c/span\u003e          \u003cspan class=\"token comment\"\u003e;第12列\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eint\u003c/span\u003e \u003cspan class=\"token number\"\u003e10h \u003c/span\u003e            \u003cspan class=\"token comment\"\u003e;调用BIOS中断\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eah\u003c/span\u003e,\u003cspan class=\"token number\"\u003e9 \u003c/span\u003e           \u003cspan class=\"token comment\"\u003e;显示字符功能号\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token string\"\u003e'a'\u003c/span\u003e          \u003cspan class=\"token comment\"\u003e;要显示的字符为'a'\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e01001010b \u003c/span\u003e   \u003cspan class=\"token comment\"\u003e;颜色属性\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e           \u003cspan class=\"token comment\"\u003e;页号为0\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e3 \u003c/span\u003e           \u003cspan class=\"token comment\"\u003e;重复3次，即显示3个'a'\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eint\u003c/span\u003e \u003cspan class=\"token number\"\u003e10h \u003c/span\u003e            \u003cspan class=\"token comment\"\u003e;调用BIOS中断\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003eint\u003c/span\u003e \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003ecodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"1b:Ta9e,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0ffh\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003eout\u003c/span\u003e  \u003cspan class=\"token number\"\u003e42h,\u003c/span\u003e\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e       \u003cspan class=\"token comment\"\u003e;设置声音频率，第一次写入低8位\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e08h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003eout\u003c/span\u003e  \u003cspan class=\"token number\"\u003e42h,\u003c/span\u003e\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e       \u003cspan class=\"token comment\"\u003e;设置声音频率，第二次写入高8位\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003ein\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e61h \u003c/span\u003e      \u003cspan class=\"token comment\"\u003e;读取端口原值\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eah\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e        \u003cspan class=\"token comment\"\u003e;保存原值到AH\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003eor\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e3 \u003c/span\u003e        \u003cspan class=\"token comment\"\u003e;设置最低两位为1：打开扬声器和定时器\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eout\u003c/span\u003e  \u003cspan class=\"token number\"\u003e61h,\u003c/span\u003e\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e       \u003cspan class=\"token comment\"\u003e;接通扬声器和定时器\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0ffffh\n\u003c/span\u003e    delay: \u003cspan class=\"token function\"\u003enop\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e delay        \u003cspan class=\"token comment\"\u003e;延迟一段时间\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eah\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eout\u003c/span\u003e  \u003cspan class=\"token number\"\u003e61h,\u003c/span\u003e\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e       \u003cspan class=\"token comment\"\u003e;恢复端口原值\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003eint\u003c/span\u003e  \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003ecodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"1c:Tbce,"])</script><script>self.__next_f.push([1,"assume cs:codesg,ds:datasg,ss:stcksg\n\ndatasg segment\n           db 'Cannot divide by zero!',32 dup(0)\ndatasg ends\n\nstcksg segment\n           db 16 dup(0)\nstcksg ends\n\ncodesg segment\n    start:\n    ;安装中断处理程序\n             mov  ax,0\n             mov  es,ax\n             mov  di,200h-32                          ;设置安装位置，安装到ES:DI处，留出了32字节的数据空间用于存储提示字符串\n             call install\n    ;设置中断向量表\n             mov  word ptr es:[0],200h                ;设置0号中断的IP=200h，真正的程序从200h开始\n             mov  word ptr es:[2],0                   ;设置0号中断的CS=0\n\n             mov  ax,4c00h\n             int  21h\n\n    ;中断安装程序\n    ;使用movsb指令安装，该指令从DS:SI复制到ES:DI，ES:DI在前面已经设置好\n    install:\n             push ax\n             push cx\n             push si\n             push ds\n             cld                                      ;设置方向标志\n    ;前32字节安装字符串常量\n             mov  ax,datasg\n             mov  ds,ax                               ;设置DS为数据段起始地址\n             mov  si,0                                ;设置SI为0\n             mov  cx,32                               ;一共复制32个字节（字符串+填充的0），循环32次\n             rep  movsb\n    ;后面安装程序\n             mov  ax,cs\n             mov  ds,ax                               ;设置DS为代码段起始地址\n             mov  si,offset div0                      ;设置SI为offset div0（从子程序开始处复制）\n             mov  cx,offset end_div0 - offset div0    ;使用地址标号相减得到指令长度，也是循环次数\n             rep  movsb\n             pop  ds\n             pop  si\n             pop  cx\n             pop  ax\n             ret\n\n    ;中断处理程序\n    div0:\n             push ax\n             push cx\n             push si\n             push di\n             push ds\n             push es\n             mov  ax,0\n             mov  ds,ax\n             mov  si,200h-32                          ;初始化DS:SI=00200h-32，这是安装好的字符串数据的起始地址\n             mov  ax,0b800h\n             mov  es,ax\n             mov  di,80*2*12                          ;初始化ES:DI=b8000h+80*2*12，这目标显存的起始地址（第12行开头）\n             mov  ch,0\n    w:       mov  cl,[si]                             ;字符串循环写入显存\n             jcxz return                              ;遇到0就停止\n             mov  es:[di],cl\n             mov  byte ptr es:[di+1],40h              ;红底黑字\n             inc  si\n             add  di,2\n             jmp  w\n    return:  pop  es\n             pop  ds\n             pop  di\n             pop  si\n             pop  cx\n             pop  ax\n             mov  ax,4c00h\n             int  21h                                 ;直接返回操作系统\n    end_div0:\n             nop\ncodesg ends\nend start\n"])</script><script>self.__next_f.push([1,"1d:T29c8,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg,\u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:datasg,\u003cspan class=\"token register variable\"\u003ess\u003c/span\u003e:stcksg\n\ndatasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Cannot divide by zero!'\u003c/span\u003e,\u003cspan class=\"token number\"\u003e32 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\ndatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\nstcksg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e16 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\nstcksg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n    \u003cspan class=\"token comment\"\u003e;安装中断处理程序\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e200h-\u003c/span\u003e\u003cspan class=\"token number\"\u003e32 \u003c/span\u003e                         \u003cspan class=\"token comment\"\u003e;设置安装位置，安装到ES:DI处，留出了32字节的数据空间用于存储提示字符串\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e install\n    \u003cspan class=\"token comment\"\u003e;设置中断向量表\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e200h \u003c/span\u003e               \u003cspan class=\"token comment\"\u003e;设置0号中断的IP=200h，真正的程序从200h开始\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e                  \u003cspan class=\"token comment\"\u003e;设置0号中断的CS=0\u003c/span\u003e\n\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003eint\u003c/span\u003e  \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;中断安装程序\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;使用movsb指令安装，该指令从DS:SI复制到ES:DI，ES:DI在前面已经设置好\u003c/span\u003e\n    install:\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003ecld\u003c/span\u003e                                      \u003cspan class=\"token comment\"\u003e;设置方向标志\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;前32字节安装字符串常量\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,datasg\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e                               \u003cspan class=\"token comment\"\u003e;设置DS为数据段起始地址\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e                               \u003cspan class=\"token comment\"\u003e;设置SI为0\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e32 \u003c/span\u003e                              \u003cspan class=\"token comment\"\u003e;一共复制32个字节（字符串+填充的0），循环32次\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003erep\u003c/span\u003e  \u003cspan class=\"token function\"\u003emovsb\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;后面安装程序\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e                               \u003cspan class=\"token comment\"\u003e;设置DS为代码段起始地址\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e div0                      \u003cspan class=\"token comment\"\u003e;设置SI为offset div0（从子程序开始处复制）\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e end_div0 \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e div0    \u003cspan class=\"token comment\"\u003e;使用地址标号相减得到指令长度，也是循环次数\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003erep\u003c/span\u003e  \u003cspan class=\"token function\"\u003emovsb\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;中断处理程序\u003c/span\u003e\n    div0:\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e200h-\u003c/span\u003e\u003cspan class=\"token number\"\u003e32 \u003c/span\u003e                         \u003cspan class=\"token comment\"\u003e;初始化DS:SI=00200h-32，这是安装好的字符串数据的起始地址\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0b800h\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e80*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2*\u003c/span\u003e\u003cspan class=\"token number\"\u003e12 \u003c/span\u003e                         \u003cspan class=\"token comment\"\u003e;初始化ES:DI=b8000h+80*2*12，这目标显存的起始地址（第12行开头）\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ech\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e    w:       \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e,\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e                             \u003cspan class=\"token comment\"\u003e;字符串循环写入显存\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003ejcxz\u003c/span\u003e return                              \u003cspan class=\"token comment\"\u003e;遇到0就停止\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e40h \u003c/span\u003e             \u003cspan class=\"token comment\"\u003e;红底黑字\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003einc\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e2\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e  w\n    return:  \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003eint\u003c/span\u003e  \u003cspan class=\"token number\"\u003e21h \u003c/span\u003e                                \u003cspan class=\"token comment\"\u003e;直接返回操作系统\u003c/span\u003e\n    end_div0:\n             \u003cspan class=\"token function\"\u003enop\u003c/span\u003e\ncodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"1e:Tf03,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg,\u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:datasg,\u003cspan class=\"token register variable\"\u003ess\u003c/span\u003e:stcksg\n\ndatasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e32 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\ndatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\nstcksg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e16 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\nstcksg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n    \u003cspan class=\"token comment\"\u003e;一段循环在屏幕中间显示A~Z的程序\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0b800h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token string\"\u003e'A'\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e80*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2*\u003c/span\u003e\u003cspan class=\"token number\"\u003e12+\u003c/span\u003e\u003cspan class=\"token number\"\u003e40*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e40h \u003c/span\u003e  \u003cspan class=\"token comment\"\u003e;第12行、第40列，红底黑字\u003c/span\u003e\n    s:     \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e80*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2*\u003c/span\u003e\u003cspan class=\"token number\"\u003e12+\u003c/span\u003e\u003cspan class=\"token number\"\u003e40*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e                \u003cspan class=\"token comment\"\u003e;显示字符\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e delay\n           \u003cspan class=\"token function\"\u003einc\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token string\"\u003e'Z'\u003c/span\u003e\n           jng  s\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003eint\u003c/span\u003e  \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;执行双重空循环，延时\u003c/span\u003e\n    delay:\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e10h\n\u003c/span\u003e    s1:    \u003cspan class=\"token function\"\u003epush\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0ffffh\n\u003c/span\u003e    s2:    \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e s2\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e s1\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\ncodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"1f:T12bc,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg,\u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:datasg,\u003cspan class=\"token register variable\"\u003ess\u003c/span\u003e:stcksg\n\ndatasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e32 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\ndatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\nstcksg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e16 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\nstcksg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n    \u003cspan class=\"token comment\"\u003e;保存原来的中断向量到DS:0处\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,datasg\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;更改原来的中断向量\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e,\u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e i9               \u003cspan class=\"token comment\"\u003e;设置9号中断的IP为offset i9\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e                             \u003cspan class=\"token comment\"\u003e;设置9号中断的CS为代码段起始地址\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;一段循环在屏幕中间显示A~Z的程序\u003c/span\u003e\n           \u003cspan class=\"token comment\"\u003e;...\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;恢复原来的中断向量\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003eint\u003c/span\u003e   \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003e\n    i9:\n           \u003cspan class=\"token comment\"\u003e;...\u003c/span\u003e\ncodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"20:T595,\u003cspan class=\"token comment\"\u003e;自定义的键盘输入处理\u003c/span\u003e\n\u003cspan class=\"token function\"\u003ein\u003c/span\u003e    \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e60h \u003c/span\u003e                                   \u003cspan class=\"token comment\"\u003e;读取键盘输入送入AL\u003c/span\u003e\n\u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e38h \u003c/span\u003e                                   \u003cspan class=\"token comment\"\u003e;判断是否为Alt键\u003c/span\u003e\njne   return                                    \u003cspan class=\"token comment\"\u003e;不是则返回\u003c/span\u003e\n\u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0b800h\n\u003c/span\u003e\u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n\u003cspan class=\"token function\"\u003exor\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e80*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2*\u003c/span\u003e\u003cspan class=\"token number\"\u003e12+\u003c/span\u003e\u003cspan class=\"token number\"\u003e40*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e01100000b \u003c/span\u003e   \u003cspan class=\"token comment\"\u003e;在红色和绿色背景之间切换\u003c/span\u003e\n21:Tc8b,"])</script><script>self.__next_f.push([1,"i9:\n       \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;模拟标志寄存器入栈\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003epushf\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;模拟设置IF=0，TF=0\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003epushf\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e11111100b\n\u003c/span\u003e       \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003epopf\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;call指令即可实现CS、IP入栈并跳转到入口地址\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003edword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;------------------------------------------------------\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;自定义的键盘输入处理\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003ein\u003c/span\u003e    \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e60h \u003c/span\u003e                                   \u003cspan class=\"token comment\"\u003e;读取键盘输入送入AL\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e38h \u003c/span\u003e                                   \u003cspan class=\"token comment\"\u003e;判断是否为Alt键\u003c/span\u003e\n       jne   return                                    \u003cspan class=\"token comment\"\u003e;不是则返回\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0b800h\n\u003c/span\u003e       \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003exor\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e80*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2*\u003c/span\u003e\u003cspan class=\"token number\"\u003e12+\u003c/span\u003e\u003cspan class=\"token number\"\u003e40*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e01100000b \u003c/span\u003e   \u003cspan class=\"token comment\"\u003e;在红色和绿色背景之间切换\u003c/span\u003e\nreturn:\n       \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n       iret\n"])</script><script>self.__next_f.push([1,"22:T9bb,"])</script><script>self.__next_f.push([1,"assume cs:codesg,ds:datasg,ss:stcksg\n\ndatasg segment\n           db 32 dup(0)\ndatasg ends\n\nstcksg segment\n           db 16 dup(0)\nstcksg ends\n\ncodesg segment\n    start:\n    ;保存原来的中断向量到DS:0处\n           mov   ax,datasg\n           mov   ds,ax\n           mov   ax,0\n           mov   es,ax\n           push  es:[9*4]\n           pop   ds:[0]\n           push  es:[9*4+2]\n           pop   ds:[2]\n    ;更改原来的中断向量\n           mov   word ptr es:[9*4],offset i9               ;设置9号中断的IP为offset i9\n           mov   es:[9*4+2],cs                             ;设置9号中断的CS为代码段起始地址\n    ;一段循环在屏幕中间显示A~Z的程序\n           mov   ax,0b800h\n           mov   es,ax\n           mov   al,'A'\n           mov   byte ptr es:[80*2*12+40*2+1],40h          ;第12行、第40列，红底黑字\n    s:     mov   es:[80*2*12+40*2],al                      ;显示字符\n           call  delay\n           inc   al\n           cmp   al,'Z'\n           jng   s\n    ;恢复原来的中断向量\n           mov   ax,0\n           mov   es,ax\n           push  ds:[0]\n           pop   es:[9*4]\n           push  ds:[2]\n           pop   es:[9*4+2]\n\n           mov   ax,4c00h\n           int   21h\n\n    ;执行双重空循环，延时\n    delay:\n           push  cx\n           mov   cx,10h\n    s1:    push  cx\n           mov   cx,0ffffh\n    s2:    loop  s2\n           pop   cx\n           loop  s1\n           pop   cx\n           ret\n\n    i9:\n           push  ax\n           push  bx\n           push  es\n    ;------------------------------------------------------\n    ;模拟标志寄存器入栈\n           pushf\n    ;模拟设置IF=0，TF=0\n           pushf\n           pop   bx\n           and   bh,11111100b\n           push  bx\n           popf\n    ;call指令即可实现CS、IP入栈并跳转到入口地址\n           call  dword ptr ds:[0]\n    ;------------------------------------------------------\n    ;自定义的键盘输入处理\n           in    al,60h                                    ;读取键盘输入送入AL\n           cmp   al,38h                                    ;判断是否为Alt键\n           jne   return                                    ;不是则返回\n           mov   ax,0b800h\n           mov   es,ax\n           xor   byte ptr es:[80*2*12+40*2+1],01100000b    ;在红色和绿色背景之间切换\n\n    return:\n           pop   es\n           pop   bx\n           pop   ax\n           iret\ncodesg ends\nend start\n"])</script><script>self.__next_f.push([1,"23:T29ba,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg,\u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:datasg,\u003cspan class=\"token register variable\"\u003ess\u003c/span\u003e:stcksg\n\ndatasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e32 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\ndatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\nstcksg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e16 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\nstcksg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n    \u003cspan class=\"token comment\"\u003e;保存原来的中断向量到DS:0处\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,datasg\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;更改原来的中断向量\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e,\u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e i9               \u003cspan class=\"token comment\"\u003e;设置9号中断的IP为offset i9\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e                             \u003cspan class=\"token comment\"\u003e;设置9号中断的CS为代码段起始地址\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;一段循环在屏幕中间显示A~Z的程序\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0b800h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token string\"\u003e'A'\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e80*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2*\u003c/span\u003e\u003cspan class=\"token number\"\u003e12+\u003c/span\u003e\u003cspan class=\"token number\"\u003e40*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e40h \u003c/span\u003e         \u003cspan class=\"token comment\"\u003e;第12行、第40列，红底黑字\u003c/span\u003e\n    s:     \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e80*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2*\u003c/span\u003e\u003cspan class=\"token number\"\u003e12+\u003c/span\u003e\u003cspan class=\"token number\"\u003e40*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e                      \u003cspan class=\"token comment\"\u003e;显示字符\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  delay\n           \u003cspan class=\"token function\"\u003einc\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token string\"\u003e'Z'\u003c/span\u003e\n           jng   s\n    \u003cspan class=\"token comment\"\u003e;恢复原来的中断向量\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003eint\u003c/span\u003e   \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;执行双重空循环，延时\u003c/span\u003e\n    delay:\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e10h\n\u003c/span\u003e    s1:    \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0ffffh\n\u003c/span\u003e    s2:    \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e  s2\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e  s1\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n\n    i9:\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;------------------------------------------------------\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;模拟标志寄存器入栈\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epushf\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;模拟设置IF=0，TF=0\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epushf\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e11111100b\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epopf\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;call指令即可实现CS、IP入栈并跳转到入口地址\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003edword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;------------------------------------------------------\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;自定义的键盘输入处理\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ein\u003c/span\u003e    \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e60h \u003c/span\u003e                                   \u003cspan class=\"token comment\"\u003e;读取键盘输入送入AL\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e38h \u003c/span\u003e                                   \u003cspan class=\"token comment\"\u003e;判断是否为Alt键\u003c/span\u003e\n           jne   return                                    \u003cspan class=\"token comment\"\u003e;不是则返回\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0b800h\n\u003c/span\u003e           \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003exor\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e80*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2*\u003c/span\u003e\u003cspan class=\"token number\"\u003e12+\u003c/span\u003e\u003cspan class=\"token number\"\u003e40*\u003c/span\u003e\u003cspan class=\"token number\"\u003e2+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e01100000b \u003c/span\u003e   \u003cspan class=\"token comment\"\u003e;在红色和绿色背景之间切换\u003c/span\u003e\n\n    return:\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n           \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n           iret\ncodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"描述内存单元的标号\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"汇编语言中同样可以用标号表示内存单元，称为数据标号，使用起来的感觉很像C语言的数组。下面的程序计算\u003ccode class=\\\"x-inline-highlight\\\"\u003earr\u003c/code\u003e中元素的和，并存放在数据标号\u003ccode class=\\\"x-inline-highlight\\\"\u003ex\u003c/code\u003e对应的字空间中：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"assume cs:codesg,ds:datasg\\n\\ndatasg segment\\n    arr    db 1,2,3,4,5,6,7,8\\n    x      dw 0\\ndatasg ends\\n\\ncodesg segment\\n    start:\\n           mov  ax,datasg\\n           mov  ds,ax\\n\\n           mov  si,0\\n           mov  cx,8\\n    s:     mov  ah,0\\n           mov  al,arr[si]    ;使用数据标号\\n           add  x,ax          ;使用数据标号\\n           inc  si\\n           loop s\\n\\n           mov  ax,4c00h\\n           int  21h\\ncodesg ends\\nend start\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$14\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"和前面学习的地址标号相比，地址标号仅仅表示一个地址，而数据标号表示地址的同时还暗含了数据的类型，操作时不再需要用\u003ccode class=\\\"x-inline-highlight\\\"\u003ebyte ptr\u003c/code\u003e等显式地指定数据的类型。\"}}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"操作显存\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"屏幕上的内容其实就是显存中的数据。显存是一块内存区域，在8086 CPU中，显存占用地址\u003ccode class=\\\"x-inline-highlight\\\"\u003ea0000h\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003ebffffh\u003c/code\u003e共\u003ccode class=\\\"x-inline-highlight\\\"\u003e128KB\u003c/code\u003e的地址空间，而显示字符时常用到其中的一小块区域：\u003ccode class=\\\"x-inline-highlight\\\"\u003eb8000h\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003ebffffh\u003c/code\u003e共\u003ccode class=\\\"x-inline-highlight\\\"\u003e32KB\u003c/code\u003e的地址空间，它是\u003ccode class=\\\"x-inline-highlight\\\"\u003e25\u003c/code\u003e行、\u003ccode class=\\\"x-inline-highlight\\\"\u003e80\u003c/code\u003e列彩色字符模式第\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e页的显示缓冲区。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这\u003ccode class=\\\"x-inline-highlight\\\"\u003e32KB\u003c/code\u003e的地址空间被划分为\u003ccode class=\\\"x-inline-highlight\\\"\u003e8\u003c/code\u003e个页，每个页\u003ccode class=\\\"x-inline-highlight\\\"\u003e4KB\u003c/code\u003e；\u003ccode class=\\\"x-inline-highlight\\\"\u003e25\u003c/code\u003e行、\u003ccode class=\\\"x-inline-highlight\\\"\u003e80\u003c/code\u003e列一共\u003ccode class=\\\"x-inline-highlight\\\"\u003e2000\u003c/code\u003e个字符，每个字符用\u003ccode class=\\\"x-inline-highlight\\\"\u003e2\u003c/code\u003e个字节描述，刚好是一页的大小。这两个字节分别是：要显示符号的ASCII码、显示属性。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"显示属性一个字节共\u003ccode class=\\\"x-inline-highlight\\\"\u003e8\u003c/code\u003e位，从高到低依次是：\"}}],[\"$\",\"div\",null,{\"className\":\"x-table-wrapper\",\"children\":[\"$\",\"table\",null,{\"className\":\"x-table\",\"children\":[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",\"0\",{\"children\":[[\"$\",\"th\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"位\"}}]}],[\"$\",\"td\",\"1\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e7\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"2\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e6\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"3\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e5\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"4\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e4\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"5\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e3\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"6\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e2\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"7\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e1\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"8\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e\"}}]}]]}],[\"$\",\"tr\",\"1\",{\"children\":[[\"$\",\"th\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"含义\"}}]}],[\"$\",\"td\",\"1\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"闪烁\"}}]}],[\"$\",\"td\",\"2\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"背景\u003ccode class=\\\"x-inline-highlight\\\"\u003eR\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"3\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"背景\u003ccode class=\\\"x-inline-highlight\\\"\u003eG\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"4\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"背景\u003ccode class=\\\"x-inline-highlight\\\"\u003eB\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"5\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"高亮\"}}]}],[\"$\",\"td\",\"6\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"前景\u003ccode class=\\\"x-inline-highlight\\\"\u003eR\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"7\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"前景\u003ccode class=\\\"x-inline-highlight\\\"\u003eG\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"8\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"前景\u003ccode class=\\\"x-inline-highlight\\\"\u003eB\u003c/code\u003e\"}}]}]]}]]}]}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"直接修改内存对应地址的值，屏幕上就会立即有变化：\"}}],[\"$\",\"$L15\",null,{\"src\":\"fig1.jpg\",\"width\":\"100%\"}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"中断、中断处理程序\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在8086 CPU中，中断可以打断当前程序的执行，当CPU收到中断请求时，会执行中断处理程序，处理完后再返回到原程序继续执行。中断处理程序的入口地址存放在\u003cspan class=\\\"x-inline-strong\\\"\u003e中断向量表\u003c/span\u003e中，根据中断类型码查表得到对应处理程序的入口地址。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"8086 CPU的中断向量表是一个\u003ccode class=\\\"x-inline-highlight\\\"\u003e1KB\u003c/code\u003e的表，包含了\u003ccode class=\\\"x-inline-highlight\\\"\u003e256\u003c/code\u003e个中断类型码对应的中断处理程序的入口地址，每个入口地址占\u003ccode class=\\\"x-inline-highlight\\\"\u003e4\u003c/code\u003e个字节，前两字节存放\u003ccode class=\\\"x-inline-highlight\\\"\u003eIP\u003c/code\u003e的值，后两字节存放\u003ccode class=\\\"x-inline-highlight\\\"\u003eCS\u003c/code\u003e的值。中断向量表的起始地址是\u003ccode class=\\\"x-inline-highlight\\\"\u003e00000h\u003c/code\u003e，终止地址是\u003ccode class=\\\"x-inline-highlight\\\"\u003e003ffh\u003c/code\u003e。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"00000h: 0号中断处理程序的入口地址IP\\n00002h: 0号中断处理程序的入口地址CS\\n00004h: 1号中断处理程序的入口地址IP\\n00006h: 1号中断处理程序的入口地址CS\\n00008h: 2号中断处理程序的入口地址IP\\n0000ah: 2号中断处理程序的入口地址CS\\n...\\n003fch: 255号中断处理程序的入口地址IP\\n003feh: 255号中断处理程序的入口地址CS\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"00000h: 0号中断处理程序的入口地址IP\\n00002h: 0号中断处理程序的入口地址CS\\n00004h: 1号中断处理程序的入口地址IP\\n00006h: 1号中断处理程序的入口地址CS\\n00008h: 2号中断处理程序的入口地址IP\\n0000ah: 2号中断处理程序的入口地址CS\\n...\\n003fch: 255号中断处理程序的入口地址IP\\n003feh: 255号中断处理程序的入口地址CS\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"中断可以分为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"内部中断：由CPU内部产生，如除法错误（\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e号）、溢出（\u003ccode class=\\\"x-inline-highlight\\\"\u003e4\u003c/code\u003e号）、\u003ccode class=\\\"x-inline-highlight\\\"\u003eint n\u003c/code\u003e指令触发（\u003ccode class=\\\"x-inline-highlight\\\"\u003en\u003c/code\u003e号）等。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"外部中断：由外部设备产生，如键盘输入等。\"}}]}]]}],[\"$\",\"$L15\",null,{\"src\":\"fig9.jpg\",\"width\":\"800px\",\"filterDarkTheme\":true}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"其中外部中断又分为可屏蔽中断和不可屏蔽中断：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"可屏蔽中断：CPU可以不响应的外中断，一般是由外部硬件通过INTR\u003ccode class=\\\"x-inline-highlight\\\"\u003e(Interrupt Request)\u003c/code\u003e信号线发送给CPU；CPU是否响应取决于\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF\u003c/code\u003e标志位，如果\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF=0\u003c/code\u003e，CPU不响应可屏蔽中断。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"不可屏蔽中断：CPU必须响应的外中断，通过NMI\u003ccode class=\\\"x-inline-highlight\\\"\u003e(Non-Maskable Interrupt)\u003c/code\u003e信号线发送。8086 CPU不可屏蔽中断的中断类型码固定为\u003ccode class=\\\"x-inline-highlight\\\"\u003e2\u003c/code\u003e。\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"几乎所有外部设备引发的中断都是可屏蔽中断，如键盘输入、打印机请求等；而不可屏蔽中断是在系统有必须处理的紧急情况发生时用来通知CPU的中断信息。\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"8086 CPU中断过程\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"中断过程由CPU的硬件自动完成，用中断类型码找到中断向量，并用它设置CS和IP。具体地说8086 CPU的中断过程为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"1.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"从中断信息中取得中断类型码\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"2.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"标志寄存器入栈（中断过程会改变标志，需要先进行保护）\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"3.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"设置\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF=0\u003c/code\u003e，\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF=0\u003c/code\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"4.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eCS\u003c/code\u003e入栈，\u003ccode class=\\\"x-inline-highlight\\\"\u003eIP\u003c/code\u003e入栈\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"5.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"从中断向量表读取中断处理程序的入口地址，设置\u003ccode class=\\\"x-inline-highlight\\\"\u003eCS\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003eIP\u003c/code\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"6.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"开始执行中断处理程序\"}}]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"单步中断\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"标志寄存器中有两个标志位与中断有关：\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF(Trap Flag)\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF(Interrupt Flag)\u003c/code\u003e。\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF\u003c/code\u003e用于单步执行，\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF\u003c/code\u003e用于可屏蔽中断的开关。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF\u003c/code\u003e陷阱标志用于调试，当\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF=1\u003c/code\u003e时，CPU在执行完一条指令后，会产生一个\u003ccode class=\\\"x-inline-highlight\\\"\u003e1\u003c/code\u003e号中断，由系统控制计算机。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF\u003c/code\u003e中断标志用于控制CPU是否响应可屏蔽中断。当\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF=1\u003c/code\u003e时，CPU响应可屏蔽中断；当\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF=0\u003c/code\u003e时，CPU不响应可屏蔽中断。这个标志位可以用\u003ccode class=\\\"x-inline-highlight\\\"\u003esti\u003c/code\u003e指令和\u003ccode class=\\\"x-inline-highlight\\\"\u003ecli\u003c/code\u003e指令来设置：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"sti  ;设置IF=1，CPU响应可屏蔽中断\\ncli  ;设置IF=0，CPU不响应可屏蔽中断\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token function\\\"\u003esti\u003c/span\u003e  \u003cspan class=\\\"token comment\\\"\u003e;设置IF=1，CPU响应可屏蔽中断\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003ecli\u003c/span\u003e  \u003cspan class=\\\"token comment\\\"\u003e;设置IF=0，CPU不响应可屏蔽中断\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-red\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"讨论\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"8086 CPU中断过程第\u003ccode class=\\\"x-inline-highlight\\\"\u003e3\u003c/code\u003e步中，为什么要设置\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF=0\u003c/code\u003e？\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"中断处理程序也是一条条的指令。如果在执行中断处理程序前\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF=1\u003c/code\u003e，则执行完程序的第一条指令后，又会产生单步中断，然后转去执行单步中断的中断处理程序。此时由于\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF=1\u003c/code\u003e，则执行完第一条指令后，又会产生单步中断……\"}}]]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"8086 CPU中断过程第\u003ccode class=\\\"x-inline-highlight\\\"\u003e3\u003c/code\u003e步中，为什么要设置\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF=0\u003c/code\u003e？\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"进入中断处理程序后，禁止其他的可屏蔽中断，避免中断嵌套。\"}}]]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"int指令与iret指令\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在执行\u003ccode class=\\\"x-inline-highlight\\\"\u003eint n\u003c/code\u003e时，逻辑上相当于自动依次执行了：\u003ccode class=\\\"x-inline-highlight\\\"\u003epushf\u003c/code\u003e、\u003ccode class=\\\"x-inline-highlight\\\"\u003epush cs\u003c/code\u003e、\u003ccode class=\\\"x-inline-highlight\\\"\u003epush ip\u003c/code\u003e；它和\u003ccode class=\\\"x-inline-highlight\\\"\u003ecall\u003c/code\u003e指令保存\u003ccode class=\\\"x-inline-highlight\\\"\u003eCS\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003eIP\u003c/code\u003e的行为很像，但还保存并修改了标志寄存器的值。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"对应地，从一个中断处理程序返回到原程序时，需要使用\u003ccode class=\\\"x-inline-highlight\\\"\u003eiret\u003c/code\u003e指令，逻辑上相当于自动依次执行了：\u003ccode class=\\\"x-inline-highlight\\\"\u003epop ip\u003c/code\u003e、\u003ccode class=\\\"x-inline-highlight\\\"\u003epop cs\u003c/code\u003e、\u003ccode class=\\\"x-inline-highlight\\\"\u003epopf\u003c/code\u003e。\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"int指令示例\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在这里我们编写设计一个\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 7ch\u003c/code\u003e中断，功能是将以\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e结尾的纯字母字符串转为大写，参数是\u003ccode class=\\\"x-inline-highlight\\\"\u003eDS:SI\u003c/code\u003e指向字符串首地址。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"先看不使用中断，只用最一般的子程序调用的实现：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"assume cs:codesg,ds:datasg,ss:stcksg\\n\\ndatasg segment\\n           db 'misunderstanding',0\\ndatasg ends\\n\\nstcksg segment\\n           db 16 dup(0)\\nstcksg ends\\n\\ncodesg segment\\n    start:\\n           mov  ax,datasg\\n           mov  ds,ax\\n           mov  si,0                       ;设置DS:SI为字符串首地址\\n           call i7ch\\n\\n           mov  ax,4c00h\\n           int  21h\\n\\n    i7ch:\\n           push cx\\n           push si\\n           mov  ch,0\\n    w:     mov  cx,[si]\\n           jcxz return\\n           and  byte ptr [si],11011111b\\n           inc  si\\n           jmp  w\\n    return:pop  si\\n           pop  cx\\n           ret\\ncodesg ends\\nend start\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$16\"}}]}]]}],[\"$\",\"$L15\",null,{\"src\":\"fig11.jpg\",\"width\":\"100%\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"现在希望编写一个\u003ccode class=\\\"x-inline-highlight\\\"\u003ei7ch\u003c/code\u003e中断处理程序，由\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 7ch\u003c/code\u003e触发中断；此时需要一个确定、但又不影响系统的内存位置存放程序；一个技巧是使用中断向量表的内存区域，因为别的程序不会用到，而系统要处理的中断事件也远没有\u003ccode class=\\\"x-inline-highlight\\\"\u003e256\u003c/code\u003e个，因此可以利用中断向量表后段地址空间，这里选取从\u003ccode class=\\\"x-inline-highlight\\\"\u003e00200h\u003c/code\u003e开始的地址空间作为存放\u003ccode class=\\\"x-inline-highlight\\\"\u003ei7ch\u003c/code\u003e程序的目的地址。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$17\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 312px, var(--bg-transparent-golden) 312px 504px, transparent 504px, transparent 600px, var(--bg-transparent-golden) 600px 624px, transparent 624px, transparent 720px, var(--bg-transparent-golden) 720px 1152px, transparent 1152px, transparent 1440px, var(--bg-transparent-golden) 1440px 1464px, transparent 1464px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$18\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"所谓的“安装程序”就是将\u003ccode class=\\\"x-inline-highlight\\\"\u003ei7ch\u003c/code\u003e中断处理程序的代码复制到内存中（通过\u003ccode class=\\\"x-inline-highlight\\\"\u003emovsb\u003c/code\u003e指令复制机器码），然后还需要修改中断向量表，将\u003ccode class=\\\"x-inline-highlight\\\"\u003e7ch\u003c/code\u003e号中断的入口地址设置为复制到的内存地址。这样触发\u003ccode class=\\\"x-inline-highlight\\\"\u003e7ch\u003c/code\u003e中断时就能够找到自定义的中断处理程序了。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"执行的效果是相同的：数据段中的字符串会被改写为大写，但要注意此时中断处理程序已经写入了内存，在其他程序中可以直接调用\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 7ch\u003c/code\u003e实现同样的功能！例如编写一个\u003ccode class=\\\"x-inline-highlight\\\"\u003etest\u003c/code\u003e程序：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"assume cs:codesg,ds:datasg\\n\\ndatasg segment\\n              db 'internationalism',0\\ndatasg ends\\n\\ncodesg segment\\n       start:\\n              mov ax,datasg\\n              mov ds,ax\\n              mov si,0\\n              int 7ch\\n\\n              mov ax,4c00h\\n              int 21h\\ncodesg ends\\nend start\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$19\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"假设前面的程序编译后得到\u003ccode class=\\\"x-inline-highlight\\\"\u003ei7ch.EXE\u003c/code\u003e，现在做一个实验，依次执行：\"}}],[\"$\",\"$L15\",null,{\"src\":\"fig12.jpg\",\"width\":\"100%\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"可以看到\u003ccode class=\\\"x-inline-highlight\\\"\u003etest\u003c/code\u003e程序中并没有\u003ccode class=\\\"x-inline-highlight\\\"\u003e7ch\u003c/code\u003e中断相关的逻辑，但先执行过\u003ccode class=\\\"x-inline-highlight\\\"\u003ei7ch.EXE\u003c/code\u003e之后，是可以调用相关逻辑完成转换大写功能的，说明成功在内存中存入程序、并改写入口地址了。\"}}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"BIOS中断和DOS中断\"}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"BIOS中断调用示例\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"BIOS中断是由BIOS提供的一些服务程序，可以通过\u003ccode class=\\\"x-inline-highlight\\\"\u003eint\u003c/code\u003e指令调用。前面提到可以直接操作显存来控制屏幕显示的内容，而定位到具体的地址需要细节的计算；而BIOS的\u003ccode class=\\\"x-inline-highlight\\\"\u003e10h\u003c/code\u003e号中断提供了一系列关于字符显示的功能，包括设置光标位置、在指定位置显示字符等。BIOS中断相当于封装了底层的细节，提供了更方便的调用方式。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"找到这些中断的中断号和功能描述，需要\u003cspan class=\\\"x-inline-strong\\\"\u003e查手册\u003c/span\u003e！例如：\"}}],[\"$\",\"$L15\",null,{\"src\":\"fig3.jpg\",\"width\":\"800px\",\"filterDarkTheme\":true}],[\"$\",\"$L15\",null,{\"src\":\"fig4.jpg\",\"width\":\"800px\",\"filterDarkTheme\":true}],[\"$\",\"$L15\",null,{\"src\":\"fig5.jpg\",\"width\":\"800px\",\"filterDarkTheme\":true}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这个手册指明显示服务的中断号是\u003ccode class=\\\"x-inline-highlight\\\"\u003e10h\u003c/code\u003e，我们如果想使用设置光标位置功能，需要设置四个输入参数：功能号\u003ccode class=\\\"x-inline-highlight\\\"\u003eAH\u003c/code\u003e，页号\u003ccode class=\\\"x-inline-highlight\\\"\u003eBH\u003c/code\u003e，行号\u003ccode class=\\\"x-inline-highlight\\\"\u003eDH\u003c/code\u003e，列号\u003ccode class=\\\"x-inline-highlight\\\"\u003eDL\u003c/code\u003e；显示字符功能同理。因此就可以编写出如下程序：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"assume cs:codesg\\ncodesg segment\\n    start:\\n           mov ah,2            ;设置光标位置功能号\\n           mov bh,0            ;页号为0\\n           mov dh,5            ;第5行\\n           mov dl,12           ;第12列\\n           int 10h             ;调用BIOS中断\\n\\n           mov ah,9            ;显示字符功能号\\n           mov al,'a'          ;要显示的字符为'a'\\n           mov bl,01001010b    ;颜色属性\\n           mov bh,0            ;页号为0\\n           mov cx,3            ;重复3次，即显示3个'a'\\n           int 10h             ;调用BIOS中断\\n\\n           mov ax,4c00h\\n           int 21h\\ncodesg ends\\nend start\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1a\"}}]}]]}],[\"$\",\"$L15\",null,{\"src\":\"fig6.jpg\",\"width\":\"100%\"}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"DOS中断\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"DOS中断是由操作系统提供的、更为高层的中断，同样提供了丰富的功能，使用时查手册即可。下图列出了一些DOS中断，并以\u003ccode class=\\\"x-inline-highlight\\\"\u003e21h\u003c/code\u003e为例做展开。\"}}],[\"$\",\"$L15\",null,{\"src\":\"fig7.jpg\",\"width\":\"100%\",\"filterDarkTheme\":true}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"二者的联系\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"BIOS和DOS在所提供的中断处理程序中包含了许多子程序，这些子程序实现了编程时常用到的功能。\u003cbr/\u003e这些功能大多是调用外设的功能，而外设的硬件细节太多，常调用ROM中的BIOS中断来完成操作；\u003cbr/\u003e对于DOS中断来说，和硬件设备相关的DOS中断处理程序中，一般都是在操作系统级调用BIOS的中断处理程序来实现的，提供更加高层的一些功能。\u003cbr/\u003e当然如果这些都不能满足需求，用户也可以在程序里直接和外设进行联系（端口操作）。\"}}],[\"$\",\"$L15\",null,{\"src\":\"fig8.jpg\",\"width\":\"600px\",\"filterDarkTheme\":true}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"端口的读写\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"CPU可以直接读写三个地方的数据：CPU内部的寄存器、内存单元、端口；而端口对应网卡、显卡等等外部芯片。这些外部芯片工作时，都有一些寄存器由CPU读写；而从CPU的角度，就把这些寄存器当作端口并统一编址。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"端口的编址是\u003ccode class=\\\"x-inline-highlight\\\"\u003e16\u003c/code\u003e位的，范围是\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003e65535\u003c/code\u003e，这部分地址是独立于内存地址的。硬件设备与特定端口之间的映射是由硬件设计者决定的；为了确保不同厂商的设备能够正常工作，会有标准化组织制定统一的行业标准。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"读写端口要使用\u003ccode class=\\\"x-inline-highlight\\\"\u003ein\u003c/code\u003e指令和\u003ccode class=\\\"x-inline-highlight\\\"\u003eout\u003c/code\u003e指令：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"in  al,20h  ;从20h号端口读取一个字节到AL\\nout 21h,al  ;将AL的内容写入21h号端口\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token function\\\"\u003ein\u003c/span\u003e  \u003cspan class=\\\"token register variable\\\"\u003eal\u003c/span\u003e,\u003cspan class=\\\"token number\\\"\u003e20h \u003c/span\u003e \u003cspan class=\\\"token comment\\\"\u003e;从20h号端口读取一个字节到AL\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003eout\u003c/span\u003e \u003cspan class=\\\"token number\\\"\u003e21h,\u003c/span\u003e\u003cspan class=\\\"token register variable\\\"\u003eal\u003c/span\u003e  \u003cspan class=\\\"token comment\\\"\u003e;将AL的内容写入21h号端口\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"对于\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003e255\u003c/code\u003e号端口，端口号可以直接用立即数给出；对于\u003ccode class=\\\"x-inline-highlight\\\"\u003e256\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003e65535\u003c/code\u003e号端口，端口号放在\u003ccode class=\\\"x-inline-highlight\\\"\u003eDX\u003c/code\u003e中：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"mov  dx,3f8h\\nin   al,dx  ;从3f8h号端口读取一个字节到AL\\nout  dx,al  ;将AL的内容写入3f8h号端口\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token function\\\"\u003emov\u003c/span\u003e  \u003cspan class=\\\"token register variable\\\"\u003edx\u003c/span\u003e,\u003cspan class=\\\"token number\\\"\u003e3f8h\\n\u003c/span\u003e\u003cspan class=\\\"token function\\\"\u003ein\u003c/span\u003e   \u003cspan class=\\\"token register variable\\\"\u003eal\u003c/span\u003e,\u003cspan class=\\\"token register variable\\\"\u003edx\u003c/span\u003e  \u003cspan class=\\\"token comment\\\"\u003e;从3f8h号端口读取一个字节到AL\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003eout\u003c/span\u003e  \u003cspan class=\\\"token register variable\\\"\u003edx\u003c/span\u003e,\u003cspan class=\\\"token register variable\\\"\u003eal\u003c/span\u003e  \u003cspan class=\\\"token comment\\\"\u003e;将AL的内容写入3f8h号端口\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-golden\",\"children\":[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在\u003ccode class=\\\"x-inline-highlight\\\"\u003ein\u003c/code\u003e指令和\u003ccode class=\\\"x-inline-highlight\\\"\u003eout\u003c/code\u003e指令中，只能使用\u003ccode class=\\\"x-inline-highlight\\\"\u003eAL\u003c/code\u003e（访问\u003ccode class=\\\"x-inline-highlight\\\"\u003e8\u003c/code\u003e位端口）或\u003ccode class=\\\"x-inline-highlight\\\"\u003eAX\u003c/code\u003e（访问\u003ccode class=\\\"x-inline-highlight\\\"\u003e16\u003c/code\u003e位端口）来存放读取或要写入的数据。\"}}]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"扬声器发声示例\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"下面的程序可以让扬声器响一下：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"assume cs:codesg\\ncodesg segment\\n    start:\\n           mov  al,0ffh\\n           out  42h,al       ;设置声音频率，第一次写入低8位\\n           mov  al,08h\\n           out  42h,al       ;设置声音频率，第二次写入高8位\\n\\n           in   al,61h       ;读取端口原值\\n           mov  ah,al        ;保存原值到AH\\n\\n           or   al,3         ;设置最低两位为1：打开扬声器和定时器\\n           out  61h,al       ;接通扬声器和定时器\\n\\n           mov  cx,0ffffh\\n    delay: nop\\n           loop delay        ;延迟一段时间\\n\\n           mov  al,ah\\n           out  61h,al       ;恢复端口原值\\n\\n           mov  ax,4c00h\\n           int  21h\\ncodesg ends\\nend start\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1b\"}}]}]]}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"键盘相关操作\"}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"键盘输入的处理过程\"}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"1.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"键盘输入\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"键盘上每一个键相当于一个开关，键盘中有一个芯片对每一个键的开关状态进行扫描：按下/松开一个键时，芯片都会产生一个扫描码，扫描码被送入主板上相关接口芯片的寄存器中，该寄存器的端口地址为\u003ccode class=\\\"x-inline-highlight\\\"\u003e60h\u003c/code\u003e。扫描码与ASCII码不同，下图是通码：\"}}],[\"$\",\"$L15\",null,{\"src\":\"fig10.jpg\",\"width\":\"800px\",\"filterDarkTheme\":true}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"按下一个键产生通码，松开一个键产生断码；通码的最高位为\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e，断码的最高位为\u003ccode class=\\\"x-inline-highlight\\\"\u003e1\u003c/code\u003e；通码和断码的低\u003ccode class=\\\"x-inline-highlight\\\"\u003e7\u003c/code\u003e位是相同的。\"}}]]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"2.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"引发\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"键盘的输入到达\u003ccode class=\\\"x-inline-highlight\\\"\u003e60h\u003c/code\u003e端口时，相关的芯片就会向CPU发出中断类型码为\u003ccode class=\\\"x-inline-highlight\\\"\u003e9\u003c/code\u003e的可屏蔽中断信息。CPU检测到该中断信息后，如果\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF=1\u003c/code\u003e，则响应中断，转去执行\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断处理程序。\"}}]]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"3.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"执行\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断处理程序\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-golden\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"BIOS键盘缓冲区\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"BIOS键盘缓冲区是系统启动后，BIOS用于存放\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断处理程序所接收的键盘输入的内存区。BIOS键盘缓冲区可以存储最多\u003ccode class=\\\"x-inline-highlight\\\"\u003e15\u003c/code\u003e个键盘输入，每个键盘输入用一个字存放，高位字节存放扫描码，低位字节存放ASCII码。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"如果输入了控制键和切换键，内存中有一个特殊的字节：键盘状态字节，地址是\u003ccode class=\\\"x-inline-highlight\\\"\u003e00417h\u003c/code\u003e，用于存放控制键和切换键的状态信息。字节内容为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-table-wrapper\",\"children\":[\"$\",\"table\",null,{\"className\":\"x-table\",\"children\":[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",\"0\",{\"children\":[[\"$\",\"th\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"位\"}}]}],[\"$\",\"td\",\"1\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e7\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"2\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e6\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"3\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e5\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"4\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e4\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"5\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e3\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"6\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e2\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"7\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e1\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"8\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e\"}}]}]]}],[\"$\",\"tr\",\"1\",{\"children\":[[\"$\",\"th\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"含义\"}}]}],[\"$\",\"td\",\"1\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eInsert\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"2\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eCaps Lock\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"3\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eNum Lock\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"4\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eScroll Lock\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"5\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eAlt\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"6\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eCtrl\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"7\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"左\u003ccode class=\\\"x-inline-highlight\\\"\u003eShift\u003c/code\u003e\"}}]}],[\"$\",\"td\",\"8\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"右\u003ccode class=\\\"x-inline-highlight\\\"\u003eShift\u003c/code\u003e\"}}]}]]}]]}]}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"程序读出\u003ccode class=\\\"x-inline-highlight\\\"\u003e60h\u003c/code\u003e端口中的扫描码，如果是字符键的扫描码，将该扫描码和它所对应的ASCII码送入内存中的BIOS键盘缓冲区；如果是控制键和切换键的扫描码，则更新键盘状态字节。\"}}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"更多中断操作\"}],[\"$\",\"$L15\",null,{\"src\":\"fig13.jpg\",\"width\":\"800px\",\"filterDarkTheme\":true}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"硬件中断、BIOS中断、DOS中断是由底层至上层针对键盘操作提供的不同功能。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"以BIOS\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 16h\u003c/code\u003e中断为例，第\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e号功能的过程是：\"}}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"1.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"检查键盘缓冲区是否有数据\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"2.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"如果没有，重复第\u003ccode class=\\\"x-inline-highlight\\\"\u003e1\u003c/code\u003e步\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"3.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"读取缓冲区第一个字单元的键盘输入\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"4.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"将读取的扫描码送入\u003ccode class=\\\"x-inline-highlight\\\"\u003eAH\u003c/code\u003e，ASCII码送入\u003ccode class=\\\"x-inline-highlight\\\"\u003eAL\u003c/code\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"5.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"将已读取的键盘输入从缓冲区中删除\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 16h\u003c/code\u003e中断和\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断是一对相互配合的程序，\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断处理程序向键盘缓冲区中写入，\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 16h\u003c/code\u003e中断处理程序从缓冲区中读出。它们写入和读出的时机不同，\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断处理程序在有键按下的时候向键盘缓冲区中写入数据；而\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 16h\u003c/code\u003e中断处理程序是在应用程序对其进行调用的时候，将数据从键盘缓冲区中读出。\"}}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"练习\"}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"编写除法错误的中断处理程序\"}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"编程自定义除法错误中断，除以\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e时在屏幕上提示\u003ccode class=\\\"x-inline-highlight\\\"\u003eCannot divide by zero!\u003c/code\u003e然后返回操作系统。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\";以下代码会触发除法错误中断\\nmov  ax,1\\nmov  bl,0\\ndiv  bl\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token comment\\\"\u003e;以下代码会触发除法错误中断\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003emov\u003c/span\u003e  \u003cspan class=\\\"token register variable\\\"\u003eax\u003c/span\u003e,\u003cspan class=\\\"token number\\\"\u003e1\\n\u003c/span\u003e\u003cspan class=\\\"token function\\\"\u003emov\u003c/span\u003e  \u003cspan class=\\\"token register variable\\\"\u003ebl\u003c/span\u003e,\u003cspan class=\\\"token number\\\"\u003e0\\n\u003c/span\u003e\u003cspan class=\\\"token function\\\"\u003ediv\u003c/span\u003e  \u003cspan class=\\\"token register variable\\\"\u003ebl\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"注：除法错误不仅仅是除以\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e，还包括除数溢出等情况。\"}}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"选取从\u003ccode class=\\\"x-inline-highlight\\\"\u003e00200h\u003c/code\u003e开始的地址空间作为存放\u003ccode class=\\\"x-inline-highlight\\\"\u003ediv0\u003c/code\u003e程序的目的地址。同时，我们希望中断处理程序能够永久驻留内存，因此为了保证正常工作，提示字符串的值也需要随程序一起复制到内存中，我们把这部分数据保存到\u003ccode class=\\\"x-inline-highlight\\\"\u003e00200h\u003c/code\u003e之前的\u003ccode class=\\\"x-inline-highlight\\\"\u003e32\u003c/code\u003e个字节（从\u003ccode class=\\\"x-inline-highlight\\\"\u003e001e0\u003c/code\u003e开始）。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$1c\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1d\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"编译上面的程序，命名为\u003ccode class=\\\"x-inline-highlight\\\"\u003ediv0.EXE\u003c/code\u003e；接下来编译一个触发除法错误中断的程序，命名为\u003ccode class=\\\"x-inline-highlight\\\"\u003ebad.EXE\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"assume cs:codesg\\ncodesg segment\\n    start: mov ax,1\\n           mov bl,0\\n           div bl\\n\\n           mov ax,4c00h\\n           int 21h\\ncodesg ends\\nend start\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token keyword\\\"\u003eassume\u003c/span\u003e \u003cspan class=\\\"token register variable\\\"\u003ecs\u003c/span\u003e:codesg\\ncodesg \u003cspan class=\\\"token keyword\\\"\u003esegment\u003c/span\u003e\\n    start: \u003cspan class=\\\"token function\\\"\u003emov\u003c/span\u003e \u003cspan class=\\\"token register variable\\\"\u003eax\u003c/span\u003e,\u003cspan class=\\\"token number\\\"\u003e1\\n\u003c/span\u003e           \u003cspan class=\\\"token function\\\"\u003emov\u003c/span\u003e \u003cspan class=\\\"token register variable\\\"\u003ebl\u003c/span\u003e,\u003cspan class=\\\"token number\\\"\u003e0\\n\u003c/span\u003e           \u003cspan class=\\\"token function\\\"\u003ediv\u003c/span\u003e \u003cspan class=\\\"token register variable\\\"\u003ebl\u003c/span\u003e\\n\\n           \u003cspan class=\\\"token function\\\"\u003emov\u003c/span\u003e \u003cspan class=\\\"token register variable\\\"\u003eax\u003c/span\u003e,\u003cspan class=\\\"token number\\\"\u003e4c00h\\n\u003c/span\u003e           \u003cspan class=\\\"token function\\\"\u003eint\u003c/span\u003e \u003cspan class=\\\"token number\\\"\u003e21h\\n\u003c/span\u003ecodesg \u003cspan class=\\\"token keyword\\\"\u003eends\u003c/span\u003e\\n\u003cspan class=\\\"token keyword\\\"\u003eend\u003c/span\u003e start\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"依次执行，在\u003ccode class=\\\"x-inline-highlight\\\"\u003ediv0.EXE\u003c/code\u003e执行完成返回后，执行\u003ccode class=\\\"x-inline-highlight\\\"\u003ebad.EXE\u003c/code\u003e能够触发自定义的中断处理程序并在屏幕上输出提示内容。\"}}],[\"$\",\"$L15\",null,{\"src\":\"fig2.jpg\",\"width\":\"100%\"}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"自定义键盘输入处理\"}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"下面的程序可以在屏幕的中心以红底黑字依次显示字符\u003ccode class=\\\"x-inline-highlight\\\"\u003eA\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003eZ\u003c/code\u003e，然后结束程序。子程序\u003ccode class=\\\"x-inline-highlight\\\"\u003edelay\u003c/code\u003e的作用是控制相邻两个字符显示的时间间隔。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"assume cs:codesg,ds:datasg,ss:stcksg\\n\\ndatasg segment\\n           db 32 dup(0)\\ndatasg ends\\n\\nstcksg segment\\n           db 16 dup(0)\\nstcksg ends\\n\\ncodesg segment\\n    start:\\n    ;一段循环在屏幕中间显示A~Z的程序\\n           mov  ax,0b800h\\n           mov  es,ax\\n           mov  al,'A'\\n           mov   byte ptr es:[80*2*12+40*2+1],40h   ;第12行、第40列，红底黑字\\n    s:     mov  es:[80*2*12+40*2],al                ;显示字符\\n           call delay\\n           inc  al\\n           cmp  al,'Z'\\n           jng  s\\n\\n           mov  ax,4c00h\\n           int  21h\\n\\n    ;执行双重空循环，延时\\n    delay:\\n           push cx\\n           mov  cx,10h\\n    s1:    push cx\\n           mov  cx,0ffffh\\n    s2:    loop s2\\n           pop  cx\\n           loop s1\\n           pop  cx\\n           ret\\ncodesg ends\\nend start\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"现在希望加入一个功能，在程序执行的任何时刻，按下\u003ccode class=\\\"x-inline-highlight\\\"\u003eAlt\u003c/code\u003e键可以切换字符的显示背景。（在红/绿色之间切换即可，只需要每次对显示属性字节异或\u003ccode class=\\\"x-inline-highlight\\\"\u003e01100000b\u003c/code\u003e）\"}}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"与上一题不同的是，首先本题不需要安装中断处理程序，只需要程序运行时能够定制化键盘中断的功能；另外由于键盘输入的中断处理程序涉及到所有键的输入，因此不能像上题一样完全重写一个处理程序，而是大致的思路应该为在原有\u003ccode class=\\\"x-inline-highlight\\\"\u003e9\u003c/code\u003e号中断处理程序的基础上，“插入”一个条件判断，如果是\u003ccode class=\\\"x-inline-highlight\\\"\u003eAlt\u003c/code\u003e键则执行想要的功能。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"综上，本题采用的思路为，先把原来的中断向量保存到内存中，然后修改原来的中断向量指向自定义的中断处理程序\u003ccode class=\\\"x-inline-highlight\\\"\u003ei9\u003c/code\u003e；在返回前还要恢复原来的中断向量。而在子程序\u003ccode class=\\\"x-inline-highlight\\\"\u003ei9\u003c/code\u003e中，还要想办法调用原来的中断处理程序，正常响应键盘输入。一个大致的框架为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"assume cs:codesg,ds:datasg,ss:stcksg\\n\\ndatasg segment\\n           db 32 dup(0)\\ndatasg ends\\n\\nstcksg segment\\n           db 16 dup(0)\\nstcksg ends\\n\\ncodesg segment\\n    start:\\n    ;保存原来的中断向量到DS:0处\\n           mov   ax,datasg\\n           mov   ds,ax\\n           mov   ax,0\\n           mov   es,ax\\n           push  es:[9*4]\\n           pop   ds:[0]\\n           push  es:[9*4+2]\\n           pop   ds:[2]\\n    ;更改原来的中断向量\\n           mov   word ptr es:[9*4],offset i9               ;设置9号中断的IP为offset i9\\n           mov   es:[9*4+2],cs                             ;设置9号中断的CS为代码段起始地址\\n\\n    ;一段循环在屏幕中间显示A~Z的程序\\n           ;...\\n\\n    ;恢复原来的中断向量\\n           mov   ax,0\\n           mov   es,ax\\n           push  ds:[0]\\n           pop   es:[9*4]\\n           push  ds:[2]\\n           pop   es:[9*4+2]\\n\\n           mov   ax,4c00h\\n           int   21h\\n\\n    i9:\\n           ;...\\ncodesg ends\\nend start\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 312px, var(--bg-transparent-golden) 312px 600px, transparent 600px, transparent 696px, var(--bg-transparent-golden) 696px 864px, transparent 864px, transparent 960px, var(--bg-transparent-golden) 960px 1008px, transparent 1008px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1f\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"前面提到8086 CPU的中断过程为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-gray\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"1.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"从中断信息中取得中断类型码\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"2.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"标志寄存器入栈（中断过程会改变标志，需要先进行保护）\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"3.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"设置\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF=0\u003c/code\u003e，\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF=0\u003c/code\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"4.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eCS\u003c/code\u003e入栈，\u003ccode class=\\\"x-inline-highlight\\\"\u003eIP\u003c/code\u003e入栈\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"5.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"从中断向量表读取中断处理程序的入口地址，设置\u003ccode class=\\\"x-inline-highlight\\\"\u003eCS\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003eIP\u003c/code\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"6.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"开始执行中断处理程序\"}}]}]]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"我们现在要在\u003ccode class=\\\"x-inline-highlight\\\"\u003ei9\u003c/code\u003e子程序中调用原来的\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断处理程序。请注意，程序之所以跳转到\u003ccode class=\\\"x-inline-highlight\\\"\u003ei9\u003c/code\u003e，是因为程序已经修改了中断向量表，然后由键盘输入产生\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断，中断过程的第\u003ccode class=\\\"x-inline-highlight\\\"\u003e1\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003e5\u003c/code\u003e步已经执行完成，在第\u003ccode class=\\\"x-inline-highlight\\\"\u003e5\u003c/code\u003e步进入到\u003ccode class=\\\"x-inline-highlight\\\"\u003ei9\u003c/code\u003e子程序中；\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"而我们还想在\u003ccode class=\\\"x-inline-highlight\\\"\u003ei9\u003c/code\u003e子程序中手动调用被保存在\u003ccode class=\\\"x-inline-highlight\\\"\u003edword ptr ds:[0]\u003c/code\u003e中的原来的\u003ccode class=\\\"x-inline-highlight\\\"\u003eint 9\u003c/code\u003e中断处理程序，此时没有人为我们自动执行中断过程了，需要手动模拟！因此这部分过程为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"1.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"模拟标志寄存器入栈\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"pushf\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token function\\\"\u003epushf\u003c/span\u003e\"}}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"2.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"模拟设置\u003ccode class=\\\"x-inline-highlight\\\"\u003eIF=0\u003c/code\u003e，\u003ccode class=\\\"x-inline-highlight\\\"\u003eTF=0\u003c/code\u003e\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"pushf\\npop   bx                ;标志寄存器的值临时赋值给BX\\nand   bh,11111100b      ;IF=0，TF=0\\npush  bx\\npopf                    ;将更新后的值赋值给标志寄存器\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token function\\\"\u003epushf\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003epop\u003c/span\u003e   \u003cspan class=\\\"token register variable\\\"\u003ebx\u003c/span\u003e                \u003cspan class=\\\"token comment\\\"\u003e;标志寄存器的值临时赋值给BX\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003eand\u003c/span\u003e   \u003cspan class=\\\"token register variable\\\"\u003ebh\u003c/span\u003e,\u003cspan class=\\\"token number\\\"\u003e11111100b \u003c/span\u003e     \u003cspan class=\\\"token comment\\\"\u003e;IF=0，TF=0\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003epush\u003c/span\u003e  \u003cspan class=\\\"token register variable\\\"\u003ebx\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003epopf\u003c/span\u003e                    \u003cspan class=\\\"token comment\\\"\u003e;将更新后的值赋值给标志寄存器\u003c/span\u003e\\n\"}}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"3.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eCS\u003c/code\u003e入栈、\u003ccode class=\\\"x-inline-highlight\\\"\u003eIP\u003c/code\u003e入栈、跳转到入口地址由\u003ccode class=\\\"x-inline-highlight\\\"\u003ecall\u003c/code\u003e指令完成：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"call  dword ptr ds:[0]\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token function\\\"\u003ecall\u003c/span\u003e  \u003cspan class=\\\"token keyword\\\"\u003edword\u003c/span\u003e \u003cspan class=\\\"token keyword\\\"\u003eptr\u003c/span\u003e \u003cspan class=\\\"token register variable\\\"\u003eds\u003c/span\u003e:\u003cspan class=\\\"token operator\\\"\u003e[\u003c/span\u003e\u003cspan class=\\\"token number\\\"\u003e0]\u003c/span\u003e\"}}]}]]}]]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在原中断处理程序调用完成后，就是自定义的部分：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\";自定义的键盘输入处理\\nin    al,60h                                    ;读取键盘输入送入AL\\ncmp   al,38h                                    ;判断是否为Alt键\\njne   return                                    ;不是则返回\\nmov   ax,0b800h\\nmov   es,ax\\nxor   byte ptr es:[80*2*12+40*2+1],01100000b    ;在红色和绿色背景之间切换\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$20\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"注意因为这是中断调用，要使用\u003ccode class=\\\"x-inline-highlight\\\"\u003eiret\u003c/code\u003e指令返回。\u003ccode class=\\\"x-inline-highlight\\\"\u003ei9\u003c/code\u003e子程序的完整代码为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"i9:\\n       push  ax\\n       push  bx\\n       push  es\\n;------------------------------------------------------\\n;模拟标志寄存器入栈\\n       pushf\\n;模拟设置IF=0，TF=0\\n       pushf\\n       pop   bx\\n       and   bh,11111100b\\n       push  bx\\n       popf\\n;call指令即可实现CS、IP入栈并跳转到入口地址\\n       call  dword ptr ds:[0]\\n;------------------------------------------------------\\n;自定义的键盘输入处理\\n       in    al,60h                                    ;读取键盘输入送入AL\\n       cmp   al,38h                                    ;判断是否为Alt键\\n       jne   return                                    ;不是则返回\\n       mov   ax,0b800h\\n       mov   es,ax\\n       xor   byte ptr es:[80*2*12+40*2+1],01100000b    ;在红色和绿色背景之间切换\\nreturn:\\n       pop   es\\n       pop   bx\\n       pop   ax\\n       iret\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$21\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-divider\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"题目的完整代码为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L13\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$22\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$23\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"执行效果（按下\u003ccode class=\\\"x-inline-highlight\\\"\u003eAlt\u003c/code\u003e键切换背景颜色）：\"}}],[\"$\",\"$L15\",null,{\"src\":\"fig14.gif\",\"width\":\"200px\"}]]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"【汇编语言】中断及外部设备操作 - 铃木的网络日记\"}],[\"$\",\"link\",\"3\",{\"rel\":\"canonical\",\"href\":\"https://1kuzus.github.io/24c/assembly-6/\"}]]\n5:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>