<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/4682f1d53f08c69e.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/251a603d14fca651.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/c3852fd214fb6838.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-784efdfcf16d24d7.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-e278622fa62dc0bf.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-faab496ef6116e58.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-ed6799cd4e1df27b.js" async="" crossorigin=""></script><script src="/_next/static/chunks/457b8330-b5c9cf3fcf214847.js" async=""></script><script src="/_next/static/chunks/d3ac728e-0c798b3b8aa3bf53.js" async=""></script><script src="/_next/static/chunks/250-0ef8476c0fa8ee24.js" async=""></script><script src="/_next/static/chunks/612-fa632c1349770315.js" async=""></script><script src="/_next/static/chunks/551-19232c47cd1e883a.js" async=""></script><script src="/_next/static/chunks/742-fa7d80f612d849db.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-aef85db72c3ae249.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/layout-943ca6d0b6a86a10.js" async=""></script><script src="/_next/static/chunks/app/layout-71de1b4a5090c7d9.js" async=""></script><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY"></script><title>8086汇编贪吃蛇 - 铃木的网络日记</title><link rel="canonical" href="https://1kuzus.github.io/24c/asm8086-snake/"/><link rel="icon" href="/favicon.ico" type="image/x-icon"/><script>
window.dataLayer = window.dataLayer || [];
function gtag() {
    dataLayer.push(arguments);
}
gtag('js', new Date());
gtag('config', 'G-45BYSZ6WPY');
</script><script>const a=z=>h.getItem(z),b=(y,z)=>h.setItem(y,z),c=(y,z)=>document.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e&&a(d)!==f&&b(d,f);a(d)===e?c(g,e):c(g,f);</script><script>
if (!Array.prototype.findLast) {
    Array.prototype.findLast = function (callback) {
        for (let i = this.length - 1; i >= 0; i--) {
            if (callback(this[i])) return this[i];
        }
        return undefined;
    };
}
if (!Array.prototype.findLastIndex) {
    Array.prototype.findLastIndex = function (callback) {
        for (let i = this.length - 1; i >= 0; i--) {
            if (callback(this[i])) return i;
        }
        return -1;
    };
}
</script><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body><div id="header"><div id="header-left-wrapper"><a href="/"><div id="header-logo-bg"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 1560 1560"><path fill="#00A8C4" d="M644 97h273l272 683H916z"></path><path fill="#30303C" d="M98 97h273l409 1024L1189 97h273L916 1462H644z"></path><path fill="#00F8FF" d="M98 1462 643 97h273L371 1462z"></path></svg></div></a></div><div id="header-right-wrapper"><button id="header-show-sidebar-button" class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024"><rect fill="#FCFCFC" x="100" y="148" width="824" height="128" rx="64"></rect><rect fill="#FCFCFC" x="100" y="448" width="824" height="128" rx="64"></rect><rect fill="#FCFCFC" x="100" y="748" width="824" height="128" rx="64"></rect></svg></button><button class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-dark-theme-icon"><path d="M525 939h-4a440 440 0 0 1-314-135 446 446 0 0 1-11-597A432 432 0 0 1 367 90a43 43 0 0 1 45 9 43 43 0 0 1 10 43 358 358 0 0 0 83 376 361 361 0 0 0 377 83 43 43 0 0 1 54 55 433 433 0 0 1-100 155 439 439 0 0 1-311 128z" fill="#FCFCFC"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-light-theme-icon"><path d="M512 61c13 0 25 8 30 20l28 68c11 29-5 62-36 73a66 66 0 0 1-22 3c-34 0-61-25-61-56 0-7 1-14 3-20l28-68c5-12 17-20 30-20zm0 902c-13 0-25-8-30-20l-28-68a53 53 0 0 1-3-20c0-31 27-56 61-56a66 66 0 0 1 22 3c31 11 47 44 36 73l-28 68c-5 12-17 20-30 20zm451-451c0 13-8 25-20 30l-68 28c-29 11-62-5-73-36a66 66 0 0 1-3-22c0-34 25-61 56-61 7 0 14 1 20 3l68 28c12 5 20 17 20 30zm-902 0c0-13 8-25 20-30l68-28a53 53 0 0 1 20-3c31 0 56 27 56 61a66 66 0 0 1-3 22 57 57 0 0 1-73 36l-68-28c-12-5-20-17-20-30zm132-319c10-9 24-12 35-7l68 28c29 13 41 47 26 77a66 66 0 0 1-13 18c-24 24-61 26-83 4a53 53 0 0 1-12-17l-28-68c-5-11-2-25 7-35zm638 638c-10 9-24 12-35 7l-68-28a53 53 0 0 1-17-12c-22-22-20-59 4-83a66 66 0 0 1 18-13c30-15 64-3 77 26l28 68c5 11 2 25-7 35zm0-638c9 10 12 24 7 35l-28 68a56 56 0 0 1-77 26 66 66 0 0 1-18-13c-24-24-26-61-4-83 5-5 11-9 17-12l68-28c11-5 25-2 35 7zM193 831c-9-10-12-24-7-35l28-68a53 53 0 0 1 12-17c22-22 59-20 83 4a66 66 0 0 1 13 18c15 30 3 64-26 77l-68 28c-11 5-25 2-35-7zm319-94a225 225 0 1 1 0-450 225 225 0 0 1 0 450z" fill="#FCFCFC"></path></svg></button><a href="https://github.com/1kuzus/1kuzus.github.io" target="_blank" rel="noreferrer"><div class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 1024 1024"><path d="M411 831c4-5 7-10 7-12v-70c-106 22-128-44-128-44-17-45-43-56-43-56-34-24 4-24 4-24 37 3 58 39 58 39 34 58 89 41 111 32 3-24 13-41 24-51-86-10-174-43-174-188 0-41 15-75 39-102-4-10-17-48 3-101 0 0 33-10 104 40 31-9 64-12 96-12s65 5 96 12c73-50 104-40 104-40 20 53 8 91 3 101 24 27 39 60 39 102 0 145-88 178-174 188 14 12 26 34 26 70v104c0 4 2 7 7 12 5 7 3 19-4 24-3 2-7 3-10 3H425c-10 0-17-6-17-17 0-5 2-8 3-10z" fill="#FCFCFC"></path></svg></div></a></div></div><div id="contents"><h4 id="contents-header">本页目录</h4></div><div id="post-layout"><div id="main" class="center-wrapper"><h1 class="post-title">8086汇编贪吃蛇</h1><div class="post-meta"><code class="not-loaded">null likes<!-- --> · </code><code class="not-loaded">null views<!-- --> · </code><code>2024-09-15</code></div><!--$--><h2 class="x-h1">变量设置</h2><p class="x-p">在数据段中使用以下变量：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>datasg <span class="token keyword">segment</span>
    addri9 <span class="token keyword">db</span> <span class="token number">0,</span><span class="token number">0,</span><span class="token number">0,</span><span class="token number">0 </span>           <span class="token comment">;存放原9号中断的中断向量</span>
    seed   <span class="token keyword">db</span> <span class="token number">0adh </span>              <span class="token comment">;随机数种子</span>
    rand   <span class="token keyword">db</span> <span class="token number">0 </span>                 <span class="token comment">;随机数</span>
    apple  <span class="token keyword">db</span> <span class="token number">44h </span>               <span class="token comment">;果实位置，初始设为44h</span>
    dir    <span class="token keyword">db</span> <span class="token number">0 </span>                 <span class="token comment">;方向，0:up 1:right 2:left 3:down</span>
    dirbuf <span class="token keyword">db</span> <span class="token number">0
</span>    snake  <span class="token keyword">db</span> <span class="token number">4ah,</span><span class="token number">49h,</span><span class="token number">48h,</span><span class="token number">47h </span>   <span class="token comment">;蛇尾 --- 蛇头</span>
           <span class="token keyword">db</span> <span class="token number">256 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
datasg <span class="token keyword">ends</span>
</code></pre></div><h2 class="x-h1">前置技术</h2><p class="x-p">在汇编实现贪吃蛇通常需要解决以下几个技术：</p><h3 class="x-h2">延时函数</h3><p class="x-p">在汇编中延时函数可以通过执行空循环来实现：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token comment">;;;;延迟一段时间</span>
delay:
          <span class="token function">push</span>  <span class="token register variable">cx</span>
          <span class="token function">mov</span>   <span class="token register variable">cx</span>,<span class="token number">7h </span>                           <span class="token comment">;增大此值可以减慢蛇的移动速度（间隔）</span>
d1:       <span class="token function">push</span>  <span class="token register variable">cx</span>
          <span class="token function">mov</span>   <span class="token register variable">cx</span>,<span class="token number">0ffffh
</span>d2:       <span class="token function">loop</span>  <span class="token number">d2
</span>          <span class="token function">pop</span>   <span class="token register variable">cx</span>
          <span class="token function">loop</span>  <span class="token number">d1
</span>          <span class="token function">pop</span>   <span class="token register variable">cx</span>
          <span class="token function">ret</span>
</code></pre></div><p class="x-p">虽然这种方法不能精确控制延迟多少秒/毫秒，但可以通过调节外层循环的次数（内层也可以）来相对地控制延迟时间。（一层循环最大执行次数是<code class="x-inline-highlight">ffffh</code>，仍然太快，因此需要两层循环）</p><h3 class="x-h2">随机数</h3><p class="x-p">使用平方取中法实现一个简单的伪随机序列，随机种子预先写死在代码中：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token comment">;;;;平方取中随机数</span>
<span class="token comment">;输出：</span>
<span class="token comment">;rand     下一个随机数</span>
getrand:
          <span class="token function">push</span>  <span class="token register variable">ax</span>
          <span class="token function">push</span>  <span class="token register variable">cx</span>
          <span class="token function">mov</span>   <span class="token register variable">al</span>,rand
          <span class="token function">mul</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> rand
          <span class="token function">mov</span>   <span class="token register variable">cl</span>,<span class="token number">4
</span>          <span class="token function">shr</span>   <span class="token register variable">ax</span>,<span class="token register variable">cl</span>
          <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">0
</span>          <span class="token function">jnz</span>   ok
          <span class="token function">mov</span>   <span class="token register variable">al</span>,seed                          <span class="token comment">;避免陷入0循环</span>
ok:
          <span class="token function">mov</span>   rand,<span class="token register variable">al</span>
          <span class="token function">pop</span>   <span class="token register variable">cx</span>
          <span class="token function">pop</span>   <span class="token register variable">ax</span>
          <span class="token function">ret</span>
</code></pre></div><p class="x-p">这里生成的是<code class="x-inline-highlight">8</code>位的随机数，每次调用<code class="x-inline-highlight">getrand</code>都会更新<code class="x-inline-highlight">rand</code>标号处的一个字节的值。这个随机数生成方法有时会陷入<code class="x-inline-highlight">0</code>循环，因此产生新的随机数时加了一个判断，如果结果为<code class="x-inline-highlight">0</code>则重新从<code class="x-inline-highlight">seed</code>开始生成。</p><h3 class="x-h2">处理键盘输入</h3><p class="x-p">使用自定义的键盘中断程序（<code class="x-inline-highlight">9</code>号中断）解决，大致框架为：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>codesg <span class="token keyword">segment</span>
    start:
             <span class="token function">mov</span>   <span class="token register variable">ax</span>,datasg
             <span class="token function">mov</span>   <span class="token register variable">ds</span>,<span class="token register variable">ax</span>
    <span class="token comment">;保存原来9号中断的中断向量到addri9处</span>
             <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0
</span>             <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
             <span class="token function">push</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>
             <span class="token function">pop</span>   <span class="token keyword">word</span> <span class="token keyword">ptr</span> addri9<span class="token operator">[</span><span class="token number">0]</span>
             <span class="token function">push</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>
             <span class="token function">pop</span>   <span class="token keyword">word</span> <span class="token keyword">ptr</span> addri9<span class="token operator">[</span><span class="token number">2]</span>
    <span class="token comment">;更改原来的中断向量</span>
             <span class="token function">mov</span>   <span class="token keyword">word</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>,<span class="token keyword">offset</span> int9    <span class="token comment">;设置9号中断的IP为offset int9</span>
             <span class="token function">mov</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>,<span class="token register variable">cs</span>                    <span class="token comment">;设置9号中断的CS为代码段起始地址</span>
             <span class="token comment">;...</span>

    <span class="token comment">;游戏结束返回</span>
    ret_main:
    <span class="token comment">;恢复原来的中断向量</span>
             <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0
</span>             <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
             <span class="token function">push</span>  <span class="token keyword">word</span> <span class="token keyword">ptr</span> addri9<span class="token operator">[</span><span class="token number">0]</span>
             <span class="token function">pop</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>
             <span class="token function">push</span>  <span class="token keyword">word</span> <span class="token keyword">ptr</span> addri9<span class="token operator">[</span><span class="token number">2]</span>
             <span class="token function">pop</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>
             <span class="token comment">;...</span>


    <span class="token comment">;;;;自定义键盘中断</span>
    int9:
             <span class="token function">push</span>  <span class="token register variable">ax</span>
             <span class="token function">push</span>  <span class="token register variable">bx</span>
    <span class="token comment">;模拟标志寄存器入栈</span>
             <span class="token function">pushf</span>
    <span class="token comment">;模拟设置IF=0，TF=0</span>
             <span class="token function">pushf</span>
             <span class="token function">pop</span>   <span class="token register variable">ax</span>
             <span class="token function">and</span>   <span class="token register variable">ah</span>,<span class="token number">11111100b
</span>             <span class="token function">push</span>  <span class="token register variable">ax</span>
             <span class="token function">popf</span>
    <span class="token comment">;call指令即可实现CS、IP入栈并跳转到入口地址</span>
             <span class="token function">call</span>  <span class="token keyword">dword</span> <span class="token keyword">ptr</span> addri9
    <span class="token comment">;自定义的键盘输入处理</span>
             <span class="token function">in</span>    <span class="token register variable">al</span>,<span class="token number">60h </span>                          <span class="token comment">;读取键盘输入送入AL</span>
             <span class="token function">cmp</span>   <span class="token register variable">al</span>,dir
             <span class="token function">je</span>    int9_dft
             <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">11h </span>                          <span class="token comment">;W键</span>
             <span class="token function">je</span>    int9_w
             <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">20h </span>                          <span class="token comment">;D键</span>
             <span class="token function">je</span>    int9_d
             <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">1eh </span>                          <span class="token comment">;A键</span>
             <span class="token function">je</span>    int9_a
             <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">1fh </span>                          <span class="token comment">;S键</span>
             <span class="token function">je</span>    int9_s
             <span class="token function">jmp</span>   int9_dft
    int9_w:
             <span class="token function">mov</span>   dirbuf,<span class="token number">0
</span>             <span class="token function">jmp</span>   int9_dft
    int9_d:
             <span class="token function">mov</span>   dirbuf,<span class="token number">1
</span>             <span class="token function">jmp</span>   int9_dft
    int9_a:
             <span class="token function">mov</span>   dirbuf,<span class="token number">2
</span>             <span class="token function">jmp</span>   int9_dft
    int9_s:
             <span class="token function">mov</span>   dirbuf,<span class="token number">3
</span>             <span class="token function">jmp</span>   int9_dft
    int9_dft:
             <span class="token function">pop</span>   <span class="token register variable">bx</span>
             <span class="token function">pop</span>   <span class="token register variable">ax</span>
             iret
codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><p class="x-p">在设计键盘响应时，不希望玩家能够直接修改蛇的移动方向为当前方向的反向（不能调转<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6741em;"></span><span class="mord">18</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6741em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span></span></span></span>），例如如果当前移动方向为向上，则应只允许修改为向左/向右，而不能修改为向下。为此额外添加了<code class="x-inline-highlight">dirbuf</code>变量，用户的键盘输入会实时存入<code class="x-inline-highlight">dirbuf</code>，但只在每次主循环中有条件地与<code class="x-inline-highlight">dir</code>同步。主循环如下（其中<code class="x-inline-highlight">move</code>函数处理蛇移动一步，后面会详细说明）：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>main_loop:
          <span class="token function">call</span>  delay
          <span class="token function">mov</span>   <span class="token register variable">al</span>,dirbuf
          <span class="token function">xor</span>   <span class="token register variable">al</span>,dir
          <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">3
</span>          <span class="token function">je</span>    keep_dir
          <span class="token function">xor</span>   <span class="token register variable">al</span>,dir
          <span class="token function">mov</span>   dir,<span class="token register variable">al</span>
keep_dir:
          <span class="token function">call</span>  move
          <span class="token function">jmp</span>   main_loop
</code></pre></div><p class="x-p">代码中<code class="x-inline-highlight">dir</code>与<code class="x-inline-highlight">dirbuf</code>异或为<code class="x-inline-highlight">3</code>时，表示方向刚好相差<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6741em;"></span><span class="mord">18</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6741em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span></span></span></span>，此时不改变<code class="x-inline-highlight">dir</code>的值（<code class="x-inline-highlight">je keep_dir</code>）；由于异或操作改变了<code class="x-inline-highlight">AL</code>的值，因此送入<code class="x-inline-highlight">dir</code>前需要再异或一次原来的<code class="x-inline-highlight">dir</code>值。</p><h3 class="x-h2">坐标设计与操作显存绘制</h3><p class="x-p">通过操作显存绘制图形，显存中用<code class="x-inline-highlight">2</code>个字节表示一个字符，低字节表示字符的ASCII码，高字节表示字符的颜色。这里不设置字符，只设置背景色，相邻的两列刚好凑成一个正方形。</p><p class="x-p">游戏的地图大小设计为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">16</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">16</span></span></span></span>（含边界），这样刚好可以用<code class="x-inline-highlight">4</code>位表示一个坐标分量，一个字节表示一个二维坐标。约定一个字节的高<code class="x-inline-highlight">4</code>位表示<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>坐标，低<code class="x-inline-highlight">4</code>位表示<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>坐标。例如<code class="x-inline-highlight">4ah</code>表示逻辑坐标<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">10</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">4</span><span class="mclose">)</span></span></span></span>，对应<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">16</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">16</span></span></span></span>地图中的第<code class="x-inline-highlight">10</code>行、第<code class="x-inline-highlight">4</code>列的方格。</p><p class="x-p">由于字符显示区是<code class="x-inline-highlight">25</code>行、<code class="x-inline-highlight">80</code>列，这里的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>坐标对应了<code class="x-inline-highlight">行号-5</code>（为了让地图显示在屏幕中间），<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>坐标对应了<code class="x-inline-highlight">列号/2</code>（因为每个字符占<code class="x-inline-highlight">2</code>列）。封装一个<code class="x-inline-highlight">write</code>函数，用于将属性写入显存的指定位置：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token comment">;;;;在显存[x+5行，2*y列]和[x+5行，2*y+1列]处写入属性BH（等价于逻辑坐标x,y）</span>
write:
<span class="token comment">;输入：</span>
<span class="token comment">;BH       属性</span>
<span class="token comment">;BL[7:4]  y坐标（逻辑列号）</span>
<span class="token comment">;BL[3:0]  x坐标（逻辑行号）</span>
          <span class="token function">push</span>  <span class="token register variable">cx</span>
          <span class="token function">mov</span>   <span class="token register variable">di</span>,<span class="token register variable">bx</span>
          <span class="token function">and</span>   <span class="token register variable">di</span>,<span class="token number">00f0h </span>                        <span class="token comment">;(di)=逻辑列号*16</span>
          <span class="token function">mov</span>   <span class="token register variable">cl</span>,<span class="token number">2
</span>          <span class="token function">shr</span>   <span class="token register variable">di</span>,<span class="token register variable">cl</span>                            <span class="token comment">;逻辑右移2位，(di)=逻辑列号*4</span>
          <span class="token function">mov</span>   <span class="token register variable">cl</span>,<span class="token register variable">bl</span>
          <span class="token function">and</span>   <span class="token register variable">cl</span>,<span class="token number">0fh </span>                          <span class="token comment">;(cl)=逻辑行号</span>
          <span class="token function">mov</span>   <span class="token register variable">al</span>,<span class="token number">10
</span>          <span class="token function">mul</span>   <span class="token register variable">cl</span>                               <span class="token comment">;(ax)=逻辑行号*10</span>
          <span class="token function">add</span>   <span class="token register variable">ax</span>,<span class="token number">0b800h+</span><span class="token number">50 </span>                    <span class="token comment">;(ax)=逻辑行号*10+b800h+50</span>
          <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>                            <span class="token comment">;(es)=逻辑行号*10+b800h+50</span>
          <span class="token function">mov</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token register variable">di</span><span class="token operator">+</span><span class="token number">1]</span>,<span class="token register variable">bh</span>
          <span class="token function">mov</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token register variable">di</span><span class="token operator">+</span><span class="token number">3]</span>,<span class="token register variable">bh</span>
          <span class="token function">pop</span>   <span class="token register variable">cx</span>
          <span class="token function">ret</span>
</code></pre></div><p class="x-p">显存的起始地址是<code class="x-inline-highlight">b8000h</code>，屏幕第<code class="x-inline-highlight">i</code>行、第<code class="x-inline-highlight">j</code>列的偏移地址是<code class="x-inline-highlight">80&#42;2&#42;i+2&#42;j</code>，用<code class="x-inline-highlight">段地址:偏移地址</code>表示为<code class="x-inline-highlight">b800:80&#42;2&#42;i+2&#42;j</code>；我们希望从第<code class="x-inline-highlight">5</code>行开始显示地图，因此偏移地址额外加上<code class="x-inline-highlight">80&#42;2&#42;5</code>，如果加到段地址上还要除以<code class="x-inline-highlight">16</code>，也就是<code class="x-inline-highlight">80&#42;2&#42;5/16=50</code>，对应代码中<code class="x-inline-highlight">0b800h+50</code>。</p><p class="x-p">同理，逻辑行号在偏移地址中数值要乘<code class="x-inline-highlight">80*2=160</code>，而表示在段地址中只需乘<code class="x-inline-highlight">160/16=10</code>。</p><h2 class="x-h1">实现</h2><h3 class="x-h2">代码</h3><p class="x-p">完整的代码如下：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">ASM8086</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">assume</span> <span class="token register variable">cs</span>:codesg,<span class="token register variable">ds</span>:datasg,<span class="token register variable">ss</span>:stcksg

datasg <span class="token keyword">segment</span>
    addri9 <span class="token keyword">db</span> <span class="token number">0,</span><span class="token number">0,</span><span class="token number">0,</span><span class="token number">0 </span>           <span class="token comment">;存放原9号中断的中断向量</span>
    seed   <span class="token keyword">db</span> <span class="token number">0adh </span>              <span class="token comment">;随机数种子</span>
    rand   <span class="token keyword">db</span> <span class="token number">0 </span>                 <span class="token comment">;随机数</span>
    apple  <span class="token keyword">db</span> <span class="token number">44h </span>               <span class="token comment">;果实位置，初始设为44h</span>
    dir    <span class="token keyword">db</span> <span class="token number">0 </span>                 <span class="token comment">;方向，0:up 1:right 2:left 3:down</span>
    dirbuf <span class="token keyword">db</span> <span class="token number">0
</span>    snake  <span class="token keyword">db</span> <span class="token number">4ah,</span><span class="token number">49h,</span><span class="token number">48h,</span><span class="token number">47h </span>   <span class="token comment">;蛇尾 --- 蛇头</span>
           <span class="token keyword">db</span> <span class="token number">256 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
datasg <span class="token keyword">ends</span>

stcksg <span class="token keyword">segment</span>
           <span class="token keyword">db</span> <span class="token number">128 </span><span class="token keyword">dup</span>(<span class="token number">0)</span>
stcksg <span class="token keyword">ends</span>

codesg <span class="token keyword">segment</span>
    start:
              <span class="token function">mov</span>   <span class="token register variable">ax</span>,datasg
              <span class="token function">mov</span>   <span class="token register variable">ds</span>,<span class="token register variable">ax</span>
    <span class="token comment">;保存原来9号中断的中断向量到addri9处</span>
              <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0
</span>              <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
              <span class="token function">push</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>
              <span class="token function">pop</span>   <span class="token keyword">word</span> <span class="token keyword">ptr</span> addri9<span class="token operator">[</span><span class="token number">0]</span>
              <span class="token function">push</span>  <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>
              <span class="token function">pop</span>   <span class="token keyword">word</span> <span class="token keyword">ptr</span> addri9<span class="token operator">[</span><span class="token number">2]</span>
    <span class="token comment">;更改原来的中断向量</span>
              <span class="token function">mov</span>   <span class="token keyword">word</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>,<span class="token keyword">offset</span> int9    <span class="token comment">;设置9号中断的IP为offset int9</span>
              <span class="token function">mov</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>,<span class="token register variable">cs</span>                    <span class="token comment">;设置9号中断的CS为代码段起始地址</span>
    <span class="token comment">;初始化</span>
              <span class="token function">call</span>  init
    <span class="token comment">;主循环</span>
    main_loop:
              <span class="token function">call</span>  delay
              <span class="token function">mov</span>   <span class="token register variable">al</span>,dirbuf
              <span class="token function">xor</span>   <span class="token register variable">al</span>,dir
              <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">3
</span>              <span class="token function">je</span>    keep_dir
              <span class="token function">xor</span>   <span class="token register variable">al</span>,dir
              <span class="token function">mov</span>   dir,<span class="token register variable">al</span>
    keep_dir:
              <span class="token function">call</span>  move
              <span class="token function">jmp</span>   main_loop
    <span class="token comment">;游戏结束返回</span>
    gameover:
    <span class="token comment">;恢复原来的中断向量</span>
              <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0
</span>              <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
              <span class="token function">push</span>  <span class="token keyword">word</span> <span class="token keyword">ptr</span> addri9<span class="token operator">[</span><span class="token number">0]</span>
              <span class="token function">pop</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4]</span>
              <span class="token function">push</span>  <span class="token keyword">word</span> <span class="token keyword">ptr</span> addri9<span class="token operator">[</span><span class="token number">2]</span>
              <span class="token function">pop</span>   <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token number">9*</span><span class="token number">4+</span><span class="token number">2]</span>
    <span class="token comment">;清空键盘缓冲区</span>
    clear:
              <span class="token function">mov</span>   <span class="token register variable">ah</span>, <span class="token number">01h
</span>              <span class="token function">int</span>   <span class="token number">16h
</span>              <span class="token function">je</span>    done
              <span class="token function">mov</span>   <span class="token register variable">ah</span>, <span class="token number">00h
</span>              <span class="token function">int</span>   <span class="token number">16h
</span>              <span class="token function">jmp</span>   clear
    done:
              <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">4c00h
</span>              <span class="token function">int</span>   <span class="token number">21h
</span>
    <span class="token comment">;;;;延迟一段时间</span>
    delay:
              <span class="token function">push</span>  <span class="token register variable">cx</span>
              <span class="token function">mov</span>   <span class="token register variable">cx</span>,<span class="token number">7h </span>                           <span class="token comment">;增大此值可以减慢蛇的移动速度（间隔）</span>
    d1:       <span class="token function">push</span>  <span class="token register variable">cx</span>
              <span class="token function">mov</span>   <span class="token register variable">cx</span>,<span class="token number">0ffffh
</span>    d2:       <span class="token function">loop</span>  <span class="token number">d2
</span>              <span class="token function">pop</span>   <span class="token register variable">cx</span>
              <span class="token function">loop</span>  <span class="token number">d1
</span>              <span class="token function">pop</span>   <span class="token register variable">cx</span>
              <span class="token function">ret</span>

    <span class="token comment">;;;;平方取中随机数</span>
    <span class="token comment">;输出：</span>
    <span class="token comment">;rand     下一个随机数</span>
    getrand:
              <span class="token function">push</span>  <span class="token register variable">ax</span>
              <span class="token function">push</span>  <span class="token register variable">cx</span>
              <span class="token function">mov</span>   <span class="token register variable">al</span>,rand
              <span class="token function">mul</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> rand
              <span class="token function">mov</span>   <span class="token register variable">cl</span>,<span class="token number">4
</span>              <span class="token function">shr</span>   <span class="token register variable">ax</span>,<span class="token register variable">cl</span>
              <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">0
</span>              <span class="token function">jnz</span>   ok
              <span class="token function">mov</span>   <span class="token register variable">al</span>,seed                          <span class="token comment">;避免陷入0循环</span>
    ok:
              <span class="token function">mov</span>   rand,<span class="token register variable">al</span>
              <span class="token function">pop</span>   <span class="token register variable">cx</span>
              <span class="token function">pop</span>   <span class="token register variable">ax</span>
              <span class="token function">ret</span>

    <span class="token comment">;;;;在显存[x+5行，2*y列]和[x+5行，2*y+1列]处写入属性BH（等价于逻辑坐标x,y）</span>
    write:
    <span class="token comment">;输入：</span>
    <span class="token comment">;BH       属性</span>
    <span class="token comment">;BL[7:4]  y坐标（逻辑列号）</span>
    <span class="token comment">;BL[3:0]  x坐标（逻辑行号）</span>
              <span class="token function">push</span>  <span class="token register variable">cx</span>
              <span class="token function">mov</span>   <span class="token register variable">di</span>,<span class="token register variable">bx</span>
              <span class="token function">and</span>   <span class="token register variable">di</span>,<span class="token number">00f0h </span>                        <span class="token comment">;(di)=逻辑列号*16</span>
              <span class="token function">mov</span>   <span class="token register variable">cl</span>,<span class="token number">2
</span>              <span class="token function">shr</span>   <span class="token register variable">di</span>,<span class="token register variable">cl</span>                            <span class="token comment">;逻辑右移2位，(di)=逻辑列号*4</span>
              <span class="token function">mov</span>   <span class="token register variable">cl</span>,<span class="token register variable">bl</span>
              <span class="token function">and</span>   <span class="token register variable">cl</span>,<span class="token number">0fh </span>                          <span class="token comment">;(cl)=逻辑行号</span>
              <span class="token function">mov</span>   <span class="token register variable">al</span>,<span class="token number">10
</span>              <span class="token function">mul</span>   <span class="token register variable">cl</span>                               <span class="token comment">;(ax)=逻辑行号*10</span>
              <span class="token function">add</span>   <span class="token register variable">ax</span>,<span class="token number">0b800h+</span><span class="token number">50 </span>                    <span class="token comment">;(ax)=逻辑行号*10+b800h+50</span>
              <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>                            <span class="token comment">;(es)=逻辑行号*10+b800h+50</span>
              <span class="token function">mov</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token register variable">di</span><span class="token operator">+</span><span class="token number">1]</span>,<span class="token register variable">bh</span>
              <span class="token function">mov</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token register variable">di</span><span class="token operator">+</span><span class="token number">3]</span>,<span class="token register variable">bh</span>
              <span class="token function">pop</span>   <span class="token register variable">cx</span>
              <span class="token function">ret</span>

    <span class="token comment">;;;;初始化地图</span>
    init:
    <span class="token comment">;清屏</span>
              <span class="token function">mov</span>   <span class="token register variable">ax</span>,<span class="token number">0b800h+</span><span class="token number">50
</span>              <span class="token function">mov</span>   <span class="token register variable">es</span>,<span class="token register variable">ax</span>
              <span class="token function">mov</span>   <span class="token register variable">cx</span>,<span class="token number">7fffh
</span>              <span class="token function">mov</span>   <span class="token register variable">di</span>,<span class="token number">0
</span>    i1:       <span class="token function">mov</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> <span class="token register variable">es</span>:<span class="token operator">[</span><span class="token register variable">di</span><span class="token operator">]</span>,<span class="token number">0
</span>              <span class="token function">inc</span>   <span class="token register variable">di</span>
              <span class="token function">loop</span>  i1
    <span class="token comment">;绘制果实和蛇</span>
              <span class="token function">call</span>  getrand
              <span class="token function">mov</span>   <span class="token register variable">bh</span>,<span class="token number">40h </span>                          <span class="token comment">;红底（果实）</span>
              <span class="token function">mov</span>   <span class="token register variable">bl</span>,apple
              <span class="token function">call</span>  write
              <span class="token function">mov</span>   <span class="token register variable">si</span>,<span class="token number">0
</span>              <span class="token function">mov</span>   <span class="token register variable">bh</span>,<span class="token number">20h </span>                          <span class="token comment">;绿底（蛇）</span>
    i2:       <span class="token function">mov</span>   <span class="token register variable">bl</span>,snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>
              <span class="token function">call</span>  write
              <span class="token function">inc</span>   <span class="token register variable">si</span>
              <span class="token function">cmp</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token number">0
</span>              <span class="token function">jnz</span>   i2
    <span class="token comment">;绘制边界</span>
              <span class="token function">mov</span>   <span class="token register variable">bh</span>,<span class="token number">70h </span>                          <span class="token comment">;白底（边界）</span>
              <span class="token function">mov</span>   <span class="token register variable">cx</span>,<span class="token number">15 </span>                           <span class="token comment">;16*16地图（包含边界）</span>
    i3:       <span class="token function">mov</span>   <span class="token register variable">bl</span>,<span class="token register variable">cl</span>                            <span class="token comment">;x=i，y=0</span>
              <span class="token function">call</span>  write
              <span class="token function">or</span>    <span class="token register variable">bl</span>,<span class="token number">0f0h </span>                         <span class="token comment">;x=i，y=15</span>
              <span class="token function">call</span>  write
              <span class="token function">mov</span>   <span class="token register variable">bl</span>,<span class="token register variable">cl</span>
              <span class="token function">push</span>  <span class="token register variable">cx</span>
              <span class="token function">mov</span>   <span class="token register variable">cx</span>,<span class="token number">4
</span>              <span class="token function">shl</span>   <span class="token register variable">bl</span>,<span class="token register variable">cl</span>                            <span class="token comment">;赋值y=i</span>
              <span class="token function">pop</span>   <span class="token register variable">cx</span>
              <span class="token function">or</span>    <span class="token register variable">bl</span>,<span class="token number">0fh </span>                          <span class="token comment">;x=15，y=i</span>
              <span class="token function">call</span>  write
              <span class="token function">and</span>   <span class="token register variable">bl</span>,<span class="token number">0f0h </span>                         <span class="token comment">;x=0，y=i</span>
              <span class="token function">call</span>  write
              <span class="token function">jcxz</span>  ret_init
              <span class="token function">sub</span>   <span class="token register variable">cx</span>,<span class="token number">1
</span>              <span class="token function">jmp</span>   i3
    ret_init:
              <span class="token function">ret</span>

    <span class="token comment">;;;;移动一步</span>
    move:
    <span class="token comment">;si移动到头部下一个位置</span>
              <span class="token function">mov</span>   <span class="token register variable">si</span>,<span class="token number">0
</span>    m2:       <span class="token function">inc</span>   <span class="token register variable">si</span>
              <span class="token function">cmp</span>   snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token number">0
</span>              <span class="token function">jnz</span>   m2
    <span class="token comment">;复制原头部数据</span>
              <span class="token function">mov</span>   <span class="token register variable">al</span>,snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">-</span><span class="token number">1]</span>
              <span class="token function">mov</span>   snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token register variable">al</span>
    <span class="token comment">;根据方向移动蛇头</span>
              <span class="token function">cmp</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> dir,<span class="token number">0
</span>              <span class="token function">je</span>    move_u
              <span class="token function">cmp</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> dir,<span class="token number">1
</span>              <span class="token function">je</span>    move_r
              <span class="token function">cmp</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> dir,<span class="token number">2
</span>              <span class="token function">je</span>    move_l
              <span class="token function">cmp</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> dir,<span class="token number">3
</span>              <span class="token function">je</span>    move_d
              <span class="token function">jmp</span>   move_dft
    move_u:
              <span class="token function">sub</span>   snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token number">1
</span>              <span class="token function">jmp</span>   move_dft
    move_r:
              <span class="token function">add</span>   snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token number">10h
</span>              <span class="token function">jmp</span>   move_dft
    move_l:
              <span class="token function">sub</span>   snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token number">10h
</span>              <span class="token function">jmp</span>   move_dft
    move_d:
              <span class="token function">add</span>   snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token number">1
</span>              <span class="token function">jmp</span>   move_dft
    move_dft:
    <span class="token comment">;擦除尾部</span>
              <span class="token function">mov</span>   <span class="token register variable">bh</span>,<span class="token number">0
</span>              <span class="token function">mov</span>   <span class="token register variable">bl</span>,snake<span class="token operator">[</span><span class="token number">0]</span>
              <span class="token function">call</span>  write
    <span class="token comment">;绘制新头部</span>
              <span class="token function">mov</span>   <span class="token register variable">bh</span>,<span class="token number">20h
</span>              <span class="token function">mov</span>   <span class="token register variable">bl</span>,snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>
              <span class="token function">call</span>  write
    <span class="token comment">;判定蛇头吃到果实或撞墙</span>
              <span class="token function">cmp</span>   <span class="token register variable">bl</span>,apple
              <span class="token function">je</span>    eat
              <span class="token function">call</span>  is_valid
              <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">0
</span>              <span class="token function">je</span>    gameover
    <span class="token comment">;移动蛇身</span>
              <span class="token function">mov</span>   <span class="token register variable">si</span>,<span class="token number">0
</span>    m1:       <span class="token function">mov</span>   <span class="token register variable">al</span>,snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">+</span><span class="token number">1]</span>
              <span class="token function">mov</span>   snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token register variable">al</span>
              <span class="token function">inc</span>   <span class="token register variable">si</span>
              <span class="token function">cmp</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">+</span><span class="token number">1]</span>,<span class="token number">0
</span>              <span class="token function">jnz</span>   m1
    <span class="token comment">;擦除复制的新头部</span>
              <span class="token function">mov</span>   snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token number">0
</span>              <span class="token function">jmp</span>   ret_move
    <span class="token comment">;吃到果实</span>
    eat:
              <span class="token function">mov</span>   <span class="token register variable">al</span>,apple
              <span class="token function">mov</span>   snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>,<span class="token register variable">al</span>
    m3:       <span class="token function">call</span>  getrand
              <span class="token function">mov</span>   <span class="token register variable">bl</span>,rand
              <span class="token function">call</span>  is_valid
              <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">1
</span>              jne   m3                               <span class="token comment">;如果生成的位置已经有蛇身，则重新生成</span>
              <span class="token function">mov</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> apple,<span class="token register variable">bl</span>
              <span class="token function">mov</span>   <span class="token register variable">bh</span>,<span class="token number">40h
</span>              <span class="token function">mov</span>   <span class="token register variable">bl</span>,apple
              <span class="token function">call</span>  write
              <span class="token function">ret</span>

    <span class="token comment">;;;;判断合法位置：边界、蛇身处判定为不合法（不判断蛇头）</span>
    is_valid:
    <span class="token comment">;输入：</span>
    <span class="token comment">;BL     坐标</span>
    <span class="token comment">;输出：</span>
    <span class="token comment">;AL     0(不合法)/1(合法)</span>
              <span class="token function">push</span>  <span class="token register variable">bx</span>
              <span class="token function">mov</span>   <span class="token register variable">al</span>,<span class="token number">0
</span>              <span class="token function">cmp</span>   <span class="token register variable">bl</span>,<span class="token number">0fh </span>                          <span class="token comment">;x=i，y=0</span>
              <span class="token function">jb</span>    false
              <span class="token function">cmp</span>   <span class="token register variable">bl</span>,<span class="token number">0f0h </span>                         <span class="token comment">;x=i，y=15</span>
              <span class="token function">ja</span>    false
              <span class="token function">mov</span>   <span class="token register variable">bh</span>,<span class="token register variable">bl</span>
              <span class="token function">and</span>   <span class="token register variable">bh</span>,<span class="token number">0fh
</span>              <span class="token function">cmp</span>   <span class="token register variable">bh</span>,<span class="token number">0fh </span>                          <span class="token comment">;x=15，y=i</span>
              <span class="token function">je</span>    false
              <span class="token function">cmp</span>   <span class="token register variable">bh</span>,<span class="token number">0 </span>                            <span class="token comment">;x=0，y=i</span>
              <span class="token function">je</span>    false

              <span class="token function">mov</span>   <span class="token register variable">si</span>,<span class="token number">0
</span>    v1:       <span class="token function">cmp</span>   <span class="token register variable">bl</span>,snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">]</span>
              <span class="token function">je</span>    false
              <span class="token function">inc</span>   <span class="token register variable">si</span>
              <span class="token function">cmp</span>   <span class="token keyword">byte</span> <span class="token keyword">ptr</span> snake<span class="token operator">[</span><span class="token register variable">si</span><span class="token operator">+</span><span class="token number">1]</span>,<span class="token number">0
</span>              <span class="token function">jnz</span>   v1

              <span class="token function">mov</span>   <span class="token register variable">al</span>,<span class="token number">1
</span>    false:
              <span class="token function">pop</span>   <span class="token register variable">bx</span>
              <span class="token function">ret</span>

    <span class="token comment">;;;;自定义键盘中断</span>
    int9:
              <span class="token function">push</span>  <span class="token register variable">ax</span>
              <span class="token function">push</span>  <span class="token register variable">bx</span>
    <span class="token comment">;模拟标志寄存器入栈</span>
              <span class="token function">pushf</span>
    <span class="token comment">;模拟设置IF=0，TF=0</span>
              <span class="token function">pushf</span>
              <span class="token function">pop</span>   <span class="token register variable">ax</span>
              <span class="token function">and</span>   <span class="token register variable">ah</span>,<span class="token number">11111100b
</span>              <span class="token function">push</span>  <span class="token register variable">ax</span>
              <span class="token function">popf</span>
    <span class="token comment">;call指令即可实现CS、IP入栈并跳转到入口地址</span>
              <span class="token function">call</span>  <span class="token keyword">dword</span> <span class="token keyword">ptr</span> addri9
    <span class="token comment">;自定义的键盘输入处理</span>
              <span class="token function">in</span>    <span class="token register variable">al</span>,<span class="token number">60h </span>                          <span class="token comment">;读取键盘输入送入AL</span>
              <span class="token function">cmp</span>   <span class="token register variable">al</span>,dir
              <span class="token function">je</span>    int9_dft
              <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">11h </span>                          <span class="token comment">;W键</span>
              <span class="token function">je</span>    int9_w
              <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">20h </span>                          <span class="token comment">;D键</span>
              <span class="token function">je</span>    int9_d
              <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">1eh </span>                          <span class="token comment">;A键</span>
              <span class="token function">je</span>    int9_a
              <span class="token function">cmp</span>   <span class="token register variable">al</span>,<span class="token number">1fh </span>                          <span class="token comment">;S键</span>
              <span class="token function">je</span>    int9_s
              <span class="token function">jmp</span>   int9_dft
    int9_w:
              <span class="token function">mov</span>   dirbuf,<span class="token number">0
</span>              <span class="token function">jmp</span>   int9_dft
    int9_d:
              <span class="token function">mov</span>   dirbuf,<span class="token number">1
</span>              <span class="token function">jmp</span>   int9_dft
    int9_a:
              <span class="token function">mov</span>   dirbuf,<span class="token number">2
</span>              <span class="token function">jmp</span>   int9_dft
    int9_s:
              <span class="token function">mov</span>   dirbuf,<span class="token number">3
</span>              <span class="token function">jmp</span>   int9_dft
    int9_dft:
              <span class="token function">pop</span>   <span class="token register variable">bx</span>
              <span class="token function">pop</span>   <span class="token register variable">ax</span>
              iret
codesg <span class="token keyword">ends</span>
<span class="token keyword">end</span> start
</code></pre></div><h3 class="x-h2">演示</h3><img alt="img" loading="lazy" width="574" height="574" decoding="async" data-nimg="1" class="x-image" style="color:transparent;height:auto" src="/_next/static/media/game.21171fe4.gif"/><!--/$--><button class="like-button not-loaded"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 1024 896"><path d="M512 911l-62-56C230 655 85 524 85 363 85 231 189 128 320 128c74 0 145 35 192 89 47-55 118-89 192-89 131 0 235 103 235 235 0 161-145 293-365 492l-62 56z" fill="#FCFCFC"></path></svg></button></div></div><div id="sidebar"><div id="sidebar-width-wrapper"><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">网络杂识<!-- --> (<!-- -->8<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23d/database-3nf/"><span>数据库设计三大范式</span></a></li><li><a class="link" href="/23d/github-linguist-vendored/"><span>不统计Github仓库某个目录下的语言</span></a></li><li><a class="link" href="/24a/deepl-shortcut-setting/"><span>解决：DeepL该快捷键已被使用</span></a></li><li><a class="link" href="/24a/git-merge-allow-unrelated-histories/"><span>记录：使用--allow-unrelated-histories</span></a></li><li><a class="link" href="/24b/injective-surjective-bijective/"><span>单射、满射、双射</span></a></li><li><a class="link" href="/25a/tai-e-a2-additional-case/"><span>南京大学程序分析Lab2（常量传播）易错样例补充</span></a></li><li><a class="link" href="/25a/tai-e-a3-solution/"><span>南京大学程序分析Lab3（死代码消除）思路</span></a></li><li><a class="link" href="/25b/debug-x86_64-program-in-arm64-system/"><span>使用QEMU在ARM64系统上调试x86_64程序</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">安全学习<!-- --> (<!-- -->15<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/wp-portswigger/"><span>PortSwigger Writeup</span></a></li><li><a class="link" href="/23d/hust-cas-login/"><span>Python登录华科统一身份认证接口</span></a></li><li><a class="link" href="/24b/learn-cwes/"><span>Learn CWEs &amp; Real-word Examples</span></a></li><li><a class="link" href="/24b/cross-site-scripting/"><span>Learn XSS</span></a></li><li><a class="link" href="/24b/cross-site-request-forgery/"><span>Learn CSRF</span></a></li><li><a class="link" href="/24d/wp-bluehens-2024/"><span>BlueHens CTF 2024 Writeup</span></a></li><li><a class="link" href="/24d/wp-1337uplive-2024/"><span>1337UP LIVE CTF 2024 Writeup</span></a></li><li><a class="link" href="/24d/wp-m0lecon-2025/"><span>m0leCon Beginner CTF 2025 Writeup</span></a></li><li><a class="link" href="/24d/wp-0xl4ugh-2024/"><span>0xl4ugh CTF 2024 Writeup</span></a></li><li><a class="link" href="/25a/wp-nullcon-hackim-2025/"><span>Nullcon HackIM CTF 2025 Writeup</span></a></li><li><a class="link" href="/25a/wp-picoctf-2025/"><span>picoCTF 2025 Writeup</span></a></li><li><a class="link" href="/25a/wp-cyber-apocalypse-ctf-2025/"><span>HTB Cyber Apocalypse CTF 2025 Writeup</span></a></li><li><a class="link" href="/25a/wp-swampctf-2025/"><span>SwampCTF 2025 Writeup</span></a></li><li><a class="link" href="/25b/wp-1753ctf-2025/"><span>1753CTF 2025 Writeup</span></a></li><li><a class="link" href="/25b/wp-nahamcon-ctf-2025/"><span>NahamCon CTF 2025 Writeup</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">安全研究<!-- --> (<!-- -->9<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/papers-sec/"><span>论文速记：安全</span></a></li><li><a class="link" href="/24b/papers-sec-240514-taintmini/"><span>论文阅读：TAINTMINI: Detecting Flow of Sensitive Data in Mini-Programs with Static Taint Analysis (ICSE 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240728-2fa-consistency/"><span>论文阅读：A Systematic Study of the Consistency of Two-Factor Authentication User Journeys on Top-Ranked Websites (NDSS 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240810-conquer/"><span>论文阅读：Do Not Give A Dog Bread Every Time He Wags His Tail: Stealing Passwords through Content Queries (CONQUER) Attack (NDSS 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240817-2fa-failures/"><span>论文阅读：Security and Privacy Failures in Popular 2FA Apps (Security 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240824-zxcvbn/"><span>论文阅读：zxcvbn: Low-Budget Password Strength Estimation (Security 2016)</span></a></li><li><a class="link" href="/24c/papers-sec-240902-pafa-authentication/"><span>论文阅读：Maginot Line: Assessing a New Cross-app Threat to PII-as-Factor Authentication in Chinese Mobile Apps (NDSS 2024)</span></a></li><li><a class="link" href="/24c/papers-sec-240922-pre-hijacked-accounts/"><span>论文阅读：Pre-hijacked accounts: An Empirical Study of Security Failures in User Account Creation on the Web (Security 2022)</span></a></li><li><a class="link" href="/24d/papers-sec-241207-aimie/"><span>论文阅读：Understanding and Detecting Abused Image Hosting Modules as Malicious Services (CCS 2023)</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">算法<!-- --> (<!-- -->26<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/sorting-algorithm/"><span>排序算法总结与代码实现</span></a></li><li><a class="link" href="/24b/mst-and-sp/"><span>最小生成树与最短路算法</span></a></li><li><a class="link" href="/24a/csp-2016-04/"><span>CSP 201604 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2018-03/"><span>CSP 201803 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-06/"><span>CSP 202006 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-09/"><span>CSP 202009 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-12/"><span>CSP 202012 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2022-06/"><span>CSP 202206 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2023-05/"><span>CSP 202305 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2023-09/"><span>CSP 202309 T1-T4题解</span></a></li><li><a class="link" href="/24b/leetcode-4/"><span>LeetCode 4.寻找两个正序数组的中位数</span></a></li><li><a class="link" href="/24b/leetcode-30/"><span>LeetCode 30.串联所有单词的子串</span></a></li><li><a class="link" href="/24b/leetcode-37/"><span>LeetCode 37.解数独</span></a></li><li><a class="link" href="/24c/leetcode-42/"><span>LeetCode 42.接雨水</span></a></li><li><a class="link" href="/24c/leetcode-51/"><span>LeetCode 51.N皇后</span></a></li><li><a class="link" href="/24c/leetcode-52/"><span>LeetCode 52.N皇后 II</span></a></li><li><a class="link" href="/24b/leetcode-60/"><span>LeetCode 60.排列序列</span></a></li><li><a class="link" href="/24b/leetcode-65/"><span>LeetCode 65.有效数字</span></a></li><li><a class="link" href="/24c/leetcode-68/"><span>LeetCode 68.文本左右对齐</span></a></li><li><a class="link" href="/24b/leetcode-84/"><span>LeetCode 84.柱状图中最大的矩形</span></a></li><li><a class="link" href="/24c/leetcode-85/"><span>LeetCode 85.最大矩形</span></a></li><li><a class="link" href="/24c/leetcode-149/"><span>LeetCode 149.直线上最多的点数</span></a></li><li><a class="link" href="/24d/leetcode-282/"><span>LeetCode 282.给表达式添加运算符</span></a></li><li><a class="link" href="/24b/leetcode-312/"><span>LeetCode 312.戳气球</span></a></li><li><a class="link" href="/24b/leetcode-1373/"><span>LeetCode 1373.二叉搜索子树的最大键值和</span></a></li><li><a class="link" href="/24b/leetcode-1739/"><span>LeetCode 1739.放置盒子</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">深度学习<!-- --> (<!-- -->8<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/papers-dl/"><span>论文速记：深度学习</span></a></li><li><a class="link" href="/23d/r2plus1d/"><span>行为识别R(2+1)D网络</span></a></li><li><a class="link" href="/23d/object-detection-map/"><span>目标检测评价指标mAP</span></a></li><li><a class="link" href="/23d/learn-rnn-lstm/"><span>学习RNN和LSTM</span></a></li><li><a class="link" href="/24a/reproduce-nerf-rpn/"><span>记录：复现NeRF-RPN代码</span></a></li><li><a class="link" href="/24b/yolov5-obb-nms-rotated/"><span>解决：nms_rotated报错&quot;THC/THC.h&quot;: No such file or directory</span></a></li><li><a class="link" href="/24c/winograd/"><span>Winograd算法</span></a></li><li><a class="link" href="/24c/model-optimization/"><span>模型优化概述：量化、压缩、轻量化</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">编程语言<!-- --> (<!-- -->5<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23c/js-array/"><span>JavaScript数组常用方法</span></a></li><li><a class="link" href="/24a/cpp-stl/"><span>C++中STL的基本使用</span></a></li><li><a class="link" href="/24a/torch-numpy-topk/"><span>在pytorch和numpy中取top-k值和索引</span></a></li><li><a class="link" href="/24a/object-oriented-programming-python/"><span>Python面向对象编程</span></a></li><li><a class="link active" href="/24c/asm8086-snake/"><span>8086汇编贪吃蛇</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">前端<!-- --> (<!-- -->2<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23d/css-auto-height-transition/"><span>CSS实现auto高度的过渡动画</span></a></li><li><a class="link" href="/24d/android-send-explicit-intent-to-dynamically-registered-receiver/"><span>不能向动态注册的广播接收器发送显式Intent</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">课程笔记<!-- --> (<!-- -->19<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/rank-inequality/"><span>【线性代数】对秩不等式的理解</span></a></li><li><a class="link" href="/23c/pattern-recognition-1/"><span>【模式识别】统计决策方法</span></a></li><li><a class="link" href="/23c/pattern-recognition-2/"><span>【模式识别】参数估计</span></a></li><li><a class="link" href="/23c/pattern-recognition-3/"><span>【模式识别】非参数估计</span></a></li><li><a class="link" href="/23d/pattern-recognition-4/"><span>【模式识别】线性学习器与线性分类器</span></a></li><li><a class="link" href="/23d/protocols/"><span>【计算机网络】协议总结</span></a></li><li><a class="link" href="/24a/machine-learning-exercises/"><span>【机器学习】习题</span></a></li><li><a class="link" href="/24a/games101-01-transformation/"><span>【GAMES101】Transformation</span></a></li><li><a class="link" href="/24a/games101-02-rasterization/"><span>【GAMES101】Rasterization</span></a></li><li><a class="link" href="/24a/games101-03-shading/"><span>【GAMES101】Shading</span></a></li><li><a class="link" href="/24a/games101-04-geometry/"><span>【GAMES101】Geometry</span></a></li><li><a class="link" href="/24c/assembly-1/"><span>【汇编语言】访问寄存器和内存</span></a></li><li><a class="link" href="/24c/assembly-2/"><span>【汇编语言】汇编语言编程</span></a></li><li><a class="link" href="/24c/assembly-3/"><span>【汇编语言】内存寻址方式</span></a></li><li><a class="link" href="/24c/assembly-4/"><span>【汇编语言】流程转移与子程序</span></a></li><li><a class="link" href="/24c/assembly-5/"><span>【汇编语言】标志寄存器</span></a></li><li><a class="link" href="/24c/assembly-6/"><span>【汇编语言】中断及外部设备操作</span></a></li><li><a class="link" href="/24d/crypto-1/"><span>【密码学】流密码</span></a></li><li><a class="link" href="/24d/crypto-2/"><span>【密码学】块密码</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">杂记<!-- --> (<!-- -->4<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/by-questions/"><span>专业课复习</span></a></li><li><a class="link" href="/24d/about-interactive-multimedia/"><span>关于交互式多媒体</span></a></li><li><a class="link" href="/longtime/hundred-thousand/"><span>十万</span></a></li><li><a class="link" href="/longtime/linux-commands/"><span>三开</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">交互式多媒体<!-- --> (<!-- -->3<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24d/about-interactive-multimedia/"><span>关于交互式多媒体</span></a></li><li><a class="link" href="/23c/pattern-recognition-1/"><span>【模式识别】统计决策方法</span></a></li><li><a class="link" href="/23d/css-auto-height-transition/"><span>CSS实现auto高度的过渡动画</span></a></li></ul></div></div></div></div><div id="sidebar-mask"></div><script src="/_next/static/chunks/webpack-784efdfcf16d24d7.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/4682f1d53f08c69e.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/251a603d14fca651.css\",\"style\",{\"crossOrigin\":\"\"}]\n4:HL[\"/_next/static/css/c3852fd214fb6838.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[47690,[],\"\"]\n7:I[76842,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"551\",\"static/chunks/551-19232c47cd1e883a.js\",\"742\",\"static/chunks/742-fa7d80f612d849db.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-aef85db72c3ae249.js\"],\"PostMeta\"]\n8:\"$Sreact.suspense\"\na:I[76842,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"551\",\"static/chunks/551-19232c47cd1e883a.js\",\"742\",\"static/chunks/742-fa7d80f612d849db.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-aef85db72c3ae249.js\"],\"LikeButton\"]\nb:I[55329,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"742\",\"static/chunks/742-fa7d80f612d849db.js\",\"55\",\"static/chunks/app/%5B...slug%5D/layout-943ca6d0b6a86a10.js\"],\"\"]\nc:I[5613,[],\"\"]\ne:I[31778,[],\"\"]\nf:I[30389,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"742\",\"static/chunks/742-fa7d80f612d849db.js\",\"55\",\"static/chunks/app/%5B...slug%5D/layout-943ca6d0b6a86a10.js\"],\"\"]\n10:I[25694,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"185\",\"static/chunks/app/layout-71de1b4a5090c7d9.js\"],\"GlobalProvider\"]\n11:I[30397,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"185\",\"static/chunks/app/layout-71de1b4a5090c7d9.js\"],\"\"]\n13:I[48955,[],\"\"]\nd:[\"slug\",\"24c/asm8086-snake\",\"c\"]\n14:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4682f1d53f08c69e.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"LFdbJQnvdAXlwLWpe5mbZ\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/24c/asm8086-snake/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"24c/asm8086-snake\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"24c\\\",\\\"asm8086-snake\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"24c/asm8086-snake\",\"c\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",[false,[\"$\",\"h1\",null,{\"className\":\"post-title\",\"children\":\"8086汇编贪吃蛇\"}],[\"$\",\"$L7\",null,{\"path\":\"/24c/asm8086-snake/\"}],[\"$\",\"$8\",null,{\"fallback\":[\"$\",\"p\",null,{\"children\":\"Loading component...\"}],\"children\":\"$L9\"}],[\"$\",\"$La\",null,{\"path\":\"/24c/asm8086-snake/\"}]],null]]},[null,[[\"$\",\"$Lb\",null,{}],[\"$\",\"div\",null,{\"id\":\"post-layout\",\"children\":[\"$\",\"div\",null,{\"id\":\"main\",\"className\":\"center-wrapper\",\"children\":[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$d\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c3852fd214fb6838.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]}]}],[\"$\",\"$Lf\",null,{}]],null]]},[null,[\"$\",\"html\",null,{\"lang\":\"zh-CN\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\"}],[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"}],[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY\"}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\nwindow.dataLayer = window.dataLayer || [];\\nfunction gtag() {\\n    dataLayer.push(arguments);\\n}\\ngtag('js', new Date());\\ngtag('config', 'G-45BYSZ6WPY');\\n\"}}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"const a=z=\u003eh.getItem(z),b=(y,z)=\u003eh.setItem(y,z),c=(y,z)=\u003edocument.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e\u0026\u0026a(d)!==f\u0026\u0026b(d,f);a(d)===e?c(g,e):c(g,f);\"}}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\nif (!Array.prototype.findLast) {\\n    Array.prototype.findLast = function (callback) {\\n        for (let i = this.length - 1; i \u003e= 0; i--) {\\n            if (callback(this[i])) return this[i];\\n        }\\n        return undefined;\\n    };\\n}\\nif (!Array.prototype.findLastIndex) {\\n    Array.prototype.findLastIndex = function (callback) {\\n        for (let i = this.length - 1; i \u003e= 0; i--) {\\n            if (callback(this[i])) return i;\\n        }\\n        return -1;\\n    };\\n}\\n\"}}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L10\",null,{\"children\":[[\"$\",\"$L11\",null,{}],[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"id\":\"notfound\",\"children\":[[\"$\",\"img\",null,{\"alt\":\"img\",\"src\":\"/images/cry.gif\"}],[\"$\",\"code\",null,{\"id\":\"notfound-404\",\"children\":\"404\"}],[\"$\",\"code\",null,{\"id\":\"notfound-text\",\"children\":\"Page Not Found\"}]]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/98e601cf5ba3633d.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/251a603d14fca651.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]}]}]]}],null]],\"initialHead\":[false,\"$L12\"],\"globalErrorComponent\":\"$13\",\"missingSlots\":\"$W14\"}]]\n"])</script><script>self.__next_f.push([1,"15:I[62029,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"551\",\"static/chunks/551-19232c47cd1e883a.js\",\"742\",\"static/chunks/742-fa7d80f612d849db.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-aef85db72c3ae249.js\"],\"\"]\n1f:I[74365,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"551\",\"static/chunks/551-19232c47cd1e883a.js\",\"742\",\"static/chunks/742-fa7d80f612d849db.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-aef85db72c3ae249.js\"],\"\"]\n16:T5f3,datasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    addri9 \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0,\u003c/span\u003e\u003cspan class=\"token number\"\u003e0,\u003c/span\u003e\u003cspan class=\"token number\"\u003e0,\u003c/span\u003e\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e           \u003cspan class=\"token comment\"\u003e;存放原9号中断的中断向量\u003c/span\u003e\n    seed   \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0adh \u003c/span\u003e              \u003cspan class=\"token comment\"\u003e;随机数种子\u003c/span\u003e\n    rand   \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0 \u003c/span\u003e                 \u003cspan class=\"token comment\"\u003e;随机数\u003c/span\u003e\n    apple  \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e44h \u003c/span\u003e               \u003cspan class=\"token comment\"\u003e;果实位置，初始设为44h\u003c/span\u003e\n    dir    \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0 \u003c/span\u003e                 \u003cspan class=\"token comment\"\u003e;方向，0:up 1:right 2:left 3:down\u003c/span\u003e\n    dirbuf \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e    snake  \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e4ah,\u003c/span\u003e\u003cspan class=\"token number\"\u003e49h,\u003c/span\u003e\u003cspan class=\"token number\"\u003e48h,\u003c/span\u003e\u003cspan class=\"token number\"\u003e47h \u003c/span\u003e   \u003cspan class=\"token comment\"\u003e;蛇尾 --- 蛇"])</script><script>self.__next_f.push([1,"头\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e256 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\ndatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n17:T441,\u003cspan class=\"token comment\"\u003e;;;;延迟一段时间\u003c/span\u003e\ndelay:\n          \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e7h \u003c/span\u003e                           \u003cspan class=\"token comment\"\u003e;增大此值可以减慢蛇的移动速度（间隔）\u003c/span\u003e\nd1:       \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0ffffh\n\u003c/span\u003ed2:       \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e  \u003cspan class=\"token number\"\u003ed2\n\u003c/span\u003e          \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e  \u003cspan class=\"token number\"\u003ed1\n\u003c/span\u003e          \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n18:T669,\u003cspan class=\"token comment\"\u003e;;;;平方取中随机数\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;输出：\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;rand     下一个随机数\u003c/span\u003e\ngetrand:\n          \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,rand\n          \u003cspan class=\"token function\"\u003emul\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e rand\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e,\u003csp"])</script><script>self.__next_f.push([1,"an class=\"token number\"\u003e4\n\u003c/span\u003e          \u003cspan class=\"token function\"\u003eshr\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e          \u003cspan class=\"token function\"\u003ejnz\u003c/span\u003e   ok\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,seed                          \u003cspan class=\"token comment\"\u003e;避免陷入0循环\u003c/span\u003e\nok:\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   rand,\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n19:T843,"])</script><script>self.__next_f.push([1,"codesg segment\n    start:\n             mov   ax,datasg\n             mov   ds,ax\n    ;保存原来9号中断的中断向量到addri9处\n             mov   ax,0\n             mov   es,ax\n             push  es:[9*4]\n             pop   word ptr addri9[0]\n             push  es:[9*4+2]\n             pop   word ptr addri9[2]\n    ;更改原来的中断向量\n             mov   word ptr es:[9*4],offset int9    ;设置9号中断的IP为offset int9\n             mov   es:[9*4+2],cs                    ;设置9号中断的CS为代码段起始地址\n             ;...\n\n    ;游戏结束返回\n    ret_main:\n    ;恢复原来的中断向量\n             mov   ax,0\n             mov   es,ax\n             push  word ptr addri9[0]\n             pop   es:[9*4]\n             push  word ptr addri9[2]\n             pop   es:[9*4+2]\n             ;...\n\n\n    ;;;;自定义键盘中断\n    int9:\n             push  ax\n             push  bx\n    ;模拟标志寄存器入栈\n             pushf\n    ;模拟设置IF=0，TF=0\n             pushf\n             pop   ax\n             and   ah,11111100b\n             push  ax\n             popf\n    ;call指令即可实现CS、IP入栈并跳转到入口地址\n             call  dword ptr addri9\n    ;自定义的键盘输入处理\n             in    al,60h                           ;读取键盘输入送入AL\n             cmp   al,dir\n             je    int9_dft\n             cmp   al,11h                           ;W键\n             je    int9_w\n             cmp   al,20h                           ;D键\n             je    int9_d\n             cmp   al,1eh                           ;A键\n             je    int9_a\n             cmp   al,1fh                           ;S键\n             je    int9_s\n             jmp   int9_dft\n    int9_w:\n             mov   dirbuf,0\n             jmp   int9_dft\n    int9_d:\n             mov   dirbuf,1\n             jmp   int9_dft\n    int9_a:\n             mov   dirbuf,2\n             jmp   int9_dft\n    int9_s:\n             mov   dirbuf,3\n             jmp   int9_dft\n    int9_dft:\n             pop   bx\n             pop   ax\n             iret\ncodesg ends\nend start\n"])</script><script>self.__next_f.push([1,"1a:T1e24,"])</script><script>self.__next_f.push([1,"codesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,datasg\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;保存原来9号中断的中断向量到addri9处\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;更改原来的中断向量\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e,\u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e int9    \u003cspan class=\"token comment\"\u003e;设置9号中断的IP为offset int9\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e                    \u003cspan class=\"token comment\"\u003e;设置9号中断的CS为代码段起始地址\u003c/span\u003e\n             \u003cspan class=\"token comment\"\u003e;...\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;游戏结束返回\u003c/span\u003e\n    ret_main:\n    \u003cspan class=\"token comment\"\u003e;恢复原来的中断向量\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n             \u003cspan class=\"token comment\"\u003e;...\u003c/span\u003e\n\n\n    \u003cspan class=\"token comment\"\u003e;;;;自定义键盘中断\u003c/span\u003e\n    int9:\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;模拟标志寄存器入栈\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epushf\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;模拟设置IF=0，TF=0\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epushf\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eah\u003c/span\u003e,\u003cspan class=\"token number\"\u003e11111100b\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epopf\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;call指令即可实现CS、IP入栈并跳转到入口地址\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003edword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\n    \u003cspan class=\"token comment\"\u003e;自定义的键盘输入处理\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003ein\u003c/span\u003e    \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e60h \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;读取键盘输入送入AL\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,dir\n             \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_dft\n             \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e11h \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;W键\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_w\n             \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e20h \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;D键\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_d\n             \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e1eh \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;A键\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_a\n             \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e1fh \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;S键\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_s\n             \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_w:\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   dirbuf,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_d:\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   dirbuf,\u003cspan class=\"token number\"\u003e1\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_a:\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   dirbuf,\u003cspan class=\"token number\"\u003e2\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_s:\n             \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   dirbuf,\u003cspan class=\"token number\"\u003e3\n\u003c/span\u003e             \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_dft:\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n             iret\ncodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"1b:T8d6,"])</script><script>self.__next_f.push([1,"游戏的地图大小设计为\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e16\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e16\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e（含边界），这样刚好可以用\u003ccode class=\"x-inline-highlight\"\u003e4\u003c/code\u003e位表示一个坐标分量，一个字节表示一个二维坐标。约定一个字节的高\u003ccode class=\"x-inline-highlight\"\u003e4\u003c/code\u003e位表示\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e坐标，低\u003ccode class=\"x-inline-highlight\"\u003e4\u003c/code\u003e位表示\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e坐标。例如\u003ccode class=\"x-inline-highlight\"\u003e4ah\u003c/code\u003e表示逻辑坐标\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e10\u003c/span\u003e\u003cspan class=\"mpunct\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e4\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，对应\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e16\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e16\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e地图中的第\u003ccode class=\"x-inline-highlight\"\u003e10\u003c/code\u003e行、第\u003ccode class=\"x-inline-highlight\"\u003e4\u003c/code\u003e列的方格。"])</script><script>self.__next_f.push([1,"1c:Td18,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token comment\"\u003e;;;;在显存[x+5行，2*y列]和[x+5行，2*y+1列]处写入属性BH（等价于逻辑坐标x,y）\u003c/span\u003e\nwrite:\n\u003cspan class=\"token comment\"\u003e;输入：\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;BH       属性\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;BL[7:4]  y坐标（逻辑列号）\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e;BL[3:0]  x坐标（逻辑行号）\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e00f0h \u003c/span\u003e                        \u003cspan class=\"token comment\"\u003e;(di)=逻辑列号*16\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e2\n\u003c/span\u003e          \u003cspan class=\"token function\"\u003eshr\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e                            \u003cspan class=\"token comment\"\u003e;逻辑右移2位，(di)=逻辑列号*4\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0fh \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;(cl)=逻辑行号\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e10\n\u003c/span\u003e          \u003cspan class=\"token function\"\u003emul\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e                               \u003cspan class=\"token comment\"\u003e;(ax)=逻辑行号*10\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0b800h+\u003c/span\u003e\u003cspan class=\"token number\"\u003e50 \u003c/span\u003e                    \u003cspan class=\"token comment\"\u003e;(ax)=逻辑行号*10+b800h+50\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e                            \u003cspan class=\"token comment\"\u003e;(es)=逻辑行号*10+b800h+50\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e3]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n          \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"1d:T249d,"])</script><script>self.__next_f.push([1,"assume cs:codesg,ds:datasg,ss:stcksg\n\ndatasg segment\n    addri9 db 0,0,0,0            ;存放原9号中断的中断向量\n    seed   db 0adh               ;随机数种子\n    rand   db 0                  ;随机数\n    apple  db 44h                ;果实位置，初始设为44h\n    dir    db 0                  ;方向，0:up 1:right 2:left 3:down\n    dirbuf db 0\n    snake  db 4ah,49h,48h,47h    ;蛇尾 --- 蛇头\n           db 256 dup(0)\ndatasg ends\n\nstcksg segment\n           db 128 dup(0)\nstcksg ends\n\ncodesg segment\n    start:\n              mov   ax,datasg\n              mov   ds,ax\n    ;保存原来9号中断的中断向量到addri9处\n              mov   ax,0\n              mov   es,ax\n              push  es:[9*4]\n              pop   word ptr addri9[0]\n              push  es:[9*4+2]\n              pop   word ptr addri9[2]\n    ;更改原来的中断向量\n              mov   word ptr es:[9*4],offset int9    ;设置9号中断的IP为offset int9\n              mov   es:[9*4+2],cs                    ;设置9号中断的CS为代码段起始地址\n    ;初始化\n              call  init\n    ;主循环\n    main_loop:\n              call  delay\n              mov   al,dirbuf\n              xor   al,dir\n              cmp   al,3\n              je    keep_dir\n              xor   al,dir\n              mov   dir,al\n    keep_dir:\n              call  move\n              jmp   main_loop\n    ;游戏结束返回\n    gameover:\n    ;恢复原来的中断向量\n              mov   ax,0\n              mov   es,ax\n              push  word ptr addri9[0]\n              pop   es:[9*4]\n              push  word ptr addri9[2]\n              pop   es:[9*4+2]\n    ;清空键盘缓冲区\n    clear:\n              mov   ah, 01h\n              int   16h\n              je    done\n              mov   ah, 00h\n              int   16h\n              jmp   clear\n    done:\n              mov   ax,4c00h\n              int   21h\n\n    ;;;;延迟一段时间\n    delay:\n              push  cx\n              mov   cx,7h                            ;增大此值可以减慢蛇的移动速度（间隔）\n    d1:       push  cx\n              mov   cx,0ffffh\n    d2:       loop  d2\n              pop   cx\n              loop  d1\n              pop   cx\n              ret\n\n    ;;;;平方取中随机数\n    ;输出：\n    ;rand     下一个随机数\n    getrand:\n              push  ax\n              push  cx\n              mov   al,rand\n              mul   byte ptr rand\n              mov   cl,4\n              shr   ax,cl\n              cmp   al,0\n              jnz   ok\n              mov   al,seed                          ;避免陷入0循环\n    ok:\n              mov   rand,al\n              pop   cx\n              pop   ax\n              ret\n\n    ;;;;在显存[x+5行，2*y列]和[x+5行，2*y+1列]处写入属性BH（等价于逻辑坐标x,y）\n    write:\n    ;输入：\n    ;BH       属性\n    ;BL[7:4]  y坐标（逻辑列号）\n    ;BL[3:0]  x坐标（逻辑行号）\n              push  cx\n              mov   di,bx\n              and   di,00f0h                         ;(di)=逻辑列号*16\n              mov   cl,2\n              shr   di,cl                            ;逻辑右移2位，(di)=逻辑列号*4\n              mov   cl,bl\n              and   cl,0fh                           ;(cl)=逻辑行号\n              mov   al,10\n              mul   cl                               ;(ax)=逻辑行号*10\n              add   ax,0b800h+50                     ;(ax)=逻辑行号*10+b800h+50\n              mov   es,ax                            ;(es)=逻辑行号*10+b800h+50\n              mov   byte ptr es:[di+1],bh\n              mov   byte ptr es:[di+3],bh\n              pop   cx\n              ret\n\n    ;;;;初始化地图\n    init:\n    ;清屏\n              mov   ax,0b800h+50\n              mov   es,ax\n              mov   cx,7fffh\n              mov   di,0\n    i1:       mov   byte ptr es:[di],0\n              inc   di\n              loop  i1\n    ;绘制果实和蛇\n              call  getrand\n              mov   bh,40h                           ;红底（果实）\n              mov   bl,apple\n              call  write\n              mov   si,0\n              mov   bh,20h                           ;绿底（蛇）\n    i2:       mov   bl,snake[si]\n              call  write\n              inc   si\n              cmp   byte ptr snake[si],0\n              jnz   i2\n    ;绘制边界\n              mov   bh,70h                           ;白底（边界）\n              mov   cx,15                            ;16*16地图（包含边界）\n    i3:       mov   bl,cl                            ;x=i，y=0\n              call  write\n              or    bl,0f0h                          ;x=i，y=15\n              call  write\n              mov   bl,cl\n              push  cx\n              mov   cx,4\n              shl   bl,cl                            ;赋值y=i\n              pop   cx\n              or    bl,0fh                           ;x=15，y=i\n              call  write\n              and   bl,0f0h                          ;x=0，y=i\n              call  write\n              jcxz  ret_init\n              sub   cx,1\n              jmp   i3\n    ret_init:\n              ret\n\n    ;;;;移动一步\n    move:\n    ;si移动到头部下一个位置\n              mov   si,0\n    m2:       inc   si\n              cmp   snake[si],0\n              jnz   m2\n    ;复制原头部数据\n              mov   al,snake[si-1]\n              mov   snake[si],al\n    ;根据方向移动蛇头\n              cmp   byte ptr dir,0\n              je    move_u\n              cmp   byte ptr dir,1\n              je    move_r\n              cmp   byte ptr dir,2\n              je    move_l\n              cmp   byte ptr dir,3\n              je    move_d\n              jmp   move_dft\n    move_u:\n              sub   snake[si],1\n              jmp   move_dft\n    move_r:\n              add   snake[si],10h\n              jmp   move_dft\n    move_l:\n              sub   snake[si],10h\n              jmp   move_dft\n    move_d:\n              add   snake[si],1\n              jmp   move_dft\n    move_dft:\n    ;擦除尾部\n              mov   bh,0\n              mov   bl,snake[0]\n              call  write\n    ;绘制新头部\n              mov   bh,20h\n              mov   bl,snake[si]\n              call  write\n    ;判定蛇头吃到果实或撞墙\n              cmp   bl,apple\n              je    eat\n              call  is_valid\n              cmp   al,0\n              je    gameover\n    ;移动蛇身\n              mov   si,0\n    m1:       mov   al,snake[si+1]\n              mov   snake[si],al\n              inc   si\n              cmp   byte ptr snake[si+1],0\n              jnz   m1\n    ;擦除复制的新头部\n              mov   snake[si],0\n              jmp   ret_move\n    ;吃到果实\n    eat:\n              mov   al,apple\n              mov   snake[si],al\n    m3:       call  getrand\n              mov   bl,rand\n              call  is_valid\n              cmp   al,1\n              jne   m3                               ;如果生成的位置已经有蛇身，则重新生成\n              mov   byte ptr apple,bl\n              mov   bh,40h\n              mov   bl,apple\n              call  write\n              ret\n\n    ;;;;判断合法位置：边界、蛇身处判定为不合法（不判断蛇头）\n    is_valid:\n    ;输入：\n    ;BL     坐标\n    ;输出：\n    ;AL     0(不合法)/1(合法)\n              push  bx\n              mov   al,0\n              cmp   bl,0fh                           ;x=i，y=0\n              jb    false\n              cmp   bl,0f0h                          ;x=i，y=15\n              ja    false\n              mov   bh,bl\n              and   bh,0fh\n              cmp   bh,0fh                           ;x=15，y=i\n              je    false\n              cmp   bh,0                             ;x=0，y=i\n              je    false\n\n              mov   si,0\n    v1:       cmp   bl,snake[si]\n              je    false\n              inc   si\n              cmp   byte ptr snake[si+1],0\n              jnz   v1\n\n              mov   al,1\n    false:\n              pop   bx\n              ret\n\n    ;;;;自定义键盘中断\n    int9:\n              push  ax\n              push  bx\n    ;模拟标志寄存器入栈\n              pushf\n    ;模拟设置IF=0，TF=0\n              pushf\n              pop   ax\n              and   ah,11111100b\n              push  ax\n              popf\n    ;call指令即可实现CS、IP入栈并跳转到入口地址\n              call  dword ptr addri9\n    ;自定义的键盘输入处理\n              in    al,60h                           ;读取键盘输入送入AL\n              cmp   al,dir\n              je    int9_dft\n              cmp   al,11h                           ;W键\n              je    int9_w\n              cmp   al,20h                           ;D键\n              je    int9_d\n              cmp   al,1eh                           ;A键\n              je    int9_a\n              cmp   al,1fh                           ;S键\n              je    int9_s\n              jmp   int9_dft\n    int9_w:\n              mov   dirbuf,0\n              jmp   int9_dft\n    int9_d:\n              mov   dirbuf,1\n              jmp   int9_dft\n    int9_a:\n              mov   dirbuf,2\n              jmp   int9_dft\n    int9_s:\n              mov   dirbuf,3\n              jmp   int9_dft\n    int9_dft:\n              pop   bx\n              pop   ax\n              iret\ncodesg ends\nend start\n"])</script><script>self.__next_f.push([1,"1e:T8750,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eassume\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e:codesg,\u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e:datasg,\u003cspan class=\"token register variable\"\u003ess\u003c/span\u003e:stcksg\n\ndatasg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    addri9 \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0,\u003c/span\u003e\u003cspan class=\"token number\"\u003e0,\u003c/span\u003e\u003cspan class=\"token number\"\u003e0,\u003c/span\u003e\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e           \u003cspan class=\"token comment\"\u003e;存放原9号中断的中断向量\u003c/span\u003e\n    seed   \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0adh \u003c/span\u003e              \u003cspan class=\"token comment\"\u003e;随机数种子\u003c/span\u003e\n    rand   \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0 \u003c/span\u003e                 \u003cspan class=\"token comment\"\u003e;随机数\u003c/span\u003e\n    apple  \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e44h \u003c/span\u003e               \u003cspan class=\"token comment\"\u003e;果实位置，初始设为44h\u003c/span\u003e\n    dir    \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0 \u003c/span\u003e                 \u003cspan class=\"token comment\"\u003e;方向，0:up 1:right 2:left 3:down\u003c/span\u003e\n    dirbuf \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e    snake  \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e4ah,\u003c/span\u003e\u003cspan class=\"token number\"\u003e49h,\u003c/span\u003e\u003cspan class=\"token number\"\u003e48h,\u003c/span\u003e\u003cspan class=\"token number\"\u003e47h \u003c/span\u003e   \u003cspan class=\"token comment\"\u003e;蛇尾 --- 蛇头\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e256 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\ndatasg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\nstcksg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n           \u003cspan class=\"token keyword\"\u003edb\u003c/span\u003e \u003cspan class=\"token number\"\u003e128 \u003c/span\u003e\u003cspan class=\"token keyword\"\u003edup\u003c/span\u003e(\u003cspan class=\"token number\"\u003e0)\u003c/span\u003e\nstcksg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\ncodesg \u003cspan class=\"token keyword\"\u003esegment\u003c/span\u003e\n    start:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,datasg\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eds\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;保存原来9号中断的中断向量到addri9处\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;更改原来的中断向量\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e,\u003cspan class=\"token keyword\"\u003eoffset\u003c/span\u003e int9    \u003cspan class=\"token comment\"\u003e;设置9号中断的IP为offset int9\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecs\u003c/span\u003e                    \u003cspan class=\"token comment\"\u003e;设置9号中断的CS为代码段起始地址\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;初始化\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  init\n    \u003cspan class=\"token comment\"\u003e;主循环\u003c/span\u003e\n    main_loop:\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  delay\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,dirbuf\n              \u003cspan class=\"token function\"\u003exor\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,dir\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e3\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    keep_dir\n              \u003cspan class=\"token function\"\u003exor\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,dir\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   dir,\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e\n    keep_dir:\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  move\n              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   main_loop\n    \u003cspan class=\"token comment\"\u003e;游戏结束返回\u003c/span\u003e\n    gameover:\n    \u003cspan class=\"token comment\"\u003e;恢复原来的中断向量\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003eword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9*\u003c/span\u003e\u003cspan class=\"token number\"\u003e4+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2]\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;清空键盘缓冲区\u003c/span\u003e\n    clear:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eah\u003c/span\u003e, \u003cspan class=\"token number\"\u003e01h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eint\u003c/span\u003e   \u003cspan class=\"token number\"\u003e16h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    done\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eah\u003c/span\u003e, \u003cspan class=\"token number\"\u003e00h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eint\u003c/span\u003e   \u003cspan class=\"token number\"\u003e16h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   clear\n    done:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4c00h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eint\u003c/span\u003e   \u003cspan class=\"token number\"\u003e21h\n\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;;;;延迟一段时间\u003c/span\u003e\n    delay:\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e7h \u003c/span\u003e                           \u003cspan class=\"token comment\"\u003e;增大此值可以减慢蛇的移动速度（间隔）\u003c/span\u003e\n    d1:       \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0ffffh\n\u003c/span\u003e    d2:       \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e  \u003cspan class=\"token number\"\u003ed2\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e  \u003cspan class=\"token number\"\u003ed1\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;;;;平方取中随机数\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;输出：\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;rand     下一个随机数\u003c/span\u003e\n    getrand:\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,rand\n              \u003cspan class=\"token function\"\u003emul\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e rand\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eshr\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejnz\u003c/span\u003e   ok\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,seed                          \u003cspan class=\"token comment\"\u003e;避免陷入0循环\u003c/span\u003e\n    ok:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   rand,\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;;;;在显存[x+5行，2*y列]和[x+5行，2*y+1列]处写入属性BH（等价于逻辑坐标x,y）\u003c/span\u003e\n    write:\n    \u003cspan class=\"token comment\"\u003e;输入：\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;BH       属性\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;BL[7:4]  y坐标（逻辑列号）\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;BL[3:0]  x坐标（逻辑行号）\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e00f0h \u003c/span\u003e                        \u003cspan class=\"token comment\"\u003e;(di)=逻辑列号*16\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e2\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eshr\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e                            \u003cspan class=\"token comment\"\u003e;逻辑右移2位，(di)=逻辑列号*4\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0fh \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;(cl)=逻辑行号\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e10\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003emul\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e                               \u003cspan class=\"token comment\"\u003e;(ax)=逻辑行号*10\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0b800h+\u003c/span\u003e\u003cspan class=\"token number\"\u003e50 \u003c/span\u003e                    \u003cspan class=\"token comment\"\u003e;(ax)=逻辑行号*10+b800h+50\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e                            \u003cspan class=\"token comment\"\u003e;(es)=逻辑行号*10+b800h+50\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e3]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;;;;初始化地图\u003c/span\u003e\n    init:\n    \u003cspan class=\"token comment\"\u003e;清屏\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0b800h+\u003c/span\u003e\u003cspan class=\"token number\"\u003e50\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e7fffh\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e    i1:       \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e \u003cspan class=\"token register variable\"\u003ees\u003c/span\u003e:\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003einc\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003edi\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eloop\u003c/span\u003e  i1\n    \u003cspan class=\"token comment\"\u003e;绘制果实和蛇\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  getrand\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e40h \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;红底（果实）\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,apple\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  write\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e20h \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;绿底（蛇）\u003c/span\u003e\n    i2:       \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  write\n              \u003cspan class=\"token function\"\u003einc\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejnz\u003c/span\u003e   i2\n    \u003cspan class=\"token comment\"\u003e;绘制边界\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e70h \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;白底（边界）\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e15 \u003c/span\u003e                           \u003cspan class=\"token comment\"\u003e;16*16地图（包含边界）\u003c/span\u003e\n    i3:       \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e                            \u003cspan class=\"token comment\"\u003e;x=i，y=0\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  write\n              \u003cspan class=\"token function\"\u003eor\u003c/span\u003e    \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0f0h \u003c/span\u003e                         \u003cspan class=\"token comment\"\u003e;x=i，y=15\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  write\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e4\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eshl\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ecl\u003c/span\u003e                            \u003cspan class=\"token comment\"\u003e;赋值y=i\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eor\u003c/span\u003e    \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0fh \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;x=15，y=i\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  write\n              \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0f0h \u003c/span\u003e                         \u003cspan class=\"token comment\"\u003e;x=0，y=i\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  write\n              \u003cspan class=\"token function\"\u003ejcxz\u003c/span\u003e  ret_init\n              \u003cspan class=\"token function\"\u003esub\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ecx\u003c/span\u003e,\u003cspan class=\"token number\"\u003e1\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   i3\n    ret_init:\n              \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;;;;移动一步\u003c/span\u003e\n    move:\n    \u003cspan class=\"token comment\"\u003e;si移动到头部下一个位置\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e    m2:       \u003cspan class=\"token function\"\u003einc\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejnz\u003c/span\u003e   m2\n    \u003cspan class=\"token comment\"\u003e;复制原头部数据\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;根据方向移动蛇头\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e dir,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    move_u\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e dir,\u003cspan class=\"token number\"\u003e1\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    move_r\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e dir,\u003cspan class=\"token number\"\u003e2\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    move_l\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e dir,\u003cspan class=\"token number\"\u003e3\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    move_d\n              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   move_dft\n    move_u:\n              \u003cspan class=\"token function\"\u003esub\u003c/span\u003e   snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e1\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   move_dft\n    move_r:\n              \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e   snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e10h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   move_dft\n    move_l:\n              \u003cspan class=\"token function\"\u003esub\u003c/span\u003e   snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e10h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   move_dft\n    move_d:\n              \u003cspan class=\"token function\"\u003eadd\u003c/span\u003e   snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e1\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   move_dft\n    move_dft:\n    \u003cspan class=\"token comment\"\u003e;擦除尾部\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  write\n    \u003cspan class=\"token comment\"\u003e;绘制新头部\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e20h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  write\n    \u003cspan class=\"token comment\"\u003e;判定蛇头吃到果实或撞墙\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,apple\n              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    eat\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  is_valid\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    gameover\n    \u003cspan class=\"token comment\"\u003e;移动蛇身\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e    m1:       \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003einc\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejnz\u003c/span\u003e   m1\n    \u003cspan class=\"token comment\"\u003e;擦除复制的新头部\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   ret_move\n    \u003cspan class=\"token comment\"\u003e;吃到果实\u003c/span\u003e\n    eat:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,apple\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e\n    m3:       \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  getrand\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,rand\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  is_valid\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e1\n\u003c/span\u003e              jne   m3                               \u003cspan class=\"token comment\"\u003e;如果生成的位置已经有蛇身，则重新生成\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e apple,\u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e40h\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,apple\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  write\n              \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;;;;判断合法位置：边界、蛇身处判定为不合法（不判断蛇头）\u003c/span\u003e\n    is_valid:\n    \u003cspan class=\"token comment\"\u003e;输入：\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;BL     坐标\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;输出：\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;AL     0(不合法)/1(合法)\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0fh \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;x=i，y=0\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ejb\u003c/span\u003e    false\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0f0h \u003c/span\u003e                         \u003cspan class=\"token comment\"\u003e;x=i，y=15\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eja\u003c/span\u003e    false\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0fh\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0fh \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;x=15，y=i\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    false\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebh\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0 \u003c/span\u003e                            \u003cspan class=\"token comment\"\u003e;x=0，y=i\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    false\n\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e    v1:       \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebl\u003c/span\u003e,snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e]\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    false\n              \u003cspan class=\"token function\"\u003einc\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e snake\u003cspan class=\"token operator\"\u003e[\u003c/span\u003e\u003cspan class=\"token register variable\"\u003esi\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1]\u003c/span\u003e,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejnz\u003c/span\u003e   v1\n\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e1\n\u003c/span\u003e    false:\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eret\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e;;;;自定义键盘中断\u003c/span\u003e\n    int9:\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;模拟标志寄存器入栈\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epushf\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;模拟设置IF=0，TF=0\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epushf\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eand\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eah\u003c/span\u003e,\u003cspan class=\"token number\"\u003e11111100b\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003epush\u003c/span\u003e  \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epopf\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e;call指令即可实现CS、IP入栈并跳转到入口地址\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecall\u003c/span\u003e  \u003cspan class=\"token keyword\"\u003edword\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eptr\u003c/span\u003e addri9\n    \u003cspan class=\"token comment\"\u003e;自定义的键盘输入处理\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ein\u003c/span\u003e    \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e60h \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;读取键盘输入送入AL\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,dir\n              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_dft\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e11h \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;W键\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_w\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e20h \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;D键\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_d\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e1eh \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;A键\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_a\n              \u003cspan class=\"token function\"\u003ecmp\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eal\u003c/span\u003e,\u003cspan class=\"token number\"\u003e1fh \u003c/span\u003e                          \u003cspan class=\"token comment\"\u003e;S键\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003eje\u003c/span\u003e    int9_s\n              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_w:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   dirbuf,\u003cspan class=\"token number\"\u003e0\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_d:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   dirbuf,\u003cspan class=\"token number\"\u003e1\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_a:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   dirbuf,\u003cspan class=\"token number\"\u003e2\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_s:\n              \u003cspan class=\"token function\"\u003emov\u003c/span\u003e   dirbuf,\u003cspan class=\"token number\"\u003e3\n\u003c/span\u003e              \u003cspan class=\"token function\"\u003ejmp\u003c/span\u003e   int9_dft\n    int9_dft:\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003ebx\u003c/span\u003e\n              \u003cspan class=\"token function\"\u003epop\u003c/span\u003e   \u003cspan class=\"token register variable\"\u003eax\u003c/span\u003e\n              iret\ncodesg \u003cspan class=\"token keyword\"\u003eends\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e start\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"变量设置\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在数据段中使用以下变量：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"datasg segment\\n    addri9 db 0,0,0,0            ;存放原9号中断的中断向量\\n    seed   db 0adh               ;随机数种子\\n    rand   db 0                  ;随机数\\n    apple  db 44h                ;果实位置，初始设为44h\\n    dir    db 0                  ;方向，0:up 1:right 2:left 3:down\\n    dirbuf db 0\\n    snake  db 4ah,49h,48h,47h    ;蛇尾 --- 蛇头\\n           db 256 dup(0)\\ndatasg ends\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$16\"}}]}]]}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"前置技术\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在汇编实现贪吃蛇通常需要解决以下几个技术：\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"延时函数\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在汇编中延时函数可以通过执行空循环来实现：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\";;;;延迟一段时间\\ndelay:\\n          push  cx\\n          mov   cx,7h                            ;增大此值可以减慢蛇的移动速度（间隔）\\nd1:       push  cx\\n          mov   cx,0ffffh\\nd2:       loop  d2\\n          pop   cx\\n          loop  d1\\n          pop   cx\\n          ret\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$17\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"虽然这种方法不能精确控制延迟多少秒/毫秒，但可以通过调节外层循环的次数（内层也可以）来相对地控制延迟时间。（一层循环最大执行次数是\u003ccode class=\\\"x-inline-highlight\\\"\u003effffh\u003c/code\u003e，仍然太快，因此需要两层循环）\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"随机数\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"使用平方取中法实现一个简单的伪随机序列，随机种子预先写死在代码中：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\";;;;平方取中随机数\\n;输出：\\n;rand     下一个随机数\\ngetrand:\\n          push  ax\\n          push  cx\\n          mov   al,rand\\n          mul   byte ptr rand\\n          mov   cl,4\\n          shr   ax,cl\\n          cmp   al,0\\n          jnz   ok\\n          mov   al,seed                          ;避免陷入0循环\\nok:\\n          mov   rand,al\\n          pop   cx\\n          pop   ax\\n          ret\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$18\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这里生成的是\u003ccode class=\\\"x-inline-highlight\\\"\u003e8\u003c/code\u003e位的随机数，每次调用\u003ccode class=\\\"x-inline-highlight\\\"\u003egetrand\u003c/code\u003e都会更新\u003ccode class=\\\"x-inline-highlight\\\"\u003erand\u003c/code\u003e标号处的一个字节的值。这个随机数生成方法有时会陷入\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e循环，因此产生新的随机数时加了一个判断，如果结果为\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e则重新从\u003ccode class=\\\"x-inline-highlight\\\"\u003eseed\u003c/code\u003e开始生成。\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"处理键盘输入\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"使用自定义的键盘中断程序（\u003ccode class=\\\"x-inline-highlight\\\"\u003e9\u003c/code\u003e号中断）解决，大致框架为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$19\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1a\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在设计键盘响应时，不希望玩家能够直接修改蛇的移动方向为当前方向的反向（不能调转\u003cspan class=\\\"katex\\\"\u003e\u003cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003e\u003cspan class=\\\"base\\\"\u003e\u003cspan class=\\\"strut\\\" style=\\\"height:0.6741em;\\\"\u003e\u003c/span\u003e\u003cspan class=\\\"mord\\\"\u003e18\u003c/span\u003e\u003cspan class=\\\"mord\\\"\u003e\u003cspan class=\\\"mord\\\"\u003e0\u003c/span\u003e\u003cspan class=\\\"msupsub\\\"\u003e\u003cspan class=\\\"vlist-t\\\"\u003e\u003cspan class=\\\"vlist-r\\\"\u003e\u003cspan class=\\\"vlist\\\" style=\\\"height:0.6741em;\\\"\u003e\u003cspan style=\\\"top:-3.063em;margin-right:0.05em;\\\"\u003e\u003cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003e\u003c/span\u003e\u003cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003e\u003cspan class=\\\"mbin mtight\\\"\u003e∘\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e），例如如果当前移动方向为向上，则应只允许修改为向左/向右，而不能修改为向下。为此额外添加了\u003ccode class=\\\"x-inline-highlight\\\"\u003edirbuf\u003c/code\u003e变量，用户的键盘输入会实时存入\u003ccode class=\\\"x-inline-highlight\\\"\u003edirbuf\u003c/code\u003e，但只在每次主循环中有条件地与\u003ccode class=\\\"x-inline-highlight\\\"\u003edir\u003c/code\u003e同步。主循环如下（其中\u003ccode class=\\\"x-inline-highlight\\\"\u003emove\u003c/code\u003e函数处理蛇移动一步，后面会详细说明）：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"main_loop:\\n          call  delay\\n          mov   al,dirbuf\\n          xor   al,dir\\n          cmp   al,3\\n          je    keep_dir\\n          xor   al,dir\\n          mov   dir,al\\nkeep_dir:\\n          call  move\\n          jmp   main_loop\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"main_loop:\\n          \u003cspan class=\\\"token function\\\"\u003ecall\u003c/span\u003e  delay\\n          \u003cspan class=\\\"token function\\\"\u003emov\u003c/span\u003e   \u003cspan class=\\\"token register variable\\\"\u003eal\u003c/span\u003e,dirbuf\\n          \u003cspan class=\\\"token function\\\"\u003exor\u003c/span\u003e   \u003cspan class=\\\"token register variable\\\"\u003eal\u003c/span\u003e,dir\\n          \u003cspan class=\\\"token function\\\"\u003ecmp\u003c/span\u003e   \u003cspan class=\\\"token register variable\\\"\u003eal\u003c/span\u003e,\u003cspan class=\\\"token number\\\"\u003e3\\n\u003c/span\u003e          \u003cspan class=\\\"token function\\\"\u003eje\u003c/span\u003e    keep_dir\\n          \u003cspan class=\\\"token function\\\"\u003exor\u003c/span\u003e   \u003cspan class=\\\"token register variable\\\"\u003eal\u003c/span\u003e,dir\\n          \u003cspan class=\\\"token function\\\"\u003emov\u003c/span\u003e   dir,\u003cspan class=\\\"token register variable\\\"\u003eal\u003c/span\u003e\\nkeep_dir:\\n          \u003cspan class=\\\"token function\\\"\u003ecall\u003c/span\u003e  move\\n          \u003cspan class=\\\"token function\\\"\u003ejmp\u003c/span\u003e   main_loop\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"代码中\u003ccode class=\\\"x-inline-highlight\\\"\u003edir\u003c/code\u003e与\u003ccode class=\\\"x-inline-highlight\\\"\u003edirbuf\u003c/code\u003e异或为\u003ccode class=\\\"x-inline-highlight\\\"\u003e3\u003c/code\u003e时，表示方向刚好相差\u003cspan class=\\\"katex\\\"\u003e\u003cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003e\u003cspan class=\\\"base\\\"\u003e\u003cspan class=\\\"strut\\\" style=\\\"height:0.6741em;\\\"\u003e\u003c/span\u003e\u003cspan class=\\\"mord\\\"\u003e18\u003c/span\u003e\u003cspan class=\\\"mord\\\"\u003e\u003cspan class=\\\"mord\\\"\u003e0\u003c/span\u003e\u003cspan class=\\\"msupsub\\\"\u003e\u003cspan class=\\\"vlist-t\\\"\u003e\u003cspan class=\\\"vlist-r\\\"\u003e\u003cspan class=\\\"vlist\\\" style=\\\"height:0.6741em;\\\"\u003e\u003cspan style=\\\"top:-3.063em;margin-right:0.05em;\\\"\u003e\u003cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003e\u003c/span\u003e\u003cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003e\u003cspan class=\\\"mbin mtight\\\"\u003e∘\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，此时不改变\u003ccode class=\\\"x-inline-highlight\\\"\u003edir\u003c/code\u003e的值（\u003ccode class=\\\"x-inline-highlight\\\"\u003eje keep_dir\u003c/code\u003e）；由于异或操作改变了\u003ccode class=\\\"x-inline-highlight\\\"\u003eAL\u003c/code\u003e的值，因此送入\u003ccode class=\\\"x-inline-highlight\\\"\u003edir\u003c/code\u003e前需要再异或一次原来的\u003ccode class=\\\"x-inline-highlight\\\"\u003edir\u003c/code\u003e值。\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"坐标设计与操作显存绘制\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"通过操作显存绘制图形，显存中用\u003ccode class=\\\"x-inline-highlight\\\"\u003e2\u003c/code\u003e个字节表示一个字符，低字节表示字符的ASCII码，高字节表示字符的颜色。这里不设置字符，只设置背景色，相邻的两列刚好凑成一个正方形。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"$1b\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"由于字符显示区是\u003ccode class=\\\"x-inline-highlight\\\"\u003e25\u003c/code\u003e行、\u003ccode class=\\\"x-inline-highlight\\\"\u003e80\u003c/code\u003e列，这里的\u003cspan class=\\\"katex\\\"\u003e\u003cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003e\u003cspan class=\\\"base\\\"\u003e\u003cspan class=\\\"strut\\\" style=\\\"height:0.4306em;\\\"\u003e\u003c/span\u003e\u003cspan class=\\\"mord mathnormal\\\"\u003ex\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e坐标对应了\u003ccode class=\\\"x-inline-highlight\\\"\u003e行号-5\u003c/code\u003e（为了让地图显示在屏幕中间），\u003cspan class=\\\"katex\\\"\u003e\u003cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003e\u003cspan class=\\\"base\\\"\u003e\u003cspan class=\\\"strut\\\" style=\\\"height:0.625em;vertical-align:-0.1944em;\\\"\u003e\u003c/span\u003e\u003cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.03588em;\\\"\u003ey\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e坐标对应了\u003ccode class=\\\"x-inline-highlight\\\"\u003e列号/2\u003c/code\u003e（因为每个字符占\u003ccode class=\\\"x-inline-highlight\\\"\u003e2\u003c/code\u003e列）。封装一个\u003ccode class=\\\"x-inline-highlight\\\"\u003ewrite\u003c/code\u003e函数，用于将属性写入显存的指定位置：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\";;;;在显存[x+5行，2*y列]和[x+5行，2*y+1列]处写入属性BH（等价于逻辑坐标x,y）\\nwrite:\\n;输入：\\n;BH       属性\\n;BL[7:4]  y坐标（逻辑列号）\\n;BL[3:0]  x坐标（逻辑行号）\\n          push  cx\\n          mov   di,bx\\n          and   di,00f0h                         ;(di)=逻辑列号*16\\n          mov   cl,2\\n          shr   di,cl                            ;逻辑右移2位，(di)=逻辑列号*4\\n          mov   cl,bl\\n          and   cl,0fh                           ;(cl)=逻辑行号\\n          mov   al,10\\n          mul   cl                               ;(ax)=逻辑行号*10\\n          add   ax,0b800h+50                     ;(ax)=逻辑行号*10+b800h+50\\n          mov   es,ax                            ;(es)=逻辑行号*10+b800h+50\\n          mov   byte ptr es:[di+1],bh\\n          mov   byte ptr es:[di+3],bh\\n          pop   cx\\n          ret\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1c\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"显存的起始地址是\u003ccode class=\\\"x-inline-highlight\\\"\u003eb8000h\u003c/code\u003e，屏幕第\u003ccode class=\\\"x-inline-highlight\\\"\u003ei\u003c/code\u003e行、第\u003ccode class=\\\"x-inline-highlight\\\"\u003ej\u003c/code\u003e列的偏移地址是\u003ccode class=\\\"x-inline-highlight\\\"\u003e80\u0026#42;2\u0026#42;i+2\u0026#42;j\u003c/code\u003e，用\u003ccode class=\\\"x-inline-highlight\\\"\u003e段地址:偏移地址\u003c/code\u003e表示为\u003ccode class=\\\"x-inline-highlight\\\"\u003eb800:80\u0026#42;2\u0026#42;i+2\u0026#42;j\u003c/code\u003e；我们希望从第\u003ccode class=\\\"x-inline-highlight\\\"\u003e5\u003c/code\u003e行开始显示地图，因此偏移地址额外加上\u003ccode class=\\\"x-inline-highlight\\\"\u003e80\u0026#42;2\u0026#42;5\u003c/code\u003e，如果加到段地址上还要除以\u003ccode class=\\\"x-inline-highlight\\\"\u003e16\u003c/code\u003e，也就是\u003ccode class=\\\"x-inline-highlight\\\"\u003e80\u0026#42;2\u0026#42;5/16=50\u003c/code\u003e，对应代码中\u003ccode class=\\\"x-inline-highlight\\\"\u003e0b800h+50\u003c/code\u003e。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"同理，逻辑行号在偏移地址中数值要乘\u003ccode class=\\\"x-inline-highlight\\\"\u003e80*2=160\u003c/code\u003e，而表示在段地址中只需乘\u003ccode class=\\\"x-inline-highlight\\\"\u003e160/16=10\u003c/code\u003e。\"}}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"实现\"}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"代码\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"完整的代码如下：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"ASM8086\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$1d\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1e\"}}]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"演示\"}],[\"$\",\"$L1f\",null,{\"src\":\"game.gif\"}]]\n"])</script><script>self.__next_f.push([1,"12:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"8086汇编贪吃蛇 - 铃木的网络日记\"}],[\"$\",\"link\",\"3\",{\"rel\":\"canonical\",\"href\":\"https://1kuzus.github.io/24c/asm8086-snake/\"}]]\n6:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>