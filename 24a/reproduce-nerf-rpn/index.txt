1:HL["/_next/static/css/8ac0b0e7f508d966.css","style",{"crossOrigin":""}]
0:["F8tpvN5-yNKUAmwFuXero",[[["",{"children":["(blogs)",{"children":["24a",{"children":["reproduce-nerf-rpn",{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/8ac0b0e7f508d966.css","precedence":"next","crossOrigin":""}]],"$L3"]]]]
4:HL["/_next/static/css/d1ba65e78d6f432c.css","style",{"crossOrigin":""}]
5:HL["/_next/static/css/f70c26425a044d6b.css","style",{"crossOrigin":""}]
6:I[9226,["185","static/chunks/app/layout-959d1352bec0edcb.js"],"GlobalProvider"]
7:I[9330,["185","static/chunks/app/layout-959d1352bec0edcb.js"],""]
8:I[6954,[],""]
9:I[7264,[],""]
a:I[413,["413","static/chunks/413-dc980fd24c15cede.js","160","static/chunks/app/not-found-aa1272efa852a321.js"],"Image"]
b:I[5285,["954","static/chunks/d3ac728e-1e5d8b71e3d43fec.js","413","static/chunks/413-dc980fd24c15cede.js","202","static/chunks/202-268c3b9a2ea32d77.js","396","static/chunks/396-150eb8004cde3d82.js","135","static/chunks/app/(blogs)/layout-39f18c96d96b8978.js"],""]
d:I[4484,["954","static/chunks/d3ac728e-1e5d8b71e3d43fec.js","413","static/chunks/413-dc980fd24c15cede.js","202","static/chunks/202-268c3b9a2ea32d77.js","367","static/chunks/app/(blogs)/24a/reproduce-nerf-rpn/page-16440d9389f69dea.js"],"Title"]
e:I[4484,["954","static/chunks/d3ac728e-1e5d8b71e3d43fec.js","413","static/chunks/413-dc980fd24c15cede.js","202","static/chunks/202-268c3b9a2ea32d77.js","367","static/chunks/app/(blogs)/24a/reproduce-nerf-rpn/page-16440d9389f69dea.js"],"H1"]
f:I[4484,["954","static/chunks/d3ac728e-1e5d8b71e3d43fec.js","413","static/chunks/413-dc980fd24c15cede.js","202","static/chunks/202-268c3b9a2ea32d77.js","367","static/chunks/app/(blogs)/24a/reproduce-nerf-rpn/page-16440d9389f69dea.js"],"H2"]
10:I[9708,["954","static/chunks/d3ac728e-1e5d8b71e3d43fec.js","413","static/chunks/413-dc980fd24c15cede.js","202","static/chunks/202-268c3b9a2ea32d77.js","367","static/chunks/app/(blogs)/24a/reproduce-nerf-rpn/page-16440d9389f69dea.js"],""]
11:I[4484,["954","static/chunks/d3ac728e-1e5d8b71e3d43fec.js","413","static/chunks/413-dc980fd24c15cede.js","202","static/chunks/202-268c3b9a2ea32d77.js","367","static/chunks/app/(blogs)/24a/reproduce-nerf-rpn/page-16440d9389f69dea.js"],"H3"]
12:I[8411,["954","static/chunks/d3ac728e-1e5d8b71e3d43fec.js","413","static/chunks/413-dc980fd24c15cede.js","202","static/chunks/202-268c3b9a2ea32d77.js","367","static/chunks/app/(blogs)/24a/reproduce-nerf-rpn/page-16440d9389f69dea.js"],""]
3:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Create Next App"}],["$","meta","2",{"name":"description","content":"Generated by create next app"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
13:T7b2,
                <work_dir>
                ├── InstantNGPforked
                └── NeRFrpn
                    └── nerf_rpn
                        ├── results
                            ├── front3d_test
                                └── proposals
                                        3dfront_0004_00.npz
                                        3dfront_0019_00.npz
                                        ...
                                        3dfront_1006_02.npz
                                        3dfront_1014_02.npz
                                    eval.json
                            └── proposals_to_ngp
                                    3dfront_0004_00.json
                                    3dfront_0019_00.json
                                    ...
                                    3dfront_1006_02.json
                                    3dfront_1014_02.json
                        ├── scripts
                                proposals2ngp.py
                        └── weights
                                front3d_anchor_resnet50.pt
                            proposals2ngp.bat
                            test.bat

                E:\
                ├── front3d_nerf_data
                    ├── 3dfront_0000_00
                    ├── 3dfront_0000_01
                    ├── ...
                    ├── 3dfront_0004_01
                        ├── overview
                        └── train
                            └── images
                                model.msgpack
                                transforms.json
                                3dfront_0004_00.json (copied from NeRFrpn\nerf_rpn\results\proposals_to_ngp)
                    ├── ...
                    ├── 3dfront_1015_02
                    └── 3dfront_1015_04
                └── front3d_rpn_data
                2:[null,["$","html",null,{"lang":"en","children":["$","body",null,{"children":["$","$L6",null,{"children":[["$","$L7",null,{}],["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":["$","div",null,{"id":"notfound","children":[["$","$La",null,{"alt":"img","width":true,"height":true,"src":"/next.svg","style":{"width":500,"height":"auto"}}],["$","div",null,{"id":"notfound-404","children":"404"}],["$","div",null,{"id":"notfound-text","children":"Page Not Found"}]]}],"notFoundStyles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/eccd2e7a1149e571.css","precedence":"next","crossOrigin":""}]],"childProp":{"current":[null,["$","$Lb",null,{"children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","(blogs)","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","(blogs)","children","24a","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","(blogs)","children","24a","children","reproduce-nerf-rpn","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Lc",[["$","$Ld",null,{"children":"$undefined"}],["$","$Le",null,{"children":"说明"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"复现仓库：<a href=\"https://github.com/lyclyc52/NeRF_RPN\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">https://github.com/lyclyc52/NeRF_RPN</a>"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"这项研究在NeRF中引入RPN，用于3D物体检测和相关任务。作者提供了改写的Instant-NGP以供可视化3D提议框。我自己在尝试复现的时候绕了一些弯子，因此借这篇博客复盘一下当时的过程。仓库提供的脚本多为适用于linux系统的<code class=\"x-inline-highlight\">.sh</code>文件，而我自己的设备是windows系统，因此示例中会给出适用于windows系统的相应指令。"}}],["$","$Le",null,{"children":"环境相关"}],["$","$Lf",null,{"children":"克隆仓库"}],["$","$L10",null,{"language":"bash","code":"git clone https://github.com/lyclyc52/NeRF_RPN.git NeRFrpn"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"环境配置参照<a href=\"https://github.com/lyclyc52/NeRF_RPN\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">官方仓库说明文档</a>即可。"}}],["$","$Lf",null,{"children":"配置Instant-NGP Fork for NeRF Feature Extraction"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"作者修改了Instant-NGP的仓库，添加了一些包括可视化bbox在内的功能。说明文档在<a href=\"https://github.com/zymk9/instant-ngp/tree/master/scripts\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">这里</a>。"}}],["$","$L10",null,{"language":"bash","code":"git clone --recursive https://github.com/zymk9/instant-ngp.git InstantNGPforked"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"这是Instant-NGP一个早期版本，执行下面的命令运行<code class=\"x-inline-highlight\">build</code>过程。更多细节可以参考<a href=\"https://github.com/zymk9/instant-ngp\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">这里</a>。"}}],["$","$L10",null,{"language":"bash","code":"\n                cd InstantNGPforked\n                cmake . -B build\n                cmake --build build --config RelWithDebInfo -j\n                "}],["$","div",null,{"className":"x-highlightblock highlight-background-golden","children":[["$","$L11",null,{"children":"遇到问题"}],["$","$L11",null,{"children":"git clone 失败，报错 fatal: early EOF"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"报错："}}],["$","$L10",null,{"language":"none","code":"\n                    error: xxxx bytes of body are still expected\n                    fetch-pack: unexpected disconnect while reading sideband packet\n                    fatal: early EOF\n                    fatal: fetch-pack: invalid index-pack output\n                    "}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"解决：增大缓冲区(<code class=\"x-inline-highlight\">1048576000</code>是<code class=\"x-inline-highlight\">1G</code>)"}}],["$","$L10",null,{"language":"bash","code":"git config --global http.postBuffer 1048576000"}],["$","$L11",null,{"children":"子模块没有一次性下载成功"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"解决：进入目录手动重新下载"}}],["$","$L10",null,{"language":"bash","code":"\n                    cd InstantNGPforked\n                    git submodule update --init --recursive\n                    "}]]}],["$","$Lf",null,{"children":"下载数据集"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"作者提供了数据集的<a href=\"https://hkustconnect-my.sharepoint.com/:f:/g/personal/bhuai_connect_ust_hk/Ekjf3YC0W9BMsc-jHWXI4xEBy5s_OJBLEbebNVIprd4zMg?e=FgbN9S\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">OneDrive链接</a>，这里以<code class=\"x-inline-highlight\">3D-FRONT</code>数据集作为例子，需要从作者提供的链接中下载<code class=\"x-inline-highlight\">front3d_nerf_data.zip</code>和<code class=\"x-inline-highlight\">front3d_rpn_data.zip</code>。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"假设数据集解压的路径为<code class=\"x-inline-highlight\">E:\\front3d_nerf_data</code>和<code class=\"x-inline-highlight\">E:\\front3d_rpn_data</code>。"}}],["$","$Lf",null,{"children":"可视化数据集"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"在完成上面步骤后，就可以先利用Instant-NGP的UI可视化数据集中标注的<code class=\"x-inline-highlight\">ground truth</code>了，这里以场景<code class=\"x-inline-highlight\">3dfront_0004_00</code>为例："}}],["$","$L10",null,{"language":"bash","code":"\n                cd InstantNGPforked\n                .\\build\\testbed --scene E:\\front3d_nerf_data\\3dfront_0004_00\\train\n                "}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"执行上述命令后，勾选UI<code class=\"x-inline-highlight\">Debug visualization</code>下的<code class=\"x-inline-highlight\">Visualize object bounding boxes</code>就可以看到如下结果："}}],["$","$L12",null,{"src":{"default":{"src":"/_next/static/media/fig1.0188d7f3.jpg","height":1066,"width":2559,"blurDataURL":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIAAMACAMBIgACEQEDEQH/xAAnAAEBAAAAAAAAAAAAAAAAAAAABgEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAAnQn/xAAZEAEBAQADAAAAAAAAAAAAAAABAwIABaH/2gAIAQEAAT8A7KtKTTW1Ez5z/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECMv/aAAgBAgEBPwCMI//EABYRAAMAAAAAAAAAAAAAAAAAAAACMf/aAAgBAwEBPwBqf//Z","blurWidth":8,"blurHeight":3}},"width":"100%"}],["$","$Lf",null,{"children":"下载预训练的权重"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"本博客给出的示例需要在上面的OneDrive链接中下载<code class=\"x-inline-highlight\">nerf_rpn_model_release\\front3d_anchor_resnet50.pt</code>。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"假设预训练权重保存的路径为<code class=\"x-inline-highlight\">NeRFrpn&#92;nerf_rpn\\weights\\front3d_anchor_resnet50.pt</code>。"}}],["$","$Le",null,{"children":"生成proposals"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"接下来，利用预训练的权重，写一个<code class=\"x-inline-highlight\">test</code>脚本生成提议框。"}}],["$","$L10",null,{"language":"bash","code":"\n                # NeRFrpn\\nerf_rpn\\test.bat\n\n                set DATA_ROOT=E:\\front3d_rpn_data\n                cd NeRFrpn\\nerf_rpn\n\n                python -u run_rpn.py ^\n                    --mode \"eval\" ^\n                    --dataset_name front3d ^\n                    --resolution 160 ^\n                    --backbone_type resnet ^\n                    --features_path %DATA_ROOT%\\features ^\n                    --boxes_path %DATA_ROOT%\\obb ^\n                    --dataset_split %DATA_ROOT%\\3dfront_split.npz ^\n                    --save_path .\\results\\front3d_test ^\n                    --checkpoint .\\weights\\front3d_anchor_resnet50.pt ^\n                    --rpn_nms_thresh 0.3 ^\n                    --normalize_density ^\n                    --rotated_bbox ^\n                    --batch_size 1 ^\n                    --gpus 0 ^\n                    --output_proposals                \n                "}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"由于我的设备显存小，所以把<code class=\"x-inline-highlight\">batch_size</code>改为了<code class=\"x-inline-highlight\">1</code>。原始的参数是<code class=\"x-inline-highlight\">2</code>。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"运行后会在<code class=\"x-inline-highlight\">NeRFrpn&#92;nerf_rpn&#92;results&#92;front3d_test</code>中得到<code class=\"x-inline-highlight\">eval.json</code>文件和储存了<code class=\"x-inline-highlight\">17</code>个测试场景的提议框的<code class=\"x-inline-highlight\">proposals</code>目录。"}}],["$","div",null,{"className":"x-highlightblock highlight-background-golden","children":[["$","$L11",null,{"children":"遇到问题"}],["$","$L11",null,{"children":"CUDA device 不匹配"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"报错：<br/>RuntimeError: Attempting to deserialize object on CUDA device 4 but torch.cuda.device_count() is 1. Please use torch.load with map_location to map your storages to an existing device."}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"解决：在<code class=\"x-inline-highlight\">run_rpn.py</code>找到下面这行代码："}}],["$","$L10",null,{"language":"python","code":"checkpoint = torch.load(args.checkpoint)"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"我的设备上只有一个GPU，因此修改为："}}],["$","$L10",null,{"language":"python","code":"checkpoint = torch.load(args.checkpoint, map_location={'cuda:4':'cuda:0'})"}]]}],["$","$Le",null,{"children":"运行proposals2ngp.py"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"下一步是生成Instant-NGP所需的<code class=\"x-inline-highlight\">transform.json</code>。"}}],["$","$L10",null,{"language":"bash","code":"\n                # NeRFrpn\\nerf_rpn\\proposals2ngp.bat\n\n                set DATA_DIR=E:\\\n                cd NeRFrpn\\nerf_rpn\n\n                python scripts\\proposals2ngp.py ^\n                    --bbox_format obb ^\n                    --dataset front3d ^\n                    --dataset_path %DATA_DIR%\\front3d_nerf_data ^\n                    --features_path %DATA_DIR%\\front3d_rpn_data\\features ^\n                    --proposals_path .\\results\\front3d_test\\proposals ^\n                    --output_dir .\\results\\proposals_to_ngp\n                "}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"运行后会在<code class=\"x-inline-highlight\">NeRFrpn&#92;nerf_rpn&#92;results&#92;proposals_to_ngp</code>中得到<code class=\"x-inline-highlight\">17</code>个测试场景的<code class=\"x-inline-highlight\">3dfront_xxxx_xx.json</code>文件。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"接下来，把文件<code class=\"x-inline-highlight\">3dfront_0004_00.json</code>复制到路径<code class=\"x-inline-highlight\">E:&#92;front3d_nerf_data&#92;3dfront_0004_00&#92;train</code>下，然后启动Instant-NGP的UI并指定这个新的<code class=\"x-inline-highlight\">json</code>文件："}}],["$","$L10",null,{"language":"bash","code":"\n                cd InstantNGPforked\n                .\\build\\testbed --scene E:\\front3d_nerf_data\\3dfront_0004_00\\train\\3dfront_0004_00.json\n                "}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"可以看到如下结果："}}],["$","$L12",null,{"src":{"default":{"src":"/_next/static/media/fig2.11ebdb93.jpg","height":1079,"width":2552,"blurDataURL":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/sBCgoKCgoKCwwMCw8QDhAPFhQTExQWIhgaGBoYIjMgJSAgJSAzLTcsKSw3LVFAODhAUV5PSk9ecWVlcY+Ij7u7+//CABEIAAMACAMBIgACEQEDEQH/xAAnAAEBAAAAAAAAAAAAAAAAAAAABQEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAAkg//xAAcEAABAwUAAAAAAAAAAAAAAAADAAECBAUSIrL/2gAIAQEAAT8AuhJkoj5yd9h9L//EABcRAAMBAAAAAAAAAAAAAAAAAAADMoH/2gAIAQIBAT8AXGn/xAAWEQADAAAAAAAAAAAAAAAAAAAAAjL/2gAIAQMBAT8Aej//2Q==","blurWidth":8,"blurHeight":3}},"width":"100%"}],["$","$Le",null,{"children":"文件结构参考"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"这里展示了前面我们生成、或需要用到的各个文件的路径示意。注意这并不是仓库中的全部内容，而是只展示了前面提及的文件。"}}],["$","$L10",null,{"language":"bash","code":"$13"}]],null],"segment":"__PAGE__"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f70c26425a044d6b.css","precedence":"next","crossOrigin":""}]]}],"segment":"reproduce-nerf-rpn"},"styles":[]}],"segment":"24a"},"styles":[]}],"params":{}}],null],"segment":"(blogs)"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/d1ba65e78d6f432c.css","precedence":"next","crossOrigin":""}]]}]]}]}]}],null]
c:null
