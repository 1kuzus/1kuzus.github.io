2:I[55329,["481","static/chunks/457b8330-69f8bab043e7caf2.js","954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-c60a65f28e774a61.js","548","static/chunks/548-617600d488b129da.js","877","static/chunks/app/%5B...slug%5D/page-bddbb5dbd3f48f88.js"],""]
3:I[93334,["481","static/chunks/457b8330-69f8bab043e7caf2.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-c60a65f28e774a61.js","931","static/chunks/app/page-43cb1a3cad7f6aa8.js"],""]
4:"$Sreact.suspense"
6:I[30389,["481","static/chunks/457b8330-69f8bab043e7caf2.js","954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-c60a65f28e774a61.js","548","static/chunks/548-617600d488b129da.js","877","static/chunks/app/%5B...slug%5D/page-bddbb5dbd3f48f88.js"],""]
7:I[5613,[],""]
9:I[31778,[],""]
a:I[25694,["250","static/chunks/250-0ef8476c0fa8ee24.js","185","static/chunks/app/layout-8463ba7e9dd08fd1.js"],"GlobalProvider"]
b:I[30397,["250","static/chunks/250-0ef8476c0fa8ee24.js","185","static/chunks/app/layout-8463ba7e9dd08fd1.js"],""]
8:["slug","24a/reproduce-nerf-rpn","c"]
0:["gxWF1u4Cr0FTqvy2DnWxJ",[[["",{"children":[["slug","24a/reproduce-nerf-rpn","c"],{"children":["__PAGE__?{\"slug\":[\"24a\",\"reproduce-nerf-rpn\"]}",{}]}]},"$undefined","$undefined",true],["",{"children":[["slug","24a/reproduce-nerf-rpn","c"],{"children":["__PAGE__",{},["$L1",[["$","$L2",null,{}],["$","div",null,{"id":"post-layout","children":[false,["$","div",null,{"id":"main","className":"center-wrapper","children":[["$","h1",null,{"className":"x-title","children":"记录：复现NeRF-RPN代码"}],["$","$L3",null,{"path":"/24a/reproduce-nerf-rpn/"}],["$","$4",null,{"fallback":["$","p",null,{"children":"Loading..."}],"children":["$","$4",null,{"fallback":["$","p",null,{"children":"Loading component..."}],"children":"$L5"}]}]]}],["$","$L6",null,{}]]}]],null]]},["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","$8","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f421cb1dbc9a88bf.css","precedence":"next","crossOrigin":""}]]}]]},[null,["$","html",null,{"lang":"zh-CN","suppressHydrationWarning":true,"children":[["$","head",null,{"children":[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon"}],["$","script",null,{"async":true,"src":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"}],["$","script",null,{"async":true,"src":"https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY"}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\nwindow.dataLayer = window.dataLayer || [];\nfunction gtag() {\n    dataLayer.push(arguments);\n}\ngtag('js', new Date());\ngtag('config', 'G-45BYSZ6WPY');\n"}}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"const a=z=>h.getItem(z),b=(y,z)=>h.setItem(y,z),c=(y,z)=>document.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e&&a(d)!==f&&b(d,f);a(d)===e?c(g,e):c(g,f);"}}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\nif (!Array.prototype.findLast) {\n    Array.prototype.findLast = function (callback) {\n        for (let i = this.length - 1; i >= 0; i--) {\n            if (callback(this[i])) return this[i];\n        }\n        return undefined;\n    };\n}\nif (!Array.prototype.findLastIndex) {\n    Array.prototype.findLastIndex = function (callback) {\n        for (let i = this.length - 1; i >= 0; i--) {\n            if (callback(this[i])) return i;\n        }\n        return -1;\n    };\n}\n"}}]]}],["$","body",null,{"children":["$","$La",null,{"children":[["$","$Lb",null,{}],["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"id":"notfound","children":[["$","img",null,{"alt":"img","src":"/images/cry.gif"}],["$","code",null,{"id":"notfound-404","children":"404"}],["$","code",null,{"id":"notfound-text","children":"Page Not Found"}]]}],"notFoundStyles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/98e601cf5ba3633d.css","precedence":"next","crossOrigin":""}]],"styles":null}]]}]}]]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/7d7aa1060b5664fb.css","precedence":"next","crossOrigin":""}]],"$Lc"]]]]
d:I[62029,["481","static/chunks/457b8330-69f8bab043e7caf2.js","954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-c60a65f28e774a61.js","548","static/chunks/548-617600d488b129da.js","877","static/chunks/app/%5B...slug%5D/page-bddbb5dbd3f48f88.js"],""]
e:I[74365,["481","static/chunks/457b8330-69f8bab043e7caf2.js","954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-c60a65f28e774a61.js","548","static/chunks/548-617600d488b129da.js","877","static/chunks/app/%5B...slug%5D/page-bddbb5dbd3f48f88.js"],""]
f:T7f4,<span class="token comment"># NeRFrpn\nerf_rpn\test.bat</span>

<span class="token builtin class-name">set</span> <span class="token assign-left variable">DATA_ROOT</span><span class="token operator">=</span>E:<span class="token punctuation">\</span>front3d_rpn_data
<span class="token builtin class-name">cd</span> NeRFrpn<span class="token punctuation">\</span>nerf_rpn

python <span class="token parameter variable">-u</span> run_rpn.py ^
    <span class="token parameter variable">--mode</span> <span class="token string">"eval"</span> ^
    <span class="token parameter variable">--dataset_name</span> front3d ^
    <span class="token parameter variable">--resolution</span> <span class="token number">160</span> ^
    <span class="token parameter variable">--backbone_type</span> resnet ^
    <span class="token parameter variable">--features_path</span> %DATA_ROOT%<span class="token punctuation">\</span>features ^
    <span class="token parameter variable">--boxes_path</span> %DATA_ROOT%<span class="token punctuation">\</span>obb ^
    <span class="token parameter variable">--dataset_split</span> %DATA_ROOT%<span class="token punctuation">\</span>3dfront_split.npz ^
    <span class="token parameter variable">--save_path</span> .<span class="token punctuation">\</span>results<span class="token punctuation">\</span>front3d_test ^
    <span class="token parameter variable">--checkpoint</span> .<span class="token punctuation">\</span>weights<span class="token punctuation">\</span>front3d_anchor_resnet50.pt ^
    <span class="token parameter variable">--rpn_nms_thresh</span> <span class="token number">0.3</span> ^
    <span class="token parameter variable">--normalize_density</span> ^
    <span class="token parameter variable">--rotated_bbox</span> ^
    <span class="token parameter variable">--batch_size</span> <span class="token number">1</span> ^
    <span class="token parameter variable">--gpus</span> <span class="token number">0</span> ^
    <span class="token parameter variable">--output_proposals</span>
10:T503,<span class="token comment"># NeRFrpn\nerf_rpn\proposals2ngp.bat</span>

<span class="token builtin class-name">set</span> <span class="token assign-left variable">DATA_DIR</span><span class="token operator">=</span>E:<span class="token punctuation">\</span>
<span class="token builtin class-name">cd</span> NeRFrpn<span class="token punctuation">\</span>nerf_rpn

python scripts<span class="token punctuation">\</span>proposals2ngp.py ^
    <span class="token parameter variable">--bbox_format</span> obb ^
    <span class="token parameter variable">--dataset</span> front3d ^
    <span class="token parameter variable">--dataset_path</span> %DATA_DIR%<span class="token punctuation">\</span>front3d_nerf_data ^
    <span class="token parameter variable">--features_path</span> %DATA_DIR%<span class="token punctuation">\</span>front3d_rpn_data<span class="token punctuation">\</span>features ^
    <span class="token parameter variable">--proposals_path</span> .<span class="token punctuation">\</span>results<span class="token punctuation">\</span>front3d_test<span class="token punctuation">\</span>proposals ^
    <span class="token parameter variable">--output_dir</span> .<span class="token punctuation">\</span>results<span class="token punctuation">\</span>proposals_to_ngp
11:T511,<work_dir>
├── InstantNGPforked
└── NeRFrpn
    └── nerf_rpn
        ├── results
            ├── front3d_test
                └── proposals
                        3dfront_0004_00.npz
                        3dfront_0019_00.npz
                        ...
                        3dfront_1006_02.npz
                        3dfront_1014_02.npz
                    eval.json
            └── proposals_to_ngp
                    3dfront_0004_00.json
                    3dfront_0019_00.json
                    ...
                    3dfront_1006_02.json
                    3dfront_1014_02.json
        ├── scripts
                proposals2ngp.py
        └── weights
                front3d_anchor_resnet50.pt
            proposals2ngp.bat
            test.bat

E:\
├── front3d_nerf_data
    ├── 3dfront_0000_00
    ├── 3dfront_0000_01
    ├── ...
    ├── 3dfront_0004_01
        ├── overview
        └── train
            └── images
                model.msgpack
                transforms.json
                3dfront_0004_00.json (copied from NeRFrpn\nerf_rpn\results\proposals_to_ngp)
    ├── ...
    ├── 3dfront_1015_02
    └── 3dfront_1015_04
└── front3d_rpn_data
12:T6e2,<span class="token operator">&lt;</span>work_dir<span class="token operator">></span>
├── InstantNGPforked
└── NeRFrpn
    └── nerf_rpn
        ├── results
            ├── front3d_test
                └── proposals
                        3dfront_0004_00.npz
                        3dfront_0019_00.npz
                        <span class="token punctuation">..</span>.
                        3dfront_1006_02.npz
                        3dfront_1014_02.npz
                    eval.json
            └── proposals_to_ngp
                    3dfront_0004_00.json
                    3dfront_0019_00.json
                    <span class="token punctuation">..</span>.
                    3dfront_1006_02.json
                    3dfront_1014_02.json
        ├── scripts
                proposals2ngp.py
        └── weights
                front3d_anchor_resnet50.pt
            proposals2ngp.bat
            test.bat

E:<span class="token punctuation">\</span>
├── front3d_nerf_data
    ├── 3dfront_0000_00
    ├── 3dfront_0000_01
    ├── <span class="token punctuation">..</span>.
    ├── 3dfront_0004_01
        ├── overview
        └── train
            └── images
                model.msgpack
                transforms.json
                3dfront_0004_00.json <span class="token punctuation">(</span>copied from NeRFrpn<span class="token punctuation">\</span>nerf_rpn<span class="token punctuation">\</span>results<span class="token punctuation">\</span>proposals_to_ngp<span class="token punctuation">)</span>
    ├── <span class="token punctuation">..</span>.
    ├── 3dfront_1015_02
    └── 3dfront_1015_04
└── front3d_rpn_data
5:[["$","h2",null,{"className":"x-h1","children":"说明"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"复现仓库：<a href=\"https://github.com/lyclyc52/NeRF_RPN\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">https://github.com/lyclyc52/NeRF_RPN</a>"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"这项研究在NeRF中引入RPN，用于3D物体检测和相关任务。作者提供了改写的Instant-NGP以供可视化3D提议框。我自己在尝试复现的时候绕了一些弯子，因此借这篇博客复盘一下当时的过程。仓库提供的脚本多为适用于Linux系统的<code class=\"x-inline-highlight\">.sh</code>文件，而我自己的设备是Windows系统，因此示例中会给出适用于Windows系统的相应指令。"}}],["$","h2",null,{"className":"x-h1","children":"环境相关"}],["$","h3",null,{"className":"x-h2","children":"克隆仓库"}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"git clone https://github.com/lyclyc52/NeRF_RPN.git NeRFrpn"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<span class=\"token function\">git</span> clone https://github.com/lyclyc52/NeRF_RPN.git NeRFrpn"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"环境配置参照<a href=\"https://github.com/lyclyc52/NeRF_RPN\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">官方仓库说明文档</a>即可。"}}],["$","h3",null,{"className":"x-h2","children":"配置Instant-NGP Fork for NeRF Feature Extraction"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"作者修改了Instant-NGP的仓库，添加了一些包括可视化bbox在内的功能。说明文档在<a href=\"https://github.com/zymk9/instant-ngp/tree/master/scripts\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">这里</a>。"}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"git clone --recursive https://github.com/zymk9/instant-ngp.git InstantNGPforked"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<span class=\"token function\">git</span> clone <span class=\"token parameter variable\">--recursive</span> https://github.com/zymk9/instant-ngp.git InstantNGPforked"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"这是Instant-NGP一个早期版本，执行下面的命令运行<code class=\"x-inline-highlight\">build</code>过程。更多细节可以参考<a href=\"https://github.com/zymk9/instant-ngp\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">这里</a>。"}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"cd InstantNGPforked\ncmake . -B build\ncmake --build build --config RelWithDebInfo -j\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<span class=\"token builtin class-name\">cd</span> InstantNGPforked\ncmake <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-B</span> build\ncmake <span class=\"token parameter variable\">--build</span> build <span class=\"token parameter variable\">--config</span> RelWithDebInfo <span class=\"token parameter variable\">-j</span>\n"}}]}]]}],["$","div",null,{"className":"x-highlightblock highlight-background-golden","children":[["$","h4",null,{"className":"x-h3","children":"遇到问题"}],["$","h4",null,{"className":"x-h3","children":"git clone 失败，报错 fatal: early EOF"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"报错："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Plain Text"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"error: xxxx bytes of body are still expected\nfetch-pack: unexpected disconnect while reading sideband packet\nfatal: early EOF\nfatal: fetch-pack: invalid index-pack output\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"error: xxxx bytes of body are still expected\nfetch-pack: unexpected disconnect while reading sideband packet\nfatal: early EOF\nfatal: fetch-pack: invalid index-pack output\n"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"解决：增大缓冲区（<code class=\"x-inline-highlight\">1048576000</code>是<code class=\"x-inline-highlight\">1G</code>）"}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"git config --global http.postBuffer 1048576000"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> http.postBuffer <span class=\"token number\">1048576000</span>"}}]}]]}],["$","h4",null,{"className":"x-h3","children":"子模块没有一次性下载成功"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"解决：进入目录手动重新下载"}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"cd InstantNGPforked\ngit submodule update --init --recursive\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<span class=\"token builtin class-name\">cd</span> InstantNGPforked\n<span class=\"token function\">git</span> submodule update <span class=\"token parameter variable\">--init</span> <span class=\"token parameter variable\">--recursive</span>\n"}}]}]]}]]}],["$","h3",null,{"className":"x-h2","children":"下载数据集"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"作者提供了数据集的<a href=\"https://hkustconnect-my.sharepoint.com/:f:/g/personal/bhuai_connect_ust_hk/Ekjf3YC0W9BMsc-jHWXI4xEBy5s_OJBLEbebNVIprd4zMg?e=FgbN9S\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">OneDrive链接</a>，这里以<code class=\"x-inline-highlight\">3D-FRONT</code>数据集作为例子，需要从作者提供的链接中下载<code class=\"x-inline-highlight\">front3d_nerf_data.zip</code>和<code class=\"x-inline-highlight\">front3d_rpn_data.zip</code>。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"假设数据集解压的路径为<code class=\"x-inline-highlight\">E:\\front3d_nerf_data</code>和<code class=\"x-inline-highlight\">E:\\front3d_rpn_data</code>。"}}],["$","h3",null,{"className":"x-h2","children":"可视化数据集"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"在完成上面步骤后，就可以先利用Instant-NGP的UI可视化数据集中标注的Ground Truth了，这里以场景<code class=\"x-inline-highlight\">3dfront_0004_00</code>为例："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"cd InstantNGPforked\n.\\build\\testbed --scene E:\\front3d_nerf_data\\3dfront_0004_00\\train\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<span class=\"token builtin class-name\">cd</span> InstantNGPforked\n.<span class=\"token punctuation\">\\</span>build<span class=\"token punctuation\">\\</span>testbed <span class=\"token parameter variable\">--scene</span> E:<span class=\"token punctuation\">\\</span>front3d_nerf_data<span class=\"token punctuation\">\\</span>3dfront_0004_00<span class=\"token punctuation\">\\</span>train\n"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"执行上述命令后，勾选UI<code class=\"x-inline-highlight\">Debug visualization</code>下的<code class=\"x-inline-highlight\">Visualize object bounding boxes</code>就可以看到如下结果："}}],["$","$Le",null,{"src":"fig1.jpg","width":"100%"}],["$","h3",null,{"className":"x-h2","children":"下载预训练的权重"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"本博客给出的示例需要在上面的OneDrive链接中下载<code class=\"x-inline-highlight\">nerf_rpn_model_release\\front3d_anchor_resnet50.pt</code>。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"假设预训练权重保存的路径为<code class=\"x-inline-highlight\">NeRFrpn&#92;nerf_rpn\\weights\\front3d_anchor_resnet50.pt</code>。"}}],["$","h2",null,{"className":"x-h1","children":"生成proposals"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"接下来，利用预训练的权重，写一个<code class=\"x-inline-highlight\">test</code>脚本生成提议框。"}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"# NeRFrpn\\nerf_rpn\\test.bat\n\nset DATA_ROOT=E:\\front3d_rpn_data\ncd NeRFrpn\\nerf_rpn\n\npython -u run_rpn.py ^\n    --mode \"eval\" ^\n    --dataset_name front3d ^\n    --resolution 160 ^\n    --backbone_type resnet ^\n    --features_path %DATA_ROOT%\\features ^\n    --boxes_path %DATA_ROOT%\\obb ^\n    --dataset_split %DATA_ROOT%\\3dfront_split.npz ^\n    --save_path .\\results\\front3d_test ^\n    --checkpoint .\\weights\\front3d_anchor_resnet50.pt ^\n    --rpn_nms_thresh 0.3 ^\n    --normalize_density ^\n    --rotated_bbox ^\n    --batch_size 1 ^\n    --gpus 0 ^\n    --output_proposals\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$f"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"由于我的设备显存小，所以把<code class=\"x-inline-highlight\">batch_size</code>改为了<code class=\"x-inline-highlight\">1</code>。原始的参数是<code class=\"x-inline-highlight\">2</code>。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"运行后会在<code class=\"x-inline-highlight\">NeRFrpn&#92;nerf_rpn&#92;results&#92;front3d_test</code>中得到<code class=\"x-inline-highlight\">eval.json</code>文件和储存了<code class=\"x-inline-highlight\">17</code>个测试场景的提议框的<code class=\"x-inline-highlight\">proposals</code>目录。"}}],["$","div",null,{"className":"x-highlightblock highlight-background-golden","children":[["$","h4",null,{"className":"x-h3","children":"遇到问题"}],["$","h4",null,{"className":"x-h3","children":"CUDA device 不匹配"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"报错："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Plain Text"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"RuntimeError: Attempting to deserialize object on CUDA device 4 but torch.cuda.device_count() is 1.\nPlease use torch.load with map_location to map your storages to an existing device.\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"RuntimeError: Attempting to deserialize object on CUDA device 4 but torch.cuda.device_count() is 1.\nPlease use torch.load with map_location to map your storages to an existing device.\n"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"解决：在<code class=\"x-inline-highlight\">run_rpn.py</code>找到下面这行代码："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Python"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"checkpoint = torch.load(args.checkpoint)"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"checkpoint <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>checkpoint<span class=\"token punctuation\">)</span>"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"我的设备上只有一个GPU，因此修改为："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Python"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"checkpoint = torch.load(args.checkpoint, map_location={'cuda:4':'cuda:0'})"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"checkpoint <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">.</span>checkpoint<span class=\"token punctuation\">,</span> map_location<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'cuda:4'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'cuda:0'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>"}}]}]]}]]}],["$","h2",null,{"className":"x-h1","children":"运行proposals2ngp.py"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"下一步是生成Instant-NGP所需的<code class=\"x-inline-highlight\">transform.json</code>。"}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"# NeRFrpn\\nerf_rpn\\proposals2ngp.bat\n\nset DATA_DIR=E:\\\ncd NeRFrpn\\nerf_rpn\n\npython scripts\\proposals2ngp.py ^\n    --bbox_format obb ^\n    --dataset front3d ^\n    --dataset_path %DATA_DIR%\\front3d_nerf_data ^\n    --features_path %DATA_DIR%\\front3d_rpn_data\\features ^\n    --proposals_path .\\results\\front3d_test\\proposals ^\n    --output_dir .\\results\\proposals_to_ngp\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$10"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"运行后会在<code class=\"x-inline-highlight\">NeRFrpn&#92;nerf_rpn&#92;results&#92;proposals_to_ngp</code>中得到<code class=\"x-inline-highlight\">17</code>个测试场景的<code class=\"x-inline-highlight\">3dfront_xxxx_xx.json</code>文件。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"接下来，把文件<code class=\"x-inline-highlight\">3dfront_0004_00.json</code>复制到路径<code class=\"x-inline-highlight\">E:&#92;front3d_nerf_data&#92;3dfront_0004_00&#92;train</code>下，然后启动Instant-NGP的UI并指定这个新的<code class=\"x-inline-highlight\">json</code>文件："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"cd InstantNGPforked\n.\\build\\testbed --scene E:\\front3d_nerf_data\\3dfront_0004_00\\train\\3dfront_0004_00.json\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<span class=\"token builtin class-name\">cd</span> InstantNGPforked\n.<span class=\"token punctuation\">\\</span>build<span class=\"token punctuation\">\\</span>testbed <span class=\"token parameter variable\">--scene</span> E:<span class=\"token punctuation\">\\</span>front3d_nerf_data<span class=\"token punctuation\">\\</span>3dfront_0004_00<span class=\"token punctuation\">\\</span>train<span class=\"token punctuation\">\\</span>3dfront_0004_00.json\n"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"可以看到如下结果："}}],["$","$Le",null,{"src":"fig2.jpg","width":"100%"}],["$","h2",null,{"className":"x-h1","children":"文件结构参考"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"这里展示了前面我们生成、或需要用到的各个文件的路径示意。注意这并不是仓库中的全部内容，而是只展示了前面提及的文件。"}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Ld",null,{"className":"x-codeblock-header-copy","text":"$11"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$12"}}]}]]}]]
c:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"记录：复现NeRF-RPN代码 - 铃木的网络日记"}],["$","link","3",{"rel":"canonical","href":"https://1kuzus.github.io/24a/reproduce-nerf-rpn/"}]]
1:null
