2:I[55329,["481","static/chunks/457b8330-b5c9cf3fcf214847.js","954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-fa632c1349770315.js","551","static/chunks/551-19232c47cd1e883a.js","842","static/chunks/842-812b9489b5c7f4d9.js","877","static/chunks/app/%5B...slug%5D/page-9c96bf7312b427f1.js"],""]
3:I[76842,["481","static/chunks/457b8330-b5c9cf3fcf214847.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-fa632c1349770315.js","842","static/chunks/842-812b9489b5c7f4d9.js","931","static/chunks/app/page-8a7b32c8a4befa3e.js"],"PostMeta"]
4:"$Sreact.suspense"
6:I[76842,["481","static/chunks/457b8330-b5c9cf3fcf214847.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-fa632c1349770315.js","842","static/chunks/842-812b9489b5c7f4d9.js","931","static/chunks/app/page-8a7b32c8a4befa3e.js"],"LikeButton"]
7:I[30389,["481","static/chunks/457b8330-b5c9cf3fcf214847.js","954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-fa632c1349770315.js","551","static/chunks/551-19232c47cd1e883a.js","842","static/chunks/842-812b9489b5c7f4d9.js","877","static/chunks/app/%5B...slug%5D/page-9c96bf7312b427f1.js"],""]
8:I[5613,[],""]
a:I[31778,[],""]
b:I[25694,["250","static/chunks/250-0ef8476c0fa8ee24.js","185","static/chunks/app/layout-9af8316721e2155d.js"],"GlobalProvider"]
c:I[30397,["250","static/chunks/250-0ef8476c0fa8ee24.js","185","static/chunks/app/layout-9af8316721e2155d.js"],""]
9:["slug","25b/debug-x86_64-program-in-arm64-system","c"]
0:["TQbl9DWDgb-w7WxOOip5t",[[["",{"children":[["slug","25b/debug-x86_64-program-in-arm64-system","c"],{"children":["__PAGE__?{\"slug\":[\"25b\",\"debug-x86_64-program-in-arm64-system\"]}",{}]}]},"$undefined","$undefined",true],["",{"children":[["slug","25b/debug-x86_64-program-in-arm64-system","c"],{"children":["__PAGE__",{},["$L1",[["$","$L2",null,{}],["$","div",null,{"id":"post-layout","children":[false,["$","div",null,{"id":"main","className":"center-wrapper","children":[["$","h1",null,{"className":"post-title","children":"使用QEMU在ARM64系统上调试x86_64程序"}],["$","$L3",null,{"path":"/25b/debug-x86_64-program-in-arm64-system/"}],["$","$4",null,{"fallback":["$","p",null,{"children":"Loading component..."}],"children":"$L5"}],["$","$L6",null,{"path":"/25b/debug-x86_64-program-in-arm64-system/"}]]}],["$","$L7",null,{}]]}]],null]]},["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","$9","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$La",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f0e9ea0d1087a412.css","precedence":"next","crossOrigin":""}]]}]]},[null,["$","html",null,{"lang":"zh-CN","suppressHydrationWarning":true,"children":[["$","head",null,{"children":[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon"}],["$","script",null,{"async":true,"src":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"}],["$","script",null,{"async":true,"src":"https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY"}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\nwindow.dataLayer = window.dataLayer || [];\nfunction gtag() {\n    dataLayer.push(arguments);\n}\ngtag('js', new Date());\ngtag('config', 'G-45BYSZ6WPY');\n"}}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"const a=z=>h.getItem(z),b=(y,z)=>h.setItem(y,z),c=(y,z)=>document.documentElement.setAttribute(y,z),d='theme',e='dark',f='light',g='class',h=localStorage;a(d)!==e&&a(d)!==f&&b(d,f);a(d)===e?c(g,e):c(g,f);"}}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\nif (!Array.prototype.findLast) {\n    Array.prototype.findLast = function (callback) {\n        for (let i = this.length - 1; i >= 0; i--) {\n            if (callback(this[i])) return this[i];\n        }\n        return undefined;\n    };\n}\nif (!Array.prototype.findLastIndex) {\n    Array.prototype.findLastIndex = function (callback) {\n        for (let i = this.length - 1; i >= 0; i--) {\n            if (callback(this[i])) return i;\n        }\n        return -1;\n    };\n}\n"}}]]}],["$","body",null,{"children":["$","$Lb",null,{"children":[["$","$Lc",null,{}],["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$La",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"id":"notfound","children":[["$","img",null,{"alt":"img","src":"/images/cry.gif"}],["$","code",null,{"id":"notfound-404","children":"404"}],["$","code",null,{"id":"notfound-text","children":"Page Not Found"}]]}],"notFoundStyles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/98e601cf5ba3633d.css","precedence":"next","crossOrigin":""}]],"styles":null}]]}]}]]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/17b3c4485edf7c41.css","precedence":"next","crossOrigin":""}]],"$Ld"]]]]
e:I[74365,["481","static/chunks/457b8330-b5c9cf3fcf214847.js","954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-fa632c1349770315.js","551","static/chunks/551-19232c47cd1e883a.js","842","static/chunks/842-812b9489b5c7f4d9.js","877","static/chunks/app/%5B...slug%5D/page-9c96bf7312b427f1.js"],""]
f:I[62029,["481","static/chunks/457b8330-b5c9cf3fcf214847.js","954","static/chunks/d3ac728e-0c798b3b8aa3bf53.js","250","static/chunks/250-0ef8476c0fa8ee24.js","612","static/chunks/612-fa632c1349770315.js","551","static/chunks/551-19232c47cd1e883a.js","842","static/chunks/842-812b9489b5c7f4d9.js","877","static/chunks/app/%5B...slug%5D/page-9c96bf7312b427f1.js"],""]
10:T485,qemu-system-x86_64 <span class="token parameter variable">-m</span> <span class="token number">1024</span> <span class="token parameter variable">-hda</span> /path/to/debian-12-nocloud-amd64.qcow2 <span class="token punctuation">\</span>
    <span class="token parameter variable">-virtfs</span> local,path<span class="token operator">=</span>/media/psf/shared,mount_tag<span class="token operator">=</span>shared,security_model<span class="token operator">=</span>none,id<span class="token operator">=</span>shared <span class="token punctuation">\</span>
    <span class="token parameter variable">-device</span> e1000,netdev<span class="token operator">=</span>net0 <span class="token punctuation">\</span>
    <span class="token parameter variable">-netdev</span> user,id<span class="token operator">=</span>net0,hostfwd<span class="token operator">=</span>tcp::2222-:22,hostfwd<span class="token operator">=</span>tcp::1234-:1234,hostfwd<span class="token operator">=</span>tcp::1235-:1235,hostfwd<span class="token operator">=</span>tcp::1236-:1236 <span class="token punctuation">\</span>
    <span class="token parameter variable">-nographic</span>
5:[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"最近有时候会做一些CTF的逆向/二进制利用题目，目前的环境是Ubuntu 22.04.2 ARM64（MacOS上的Parallels Desktop虚拟机），然而大部分题目的可执行文件都是x86_64的，虽然可以利用Rosetta来正常运行x86_64的程序，但是没办法顺利调试。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"由于实在不想在两台电脑上来回切换，所以花了两三天时间找了找解决方案，目前是在我的Ubuntu ARM64系统上用QEMU又套了一个x86_64的虚拟机，用GDB远程调试。在这里记录下配置的全过程～"}}],["$","h2",null,{"className":"x-h1","children":"之前的尝试"}],["$","h3",null,{"className":"x-h2","children":"Windows笔记本 + VMware虚拟机"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"没什么问题，就是感觉搞两台电脑太麻烦了，所以才有了本文..."}}],["$","h3",null,{"className":"x-h2","children":"QEMU user mode + gdb-multiarch"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"首先，这种方式是可以成功调试的，具体步骤为："}}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"1."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">qemu-x86_64 -g 1234 /path/to/binary</code>，这时会在<code class=\"x-inline-highlight\">1234</code>端口上监听，等待GDB连接；"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"2."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"然后新开一个终端，执行：<code class=\"x-inline-highlight\">gdb-multiarch /path/to/binary</code>；"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"3."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"进入GDB后，执行<code class=\"x-inline-highlight\">target remote :1234</code>，就可以调试了。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"（这一步如果使用GDB插件GEF，需要进入GDB后执行<code class=\"x-inline-highlight\">gef-remote --qemu-user --qemu-binary /path/to/binary localhost 1234</code>，参考<a href=\"https://hugsy.github.io/gef/commands/gef-remote/#qemu-mode\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">gef-remote qemu-mode</a>。）"}}]]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"然而QEMU user mode和GDB远程协议交换的信息不全，不足以在本地建立起等价的<code class=\"x-inline-highlight\">/proc/[pid]/maps</code>（参考<a href=\"https://github.com/hugsy/gef/issues/1036#issuecomment-1874354407\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">issue</a>），这会导致一些原生命令如<code class=\"x-inline-highlight\">info proc mappings</code>或者插件命令<code class=\"x-inline-highlight\">vmmap</code>、<code class=\"x-inline-highlight\">search-pattern</code>等无法正常工作。"}}],["$","h2",null,{"className":"x-h1","children":"当前解决"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"所以，最后还是决定用QEMU模拟一个完整的x86_64虚拟机，一方面可以解决GDB调试的问题，另一方面有了完整的x86_64环境，也方便用来做一些其他的事情。"}}],["$","h3",null,{"className":"x-h2","children":"安装QEMU和x86_64系统"}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"1."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">sudo apt install qemu-user qemu-system-x86</code>"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"2."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"接下来选择一个磁盘镜像，我选择的是<code class=\"x-inline-highlight\">debian-12-nocloud-amd64.qcow2</code>，可以直接在<a href=\"https://cdimage.debian.org/images/cloud/bookworm/latest/\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">这里</a>下载，注意选择<code class=\"x-inline-highlight\">nocloud</code>版本，最轻量，默认用户<code class=\"x-inline-highlight\">root</code>，无密码。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"这一步原则上只要是x86_64的系统就行，也可以从<code class=\"x-inline-highlight\">.iso</code>镜像安装，或者选择一些其他的最小化Linux发行版（有的只有几十MB大小）。个人感觉这个Debian镜像站还不错，可以下载<code class=\"x-inline-highlight\">.qcow2</code>文件，QEMU可以免安装运行；并且包含<code class=\"x-inline-highlight\">glibc</code>（Alpine就不包含，不过Alpine镜像更小），和大部分题目的环境一致。"}}]]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"3."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"尝试启动系统：<code class=\"x-inline-highlight\">qemu-system-x86_64 -m 1024 -hda /path/to/debian-12-nocloud-amd64.qcow2 -nographic</code>"}}],["$","div",null,{"className":"x-uli","children":[["$","div",null,{"className":"x-uli-marker","children":["$","div",null,{"className":"x-uli-marker-dot"}]}],["$","div",null,{"className":"x-uli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">-hda</code>：下载的磁盘镜像路径；"}}]}]]}],["$","div",null,{"className":"x-uli","children":[["$","div",null,{"className":"x-uli-marker","children":["$","div",null,{"className":"x-uli-marker-dot"}]}],["$","div",null,{"className":"x-uli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">-nographic</code>：不启动图形界面，直接输出到终端。"}}]}]]}]]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"4."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"登录系统，用户名<code class=\"x-inline-highlight\">root</code>，默认无密码。"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"看到下面的结果就说明成功了～"}}],["$","$Le",null,{"src":"fig1.jpg"}],["$","h3",null,{"className":"x-h2","children":"在x86_64系统上安装gdbserver"}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"1."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">sudo apt update</code>"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"2."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">sudo apt install gdbserver</code>"}}]}]]}],["$","h3",null,{"className":"x-h2","children":"配置共享文件夹和端口转发"}],["$","div",null,{"className":"x-highlightblock highlight-background-golden","children":["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"下面语境中“主机”指的是运行QEMU的Ubuntu 22.04.2 ARM64虚拟机。"}}]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"在这一步，我们让QEMU的x86_64系统和主机之间共享一个目录，可以把题目放在共享文件夹里。（对于我的环境，我可以让MacOS、Ubuntu ARM64虚拟机以及Ubuntu中的QEMU的x86_64系统共享同一个文件夹，共享文件很方便。）"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"同时，目前我使用<code class=\"x-inline-highlight\">user</code>网络模式，QEMU的x86_64系统可以访问互联网，但是外部（包括主机）无法直接访问QEMU的x86_64系统，需要配置端口转发。这一步相当于把QEMU虚拟机的端口<code class=\"x-inline-highlight\">xxxx</code>转发到主机的端口<code class=\"x-inline-highlight\">yyyy</code>，然后主机可以通过<code class=\"x-inline-highlight\">localhost:yyyy</code>来访问对应的服务，这一步很关键，QEMU虚拟机上的SSH和<code class=\"x-inline-highlight\">gdbserver</code>都需要这种方式访问。"}}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"1."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"上述功能通过QEMU启动参数来实现配置："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Lf",null,{"className":"x-codeblock-header-copy","text":"qemu-system-x86_64 -m 1024 -hda /path/to/debian-12-nocloud-amd64.qcow2 \\\n    -virtfs local,path=/media/psf/shared,mount_tag=shared,security_model=none,id=shared \\\n    -device e1000,netdev=net0 \\\n    -netdev user,id=net0,hostfwd=tcp::2222-:22,hostfwd=tcp::1234-:1234,hostfwd=tcp::1235-:1235,hostfwd=tcp::1236-:1236 \\\n    -nographic\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$10"}}]}]]}],["$","div",null,{"className":"x-uli","children":[["$","div",null,{"className":"x-uli-marker","children":["$","div",null,{"className":"x-uli-marker-dot"}]}],["$","div",null,{"className":"x-uli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">-virtfs</code>行：启用虚拟文件系统共享，<code class=\"x-inline-highlight\">/media/psf/shared</code>是主机上的路径，后面的<code class=\"x-inline-highlight\">mount_tag=shared</code>是虚拟机上的挂载点标签，<code class=\"x-inline-highlight\">id=shared</code>是QEMU使用的标识符，可以自定义；"}}]}]]}],["$","div",null,{"className":"x-uli","children":[["$","div",null,{"className":"x-uli-marker","children":["$","div",null,{"className":"x-uli-marker-dot"}]}],["$","div",null,{"className":"x-uli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">-device</code>行：模拟网卡，<code class=\"x-inline-highlight\">net0</code>是标识符，下面有用到；"}}]}]]}],["$","div",null,{"className":"x-uli","children":[["$","div",null,{"className":"x-uli-marker","children":["$","div",null,{"className":"x-uli-marker-dot"}]}],["$","div",null,{"className":"x-uli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">-netdev</code>行：使用<code class=\"x-inline-highlight\">user</code>网络模式，转发了虚拟机上的<code class=\"x-inline-highlight\">22</code>、<code class=\"x-inline-highlight\">1234</code>、<code class=\"x-inline-highlight\">1235</code>、<code class=\"x-inline-highlight\">1236</code>四个端口，注意虚拟机的<code class=\"x-inline-highlight\">22</code>端口被转发到主机的<code class=\"x-inline-highlight\">2222</code>端口，因为主机的<code class=\"x-inline-highlight\">22</code>端口通常已经被占用；另外三个端口留给<code class=\"x-inline-highlight\">gdbserver</code>或其他目的使用，与转发给主机的端口号一致。"}}]}]]}]]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"2."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"关闭QEMU虚拟机，用上述命令再次启动；"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"3."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"还需要在虚拟机中挂载共享目录："}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">cd /mnt</code>"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">mkdir shared</code>"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">mount -t 9p shared /mnt/shared</code>"}}],["$","div",null,{"className":"x-uli","children":[["$","div",null,{"className":"x-uli-marker","children":["$","div",null,{"className":"x-uli-marker-dot"}]}],["$","div",null,{"className":"x-uli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">-t</code>：指定文件系统类型，QEMU的<code class=\"x-inline-highlight\">-virtfs</code>默认使用9P文件系统。"}}]}]]}]]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"到这里，在QEMU虚拟机执行<code class=\"x-inline-highlight\">ls /mnt/shared</code>应当可以看到主机上的共享文件夹的内容。"}}],["$","h3",null,{"className":"x-h2","children":"gdbserver + pwndbg远程调试"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"对比了一下GEF和pwndbg，感觉pwndbg远程调试的命令更简洁一些，并且自带其他架构，不需要安装<code class=\"x-inline-highlight\">gdb-multiarch</code>，所以决定使用pwndbg。"}}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"1."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"在Ubuntu ARM64上安装pwndbg，在<a href=\"https://github.com/pwndbg/pwndbg/releases\" target=\"_blank\" rel=\"noreferrer\" class=\"x-inline-link\">pwndbg/releases</a>中选择<code class=\"x-inline-highlight\">pwndbg_yyyy.mm.dd_arm64.deb</code>下载。"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"2."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">sudo dpkg -i pwndbg_yyyy.mm.dd_arm64.deb</code>"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"接下来在QEMU虚拟机中启动<code class=\"x-inline-highlight\">gdbserver</code>，监听<code class=\"x-inline-highlight\">1234</code>端口，并在主机中连接。"}}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"3."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"QEMU虚拟机终端中执行：<code class=\"x-inline-highlight\">gdbserver :1234 /mnt/shared/binary</code>，这里假设二进制文件<code class=\"x-inline-highlight\">binary</code>已经拷贝到共享目录中。"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"4."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"主机终端中执行：<code class=\"x-inline-highlight\">pwndbg</code>，进入调试界面说明前面安装成功了。"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"5."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"主机pwndbg调试界面执行：<code class=\"x-inline-highlight\">target remote :1234</code>"}}]}]]}],["$","$Le",null,{"src":"fig2.jpg","width":"100%"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"至此就配置成功了！验证一下<code class=\"x-inline-highlight\">vmmap</code>和<code class=\"x-inline-highlight\">search</code>均可以正常使用～"}}],["$","$Le",null,{"src":"fig3.jpg","width":"100%"}],["$","h2",null,{"className":"x-h1","children":"更多配置"}],["$","h3",null,{"className":"x-h2","children":"自动挂载共享目录"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"每次重启QEMU虚拟机都需要手动挂载共享目录比较麻烦，可以在<code class=\"x-inline-highlight\">/etc/fstab</code>中添加一行来实现自动挂载，在QEMU虚拟机中执行："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Bash"}],["$","$Lf",null,{"className":"x-codeblock-header-copy","text":"echo \"shared /mnt/shared 9p trans=virtio,access=any 0 0\" | sudo tee -a /etc/fstab"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"shared /mnt/shared 9p trans=virtio,access=any 0 0\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> <span class=\"token parameter variable\">-a</span> /etc/fstab"}}]}]]}],["$","h3",null,{"className":"x-h2","children":"SSH"}],["$","h4",null,{"className":"x-h3","children":"安装与配置"}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"调试程序不需要SSH，但是建议装一下，便于从主机连接，可以实现远程开发之类的。"}}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"1."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">sudo apt install openssh-server</code>"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"2."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"我使用的<code class=\"x-inline-highlight\">qcow2</code>镜像默认无密码，SSH连接时会提示<code class=\"x-inline-highlight\">Permission denied</code>，需要修改SSH配置文件<code class=\"x-inline-highlight\">sshd_config</code>。"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"在QEMU虚拟机中：<code class=\"x-inline-highlight\">sudo vi /etc/ssh/sshd_config</code>"}}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"找到以下两行："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Plain Text"}],["$","$Lf",null,{"className":"x-codeblock-header-copy","text":"#PermitRootLogin prohibit-password\n...\n#PermitEmptyPasswords no\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"#PermitRootLogin prohibit-password\n...\n#PermitEmptyPasswords no\n"}}]}]]}],["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"修改为："}}],["$","div",null,{"className":"x-codeblock","children":[["$","div",null,{"className":"x-codeblock-header","children":[["$","div",null,{"className":"x-codeblock-header-language","children":"Plain Text"}],["$","$Lf",null,{"className":"x-codeblock-header-copy","text":"PermitRootLogin yes\n...\nPermitEmptyPasswords yes\n"}]]}],["$","pre",null,{"style":{"background":null},"children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"PermitRootLogin yes\n...\nPermitEmptyPasswords yes\n"}}]}]]}]]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"3."}],["$","div",null,{"className":"x-oli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"保存退出后，重启SSH服务：<code class=\"x-inline-highlight\">sudo systemctl restart sshd</code>"}}]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"4."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"在Ubuntu主机中连接：<code class=\"x-inline-highlight\">ssh -p 2222 root@localhost</code>"}}],["$","div",null,{"className":"x-uli","children":[["$","div",null,{"className":"x-uli-marker","children":["$","div",null,{"className":"x-uli-marker-dot"}]}],["$","div",null,{"className":"x-uli-content-wrapper","children":["$","p",null,{"dangerouslySetInnerHTML":{"__html":"<code class=\"x-inline-highlight\">-p</code>：指定端口，前面QEMU启动时已经将虚拟机的<code class=\"x-inline-highlight\">22</code>端口转发到主机的<code class=\"x-inline-highlight\">2222</code>端口，所以这里连接<code class=\"x-inline-highlight\">localhost:2222</code>。"}}]}]]}],["$","$Le",null,{"src":"fig4.jpg"}]]}]]}],["$","div",null,{"className":"x-highlightblock highlight-background-golden","children":["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"下面语境中“主机”指的是MacOS。"}}]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"5."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"如果需要，也可以在MacOS中SSH连接到QEMU虚拟机，我的Ubuntu ARM64 Parallels Desktop虚拟机使用“共享网络”模式，MacOS主机可以访问到Ubuntu虚拟机。在Ubuntu虚拟机中执行<code class=\"x-inline-highlight\">ip addr</code>，查到Ubuntu虚拟机的IP地址："}}],["$","$Le",null,{"src":"fig5.jpg"}]]}]]}],["$","div",null,{"className":"x-oli","children":[["$","div",null,{"className":"x-oli-number","children":"6."}],["$","div",null,{"className":"x-oli-content-wrapper","children":[["$","p",null,{"className":"x-p","dangerouslySetInnerHTML":{"__html":"然后在MacOS主机中SSH连接：<code class=\"x-inline-highlight\">ssh -p 2222 root@10.211.55.3</code>"}}],["$","$Le",null,{"src":"fig6.jpg"}]]}]]}]]
d:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"使用QEMU在ARM64系统上调试x86_64程序 - 铃木的网络日记"}],["$","link","3",{"rel":"canonical","href":"https://1kuzus.github.io/25b/debug-x86_64-program-in-arm64-system/"}]]
1:null
