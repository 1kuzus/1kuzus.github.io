<!DOCTYPE html><html class="light" lang="zh-CN"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="铃木的网络日记" name="description"><meta content="1kuzus" name="author"><script src="https://www.googletagmanager.com/gtag/js?id=G-45BYSZ6WPY" async></script><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-45BYSZ6WPY"),localStorage.getItem("theme")||localStorage.setItem("theme","light"),document.documentElement.setAttribute("class",localStorage.getItem("theme"))</script><title>【计算机网络】协议总结</title><script src="/static/js/main.785689fc.js" defer></script><link href="/static/css/main.83ace1da.css" rel="stylesheet"><link href="https://www.googletagmanager.com" rel="preconnect"><link href="https://busuanzi.ibruce.info" rel="preconnect"><meta content="AymqwRC7u88Y4JPvfIF2F37QKylC04248hLCdJAsh8xgOfe/dVJPV3XS3wLFca1ZMVOtnBfVjaCMTVudWM//5g4AAAB7eyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjk1MTY3OTk5LCJpc1RoaXJkUGFydHkiOnRydWV9" http-equiv="origin-trial"><link href="http://busuanzi.ibruce.info" rel="preconnect"></head><body><div id="root"><div class="" id="header"><div id="header-left-wrapper"><div id="header-logo-bg"><svg height="36px" viewBox="0 0 1560 1560" width="36px" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"><path d="M644 97h272.529L1189 780H916.471z" fill="#00A8C4"></path><path d="M98 97h272.84L780 1120.73 1189.162 97H1462L916.438 1462H643.562z" fill="#30303C"></path><path d="M98 1462L643.3 97H916L370.7 1462z" fill="#00F8FF"></path></g></svg></div><div id="header-archive"><h3 id="header-archive-text">归档</h3><div class="header-archive-rightarrow"><svg height="16px" viewBox="0 0 1024 1024" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M761.056 532.128c.512-.992 1.344-1.824 1.792-2.848 8.8-18.304 5.92-40.704-9.664-55.424L399.936 139.744c-19.264-18.208-49.632-17.344-67.872 1.888-18.208 19.264-17.376 49.632 1.888 67.872l316.96 299.84L335.2 813.632c-19.072 18.4-19.648 48.768-1.248 67.872 9.408 9.792 21.984 14.688 34.56 14.688 12 0 24-4.48 33.312-13.44l350.048-337.376c.672-.672.928-1.6 1.6-2.304.512-.48 1.056-.832 1.568-1.344 2.72-2.848 4.16-6.336 6.016-9.6z" fill="#50505c"></path></svg></div></div></div><div id="header-right-wrapper"><div id="header-theme-bg"><svg height="20px" viewBox="0 0 1024 1024" width="20px" xmlns="http://www.w3.org/2000/svg"><path d="M512 61.44c13.312 0 25.252 7.639 29.942 19.17l27.566 67.972c11.92 29.348-4.178 62.075-35.943 73.094A65.946 65.946 0 01512 225.28c-33.935 0-61.44-25.416-61.44-56.77 0-6.8 1.331-13.558 3.912-19.928l27.586-67.973C486.728 69.08 498.647 61.44 512 61.44zm0 901.12c-13.332 0-25.272-7.639-29.942-19.17l-27.586-67.972a52.961 52.961 0 01-3.912-19.927c0-31.335 27.505-56.771 61.44-56.771a66.28 66.28 0 0121.565 3.604c31.765 11.019 47.862 43.746 35.943 73.114l-27.566 67.953c-4.69 11.53-16.63 19.169-29.942 19.169zM962.56 512c0 13.312-7.639 25.252-19.17 29.942l-67.972 27.566c-29.348 11.92-62.075-4.178-73.094-35.943A65.946 65.946 0 01798.72 512c0-33.935 25.416-61.44 56.77-61.44 6.8 0 13.558 1.331 19.928 3.912l67.973 27.586c11.53 4.67 19.169 16.589 19.169 29.942zm-901.12 0c0-13.332 7.639-25.272 19.17-29.942l67.972-27.586a52.9 52.9 0 0119.927-3.912c31.335 0 56.771 27.505 56.771 61.44a66.28 66.28 0 01-3.604 21.565c-11.019 31.765-43.746 47.862-73.114 35.943l-67.953-27.566C69.08 537.252 61.44 525.312 61.44 512zm131.953-318.587c9.42-9.42 23.265-12.452 34.734-7.618l67.563 28.549c29.184 12.35 40.94 46.858 26.256 77.107a65.946 65.946 0 01-12.698 17.817c-23.982 23.983-61.399 25.457-83.558 3.277a52.961 52.961 0 01-11.346-16.855l-28.55-67.543c-4.853-11.469-1.822-25.313 7.599-34.734zm637.194 637.194c-9.42 9.421-23.265 12.452-34.734 7.598l-67.543-28.549a52.961 52.961 0 01-16.876-11.325c-22.16-22.18-20.685-59.597 3.298-83.579a65.946 65.946 0 0117.817-12.698c30.25-14.684 64.758-2.928 77.107 26.256l28.55 67.563c4.833 11.47 1.802 25.293-7.62 34.734zm0-637.214c9.42 9.42 12.452 23.265 7.618 34.734l-28.549 67.563c-12.35 29.184-46.858 40.94-77.107 26.256a65.946 65.946 0 01-17.817-12.698c-23.983-23.982-25.457-61.399-3.277-83.558 4.792-4.834 10.506-8.663 16.855-11.346l67.543-28.55c11.469-4.853 25.313-1.822 34.734 7.599zM193.393 830.587c-9.421-9.42-12.452-23.265-7.598-34.734l28.549-67.543a52.618 52.618 0 0111.325-16.876c22.18-22.16 59.597-20.685 83.579 3.298a65.842 65.842 0 0112.698 17.817c14.684 30.25 2.928 64.758-26.256 77.107l-67.563 28.55c-11.47 4.833-25.293 1.802-34.734-7.62zM512 737.28c-124.416 0-225.28-100.864-225.28-225.28S387.584 286.72 512 286.72 737.28 387.584 737.28 512 636.416 737.28 512 737.28z" fill="#FCFCFC"></path></svg></div><a href="https://github.com/1kuzus/1kuzus.github.io" rel="noreferrer" target="_blank"><div id="header-github-bg"><svg height="36px" viewBox="0 0 1024 1024" width="36px" xmlns="http://www.w3.org/2000/svg"><path d="M411.306667 831.146667c3.413333-5.12 6.826667-10.24 6.826666-11.946667v-69.973333c-105.813333 22.186667-128-44.373333-128-44.373334-17.066667-44.373333-42.666667-56.32-42.666666-56.32-34.133333-23.893333 3.413333-23.893333 3.413333-23.893333 37.546667 3.413333 58.026667 39.253333 58.026667 39.253333 34.133333 58.026667 88.746667 40.96 110.933333 32.426667 3.413333-23.893333 13.653333-40.96 23.893333-51.2-85.333333-10.24-174.08-42.666667-174.08-187.733333 0-40.96 15.36-75.093333 39.253334-102.4-3.413333-10.24-17.066667-47.786667 3.413333-100.693334 0 0 32.426667-10.24 104.106667 39.253334 30.72-8.533333 63.146667-11.946667 95.573333-11.946667 32.426667 0 64.853333 5.12 95.573333 11.946667 73.386667-49.493333 104.106667-39.253333 104.106667-39.253334 20.48 52.906667 8.533333 90.453333 3.413333 100.693334 23.893333 27.306667 39.253333 59.733333 39.253334 102.4 0 145.066667-88.746667 177.493333-174.08 187.733333 13.653333 11.946667 25.6 34.133333 25.6 69.973333v104.106667c0 3.413333 1.706667 6.826667 6.826666 11.946667 5.12 6.826667 3.413333 18.773333-3.413333 23.893333-3.413333 1.706667-6.826667 3.413333-10.24 3.413333h-174.08c-10.24 0-17.066667-6.826667-17.066667-17.066666 0-5.12 1.706667-8.533333 3.413334-10.24z" fill="#FCFCFC"></path></svg></div></a></div></div><div id="blog-layout"><div id="main"><h1 class="x-title">【计算机网络】协议总结</h1><div class="x-highlightblock highlight-background-golden"><p class="x-p">文中各层出现的协议参考教程的教学顺序，不代表对协议所属层次的划分。</p></div><h2 class="x-h1">链路层</h2><h3 class="x-h2">可靠传输</h3><p class="x-p">在链路层传输中，可能出现的错误包括数据位出错、分组丢失、分组失序、分组重复等。可靠传输服务希望实现发送端发送什么，接收端就接收到什么。虽然下面将在链路层这一章节中介绍SW、GBN、SR三种协议，但要明确的是，可靠传输服务并不仅仅局限于链路层，其他各层均可选择实现可靠传输。</p><h3 class="x-h2">停等协议 - SW</h3><p class="x-p"><span class="x-inline-strong">停等协议</span><code class="x-inline-highlight">(Stop and Wait, SW)</code>的发送方每发送一帧数据就停止，并等待接收方发送确认帧，收到确认后再发送下一帧。</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/sw.6c99883b5301d8cc7c4d.png" width="100%"></div><h4 class="x-h3">确认与否认、超时重传</h4><p class="x-p">发送方发送数据后等待接收方<code class="x-inline-highlight">ACK</code>或<code class="x-inline-highlight">NAK</code>的响应，并启动超时计时器，如果一定时间收不到响应则启动超时重传。</p><h4 class="x-h3">确认丢失</h4><p class="x-p">如果确认分组丢失，接收方需要能感知到数据分组是否重复，因此数据分组需要编号，在停等协议中，由于每发送一个数据就进行等待，因此使用一位编号就够了。</p><h4 class="x-h3">确认迟到</h4><p class="x-p">如果确认分组迟到，在图示情况中，发送方需要感知到第二个<code class="x-inline-highlight">ACK</code>是对第二个<code class="x-inline-highlight">DATA 0</code>的重复确认，而不是对<code class="x-inline-highlight">DATA 1</code>的确认。因此确认分组也需要使用一位编号。</p><h3 class="x-h2">回退N帧协议 - GBN</h3><p class="x-p"><span class="x-inline-strong">回退N帧协议</span><code class="x-inline-highlight">(Go Back N, GBN)</code>允许发送方连续发送多个帧（即发送窗口可以大于<code class="x-inline-highlight">1</code>），以解决停等协议信道利用率低的问题。</p><p class="x-p">发送方可在未收到接收方确认分组的情况下，将序号落在发送窗口内的多个数据分组全部发送出去；但接收方的接收窗口大小仅为<code class="x-inline-highlight">1</code>，也就是只有接收到了此窗口所代表的序号的分组，接收方才会回复<code class="x-inline-highlight">ACK</code>并且移动接收窗口。同理，发送方收到了发送窗口中最早的那个序号对应分组的<code class="x-inline-highlight">ACK</code>，才会移动发送窗口。</p><h4 class="x-h3">累计确认</h4><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/gbn1.57fb5726e2cb5ac8bb39.png" width="100%"></div><p class="x-p">接收方不一定要对收到的数据逐个确认，也可以对最后一个分组进行确认。<code class="x-inline-highlight">ACK n</code>表示序号为<code class="x-inline-highlight">n</code>及其之前的分组都已经被正确接收。称这种方法为累计确认。例如图中，接收方只对<code class="x-inline-highlight">1</code>号、<code class="x-inline-highlight">4</code>号数据分组进行确认，并且<code class="x-inline-highlight">ACK 1</code>在传输过程中丢失，发送方仍然可以根据收到的<code class="x-inline-highlight">ACK 4</code>判断<code class="x-inline-highlight">0</code>~<code class="x-inline-highlight">4</code>号分组都已经被正确接收。</p><h4 class="x-h3">有差错情况</h4><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/gbn2.8cfedf7f71174edbda04.png" width="100%"></div><p class="x-p">例如发送方发送了<code class="x-inline-highlight">5</code>/<code class="x-inline-highlight">6</code>/<code class="x-inline-highlight">7</code>/<code class="x-inline-highlight">0</code>/<code class="x-inline-highlight">1</code>五个分组，但<code class="x-inline-highlight">5</code>号数据分组丢失，此时由于到达的四个分组都与接收窗口序号不匹配，接收方会将其丢弃，并重复响应<code class="x-inline-highlight">ACK 4</code>。</p><h3 class="x-h2">选择重传协议 - SR</h3><p class="x-p"><span class="x-inline-strong">选择重传协议</span><code class="x-inline-highlight">(Selective Repeat, SR)</code>加大接收窗口的长度（即接收窗口也可以大于<code class="x-inline-highlight">1</code>），缓存乱序到达的帧，这样不至于在一些情况下需要重传所有未被确认的帧从而导致效率降低。</p><p class="x-p">与GBN一样，发送方可在未收到接收方确认分组的情况下，将序号落在发送窗口内的多个数据分组全部发送出去；接收方可接收未按序到达但没有误码并且序号落在接收窗口内的数据分组；发送方收到未按序到达的确认分组时，对其进行记录，以防止其相应数据分组的超时重发，但发送窗口不能向前滑动。为了使发送方仅重传出现差错的分组，接收方不再采用累积确认，而是对每个正确接收的数据分组进行<span class="x-inline-strong">逐一确认</span>。</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/sr1.2efe6e39f8e3e0f148ee.png" width="100%"></div><p class="x-p">例如发送方发送了<code class="x-inline-highlight">0</code>/<code class="x-inline-highlight">1</code>/<code class="x-inline-highlight">2</code>/<code class="x-inline-highlight">3</code>四个分组，但<code class="x-inline-highlight">2</code>号数据分组丢失，此时<code class="x-inline-highlight">0</code>号、<code class="x-inline-highlight">1</code>号按序到达，接收窗口可以向前移动；而<code class="x-inline-highlight">3</code>号分组可以被接收，但接收窗口不能移动。</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/sr2.4190b2c480f396453a98.png" width="100%"></div><p class="x-p">返回的<code class="x-inline-highlight">ACK</code>到达发送方之后，发送方可以把发送窗口的起点移动到<code class="x-inline-highlight">2</code>号，同时记录<code class="x-inline-highlight">3</code>号分组已接收。移动发送窗口后，可以把新纳入窗口的<code class="x-inline-highlight">4</code>号、<code class="x-inline-highlight">5</code>号发送出去。</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/sr3.d71ca9d66d5a43ca166b.png" width="100%"></div><p class="x-p">如果<code class="x-inline-highlight">4</code>号、<code class="x-inline-highlight">5</code>号可以被正常接收，并且返回的<code class="x-inline-highlight">ACK 4</code>、<code class="x-inline-highlight">ACK 5</code>可以正确到达发送方，那么最后会使得发送窗口和接收窗口都卡在<code class="x-inline-highlight">2</code>的位置，并最终触发<code class="x-inline-highlight">2</code>号分组超时重传。</p><div class="x-highlightblock highlight-background-golden"><h4 class="x-h3">GBN和SR的重传计时器</h4><p class="x-p">在GBN中一个连接只会设置一个定时器，也就是说发生超时时，GBN会重发所有已发送但未被确认过的分组；<br>而在SR中会为每个分组设置定时器。</p></div><h3 class="x-h2">媒体接入控制</h3><p class="x-p">共享信道要着重考虑的一个问题就是如何协调多个发送和接收站点对一个共享传输媒体的占用，即<span class="x-inline-strong">媒体接入控制</span><code class="x-inline-highlight">(Medium Access Control, MAC)</code>。</p><table class="x-table"><tbody><tr><th rowspan="4">静态划分信道</th><td colspan="2">时分多路复用</td></tr><tr><td colspan="2">频分多路复用</td></tr><tr><td colspan="2">波分多路复用</td></tr><tr><td colspan="2">码分多路复用</td></tr><tr><th rowspan="5">动态接入控制</th><th>轮询访问</th><td>令牌传递</td></tr><tr><th rowspan="4">随机访问</th><td>ALOHA</td></tr><tr><td>CSMA</td></tr><tr><td>CSMA/CD</td></tr><tr><td>CSMA/CA</td></tr></tbody></table><h3 class="x-h2">载波监听多路访问 - CSMA</h3><p class="x-p"><span class="x-inline-strong">载波监听多路访问</span><code class="x-inline-highlight">(Carrier Sense Multiple Access, CSMA)</code>的思想是在发送帧之前监听信道。其原理是：当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会互相叠加而增大。当一个站检测到的信号电压摆动值超过一定门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。</p><h4 class="x-h3">非坚持CSMA</h4><p class="x-p">非坚持指的是对于监听信道忙之后就不继续监听。<br>当主机要发送数据并对信道进行监听时，发现信道空闲则可直接传输；忙则等待一个随机的时间之后再进行监听。<br>这样的缺点是可能存在各主机都在延迟等待过程中，使得信道处于空闲状态但无人发送数据，媒体使用率降低。</p><h4 class="x-h3">1-坚持CSMA</h4><p class="x-p">当主机要发送数据并对信道进行监听时，发现信道空闲则可直接传输；忙则一直保持监听，直到空闲马上传输。<br>这样的缺点是假如有两个或两个以上的站点有数据要发送，冲突就不可避免。</p><h4 class="x-h3">p-坚持CSMA</h4><p class="x-p">当主机要发送数据并对信道进行监听时，发现信道空闲则以<code class="x-inline-highlight">p</code>概率直接传输；忙则一直保持监听，直到空闲再以<code class="x-inline-highlight">p</code>概率传输。对于空闲时其余的<code class="x-inline-highlight">1-p</code>概率，则会等到下一个时间槽重复上述规则。</p><h3 class="x-h2">碰撞检测 - CSMA/CD</h3><p class="x-p">上述的三种CSMA发生冲突后，仍然会坚持把数据帧发完，这时接收方收到叠加在一起的有碰撞数据会响应否认<code class="x-inline-highlight">NAK</code>或者不响应等待发送方重发，这是一种被动的方式。<span class="x-inline-strong">碰撞检测</span><code class="x-inline-highlight">(Collision Detection, CD)</code>就是边发送数据边检测信道上信号电压的变化情况，来判断是否有其他主机也在发送数据。如果发现碰撞则立刻主动终止发送。</p><h4 class="x-h3">强化碰撞</h4><p class="x-p">以太网的强化碰撞：当发送帧的站点检测到碰撞，除了立即停止发送帧外，还要再继续发送<code class="x-inline-highlight">48</code>位的人为干扰信号，以便有足够多的碰撞信号使所有站点都能检测出碰撞。</p><h4 class="x-h3">争用期</h4><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/csma1.2a11daa6d5a2b4dea4fe.png" width="100%"></div><p class="x-p">图中<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.1132em">τ</span></span></span></span>是单程传播时延，<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal" style="margin-right:.03785em">δ</span></span></span></span>并没有很强的物理含义，我们只是假设主机D发送数据后经过<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal" style="margin-right:.03785em">δ</span></span></span></span>时间检测到A的信号。这张图的重点是，在<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal" style="margin-right:.03785em">δ</span></span></span></span>趋近于0的情况下，A最长需要<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:.1132em">τ</span></span></span></span>的时间检测到碰撞。我们把<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:.1132em">τ</span></span></span></span>称作<span class="x-inline-strong">争用期</span><code class="x-inline-highlight">(Contention Period)</code>，它的意义是只要经过<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:.1132em">τ</span></span></span></span>时间还没有检测到碰撞，就能肯定这次发送不会发生碰撞。</p><h4 class="x-h3">截断二进制指数规避算法</h4><p class="x-p">第<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6151em"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span>次重传的退避时间为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7278em;vertical-align:-.0833em"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:.1132em">τ</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span></span></span></span>，r为从集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.138em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="minner">…</span><span class="mspace" style="margin-right:.1667em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.888em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">i</span><span class="mtight">n</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mtight">10</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mclose">}</span></span></span></span>中随机选出的数。当重传达<code class="x-inline-highlight">16</code>次仍不能成功时，则丢弃该帧，并向上层报告。</p><h4 class="x-h3">最小/最大帧长的由来</h4><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="data:image/png;base64,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" width="600"></div><p class="x-p">如果一个帧的长度太小，可能一个站点还没来得及检测到其发送的帧产生了碰撞，就已经将这个帧发送完毕了。帧的传输时间要大于争用期。对于<code class="x-inline-highlight">10 Mb/s</code>以太网，帧的最小长度为<code class="x-inline-highlight">64</code>字节。减去帧头和帧尾，数据部分至少应为<code class="x-inline-highlight">46</code>字节。</p><p class="x-p">如果一个帧的长度过大，一个站点不停地发送帧，其他站点就一直无法无法使用信道；如果帧的长度过大，接收方的缓冲区也可能产生溢出。以太网规定数据部分最长为<code class="x-inline-highlight">1500</code>字节，加上帧头和帧尾，帧的最大长度为<code class="x-inline-highlight">1518</code>字节。</p><h3 class="x-h2">碰撞避免 - CSMA/CA</h3><p class="x-p">在无线局域网中可能会出现隐蔽站的问题，使用碰撞检测意义不大。不同于以太网，802.11标准使用<span class="x-inline-strong">碰撞避免</span><code class="x-inline-highlight">(Collision Avoidance, CA)</code>而不是碰撞检测。</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/csma3.fa0bc36fa6c06e11198f.png" width="600"></div><h4 class="x-h3">使用确认帧</h4><p class="x-p">CSMA、CSMA/CD都没有使用确认帧机制。但因为无线信道的通信质量远不如有线信道，因此CSMA/CA要求接收方收到数据帧后响应<code class="x-inline-highlight">ACK</code>，发送方收到<code class="x-inline-highlight">ACK</code>就可以进行下一个数据帧的发送。</p><h4 class="x-h3">预约信道</h4><p class="x-p">802.11标准允许发送站对信道进行预约。<br>检测到信道空闲时，源站先发送<span class="x-inline-strong">请求发送</span><code class="x-inline-highlight">(Request To Send, RTS)</code>，包括源地址、目的地址和这次通信所需的时间；<br>若目的站收到源站发来的<code class="x-inline-highlight">RTS</code>帧且媒体空闲，就响应<span class="x-inline-strong">允许发送</span><code class="x-inline-highlight">(Clear To Send, CTS)</code>它也包括这次通信所需的时间（从<code class="x-inline-highlight">RTS</code>复制）。<code class="x-inline-highlight">CTS</code>帧可以被目的站范围内所有站点收到，其作用有两点：给源站明确的发送许可，同时指示其他站在预约期内不要发送。</p><h2 class="x-h1">网络层</h2><h3 class="x-h2">自治系统、IGP和EGP</h3><p class="x-p"><span class="x-inline-strong">自治系统</span><code class="x-inline-highlight">(Autonomous System, AS)</code>通常由一组处在相同管理控制下的路由器组成。通常，一个<span class="x-inline-strong">互联网服务提供商</span><code class="x-inline-highlight">(Internet Service Provider, ISP)</code>中的路由器以及连接它们的链路构成一个AS。不过某些ISP会将它们的网络划分为多个AS。一个自治系统将会分配一个唯一的<span class="x-inline-strong">自治系统号</span><code class="x-inline-highlight">(ASN)</code>。</p><p class="x-p">自治系统可以被理解为互联网中的小型网络单位。由此产生了<span class="x-inline-strong">自治系统内部路由选择协议</span><code class="x-inline-highlight">(intra-AS routing protocol)</code>和<span class="x-inline-strong">自治系统间路由选择协议</span><code class="x-inline-highlight">(inter-AS routing protocol)</code>。有时也会把这两个概念称作<span class="x-inline-strong">内部网关协议</span><code class="x-inline-highlight">(Interior Gateway Protocol, IGP)</code>和<span class="x-inline-strong">外部网关协议</span><code class="x-inline-highlight">(Exterior Gateway Protocol, EGP)</code>。</p><p class="x-p">IGP和EGP并不指代某个具体的协议，而是代表一个类别。下面会讨论如下三个协议：</p><table class="x-table"><tbody><tr><th>分类</th><th>名称</th></tr><tr><td rowspan="2">IGP</td><td><p class="x-p"><span class="x-inline-strong">路由信息协议</span><code class="x-inline-highlight">(Routing Information Protocol, RIP)</code></p></td></tr><tr><td><p class="x-p"><span class="x-inline-strong">开放最短路径优先</span><code class="x-inline-highlight">(Open Shortest Path First, OSPF)</code></p></td></tr><tr><td>EGP</td><td><p class="x-p"><span class="x-inline-strong">边界网关协议</span><code class="x-inline-highlight">(Border Gateway Protocol, BGP)</code></p></td></tr></tbody></table><h3 class="x-h2">路由信息协议 - RIP</h3><p class="x-p"><span class="x-inline-strong">路由信息协议</span><code class="x-inline-highlight">(Routing Information Protocol, RIP)</code>是基于<code class="x-inline-highlight">距离矢量法</code>的，较为简单，适用于小网络。<br>RIP协议要求网络中每一个路由器都维护从自己到每个其他目的网络的距离，这个距离用<span class="x-inline-strong">跳数</span>来衡量，每经过一个路由器跳数+1。<br>RIP协议允许一条路最多包含<code class="x-inline-highlight">15</code>个路由器，即跳数最多为<code class="x-inline-highlight">15</code>，超过则表示不可达。<br>RIP协议只和<span class="x-inline-strong">相邻路由器</span>交换信息，交换的信息是<span class="x-inline-strong">自己的路由表</span>。</p><h4 class="x-h3">RIP协议路由更新规则</h4><p class="x-p no-margin-bottom">路由表中包含<span class="x-inline-strong">目的网络</span>、<span class="x-inline-strong">到目的网络的距离</span>、<span class="x-inline-strong">下一跳路由器</span>。对于每个路由器，路由表更新规则为：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">对于接收到的新表的每一项，若原表没有这项对应的目标网络，则添加到自己的路由表中；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">若有，且原表项的下一跳路由器就是发来更新信息的路由器，则用新表项替换原表项，但距离要+1，且下一跳路由器应修改为自己；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">若有，且原表项的下一跳路由器不是发来更新信息的路由器，那么比较<code class="x-inline-highlight">原表项的距离</code>和<code class="x-inline-highlight">新表项的距离+1</code>，选择较小的。<br>同上一条，填入新表项时距离要+1，下一跳路由器应修改为自己。</p></div></div><p class="x-p with-margin-top">考虑一个例子：</p><div class="x-highlightblock highlight-background-gray"><p class="x-p">R6和R4是两个相邻路由器，现在R6收到R4发来的更新信息，试更新R6的路由表。</p><div class="x-divider"></div><div class="x-flexrow" style="gap:32px 32px"><div><p class="x-p no-margin-bottom">R6的路由表</p><table class="x-table"><tbody><tr><th>目的网络</th><th>距离</th><th>下一跳路由器</th></tr><tr><td>Net1</td><td>-</td><td>-</td></tr><tr><td>Net2</td><td>3</td><td>R4</td></tr><tr><td>Net3</td><td>4</td><td>R5</td></tr></tbody></table></div><div><p class="x-p no-margin-bottom">R4发给R6的路由表（更新信息）</p><table class="x-table"><tbody><tr><th>目的网络</th><th>距离</th><th>下一跳路由器</th></tr><tr><td>Net1</td><td>7</td><td>R1</td></tr><tr><td>Net2</td><td>4</td><td>R2</td></tr><tr><td>Net3</td><td>1</td><td>直接交付</td></tr></tbody></table></div></div><div class="x-br"></div><p class="x-p">解：<br>对于Net1，原表中没有，填入新表项，距离改为<code class="x-inline-highlight">7+1=8</code>；<br>对于Net2，原表中有，并且原表项下一跳路由器也是R4，因此填入新表项，但距离改为<code class="x-inline-highlight">5</code>，下一跳路由器改为R4；<br>对于Net3，原表中有，但下一跳路由器不是R4；此时比较<code class="x-inline-highlight">4</code>和<code class="x-inline-highlight">1+1</code>，选择较小的新表项，同理下一跳路由器应改为R4。<br>最终结果为：</p><p class="x-p no-margin-bottom">更新后R6的路由表</p><table class="x-table"><tbody><tr><th>目的网络</th><th>距离</th><th>下一跳路由器</th></tr><tr><td>Net1</td><td>8</td><td>R4</td></tr><tr><td>Net2</td><td>5</td><td>R4</td></tr><tr><td>Net3</td><td>2</td><td>R4</td></tr></tbody></table></div><h3 class="x-h2">开放最短路径优先 - OSPF</h3><p class="x-p"><span class="x-inline-strong">开放最短路径优先</span><code class="x-inline-highlight">(Open Shortest Path First, OSPF)</code>是基于<code class="x-inline-highlight">链路状态法</code>的，较为复杂，适用于大网络。<br>每个路由器使用洪泛法向区域中的所有路由器发送信息，因此最终整个区域内所有路由器都得到了区域完整的图结构。然后每台路由器在本地运行<code class="x-inline-highlight">Dijkstra</code>最短路径算法，确定一个以自身为根节点到所有子网的最短路径树。</p><h4 class="x-h3">在单个自治系统中再划分层次结构</h4><p class="x-p">为了应用于规模很大的网络，OSPF协议可以将一个自治系统再划分为若干更小的<span class="x-inline-strong">区域</span>。在每个区域内，一台或多台区域边界路由器负责为流向该区域以外的分组提供路由选择。在AS中只有一个区域被配置成主干区域。主干区域的主要作用是为该AS中其他区域之间的流量提供路由选择。该主干总是包含本AS中的所有区域边界路由器、但也可能包含非边界路由器。在AS中的区域间的路由选择要求分组先路由到一个区域边界路由器（区域内路由选择），然后通过主干路由到位于目的区域的区域边界路由器进而再路由到最终目的地。</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/ospf.d218372b839f85c2a948.png" width="600"></div><h4 class="x-h3">OSPF 相较于 RIP 的优点</h4><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">安全：使用鉴别，仅有受信任的路由器能参于OSPF协议，可防止恶意入侵者将不正确的信息注入路由器表内。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">允许多条相同开销的路径：当存在多条相等开销的路径时，无须仅选择单一的路径来承载所有的流量。（RIP协议只允许一条）</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">对单播与多播路由选择的综合支持：<span class="x-inline-strong">多播OSPF</span><code class="x-inline-highlight">(MOSPF)</code>提供对OSPF的简单扩展，以便提供多播路由选择。MOSPF使用现有的OSPF链路数据库，并为现有的OSPF链路状态广播机制增加了一种新型的链路状态通告。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">支持在单个AS中的层次结构。</p></div></div><h3 class="x-h2">边界网关协议 - BGP</h3><p class="x-p"><span class="x-inline-strong">边界网关协议</span><code class="x-inline-highlight">(Border Gateway Protocol, BGP)</code>在这里只做简单的概念性介绍。</p><div class="x-flexrow"><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/bgp1.fa13363163d372089df8.png" width="400"></div><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/bgp2.08659e65fd0c2fc90eb4.png" width="400"></div></div><p class="x-p">在不同自治系统内，度量路由的代价可能不同；自治系统之间的路由选择也需要考虑相关的政治、经济、安全因素。BGP只希望选择一条可达，无环路，且相对较优的路由。</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/bgp3.5ed0ee7800740ebd007e.png" width="600"></div><p class="x-p">在配置BGP时，每个AS需要选择至少一个路由器作为<span class="x-inline-strong">BGP发言人</span>，不同自治系统的BGP发言人要通过TCP连接交换路由信息。当BGP发言人互相交换了网络可达性信息后，各BGP发言人就根据自己的策略选择出到达各自治系统的较好的路由，也就是构造出树形结构、不存在回路的连通图。</p><div class="x-highlightblock highlight-background-red"><p class="x-p">关于协议所属层次的划分：<br>RIP基于UDP，BGP基于TCP，归类到应用层协议比较合理；<br>OSPF基于IP，归类到传输层协议比较合理；<br>只不过，它们计算出的路径都服务于网络层，因此按照课程目录划在了网络层下。</p></div><h3 class="x-h2">IPv4编址</h3><p class="x-p"><span class="x-inline-strong">网际协议</span><code class="x-inline-highlight">(Internet Protocol, IP)</code>现在有两个常用的版本，IPv4和IPv6。<br>每个IPv4地址长度为<code class="x-inline-highlight">32</code>位，等价为<code class="x-inline-highlight">4</code>字节，大约有<code class="x-inline-highlight">40</code>亿个可能的地址。地址通常用点分十进制记法表示，例如<code class="x-inline-highlight">192.32.216.9</code>。</p><h4 class="x-h3">粗略的分类</h4><p class="x-p">IPv4地址有诸多分类，且其中有很多特殊地址、保留地址，因此先从最普遍的地址分类入手，再逐渐深入介绍特殊的IPv4地址。<br>IPv4地址可以看作由两部分组成：网络号和主机号。根据网络号和主机号分为A、B、C三类，同时还有特殊的D、E两类。</p><table class="x-table"><tbody><tr><th>分类</th><th>网络号</th><th>主机号</th><th>前8位十进制范围</th><th>特殊说明</th></tr><tr><td>A</td><td><p class="x-p">前<code class="x-inline-highlight">8</code>位</p></td><td><p class="x-p">后<code class="x-inline-highlight">32</code>位</p></td><td><p class="x-p"><code class="x-inline-highlight">0</code>~<code class="x-inline-highlight">127</code></p></td><td>-</td></tr><tr><td>B</td><td><p class="x-p">前<code class="x-inline-highlight">16</code>位</p></td><td><p class="x-p">后<code class="x-inline-highlight">16</code>位</p></td><td><p class="x-p"><code class="x-inline-highlight">128</code>~<code class="x-inline-highlight">191</code></p></td><td>-</td></tr><tr><td>C</td><td><p class="x-p">前<code class="x-inline-highlight">8</code>位</p></td><td><p class="x-p">后<code class="x-inline-highlight">32</code>位</p></td><td><p class="x-p"><code class="x-inline-highlight">192</code>~<code class="x-inline-highlight">223</code></p></td><td>-</td></tr><tr><td>D</td><td colspan="2">不区分</td><td><p class="x-p"><code class="x-inline-highlight">224</code>~<code class="x-inline-highlight">239</code></p></td><td>D类IPv4地址不区分网络号与主机号，作多播地址用，不做介绍</td></tr><tr><td>E</td><td colspan="2">不区分</td><td><p class="x-p"><code class="x-inline-highlight">240</code>~<code class="x-inline-highlight">255</code></p></td><td><p class="x-p">E类IPv4地址不区分网络号与主机号，<br>仅保留为搜索、Internet的实验和开发用，不做介绍</p></td></tr></tbody></table><h4 class="x-h3">特殊地址</h4><p class="x-p">上述分类中，各分类的范围中，都有很少一部分的地址有特殊的含义：</p><table class="x-table"><tbody><tr><th width="100">网络号</th><th>主机号</th><th width="120">是否可作为源地址</th><th width="120">是否可作为目的地址</th><th>描述</th></tr><tr><td><p class="x-p">全<code class="x-inline-highlight">0</code></p></td><td><p class="x-p">全<code class="x-inline-highlight">0</code></p></td><td>是</td><td>否</td><td><p class="x-p"><code class="x-inline-highlight">0.0.0.0</code>严格来说不是一个真正意义上的ip地址，它在本网范围内表示主机，也被用于一些协议的默认参数。</p></td></tr><tr><td><p class="x-p">全<code class="x-inline-highlight">0</code></p></td><td>某特定值</td><td>是</td><td>否</td><td><p class="x-p">本网内某特定主机，相当于把本应是本网的网络号填作了<code class="x-inline-highlight">0</code>。</p></td></tr><tr><td>某特定值</td><td><p class="x-p">全<code class="x-inline-highlight">0</code></p></td><td>否</td><td>否</td><td><p class="x-p">代表一个网段。</p></td></tr><tr><td>某特定值</td><td><p class="x-p">全<code class="x-inline-highlight">1</code></p></td><td>否</td><td>是</td><td>直接广播地址，对特定网络上的所有主机进行广播。</td></tr><tr><td><p class="x-p">全<code class="x-inline-highlight">1</code></p></td><td><p class="x-p">全<code class="x-inline-highlight">1</code></p></td><td>否</td><td>是</td><td><p class="x-p"><code class="x-inline-highlight">255.255.255.255</code>表示本网广播地址</p></td></tr><tr><td><p class="x-p"><code class="x-inline-highlight">127</code></p></td><td><p class="x-p"><code class="x-inline-highlight">0.0.1</code>~<code class="x-inline-highlight">255.255.254</code></p></td><td>是</td><td>是</td><td>回环地址，用于本地回环测试。</td></tr></tbody></table><h4 class="x-h3">私有地址</h4><p class="x-p">提到IP地址，第一反应可能就是<code class="x-inline-highlight">192.168.0.1</code>这串数字了！又或许你打开<code class="x-inline-highlight">cmd</code>窗口输入<code class="x-inline-highlight">ipconfig</code>，然后发现你的设备IP地址是<code class="x-inline-highlight">192.168.137.1</code>。这个问题可能让人感到困扰：一方面，课本上说IP地址是互联网上唯一的；另一方面，似乎无论你处在哪个移动或有线网络下，你的设备IP总是长成<code class="x-inline-highlight">192.168.x.x</code>的样子，这似乎根本无法保证唯一性。这个问题涉及到<span class="x-inline-strong">私有地址</span>。</p><p class="x-p">除了特殊IP地址，还有一部分地址作为私有地址；这些地址不能用于在互联网上标识一个主机，只适用于在内部网络中使用。它们是：</p><table class="x-table"><tbody><tr><th>分类</th><th>地址范围</th></tr><tr><td>A</td><td><p class="x-p"><code class="x-inline-highlight">10.0.0.0</code>~<code class="x-inline-highlight">10.255.255.255</code></p></td></tr><tr><td>B</td><td><p class="x-p"><code class="x-inline-highlight">172.16.0.0</code>~<code class="x-inline-highlight">172.31.255.255</code></p></td></tr><tr><td>C</td><td><p class="x-p"><code class="x-inline-highlight">192.168.0.0</code>~<code class="x-inline-highlight">192.168.255.255</code></p></td></tr></tbody></table><p class="x-p">这样的私有地址仅对本地网络中的设备有意义。但既然如此，想在互联网上发送或接收数据时，该如何处理编址呢？这需要用到<span class="x-inline-strong">网络地址转换</span><code class="x-inline-highlight">(Network Address Translation, NAT)</code>，NAT可以将内网的IP地址映射到互联网上的IP地址。从某种角度，NAT使得路由器对外界隐藏了本地网络的细节。</p><h3 class="x-h2">IPv6编址</h3><p class="x-p">用IPv6来取代IPv4主要是为了解决IPv4地址用尽问题，同时IPv6也在其他方面对于IPv4有许多改进。<br>每个IPv6地址长度为<code class="x-inline-highlight">128</code>位，地址通常用<code class="x-inline-highlight">8</code>组四位十六进制数表示，例如<code class="x-inline-highlight">2001:0db8:86a3:08d3:1319:8a2e:0370:7344</code>。</p><p class="x-p no-margin-bottom">IPv6的地址有时可以省略，具体规则是：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">每组数字的前导<code class="x-inline-highlight">0</code>可以省略；</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">可以用<code class="x-inline-highlight">::</code>表示一组多组连续的<code class="x-inline-highlight">0</code>，但<span class="x-inline-strong">只能出现一次</span>。</p></div></div><p class="x-p with-margin-top no-margin-bottom">例如下面的IPv6地址是等价的：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">2001:0db8:00de:0000:0000:0000:0000:2e13</code></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">2001:db8:de:0:0:0:0:2e13</code></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">2001:db8:de::2e13</code></p></div></div><h3 class="x-h2">IPv6比IPv4的改进</h3><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/ip.abb499878a29c8a3d493.png" width="100%"></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">扩大了地址空间，从<code class="x-inline-highlight">8</code>位变为<code class="x-inline-highlight">32</code>位</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">IPv6移除了校验和字段，以减少每跳的处理时间</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">IPv6将可选字段移出首部字段，放在有效载荷的扩展首部中，路由器不对扩展首部进行检查，提高了处理效率</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">IPv6支持即插即用，不需要DHCP协议</p></div></div><h3 class="x-h2">动态主机配置协议 - DHCP</h3><p class="x-p"><span class="x-inline-strong">动态主机配置协议</span><code class="x-inline-highlight">(Dynamic Host Configuration Protocol, DHCP)</code>是使用UDP协议的应用层协议，用于自动给内网机器分配IP地址等信息。虽然可以手动给内网设备一个一个的分配IP地址，但这项任务通常由DHCP服务器完成。</p><p class="x-p no-margin-bottom">DHCP的四个步骤是：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><span class="x-inline-strong">DHCP发现</span><code class="x-inline-highlight">(DHCP Discover)</code><br>新加入主机的首要任务是发现一个要与其交互的DHCP服务器，这可以通过生成一个目的地址为<code class="x-inline-highlight">255.255.255.255</code>或者一个子网广播地址的UDP包实现。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><span class="x-inline-strong">DHCP提供</span><code class="x-inline-highlight">(DHCP Offer)</code><br>DHCP服务器提供一个IP租约。服务器租用期通常设置为几小时或几天。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><span class="x-inline-strong">DHCP请求</span><code class="x-inline-highlight">(DHCP Request)</code><br>当客户主机从一个或多个DHCP服务器的提供中选择了一个IP租约时，它必须告诉其他的DHCP服务器它已经接受了一个租约提供。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><span class="x-inline-strong">DHCP确认</span><code class="x-inline-highlight">(DHCP Acknowledge/ACK)</code><br>对DHCP Request报文进行响应，证实所要求的参数。一旦客户主机收到DHCP ACK后，配置过程就完成了。</p></div></div><h3 class="x-h2">地址解析协议 - ARP</h3><p class="x-p">在以太网协议中规定，同一局域网中的一台主机要和另一台主机进行直接通信，必须要知道目标主机的MAC地址，而网络层和运输层只关心目标主机的IP地址。<br><span class="x-inline-strong">地址解析协议</span><code class="x-inline-highlight">(Address Resolution Protocol, ARP)</code>用于完成网络层地址（例如IP地址）和链路层地址（即MAC地址）的转换。</p><h3 class="x-h2">互联网控制报文协议 - ICMP</h3><p class="x-p"><span class="x-inline-strong">互联网控制报文协议</span><code class="x-inline-highlight">(Internet Control Message Protocol, ICMP)</code>被主机和路由器用来彼此沟通网络层的信息，ICMP最典型的用途是差错报告，提供可能发生在通信环境中的各种问题反馈。通过这些信息，管理者可以对所发生的问题作出诊断，然后采取适当的措施解决。</p><h2 class="x-h1">运输层</h2><h3 class="x-h2">用户数据报协议 - UDP</h3><p class="x-p"><span class="x-inline-strong">用户数据报协议</span><code class="x-inline-highlight">(User Datagram Protocol, UDP)</code>提供无连接、不可靠的服务，支持单播、多播、广播；UDP面向报文，对应用进程交下来的报文既不合并也不拆分。</p><p class="x-p">UDP传输效率更高，其牺牲了可靠性来保证性能。UDP适用于实时应用，例如视频会议、电话等。<br>UDP首部开销小，只包括源端口、目的端口、长度、校验和共<code class="x-inline-highlight">8</code>字节。</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/tcpudp.1d957344327214e5afb4.jpg" width="600"></div><h3 class="x-h2">传输控制协议 - TCP</h3><p class="x-p"><span class="x-inline-strong">传输控制协议</span><code class="x-inline-highlight">(Transmission Control Protocol, TCP)</code>提供连接、可靠的服务，仅支持单播；TCP面向字节流，把应用进程交下来的报文仅当作字节流。</p><p class="x-p no-margin-bottom">TCP首部由<code class="x-inline-highlight">20</code>字节固定首部和最大<code class="x-inline-highlight">40</code>字节的扩展首部构成。下面是对一些字段的解释：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">序号、确认号、<code class="x-inline-highlight">ACK</code>标志位（在Flags中）：用于实现TCP可靠传输；确认号指出期望收到对方下一个TCP报文段的数据载荷的第一个字节的序号，同时也是对之前收到的所有数据的确认。只有当<code class="x-inline-highlight">ACK</code>取值为<code class="x-inline-highlight">1</code>时，确认号字段才有效。TCP规定在连接建立后所有传送的报文段都必须把<code class="x-inline-highlight">ACK</code>置<code class="x-inline-highlight">1</code>。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">数据偏移：占<code class="x-inline-highlight">4</code>位，以<code class="x-inline-highlight">4</code>字节为单位，用来指出TCP报文段的数据载荷部分的起始处距离TCP报文段的起始处有多远；这个字段实际上指出了TCP报文段的首部长度。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">SYN</code>标志位（在Flags中）：在TCP连接建立时用来同步序号。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><code class="x-inline-highlight">FIN</code>标志位（在Flags中）：用来释放TCP连接。</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">窗口：占<code class="x-inline-highlight">16</code>位，以字节为单位，用于流量控制；接收方给出的<span class="x-inline-strong">接收窗口</span>值是发送方设置其发送窗口的依据之一（另一个是<span class="x-inline-strong">拥塞窗口</span>）。</p></div></div><h4 class="x-h3">TCP连接建立</h4><p class="x-p">TCP通过三报文握手建立连接，目的是使双方能感知到对方的存在，同时协商一些参数。过程如下图所示：</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/tcp1.5ac0f05b271071a7f481.jpg" width="100%"></div><h4 class="x-h3">TCP连接释放</h4><p class="x-p">TCP通过四报文挥手释放连接。服务端响应客户端的释放请求后进入关闭等待状态，但如果TCP服务器进程还有数据要发送，服务端仍然会发送完最后的数据才会发送连接释放报文段。<br>客户端确认了连接释放报文段后，还要经过<code class="x-inline-highlight">2</code>倍<span class="x-inline-strong">最长报文段寿命</span><code class="x-inline-highlight">(Maximum Segment Lifetime, MSL)</code>才进入关闭状态，这是为了防止客户端确认报文丢失，如果直接进入关闭状态就无法接收到服务端重传的连接释放报文。过程如下图所示：</p><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/tcp2.3c91ff0725cda2b9428e.jpg" width="100%"></div><h4 class="x-h3">TCP可靠传输</h4><p class="x-p">TCP综合了GBN和SR的一些机制来实现可靠传输。</p><p class="x-p">TCP的接收方也会维护接收窗口，这点与SR类似；但TCP采用与GBN类似的累计确认。<br>需要注意的是，GBN中<code class="x-inline-highlight">ACK n</code>表示序号为<code class="x-inline-highlight">n</code>及其之前的分组都已经被正确接收，而TCP中<code class="x-inline-highlight">ACK n</code>表示序号为<code class="x-inline-highlight">n-1</code>及其之前的分组都已经被正确接收，接收方期望收到的最小序号的分组是序号<code class="x-inline-highlight">n</code>。</p><p class="x-p">如果接收方收到了失序到达的分组，会缓存这些分组（像SR一样），但不是对分组逐一确认，而是累计确认期望收到的最小序号的分组（类似GBN）。TCP同样只有一个超时计时器（像GBN一样），如果发生超时就会重传窗口内所有已发送但未得到确认的数据。</p><p class="x-p">不过，例如当发送方陆续发送序号<code class="x-inline-highlight">n</code>之后的分组，但却收到了重复的<code class="x-inline-highlight">ACK n</code>时，就可以判断分组<code class="x-inline-highlight">n</code>一定因为某些原因没有被接收方收到。 此时发送方可以不等到重传计时器超时，而是在收到<code class="x-inline-highlight">3</code>次重复确认后，就立即重传这个分组，这也被称为<span class="x-inline-strong">快重传</span>。</p><h4 class="x-h3">TCP流量控制</h4><p class="x-p">传输速度快固然是好事，但如果发送方传输速度超过了接收方的接收能力就会导致丢包。TCP流量控制就是接收方通过<code class="x-inline-highlight">ACK</code>设置头部中的窗口字段，根据自己接收缓存的大小，动态地调整发送方的发送窗口大小。</p><p class="x-p">一个特殊的情况是，当接收方通知发送方窗口大小为<code class="x-inline-highlight">0</code>时，发送方就不再会发送新的数据。此时发送方不收到接收方调整接收窗口的报文，双方就会陷入互相等待。因此TCP为每个连接设有一个持续计时器，只要TCP连接的一方收到对方的零窗口通知，就启动持续计时器；若持续计时器超时就发送一个零窗口探测报文，对方在确认探测报文时就给出现在的窗口值。</p><h4 class="x-h3">TCP拥塞控制</h4><p class="x-p">如果网络中对某一资源的需求超过了可用的资源，例如很多主机都向带宽有限的链路上发送数据，就会引起拥塞。TCP拥塞控制就是为了防止过多数据注入到网络当中。</p><div class="x-highlightblock highlight-background-golden"><h4 class="x-h3">拥塞控制与流量控制的区别</h4><p class="x-p no-margin-bottom">流量控制中接收方告知发送方的窗口大小称为<span class="x-inline-strong">接收窗口</span><code class="x-inline-highlight">(Receiver Window, rwnd)</code>，其反映了接收方的容量；<br>拥塞控制中发送方根据网络拥塞程度调整的发送窗口大小称为<span class="x-inline-strong">拥塞窗口</span><code class="x-inline-highlight">(Congestion Window, cwnd)</code>，其反映了当前网络容量。</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">流量控制是端到端的问题，由接收方主动控制发送方的发送窗口</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">拥塞控制是网络上的全局问题，由发送方主动根据对网络拥塞程度的估计调整发送窗口的值</p></div></div><p class="x-p">发送方发送窗口大小应该取<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mclose">)</span></span></span></span>。</p></div><div class="x-highlightblock highlight-background-gray"><h4 class="x-h3">拥塞控制的实现</h4><div class="x-image-wrapper x-image-invert"><img alt="img" loading="lazy" src="/static/media/tcp3.4142bfff0c6965122546.jpg" width="600"></div><h4 class="x-h3">慢开始</h4><p class="x-p">执行慢开始算法时拥塞窗口初始大小为<code class="x-inline-highlight">1</code>，同时要设定慢开始门限值（图中是<code class="x-inline-highlight">8</code>），拥塞窗口将指数增大到门限值。</p><h4 class="x-h3">拥塞避免</h4><p class="x-p no-margin-bottom">拥塞窗口增大到门限值后执行拥塞避免算法，此阶段拥塞窗口线性增加<code class="x-inline-highlight">1</code>。<br>随着拥塞窗口增大，可能会有报文段发生丢失，引起发送方重传计时器超时。因此发送方判断网络可能出现了拥塞，此时会：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">将慢开始门限值更新为发生拥塞时拥塞窗口的一半</p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">将拥塞窗口置为<code class="x-inline-highlight">1</code>，并重新开始执行慢开始算法</p></div></div><div class="x-divider"></div><p class="x-p">慢开始和拥塞避免算法是1988年<code class="x-inline-highlight">Tahoe</code>版本提出的TCP拥塞控制算法，1990年<code class="x-inline-highlight">Reno</code>版本又增加了快重传和快恢复。</p><h4 class="x-h3">快重传</h4><p class="x-p">快重传就是使发送方尽快进行重传，而不是等超时重传计时器超时再重传。见上文TCP可靠传输。</p><h4 class="x-h3">快恢复</h4><p class="x-p">发送方一旦收到<code class="x-inline-highlight">3</code>个重复的确认，就知道现在只是丢失了个别的报文段。于是不启动慢开始算法，而执行快恢复算法。<br>发送方将慢开始门限值和拥塞窗口大小调整为当前窗口大小的一半，并开始执行拥塞避免算法。</p></div><h2 class="x-h1">参考资料</h2><p class="x-p no-margin-bottom">本文的部分内容、图片来源于：</p><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><a href="https://www.bilibili.com/video/BV19E411D78Q" class="x-inline-link" rel="noreferrer" target="_blank">Bilibili - 王道计算机考研 计算机网络</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p"><a href="https://www.bilibili.com/video/BV1c4411d7jb" class="x-inline-link" rel="noreferrer" target="_blank">Bilibili - 计算机网络微课堂</a></p></div></div><div class="x-uli"><div class="x-uli-marker"><div class="x-uli-marker-dot"></div></div><div class="x-uli-content-wrapper"><p class="x-p">《计算机网络自顶向下方法》（第七版）</p></div></div></div><div id="sidebar"><div class="sidebar-list show-list"><div class="sidebar-list-head"><h3 class="sidebar-list-category">网络杂识 (4)</h3><div class="sidebar-list-category-rightarrow"><svg height="16px" viewBox="0 0 1024 1024" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M761.056 532.128c.512-.992 1.344-1.824 1.792-2.848 8.8-18.304 5.92-40.704-9.664-55.424L399.936 139.744c-19.264-18.208-49.632-17.344-67.872 1.888-18.208 19.264-17.376 49.632 1.888 67.872l316.96 299.84L335.2 813.632c-19.072 18.4-19.648 48.768-1.248 67.872 9.408 9.792 21.984 14.688 34.56 14.688 12 0 24-4.48 33.312-13.44l350.048-337.376c.672-.672.928-1.6 1.6-2.304.512-.48 1.056-.832 1.568-1.344 2.72-2.848 4.16-6.336 6.016-9.6z" fill="#50505c"></path></svg></div></div><div class="sidebar-list-ul-wrapper"><ul class="sidebar-list-ul"><li class="sidebar-list-li"><a href="/23d/database-3nf/" class="sidebar-list-link"><span class="sidebar-list-title">数据库设计三大范式</span></a></li><li class="sidebar-list-li"><a href="/23d/github-linguist-vendored/" class="sidebar-list-link"><span class="sidebar-list-title">不统计Github仓库某个目录下的语言</span></a></li><li class="sidebar-list-li"><a href="/24a/deepl-shortcut-setting/" class="sidebar-list-link"><span class="sidebar-list-title">解决：DeepL该快捷键已被使用</span></a></li><li class="sidebar-list-li"><a href="/24a/git-merge-allow-unrelated-histories/" class="sidebar-list-link"><span class="sidebar-list-title">记录：使用--allow-unrelated-histories</span></a></li></ul></div></div><div class="sidebar-list show-list"><div class="sidebar-list-head"><h3 class="sidebar-list-category">算法 (8)</h3><div class="sidebar-list-category-rightarrow"><svg height="16px" viewBox="0 0 1024 1024" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M761.056 532.128c.512-.992 1.344-1.824 1.792-2.848 8.8-18.304 5.92-40.704-9.664-55.424L399.936 139.744c-19.264-18.208-49.632-17.344-67.872 1.888-18.208 19.264-17.376 49.632 1.888 67.872l316.96 299.84L335.2 813.632c-19.072 18.4-19.648 48.768-1.248 67.872 9.408 9.792 21.984 14.688 34.56 14.688 12 0 24-4.48 33.312-13.44l350.048-337.376c.672-.672.928-1.6 1.6-2.304.512-.48 1.056-.832 1.568-1.344 2.72-2.848 4.16-6.336 6.016-9.6z" fill="#50505c"></path></svg></div></div><div class="sidebar-list-ul-wrapper"><ul class="sidebar-list-ul"><li class="sidebar-list-li"><a href="/24a/cpp-stl/" class="sidebar-list-link"><span class="sidebar-list-title">C++中STL的基本使用</span></a></li><li class="sidebar-list-li"><a href="/24a/csp-2016-04/" class="sidebar-list-link"><span class="sidebar-list-title">CSP 201604 T1-T4题解</span></a></li><li class="sidebar-list-li"><a href="/24a/csp-2018-03/" class="sidebar-list-link"><span class="sidebar-list-title">CSP 201803 T1-T4题解</span></a></li><li class="sidebar-list-li"><a href="/24a/csp-2020-06/" class="sidebar-list-link"><span class="sidebar-list-title">CSP 202006 T1-T4题解</span></a></li><li class="sidebar-list-li"><a href="/24a/csp-2020-09/" class="sidebar-list-link"><span class="sidebar-list-title">CSP 202009 T1-T4题解</span></a></li><li class="sidebar-list-li"><a href="/24a/csp-2020-12/" class="sidebar-list-link"><span class="sidebar-list-title">CSP 202012 T1-T5题解</span></a></li><li class="sidebar-list-li"><a href="/24a/csp-2023-05/" class="sidebar-list-link"><span class="sidebar-list-title">CSP 202305 T1-T4题解</span></a></li><li class="sidebar-list-li"><a href="/24a/csp-2023-09/" class="sidebar-list-link"><span class="sidebar-list-title">CSP 202309 T1-T4题解</span></a></li></ul></div></div><div class="sidebar-list show-list"><div class="sidebar-list-head"><h3 class="sidebar-list-category">深度学习 (5)</h3><div class="sidebar-list-category-rightarrow"><svg height="16px" viewBox="0 0 1024 1024" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M761.056 532.128c.512-.992 1.344-1.824 1.792-2.848 8.8-18.304 5.92-40.704-9.664-55.424L399.936 139.744c-19.264-18.208-49.632-17.344-67.872 1.888-18.208 19.264-17.376 49.632 1.888 67.872l316.96 299.84L335.2 813.632c-19.072 18.4-19.648 48.768-1.248 67.872 9.408 9.792 21.984 14.688 34.56 14.688 12 0 24-4.48 33.312-13.44l350.048-337.376c.672-.672.928-1.6 1.6-2.304.512-.48 1.056-.832 1.568-1.344 2.72-2.848 4.16-6.336 6.016-9.6z" fill="#50505c"></path></svg></div></div><div class="sidebar-list-ul-wrapper"><ul class="sidebar-list-ul"><li class="sidebar-list-li"><a href="/longtime/papers/" class="sidebar-list-link"><span class="sidebar-list-title">论文速记</span></a></li><li class="sidebar-list-li"><a href="/23d/r2plus1d/" class="sidebar-list-link"><span class="sidebar-list-title">行为识别R(2+1)D网络</span></a></li><li class="sidebar-list-li"><a href="/23d/object-detection-map/" class="sidebar-list-link"><span class="sidebar-list-title">目标检测评价指标mAP</span></a></li><li class="sidebar-list-li"><a href="/23d/learn-rnn-lstm/" class="sidebar-list-link"><span class="sidebar-list-title">学习RNN和LSTM</span></a></li><li class="sidebar-list-li"><a href="/24a/reproduce-nerf-rpn/" class="sidebar-list-link"><span class="sidebar-list-title">记录：复现NeRF-RPN代码</span></a></li></ul></div></div><div class="sidebar-list show-list"><div class="sidebar-list-head"><h3 class="sidebar-list-category">Python学习 (2)</h3><div class="sidebar-list-category-rightarrow"><svg height="16px" viewBox="0 0 1024 1024" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M761.056 532.128c.512-.992 1.344-1.824 1.792-2.848 8.8-18.304 5.92-40.704-9.664-55.424L399.936 139.744c-19.264-18.208-49.632-17.344-67.872 1.888-18.208 19.264-17.376 49.632 1.888 67.872l316.96 299.84L335.2 813.632c-19.072 18.4-19.648 48.768-1.248 67.872 9.408 9.792 21.984 14.688 34.56 14.688 12 0 24-4.48 33.312-13.44l350.048-337.376c.672-.672.928-1.6 1.6-2.304.512-.48 1.056-.832 1.568-1.344 2.72-2.848 4.16-6.336 6.016-9.6z" fill="#50505c"></path></svg></div></div><div class="sidebar-list-ul-wrapper"><ul class="sidebar-list-ul"><li class="sidebar-list-li"><a href="/24a/torch-numpy-topk/" class="sidebar-list-link"><span class="sidebar-list-title">在pytorch和numpy中取top-k值和索引</span></a></li><li class="sidebar-list-li"><a href="/24a/object-oriented-programming-python/" class="sidebar-list-link"><span class="sidebar-list-title">Python面向对象编程</span></a></li></ul></div></div><div class="sidebar-list show-list"><div class="sidebar-list-head"><h3 class="sidebar-list-category">前端与JavaScript (2)</h3><div class="sidebar-list-category-rightarrow"><svg height="16px" viewBox="0 0 1024 1024" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M761.056 532.128c.512-.992 1.344-1.824 1.792-2.848 8.8-18.304 5.92-40.704-9.664-55.424L399.936 139.744c-19.264-18.208-49.632-17.344-67.872 1.888-18.208 19.264-17.376 49.632 1.888 67.872l316.96 299.84L335.2 813.632c-19.072 18.4-19.648 48.768-1.248 67.872 9.408 9.792 21.984 14.688 34.56 14.688 12 0 24-4.48 33.312-13.44l350.048-337.376c.672-.672.928-1.6 1.6-2.304.512-.48 1.056-.832 1.568-1.344 2.72-2.848 4.16-6.336 6.016-9.6z" fill="#50505c"></path></svg></div></div><div class="sidebar-list-ul-wrapper"><ul class="sidebar-list-ul"><li class="sidebar-list-li"><a href="/23c/js-array/" class="sidebar-list-link"><span class="sidebar-list-title">JavaScript数组常用方法</span></a></li><li class="sidebar-list-li"><a href="/23d/css-auto-height-transition/" class="sidebar-list-link"><span class="sidebar-list-title">CSS实现auto高度的过渡动画</span></a></li></ul></div></div><div class="sidebar-list show-list"><div class="sidebar-list-head"><h3 class="sidebar-list-category">课程 (11)</h3><div class="sidebar-list-category-rightarrow"><svg height="16px" viewBox="0 0 1024 1024" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M761.056 532.128c.512-.992 1.344-1.824 1.792-2.848 8.8-18.304 5.92-40.704-9.664-55.424L399.936 139.744c-19.264-18.208-49.632-17.344-67.872 1.888-18.208 19.264-17.376 49.632 1.888 67.872l316.96 299.84L335.2 813.632c-19.072 18.4-19.648 48.768-1.248 67.872 9.408 9.792 21.984 14.688 34.56 14.688 12 0 24-4.48 33.312-13.44l350.048-337.376c.672-.672.928-1.6 1.6-2.304.512-.48 1.056-.832 1.568-1.344 2.72-2.848 4.16-6.336 6.016-9.6z" fill="#50505c"></path></svg></div></div><div class="sidebar-list-ul-wrapper"><ul class="sidebar-list-ul"><li class="sidebar-list-li"><a href="/23c/pattern-recognition-1/" class="sidebar-list-link"><span class="sidebar-list-title">【模式识别】统计决策方法</span></a></li><li class="sidebar-list-li"><a href="/23c/pattern-recognition-2/" class="sidebar-list-link"><span class="sidebar-list-title">【模式识别】参数估计</span></a></li><li class="sidebar-list-li"><a href="/23c/pattern-recognition-3/" class="sidebar-list-link"><span class="sidebar-list-title">【模式识别】非参数估计</span></a></li><li class="sidebar-list-li"><a href="/23d/pattern-recognition-4/" class="sidebar-list-link"><span class="sidebar-list-title">【模式识别】线性学习器与线性分类器</span></a></li><li class="sidebar-list-li active"><a href="/23d/protocols/" class="sidebar-list-link"><span class="sidebar-list-title">【计算机网络】协议总结</span></a></li><li class="sidebar-list-li"><a href="/24a/machine-learning-exercises/" class="sidebar-list-link"><span class="sidebar-list-title">【机器学习】习题</span></a></li><li class="sidebar-list-li"><a href="/24a/games101-01-transformation/" class="sidebar-list-link"><span class="sidebar-list-title">【GAMES101】Transformation</span></a></li><li class="sidebar-list-li"><a href="/24a/games101-02-rasterization/" class="sidebar-list-link"><span class="sidebar-list-title">【GAMES101】Rasterization</span></a></li><li class="sidebar-list-li"><a href="/24a/games101-03-shading/" class="sidebar-list-link"><span class="sidebar-list-title">【GAMES101】Shading</span></a></li><li class="sidebar-list-li"><a href="/24a/games101-04-geometry/" class="sidebar-list-link"><span class="sidebar-list-title">【GAMES101】Geometry</span></a></li><li class="sidebar-list-li"><a href="/24a/games101-05-ray-tracing/" class="sidebar-list-link"><span class="sidebar-list-title">【GAMES101】Ray Tracing</span></a></li></ul></div></div><div class="sidebar-list show-list"><div class="sidebar-list-head"><h3 class="sidebar-list-category">其他 (2)</h3><div class="sidebar-list-category-rightarrow"><svg height="16px" viewBox="0 0 1024 1024" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M761.056 532.128c.512-.992 1.344-1.824 1.792-2.848 8.8-18.304 5.92-40.704-9.664-55.424L399.936 139.744c-19.264-18.208-49.632-17.344-67.872 1.888-18.208 19.264-17.376 49.632 1.888 67.872l316.96 299.84L335.2 813.632c-19.072 18.4-19.648 48.768-1.248 67.872 9.408 9.792 21.984 14.688 34.56 14.688 12 0 24-4.48 33.312-13.44l350.048-337.376c.672-.672.928-1.6 1.6-2.304.512-.48 1.056-.832 1.568-1.344 2.72-2.848 4.16-6.336 6.016-9.6z" fill="#50505c"></path></svg></div></div><div class="sidebar-list-ul-wrapper"><ul class="sidebar-list-ul"><li class="sidebar-list-li"><a href="/longtime/demo/" class="sidebar-list-link"><span class="sidebar-list-title">示例</span></a></li><li class="sidebar-list-li"><a href="/longtime/updates/" class="sidebar-list-link"><span class="sidebar-list-title">更新日志</span></a></li></ul></div></div></div><div id="sidebar-mask"></div><div id="contents"><h4 id="contents-header">本页目录</h4><ul><li class="titletype-x-h1 active">链路层</li><li class="titletype-x-h2">可靠传输</li><li class="titletype-x-h2">停等协议 - SW</li><li class="titletype-x-h2">回退N帧协议 - GBN</li><li class="titletype-x-h2">选择重传协议 - SR</li><li class="titletype-x-h2">媒体接入控制</li><li class="titletype-x-h2">载波监听多路访问 - CSMA</li><li class="titletype-x-h2">碰撞检测 - CSMA/CD</li><li class="titletype-x-h2">碰撞避免 - CSMA/CA</li><li class="titletype-x-h1">网络层</li><li class="titletype-x-h2">自治系统、IGP和EGP</li><li class="titletype-x-h2">路由信息协议 - RIP</li><li class="titletype-x-h2">开放最短路径优先 - OSPF</li><li class="titletype-x-h2">边界网关协议 - BGP</li><li class="titletype-x-h2">IPv4编址</li><li class="titletype-x-h2">IPv6编址</li><li class="titletype-x-h2">IPv6比IPv4的改进</li><li class="titletype-x-h2">动态主机配置协议 - DHCP</li><li class="titletype-x-h2">地址解析协议 - ARP</li><li class="titletype-x-h2">互联网控制报文协议 - ICMP</li><li class="titletype-x-h1">运输层</li><li class="titletype-x-h2">用户数据报协议 - UDP</li><li class="titletype-x-h2">传输控制协议 - TCP</li><li class="titletype-x-h1">参考资料</li></ul></div></div></div></body></html>